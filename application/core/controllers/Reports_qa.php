<?php 

 class Reports_qa extends CI_Controller{
	
	public function __construct(){
		parent::__construct();
		$this->load->model('user_model');
		$this->load->model('Common_model');
		$this->load->model('reports_model');
		$this->load->model('Qa_welcomepickup_model');
		$this->load->model('Qa_RPM_Sentry_model');
		$this->load->model('QA_Servicerequest_model');
		$this->load->model('Qa_checkpoint_model');
		$this->load->model('Qa_checkpoint_chat_model');
		$this->load->model('Profile_model');
		$this->load->helper(array('form', 'url'));
		$this->load->model('Qa_verso_model');
		$this->load->model('Dfr_model');
		$this->reports_model->set_report_database("report");
		$this->load->model('Qa_vrs_model');
		$this->load->model('Qa_od_model');
		$this->load->library('excel');
		$this->objPHPExcel = new PHPExcel();
	}


////////////////////////////////////////////// VFS Report //////////////////////////////////////////////////

	public function qa_vfs_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_vfs_report.php";
			$data["content_js"] = "qa_od_js.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$campaign="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			$campaign = $this->input->get('campaign');
			
			$data["qa_vfs_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
		
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_vfs_".$campaign."_feedback) xx Left Join
				(Select id as sid, fname, lname, fusion_id, office_id, assigned_to, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_vfs_list"] = $fullAray;
				$this->create_qa_vfs_CSV($fullAray,$campaign);	
				$dn_link = base_url()."reports_qa/download_qa_vfs_CSV/".$campaign;
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['campaign']=$campaign;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_vfs_CSV($campaign)
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA VFS ".$campaign." Audit List-'".$currDate."'.csv";
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	
	public function create_qa_vfs_CSV($rr,$campaign)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		if($campaign=='chat'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Chat Date", "AHT", "Mission", "Recording ID", "Week", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Opening - a)Appropriate greeting as per script", "Technical aspects - a)Response Time", "Technical aspects - b)FCR achieved", "Technical aspects - c)Understand the issue of the applicant", "Technical aspects - d)Attentiveness displayed", "Technical aspects - e)Paraphrasing", "Technical aspects - f)Used all the available resources for providing resolution", "Technical aspects - g)Appropriate Probing", "Additions - a)Offers VAS options wherever applicable", "Additions - b)Awareness created with regards to VFS", "Documentation - a)Correct dispostion", "Documentation - b)Update ASM/V2", "Hold Protocol - a)Was Hold Required", "Hold Protocol - b)Hold Guidelines followed", "Communication - a)Formatting", "Communication - b)Avoid Negative statements", "Communication - c)Telling the customer what to do next", "Communication - d)Avoid Slangs & Jargons", "Communication - e)Correct and accurate grammar usage", "Communication - f)Further assistance", "Chat Closing - a)Adherence to chat closing script","used_applicant", "Fatal Parameter - a)Delayed opening", "Fatal Parameter - b)Rude on chat",  "Fatal Parameter - c)Incomplete Information", "Fatal Parameter - d)Complaint Avoidance","Comments","Comments 1","Comments 2","Comments 3","Comments 4","Comments 5","Comments 6","Comments 7","Comments 8","Comments 9","Comments 10","Comments 11","Comments 12","Comments 13","Comments 14","Comments 15","Comments 16","Comments 17","Comments 18","Comments 19","Comments 20","Comments 21","Comments 22","Comments 23","Comments 24","Comments 25", "Reason For Fatal Error", "Inprovement Area", "Chat Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		}else if($campaign=='call'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "AHT", "Mission", "Recording ID", "Week", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Opening - a)Appropriate greeting as per script", "Opening - b)Clear and Crisp opening", "Communication - a)Voice modulation", "Communication - b)Appropriate pace", "Communication - c)Courteous and professional", "Communication - d)Empathy on call", "Communication - e)Adjusted to customer language", "Communication - f)No jargons simple words used", "Communication - g)Active listening", "Communication - h)Paraprashing", "Communication - i)Grammatically correct sentences", "Technical aspects - a)Appropriate Probing", "Technical aspects - b)Escalate the issue wherever required", "Technical aspects - c)Call control", "Technical aspects - d)Query resolved on call FTR", "Additons - a)Offers VAS options wherever applicable", "Additons - b. Awareness created with regards to VFS", "Documentation - a)Correct dispostion", "Documentation - b)Update ASM V2", "Hold Protocol - a)Was Hold Required", "Hold Protocol - b)Hold Guidelines followed", "Hold Protocol - c)Dead Air <= 8 seconds", "Call Closing - a)Further assistance", "Call Closing - b)Attempt to take feedback on experience CSAT", "Call Closing - c)Adherence to call closing script", "Fatal Parameter - a)Delayed opening", "Fatal Parameter - b)Rude on chat", "Fatal Parameter - c)Incomplete/Inaccurate Information shared","used_applicant", "Fatal Parameter - d)Complaint Avoidance","Comments 1","Comments 2","Comments 3","Comments 4","Comments 5","Comments 6","Comments 7","Comments 8","Comments 9","Comments 10","Comments 11","Comments 12","Comments 13","Comments 14","Comments 15","Comments 16","Comments 17","Comments 18","Comments 19","Comments 20","Comments 21","Comments 22","Comments 23","Comments 24","Comments 25","Comments 26","Comments 27","Comments 28","Comments 29", "Reason For Fatal Error", "Inprovement Area", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		}else if($campaign=='email'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Email Date", "AHT", "Mission", "Recording ID", "Week", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Content Writing - a)a. Used one idea per paragraph", "Content Writing - b)Used bullet points where appropriate", "Content Writing - c)Adhered word limit per sentence", "Content Writing - d)Template Adherence where applicable", "Accuracy follow up - a)Interim response provided", "Accuracy follow up - b)FCR achieved", "Accuracy follow up - c)Understand the issue of the applicant", "Accuracy follow up - d)Attentiveness displayed", "Accuracy follow up - e)Used all the available resources for providing resolution", "Accuracy follow up - f)Standardized subject line on trail mails", "Additions - a)Offers VAS options wherever applicable", "Additions - b)Awareness created with regards to VFS website", "Documentation - a)Correct dispostion", "Documentation - b)Update ASM V2", "Composition - a)Formatting", "Composition - b)Shows respect and makes the customer feel valued", "Composition - c)Telling the customer what to do next", "Composition - d)Avoid Slangs & Jargons", "Composition - e)Correct and accurate grammar usage", "Composition - f)Correct closing", "Composition - g)Further assistance", "Fatal Parameter - a)Rude or unprofessional on email","used_applicant", "Fatal Parameter - b)Incomplete", "Fatal Parameter - c)Email hygiene", "Fatal Parameter - d)Complaint Avoidance","Comments 1","Comments 2","Comments 3","Comments 4","Comments 5","Comments 6","Comments 7","Comments 8","Comments 9","Comments 10","Comments 11","Comments 12","Comments 13","Comments 14","Comments 15","Comments 16","Comments 17","Comments 18","Comments 19","Comments 20","Comments 21","Comments 22","Comments 23","Comments 24","Comments 25","Comments 26", "Reason For Fatal Error", "Inprovement Area", "Email Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		}
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		if($campaign=='chat'){
			
			foreach($rr as $user){	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
			
				$row = '"'.$auditorName.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['mission'].'",';
				$row .= '"'.$user['recording_id'].'",';
				$row .= '"'.$user['week'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['appropiate_greeting'].'",';
				$row .= '"'.$user['response_time'].'",';
				$row .= '"'.$user['FCR_achieved'].'",';
				$row .= '"'.$user['understand_issue'].'",';
				$row .= '"'.$user['attentiveness_display'].'",';
				$row .= '"'.$user['paraphrasing'].'",';
				$row .= '"'.$user['use_available_resource'].'",';
				$row .= '"'.$user['appropiate_probing'].'",';
				$row .= '"'.$user['VAS_options'].'",';
				$row .= '"'.$user['awareness_created'].'",';
				$row .= '"'.$user['correct_disposition'].'",';
				$row .= '"'.$user['update_ASM'].'",';
				$row .= '"'.$user['hold_required'].'",';
				$row .= '"'.$user['hold_guidelines'].'",';
				$row .= '"'.$user['formatting'].'",';
				$row .= '"'.$user['avoid_negative_statement'].'",';
				$row .= '"'.$user['procedure_guide_step'].'",';
				$row .= '"'.$user['avoid_slangs'].'",';
				$row .= '"'.$user['correct_grammar_use'].'",';
				$row .= '"'.$user['further_assistance'].'",';
				$row .= '"'.$user['chat_adherence'].'",';
				$row .= '"'.$user['used_applicant'].'",';
				$row .= '"'.$user['delayed_opening'].'",';
				$row .= '"'.$user['rude_on_chat'].'",';
				$row .= '"'.$user['inacurate_information'].'",';
				$row .= '"'.$user['complaint_avoidance'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm0'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm1'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm2'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm3'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm4'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm5'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm6'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm7'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm8'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm9'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm10'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm11'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm12'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm13'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm14'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm15'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm16'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm17'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm18'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm19'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm20'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm21'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm22'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm23'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm24'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm25'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['reason_for_fatal'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['inprovement_area'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_date'].'",';
				$row .= '"'.$user['client_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';	
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		
		}if($campaign=='call'){
			
			foreach($rr as $user){	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
			
				$row = '"'.$auditorName.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['mission'].'",';
				$row .= '"'.$user['recording_id'].'",';
				$row .= '"'.$user['week'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['appropiate_greeting'].'",';
				$row .= '"'.$user['clear_opening'].'",';
				$row .= '"'.$user['voice_modulation'].'",';
				$row .= '"'.$user['appropiate_pace'].'",';
				$row .= '"'.$user['professional_courteous'].'",';
				$row .= '"'.$user['call_empathy'].'",';
				$row .= '"'.$user['adjust_customer_language'].'",';
				$row .= '"'.$user['simple_word_used'].'",';
				$row .= '"'.$user['active_listening'].'",';
				$row .= '"'.$user['paraprasing'].'",';
				$row .= '"'.$user['avoid_fumbling'].'",';
				$row .= '"'.$user['appropiate_probing'].'",';
				$row .= '"'.$user['escalate_issue'].'",';
				$row .= '"'.$user['call_control'].'",';
				$row .= '"'.$user['query_resolved'].'",';
				$row .= '"'.$user['offers_VAS'].'",';
				$row .= '"'.$user['awareness_created'].'",';
				$row .= '"'.$user['correct_disposition'].'",';
				$row .= '"'.$user['update_ASM'].'",';
				$row .= '"'.$user['hold_required'].'",';
				$row .= '"'.$user['hold_guidelines'].'",';
				$row .= '"'.$user['dead_air_8sec'].'",';
				$row .= '"'.$user['further_assistance'].'",';
				$row .= '"'.$user['CSAT_experience_feedback'].'",';
				$row .= '"'.$user['call_adherence'].'",';
				$row .= '"'.$user['used_applicant'].'",';
				$row .= '"'.$user['delayed_opening'].'",';
				$row .= '"'.$user['rude_on_call'].'",';
				$row .= '"'.$user['incomplete_information'].'",';
				$row .= '"'.$user['complaint_avoidance'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm1'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm2'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm3'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm4'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm5'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm6'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm7'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm8'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm9'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm10'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm11'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm12'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm13'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm14'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm15'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm16'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm17'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm18'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm19'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm20'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm21'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm22'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm23'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm24'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm25'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm26'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm27'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm28'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm29'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['reason_for_fatal'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['inprovement_area'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_date'].'",';
				$row .= '"'.$user['client_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';	
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}if($campaign=='email'){
			
			foreach($rr as $user){	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
			
				$row = '"'.$auditorName.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['mission'].'",';
				$row .= '"'.$user['recording_id'].'",';
				$row .= '"'.$user['week'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['use_paragraph_idea'].'",';
				$row .= '"'.$user['use_bullet_point'].'",';
				$row .= '"'.$user['adhered_word_limit'].'",';
				$row .= '"'.$user['template_adherence'].'",';
				$row .= '"'.$user['interim_responce'].'",';
				$row .= '"'.$user['FCR_achieved'].'",';
				$row .= '"'.$user['understand_issue'].'",';
				$row .= '"'.$user['attentiveness_display'].'",';
				$row .= '"'.$user['use_available_resource'].'",';
				$row .= '"'.$user['standardized_subject'].'",';
				$row .= '"'.$user['VAS_option'].'",';
				$row .= '"'.$user['awarreness_created'].'",';
				$row .= '"'.$user['correct_disposition'].'",';
				$row .= '"'.$user['update_ASM'].'",';
				$row .= '"'.$user['formatting'].'",';
				$row .= '"'.$user['show_customer_feel_value'].'",';
				$row .= '"'.$user['procedure_guide_step'].'",';
				$row .= '"'.$user['avoid_slangs'].'",';
				$row .= '"'.$user['correct_grammar_use'].'",';
				$row .= '"'.$user['correct_closing'].'",';
				$row .= '"'.$user['further_assistance'].'",';
				$row .= '"'.$user['used_applicant'].'",';
				$row .= '"'.$user['rude_on_email'].'",';
				$row .= '"'.$user['inacurate_information'].'",';
				$row .= '"'.$user['email_hygiene'].'",';
				$row .= '"'.$user['complaint_avoidance'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm1'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm2'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm3'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm4'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm5'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm6'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm7'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm8'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm9'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm10'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm11'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm12'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm13'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm14'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm15'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm16'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm17'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm18'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm19'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm20'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm21'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm22'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm23'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm24'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm25'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comm26'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['reason_for_fatal'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['inprovement_area'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_date'].'",';
				$row .= '"'.$user['client_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';	
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}
		
	}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////// Biomet Report //////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////////
		public function qa_biomet_report(){
			if(check_logged_in()){
				$user_office_id=get_user_office_id();
				$current_user = get_user_id();
				$is_global_access=get_global_access();
				$role_dir=get_role_dir();
				$data["show_download"] = false;
				$data["download_link"] = "";
				$data["show_table"] = false;
				$data["show_table"] = false;
				$data["aside_template"] = "reports/aside.php";
				$data["content_template"] = "reports_qa/qa_biomet_report.php";
				$data["content_js"] = "qa_biomet_js.php";
				
				$data['location_list'] = $this->Common_model->get_office_location_list();
				
				$office_id = "";
				$date_from="";
				$date_to="";
				$campaign="";
				$action="";
				$dn_link="";
				$cond="";
				$cond1="";
				
				$campaign = $this->input->get('campaign');
				
				$data["qa_biomet_list"] = array();
				
				if($this->input->get('show')=='Show')
				{
					$date_from = mmddyy2mysql($this->input->get('date_from'));
					$date_to = mmddyy2mysql($this->input->get('date_to'));
					$office_id = $this->input->get('office_id');
					
					if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
			
					if($office_id=="All") $cond .= "";
					else $cond .=" and office_id='$office_id'";
					
					if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
						$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
					}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
						$cond1 .=" And assigned_to='$current_user'";
					}else{
						$cond1 .="";
					}
			
					$qSql="SELECT * from
					(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
					(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
					(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
					(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
					(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_biomet_".$campaign."_feedback) xx Left Join
					(Select id as sid, fname, lname, fusion_id, office_id, assigned_to, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
					
					$fullAray = $this->Common_model->get_query_result_array($qSql);
					$data["qa_biomet_list"] = $fullAray;
					$this->create_qa_biomet_CSV($fullAray,$campaign);	
					$dn_link = base_url()."reports_qa/download_qa_biomet_CSV/".$campaign;
				}
				
				$data['download_link']=$dn_link;
				$data["action"] = $action;	
				$data['date_from'] = $date_from;
				$data['date_to'] = $date_to;	
				$data['office_id']=$office_id;
				$data['campaign']=$campaign;
				
				$this->load->view('dashboard',$data);
			}
		}	
		 
	
		public function download_qa_biomet_CSV($campaign)
		{
			$currDate=date("Y-m-d");
			$filename = "./assets/reports/Report".get_user_id().".csv";
			$newfile="QA biomet ".$campaign." Audit List-'".$currDate."'.csv";
			header('Content-Disposition: attachment;  filename="'.$newfile.'"');
			readfile($filename);
		}
		
		
		public function create_qa_biomet_CSV($rr,$campaign)
		{
			$filename = "./assets/reports/Report".get_user_id().".csv";
			$fopen = fopen($filename,"w+");
			
			if($campaign=='chat'){
				$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Chat Date", "AHT", "Mission", "Recording ID", "Week", "Audit Type", "VOC", "Audit Date Time", "Interval(In Second)", "Overall Score", "Opening - a)Appropriate greeting as per script", "Technical aspects - a)Response Time", "Technical aspects - b)FCR achieved", "Technical aspects - c)Understand the issue of the applicant", "Technical aspects - d)Attentiveness displayed", "Technical aspects - e)Paraphrasing", "Technical aspects - f)Used all the available resources for providing resolution", "Technical aspects - g)Appropriate Probing", "Additions - a)Offers VAS options wherever applicable", "Additions - b)Awareness created with regards to VFS", "Documentation - a)Correct dispostion", "Documentation - b)Correct disposition sub-type","Documentation - c)Captured response query precisely", "Hold Protocol - a)Was Hold Required", "Hold Protocol - b)Hold Guidelines followed", "Communication - a)Formatting", "Communication - b)Avoid Negative statements", "Communication - c)Telling the customer what to do next", "Communication - d)Avoid Slangs & Jargons", "Communication - e)Correct and accurate grammar usage", "Communication - f)Further assistance", "Chat Closing - a)Adherence to chat closing script", "Fatal Parameter - a)Delayed opening", "Fatal Parameter - b)Rude on chat",  "Fatal Parameter - c)Incomplete Information", "Fatal Parameter - d)Complaint Avoidance", "Reason For Fatal Error", "Improvement Area", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
			}else if($campaign=='call'){
				$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Chat Date", "AHT", "Mission", "Recording ID", "Week", "Audit Type", "VOC", "Audit Date Time", "Interval(In Second)", "Overall Score", "Opening - a)Appropriate greeting as per script", "Opening - b)Clear and Crisp opening", "Communication - a)Voice modulation", "Communication - b)Appropriate pace", "Communication - c)Courteous and professional", "Communication - d)Empathy on call", "Communication - e)Adjusted to customer language", "Communication - f)No jargons simple words used", "Communication - g)Active listening", "Communication - h)Paraprashing", "Communication - i)Grammatically correct sentences", "Technical aspects - a)Appropriate Probing", "Technical aspects - b)Escalate the issue wherever required", "Technical aspects - c)Call control", "Technical aspects - d)Query resolved on call FTR", "Additons - a)Offers VAS options wherever applicable", "Additons - b. Awareness created with regards to VFS", "Documentation - a)Correct dispostion", "Documentation - b)Correct disposition sub-type","Documentation - c)Captured response query precisely", "Hold Protocol - a)Was Hold Required", "Hold Protocol - b)Hold Guidelines followed", "Hold Protocol - c)Dead Air <= 8 seconds", "Call Closing - a)Further assistance", "Call Closing - b)Attempt to take feedback on experience CSAT", "Call Closing - c)Adherence to call closing script", "Fatal Parameter - a)Delayed opening", "Fatal Parameter - b)Rude on chat", "Fatal Parameter - c)Incomplete/Inaccurate Information shared", "Fatal Parameter - d)Complaint Avoidance", "Reason For Fatal Error", "Improvement Area", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
			}else if($campaign=='email'){
				$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Chat Date", "AHT", "Mission", "Recording ID", "Week", "Audit Type", "VOC", "Audit Date Time", "Interval(In Second)", "Overall Score", "Content Writing - a)a. Used one idea per paragraph", "Content Writing - b)Used bullet points where appropriate", "Content Writing - c)Adhered word limit per sentence", "Content Writing - d)Template Adherence where applicable", "Accuracy follow up - a)Interim response provided", "Accuracy follow up - b)FCR achieved", "Accuracy follow up - c)Understand the issue of the applicant", "Accuracy follow up - d)Attentiveness displayed", "Accuracy follow up - e)Used all the available resources for providing resolution", "Accuracy follow up - f)Standardized subject line on trail mails", "Additions - a)Offers VAS options wherever applicable", "Additions - b)Awareness created with regards to VFS website", "Documentation - a)Correct dispostion", "Documentation - b)Correct disposition sub-type","Documentation - c)Captured response query precisely", "Composition - a)Formatting", "Composition - b)Shows respect and makes the customer feel valued", "Composition - c)Telling the customer what to do next", "Composition - d)Avoid Slangs & Jargons", "Composition - e)Correct and accurate grammar usage", "Composition - f)Correct closing", "Fatal Parameter - a)Rude or unprofessional on email", "Fatal Parameter - b)Incomplete", "Fatal Parameter - c)Email hygiene", "Fatal Parameter - d)Complaint Avoidance", "Reason For Fatal Error", "Improvement Area", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
			}
			
			$row = "";
			foreach($header as $data) $row .= ''.$data.',';
			fwrite($fopen,rtrim($row,",")."\r\n");
			$searches = array("\r", "\n", "\r\n");
			
			if($campaign=='chat'){
				
				foreach($rr as $user){	
					if($user['entry_by']!=''){
						$auditorName = $user['auditor_name'];
					}else{
						$auditorName = $user['client_name'];
					}
					
					if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
						$interval1 = '---';
					}else{
						$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
					}
				
					$row = '"'.$auditorName.'",'; 
					$row .= '"'.$user['audit_date'].'",'; 
					$row .= '"'.$user['fusion_id'].'",'; 
					$row .= '"'.$user['fname']." ".$user['lname'].'",';
					$row .= '"'.$user['tl_name'].'",';
					$row .= '"'.$user['call_date'].'",';
					$row .= '"'.$user['call_duration'].'",';
					$row .= '"'.$user['mission'].'",';
					$row .= '"'.$user['recording_id'].'",';
					$row .= '"'.$user['week'].'",';
					$row .= '"'.$user['audit_type'].'",';
					$row .= '"'.$user['voc'].'",';
					// $row .= '"'.$user['audit_start_time'].'",';
					$row .= '"'.$user['entry_date'].'",';
					$row .= '"'.$interval1.'",';
					$row .= '"'.$user['overall_score'].'%'.'",';
					$row .= '"'.$user['appropiate_greeting'].'",';
					$row .= '"'.$user['response_time'].'",';
					$row .= '"'.$user['FCR_achieved'].'",';
					$row .= '"'.$user['understand_issue'].'",';
					$row .= '"'.$user['attentiveness_display'].'",';
					$row .= '"'.$user['paraphrasing'].'",';
					$row .= '"'.$user['use_available_resource'].'",';
					$row .= '"'.$user['appropiate_probing'].'",';
					$row .= '"'.$user['VAS_options'].'",';
					$row .= '"'.$user['awareness_created'].'",';
					$row .= '"'.$user['correct_disposition'].'",';
					$row .= '"'.$user['update_ASM'].'",';
					$row .= '"'.$user['capture_query'].'",';
					$row .= '"'.$user['hold_required'].'",';
					$row .= '"'.$user['hold_guidelines'].'",';
					$row .= '"'.$user['formatting'].'",';
					$row .= '"'.$user['avoid_negative_statement'].'",';
					$row .= '"'.$user['procedure_guide_step'].'",';
					$row .= '"'.$user['avoid_slangs'].'",';
					$row .= '"'.$user['correct_grammar_use'].'",';
					$row .= '"'.$user['further_assistance'].'",';
					$row .= '"'.$user['chat_adherence'].'",';
					
					$row .= '"'.$user['delayed_opening'].'",';
					$row .= '"'.$user['rude_on_chat'].'",';
					$row .= '"'.$user['inacurate_information'].'",';
					$row .= '"'.$user['complaint_avoidance'].'",';
					
					$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['reason_for_fatal'])).'",';
					$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['improvement_area'])).'",';
					
					$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
					$row .= '"'.$user['agent_rvw_date'].'",';
					$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
					$row .= '"'.$user['mgnt_rvw_date'].'",';
					$row .= '"'.$user['mgnt_rvw_name'].'",';
					$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
					$row .= '"'.$user['client_rvw_date'].'",';
					$row .= '"'.$user['client_rvw_name'].'",';
					$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';	
					fwrite($fopen,$row."\r\n");
				}
				fclose($fopen);
			
			}if($campaign=='call'){
				
				foreach($rr as $user){	
					if($user['entry_by']!=''){
						$auditorName = $user['auditor_name'];
					}else{
						$auditorName = $user['client_name'];
					}
					
					if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
						$interval1 = '---';
					}else{
						$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
					}
				
					$row = '"'.$auditorName.'",'; 
					$row .= '"'.$user['audit_date'].'",'; 
					$row .= '"'.$user['fusion_id'].'",'; 
					$row .= '"'.$user['fname']." ".$user['lname'].'",';
					$row .= '"'.$user['tl_name'].'",';
					$row .= '"'.$user['call_date'].'",';
					$row .= '"'.$user['call_duration'].'",';
					$row .= '"'.$user['mission'].'",';
					$row .= '"'.$user['recording_id'].'",';
					$row .= '"'.$user['week'].'",';
					$row .= '"'.$user['audit_type'].'",';
					$row .= '"'.$user['voc'].'",';
					// $row .= '"'.$user['audit_start_time'].'",';
					$row .= '"'.$user['entry_date'].'",';
					$row .= '"'.$interval1.'",';
					$row .= '"'.$user['overall_score'].'%'.'",';
					$row .= '"'.$user['appropiate_greeting'].'",';
					$row .= '"'.$user['clear_opening'].'",';
					$row .= '"'.$user['voice_modulation'].'",';
					$row .= '"'.$user['appropiate_pace'].'",';
					$row .= '"'.$user['professional_courteous'].'",';
					$row .= '"'.$user['call_empathy'].'",';
					$row .= '"'.$user['adjust_customer_language'].'",';
					$row .= '"'.$user['simple_word_used'].'",';
					$row .= '"'.$user['active_listening'].'",';
					$row .= '"'.$user['paraprasing'].'",';
					$row .= '"'.$user['avoid_fumbling'].'",';
					$row .= '"'.$user['appropiate_probing'].'",';
					$row .= '"'.$user['escalate_issue'].'",';
					$row .= '"'.$user['call_control'].'",';
					$row .= '"'.$user['query_resolved'].'",';
					$row .= '"'.$user['offers_VAS'].'",';
					$row .= '"'.$user['awareness_created'].'",';
					$row .= '"'.$user['correct_disposition'].'",';
					$row .= '"'.$user['update_ASM'].'",';
					$row .= '"'.$user['capture_query'].'",';
					$row .= '"'.$user['hold_required'].'",';
					$row .= '"'.$user['hold_guidelines'].'",';
					$row .= '"'.$user['dead_air_8sec'].'",';
					$row .= '"'.$user['further_assistance'].'",';
					$row .= '"'.$user['CSAT_experience_feedback'].'",';
					$row .= '"'.$user['call_adherence'].'",';
					
					$row .= '"'.$user['delayed_opening'].'",';
					$row .= '"'.$user['rude_on_call'].'",';
					$row .= '"'.$user['incomplete_information'].'",';
					$row .= '"'.$user['complaint_avoidance'].'",';
					
					$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['reason_for_fatal'])).'",';
					$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['improvement_area'])).'",';
					$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
					$row .= '"'.$user['agent_rvw_date'].'",';
					$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
					$row .= '"'.$user['mgnt_rvw_date'].'",';
					$row .= '"'.$user['mgnt_rvw_name'].'",';
					$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
					$row .= '"'.$user['client_rvw_date'].'",';
					$row .= '"'.$user['client_rvw_name'].'",';
					$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';	
					fwrite($fopen,$row."\r\n");
				}
				fclose($fopen);
				
			}if($campaign=='email'){
				
				foreach($rr as $user){	
					if($user['entry_by']!=''){
						$auditorName = $user['auditor_name'];
					}else{
						$auditorName = $user['client_name'];
					}
					
					if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
						$interval1 = '---';
					}else{
						$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
					}
				
					$row = '"'.$auditorName.'",'; 
					$row .= '"'.$user['audit_date'].'",'; 
					$row .= '"'.$user['fusion_id'].'",'; 
					$row .= '"'.$user['fname']." ".$user['lname'].'",';
					$row .= '"'.$user['tl_name'].'",';
					$row .= '"'.$user['call_date'].'",';
					$row .= '"'.$user['call_duration'].'",';
					$row .= '"'.$user['mission'].'",';
					$row .= '"'.$user['recording_id'].'",';
					$row .= '"'.$user['week'].'",';
					$row .= '"'.$user['audit_type'].'",';
					$row .= '"'.$user['voc'].'",';
					// $row .= '"'.$user['audit_start_time'].'",';
					$row .= '"'.$user['entry_date'].'",';
					$row .= '"'.$interval1.'",';
					$row .= '"'.$user['overall_score'].'%'.'",';
					$row .= '"'.$user['use_paragraph_idea'].'",';
					$row .= '"'.$user['use_bullet_point'].'",';
					$row .= '"'.$user['adhered_word_limit'].'",';
					$row .= '"'.$user['template_adherence'].'",';
					$row .= '"'.$user['interim_responce'].'",';
					$row .= '"'.$user['FCR_achieved'].'",';
					$row .= '"'.$user['understand_issue'].'",';
					$row .= '"'.$user['attentiveness_display'].'",';
					$row .= '"'.$user['use_available_resource'].'",';
					$row .= '"'.$user['standardized_subject'].'",';
					$row .= '"'.$user['VAS_option'].'",';
					$row .= '"'.$user['awarreness_created'].'",';
					$row .= '"'.$user['correct_disposition'].'",';
					$row .= '"'.$user['update_ASM'].'",';
					$row .= '"'.$user['capture_query'].'",';
					$row .= '"'.$user['formatting'].'",';
					$row .= '"'.$user['show_customer_feel_value'].'",';
					$row .= '"'.$user['procedure_guide_step'].'",';
					$row .= '"'.$user['avoid_slangs'].'",';
					$row .= '"'.$user['correct_grammar_use'].'",';
					$row .= '"'.$user['correct_closing'].'",';
					// $row .= '"'.$user['further_assistance'].'",';
					
					$row .= '"'.$user['rude_on_email'].'",';
					$row .= '"'.$user['inacurate_information'].'",';
					$row .= '"'.$user['email_hygiene'].'",';
					$row .= '"'.$user['complaint_avoidance'].'",';
					
					$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['reason_for_fatal'])).'",';
					$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['improvement_area'])).'",';
					$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
					$row .= '"'.$user['agent_rvw_date'].'",';
					$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
					$row .= '"'.$user['mgnt_rvw_date'].'",';
					$row .= '"'.$user['mgnt_rvw_name'].'",';
					$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
					$row .= '"'.$user['client_rvw_date'].'",';
					$row .= '"'.$user['client_rvw_name'].'",';
					$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';	
					fwrite($fopen,$row."\r\n");
				}
				fclose($fopen);
				
			}
			
		}




///////////////////////////////////////////////////////////////////////////////////// 
/////////////////////////////// QA HElpdesk ////////////////////////////////////	
/////////////////////////////////////////////////////////////////////////////////////

public function qa_it_helpdesk_feedback_report(){
	if(check_logged_in()){
		$user_office_id=get_user_office_id();
		$current_user = get_user_id();
		$is_global_access=get_global_access();
		$role_dir=get_role_dir();
		$data["show_download"] = false;
		$data["download_link"] = "";
		$data["show_table"] = false;
		$data["show_table"] = false;
		$data["aside_template"] = "reports_qa/aside.php";
		$data["content_template"] = "reports_qa/qa_it_helpdesk_feedback_report.php";
		$data["content_js"] = "qa_biomet_js.php";
		
		$data['location_list'] = $this->Common_model->get_office_location_list();
		
		$office_id = "";
		$date_from="";
		$date_to="";
		$campaign="";
		$action="";
		$dn_link="";
		$cond="";
		$cond1="";
		
		$data["qa_it_helpdesk_feedback_list"] = array();
		
		if($this->input->get('show')=='Show')
		{
			$date_from = mmddyy2mysql($this->input->get('date_from'));
			$date_to = mmddyy2mysql($this->input->get('date_to'));
			$office_id = $this->input->get('office_id');
			
			if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
	
			if($office_id=="All") $cond .= "";
			else $cond .=" and office_id='$office_id'";
			
			if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
				$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
			}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
				$cond1 .=" And assigned_to='$current_user'";
			}else{
				$cond1 .="";
			}
	
			$qSql="SELECT * from
			(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
			(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
			(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
			(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
			(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_it_helpdesk_feedback) xx Left Join
			(Select id as sid, fname, lname, fusion_id, office_id, assigned_to, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
			
			$fullAray = $this->Common_model->get_query_result_array($qSql);
			$data["qa_it_helpdesk_feedback_list"] = $fullAray;
			$this->create_qa_it_helpdesk_feedback_CSV($fullAray);	
			$dn_link = base_url()."reports_qa/download_qa_it_helpdesk_feedback_CSV";	
		}
		
		$data['download_link']=$dn_link;
		$data["action"] = $action;	
		$data['date_from'] = $date_from;
		$data['date_to'] = $date_to;	
		$data['office_id']=$office_id;
		
		$this->load->view('dashboard',$data);
	}
}	
 

public function download_qa_it_helpdesk_feedback_CSV()
{
	$currDate=date("Y-m-d");
	$filename = "./assets/reports/Report".get_user_id().".csv";
	$newfile="QA IT HELPDESK Audit List-'".$currDate."'.csv";
	header('Content-Disposition: attachment;  filename="'.$newfile.'"');
	readfile($filename);
}


public function create_qa_it_helpdesk_feedback_CSV($rr)
{
	$filename = "./assets/reports/Report".get_user_id().".csv";
	$fopen = fopen($filename,"w+");
	
	$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Ticket Date", "Ticket Category", "Audit Type", "VOC", "Entry Date Time", "Overall Score", "Initial Responce", "Communication/Formation", "probing", "Assistance Enthusiasmt", "Identification of Issue", "Documentation", "Ownership", "Escalationt", "Knowledge", "Verbiage", "On call resolution/Proper Assistance", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
	
	$row = "";
	foreach($header as $data) $row .= ''.$data.',';
	fwrite($fopen,rtrim($row,",")."\r\n");
	$searches = array("\r", "\n", "\r\n");
	
	foreach($rr as $user){	
		if($user['entry_by']!=''){
			$auditorName = $user['auditor_name'];
		}else{
			$auditorName = $user['client_name'];
		}
		
	
		$row = '"'.$auditorName.'",'; 
		$row .= '"'.$user['audit_date'].'",'; 
		$row .= '"'.$user['fusion_id'].'",'; 
		$row .= '"'.$user['fname']." ".$user['lname'].'",';
		$row .= '"'.$user['tl_name'].'",';
		$row .= '"'.$user['ticket_date'].'",';
		$row .= '"'.$user['ticket_category'].'",';
		$row .= '"'.$user['audit_type'].'",';
		$row .= '"'.$user['voc'].'",';
		$row .= '"'.$user['entry_date'].'",';
		$row .= '"'.$user['overall_score'].'%'.'",';
		$row .= '"'.$user['initial_responce'].'",';
		$row .= '"'.$user['communication'].'",';
		$row .= '"'.$user['probing'].'",';
		$row .= '"'.$user['assistance_enthusiasm'].'",';
		$row .= '"'.$user['issue_identification'].'",';
		$row .= '"'.$user['documentation'].'",';
		$row .= '"'.$user['ownership'].'",';
		$row .= '"'.$user['escalation'].'",';
		$row .= '"'.$user['knowledge'].'",';
		$row .= '"'.$user['verbiage'].'",';
		$row .= '"'.$user['on_call_resolution'].'",';
		$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
		$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
		$row .= '"'.$user['agent_rvw_date'].'",';
		$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
		$row .= '"'.$user['mgnt_rvw_date'].'",';
		$row .= '"'.$user['mgnt_rvw_name'].'",';
		$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
		$row .= '"'.$user['client_rvw_date'].'",';
		$row .= '"'.$user['client_rvw_name'].'",';
		$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';	
		fwrite($fopen,$row."\r\n");
	}
	fclose($fopen);
	
}




///////////////////////////////////////////////////////////////////////////////////// 
/////////////////////////////// QA SENSIO REPORT ////////////////////////////////////	
/////////////////////////////////////////////////////////////////////////////////////

	public function qa_sensio_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_sensio_report.php";
			$data["content_js"] = "qa_metropolis_js.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$campaign="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			$data["qa_sensio_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
		
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_sensio_feedback) xx Left Join
				(Select id as sid, fname, lname, fusion_id, office_id, assigned_to, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_sensio_list"] = $fullAray;
				$this->create_qa_sensio_CSV($fullAray);	
				$dn_link = base_url()."reports_qa/download_qa_sensio_CSV";	
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_sensio_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Sensio Audit List-'".$currDate."'.csv";
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	
	public function create_qa_sensio_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call ID", "Call Duration", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Scripted Opening", "Answered Call within 20 Seconds", "Active Listening", "Acknowledgement", "Grammar and Pronounciation", "Appropriate Speech", "Easy to Understand", "Correct Use of Phonetics", "Did the Agent Properly Educate the Customer?", "Ownership", "Polite", "Empathy/Assurance", "Hold", "Offer of Additional Assistance", "Scripted Close", "OPENING Remarks 1", "OPENING Remarks 2", "LISTENING SKILLS Remarks 1", "LISTENING SKILLS Remarks 2", "COMMUNICATION SKILLS Remarks 1", "COMMUNICATION SKILLS Remarks 2", "COMMUNICATION SKILLS Remarks 3", "COMMUNICATION SKILLS Remarks 4", "EDUCATION Remarks", "CUSTOMER SERVICE Remarks 1", "CUSTOMER SERVICE Remarks 2", "CUSTOMER SERVICE Remarks 3", "CUSTOMER SERVICE Remarks 4", "CLOSING Remarks 1", "CLOSING Remarks 2", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user){	
			if($user['entry_by']!=''){
				$auditorName = $user['auditor_name'];
			}else{
				$auditorName = $user['client_name'];
			}
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
		
			$row = '"'.$auditorName.'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['call_id'].'",';
			$row .= '"'.$user['call_duration'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'.$user['script_openning'].'",';
			$row .= '"'.$user['call_answer_20sec'].'",';
			$row .= '"'.$user['active_listening'].'",';
			$row .= '"'.$user['acknowledgement'].'",';
			$row .= '"'.$user['grammar_pronounciation'].'",';
			$row .= '"'.$user['appropiate_speech'].'",';
			$row .= '"'.$user['easy_to_understand'].'",';
			$row .= '"'.$user['correct_use_phonetics'].'",';
			$row .= '"'.$user['properly_educate_customer'].'",';
			$row .= '"'.$user['ownership'].'",';
			$row .= '"'.$user['polite'].'",';
			$row .= '"'.$user['empathy_assurance'].'",';
			$row .= '"'.$user['hold'].'",';
			$row .= '"'.$user['additional_assistance'].'",';
			$row .= '"'.$user['script_close'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
			$row .= '"'.$user['client_rvw_date'].'",';
			$row .= '"'.$user['client_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';	
			fwrite($fopen,$row."\r\n");
		}
		fclose($fopen);
		
	}

///////////////////////////////////////////////////////////////////////////////////////////	 
////////////////////////////////////// QA Paynearby REPORT ////////////////////////////////	
///////////////////////////////////////////////////////////////////////////////////////////
	public function qa_paynearby_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_paynearby_report.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$audit_type="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			$campaign = $this->input->get('campaign');
			
			$data["qa_paynearby_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				//$dt_frm = getEstToLocal($date_from,agent_id);
				
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				//$dt_to = getEstToLocal($date_to,agent_id);
				
				$office_id = $this->input->get('office_id');
				$audit_type = $this->input->get('audit_type');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (getLocalToEST(audit_date,agent_id) >= '$date_from' and getLocalToEST(audit_date,agent_id) <= '$date_to' ) ";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if($audit_type=="All") $cond .= "";
				else $cond .=" and audit_type='$audit_type'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else if(get_login_type()=="client"){
					$cond1 .=" And audit_type not in ('Operation Audit','Trainer Audit')";
				}else{
					$cond1 .="";
				}
				
				if($campaign=='inbound'){
					/* $qSql="SELECT * from
					(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, 
					(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name from qa_paynearby_feedback) xx Left Join 
					(Select id as sid, fname, lname, fusion_id, office_id, get_process_names(id) as campaign, DATEDIFF(CURDATE(), doj) as tenure, assigned_to from signin) yy on (xx.agent_id=yy.sid) Left join 
					(Select fd_id, agnt_fd_acpt, note as agent_note, date(entry_date) as agent_rvw_date from qa_paynearby_agent_rvw) zz on (xx.id=zz.fd_id) Left Join 
					(Select fd_id as mgnt_fd_id, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as mgnt_name, note as mgnt_note, date(entry_date) as mgnt_rvw_date from qa_paynearby_mgnt_rvw) ww on (xx.id=ww.mgnt_fd_id) $cond $cond1 order by audit_date"; */
					$qSql="Select P.*, concat(sa.fname, ' ', sa.lname) as auditor_name, concat(stl.fname, ' ', stl.lname) as tl_name, S.id as sid, S.fname, S.lname, S.fusion_id, 	S.office_id, get_process_names(S.id) as campaign, DATEDIFF(CURDATE(), S.doj) as tenure, S.assigned_to, PAR.fd_id, PAR.agnt_fd_acpt, PAR.note as agent_note, date(PAR.entry_date) as agent_rvw_date, PMR.fd_id as mgnt_fd_id, PMR.note as mgnt_note, date(PMR.entry_date) as mgnt_rvw_date, PMR.entry_by as mgnt_entry_by, concat(mrn.fname, ' ', mrn.lname) as mgnt_name
					from qa_paynearby_feedback P 
					Left Join signin S ON P.agent_id=S.id
					Left Join signin sa ON P.entry_by=sa.id
					Left Join signin stl ON P.tl_id=stl.id
					Left Join qa_paynearby_agent_rvw PAR ON P.id=PAR.fd_id
					Left Join qa_paynearby_mgnt_rvw PMR ON P.id=PMR.fd_id
					Left Join signin mrn ON PMR.entry_by=mrn.id $cond $cond1 order by audit_date";
				}else{
					$qSql="SELECT * from (Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, (select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name from qa_paynearby_".$campaign."_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, assigned_to, get_process_names(id) as campaign, DATEDIFF(CURDATE(), doj) as tenure from signin) yy on (xx.agent_id=yy.sid) order by audit_date";
				}
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_paynearby_list"] = $fullAray;
				$this->create_qa_paynearby_CSV($fullAray,$campaign);	
				$dn_link = base_url()."reports_qa/download_qa_paynearby_CSV/".$campaign;
				
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['campaign']=$campaign;
			$data['audit_type']=$audit_type;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_paynearby_CSV($campaign)
	{
		$currDate=date("Y-m-d");
		if($campaign=='inbound'){
			$pnb_hdr='Paynearby Inbound';
		}else if($campaign=='ob_sales'){
			$pnb_hdr='Paynearby Outbound - Sales';
		}else if($campaign=='ob_service'){
			$pnb_hdr='Paynearby Outbound - Service';
		}else if($campaign=='email'){
			$pnb_hdr='Paynearby Email';
		}
		
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA ".$pnb_hdr." Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_paynearby_CSV($rr,$campaign)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		if($campaign=='inbound'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Tenurity (in Days)", "Call Date/Time", "Call Duration", "Incoming Number", "Campaign", "Register No", "Customer Name", "Call Link", "Ticket Number", "Call Disconnect By", "Tagging", "Query/Service", "Type Of Call", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Opening with Greeting (incl late opening/Name confirmation)", "Initial Empathy with Assurance statement done", "DID AGENT UNDERSTOOD THE QUERY & NECESSARY PROBING DONE", "Followed proper Telephone etiquettes (mute hold transfer)", "IVR Promotion done", "Effective rebuttals on Objection Handling/Convincing skills", "Fraud Alert Message informed", "Appropriate sentences and acknowledgment used on call", "Did the Agent was Polite on call/Not done Arguments/Professional", "Good Behavior/Willingness", "Good in listening/Repetition not happened due to lack in listening skills/Attentive", "Not interrupted", "Proper Empathy done whenever required", "Did the agent maintained Proper Pace/tone modulation/clarity in speech", "Did the agent have Patience", "Energy/Enthusiasm", "Confidence Level", "Grammatical errors/Fumbling/Fillers", "No Dead Air found", "Not Dragged the call", "Rude flirting foul language Abusive with customer not happened", "Was Exact TAT informed (Not less than Actual)", "Not provided Wrong information on call", "Was Correct tagging done/raised proper ticket", "Not having (Minor Errors in Comments/Sub dispositions)", "Customer satisfied/Rapport building done", "Did the agent followed Proper call closing Script as per process", "Overall Score", "Grade", "Call Summary", "Feedback", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By", "Mgnt Comment");
		}else if($campaign=='ob_sales'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Tenurity (in Days)", "Call Date/Time", "Call Duration", "Incoming Number", "Campaign", "Register No", "Customer Name", "Call Link", "Ticket Number", "Call Disconnect By", "Tagging", "Query/Service", "Type Of Call", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "STANDARD CALL OPENING PROCEDURE", "** EXPLANATION ABOUT PRODUCT AND PROCESS WITH FULL INFORMATION", "**CORRECT TAGGINGS / WRONG INFORMATION", "NECESSARY PROBING DONE ON CALL BASED", "SALES PICHER POLITE PITCHING URGE FOR SALES & SERVICE", "ACTIVE LISTENING", "ASSURANCE ACKNOWLEDGEMENT STATEMENTS ON CALL", "TONE MODULATION", "DRAGGING / STAMMERING / JARGONS / FILLERS", "CLOSING PROCEDURE FOLLOWED", "Call Summary", "Feedback", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By", "Mgnt Comment");
		}else if($campaign=='ob_service'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Tenurity (in Days)", "Call Date/Time", "Call Duration", "Incoming Number", "Campaign", "Register No", "Customer Name", "Call Link", "Ticket Number", "Call Disconnect By", "Tagging", "Query/Service", "Type Of Call", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "STANDARD CALL OPENING WITH COMPANY NAME", "NECESSARY PROBING TO BE DONE & UNDERSTANDING THE CUSTOMER", "FOR BNB AND AMAZON EXPLAINATION ABOUT SHOP SET UP AS PER CHECK LIST", "**FOR FLIPKART- EXPLANATION ABOUT FLIPKART PROCESS WITH FULL INFORMATION", "**TAGGING / WRONG INFORAMTION ON CALL", "ACTIVE LISTENING", "RAPPO BUILDING / ASSURANCE", "TONE MODULATION", "DRAGGING / STAMMERING / JARGONS / FILLERS", "Call Summary", "Feedback", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By", "Mgnt Comment");
		}else if($campaign=='email'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Date of Mail Received", "Date of Mail Action", "Status", "TAT", "Replied Date of TAT", "Email Number", "MSISDN", "Mail ID", "Interaction ID", "Category", "Sub Category", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Has all the queries of the customer answered", "Correct process followed", "Correct & Accurate Resolution given & completed on time", "For the missing details has the CSE called the customer to get those", "MINOR ERRORS - NOT GIVEN COMPLETE SOLUTION", "**Wrong or in complete information provided on mail", "Professional and Empathy statements used as per senario and acknowledge as per the query", "Email Etiquette Grammatical error punctuations font & spelling mistakes", "Email Summary", "Feedback", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By", "Mgnt Comment");
		}
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		if($campaign=='inbound'){
			
			foreach($rr as $user){	
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['tenure'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['incoming_no'].'",';
				$row .= '"'.$user['campaign'].'",';
				$row .= '"'.$user['register_no'].'",';
				$row .= '"'.$user['customer'].'",';
				$row .= '"'.$user['call_link'].'",';
				$row .= '"'.$user['ticket_no'].'",';
				$row .= '"'.$user['call_disconnect_by'].'",';
				$row .= '"'.$user['tagging'].'",';
				$row .= '"'.$user['query_service'].'",';
				$row .= '"'.$user['call_type'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['opening_greeting'].'",';
				$row .= '"'.$user['initial_empathy'].'",';
				$row .= '"'.$user['agent_query'].'",';
				$row .= '"'.$user['proper_telephone'].'",';
				$row .= '"'.$user['ivr_promotion'].'",';
				$row .= '"'.$user['efective_rebuttal'].'",';
				$row .= '"'.$user['fraud_alert'].'",';
				$row .= '"'.$user['sentence_acknowledge'].'",';
				$row .= '"'.$user['polite_call'].'",';
				$row .= '"'.$user['good_behaviour'].'",';
				$row .= '"'.$user['good_listening'].'",';
				$row .= '"'.$user['not_interrupt'].'",';
				$row .= '"'.$user['proper_empathy'].'",';
				$row .= '"'.$user['proper_pace'].'",';
				$row .= '"'.$user['agent_patience'].'",';
				$row .= '"'.$user['energy_enthusias'].'",';
				$row .= '"'.$user['confident_level'].'",';
				$row .= '"'.$user['error_fumbling'].'",';
				$row .= '"'.$user['dead_air'].'",';
				$row .= '"'.$user['dragged_call'].'",';
				$row .= '"'.$user['rude_language'].'",';
				$row .= '"'.$user['exact_tat'].'",';
				$row .= '"'.$user['wrong_provide'].'",';
				$row .= '"'.$user['correct_tagging'].'",';
				$row .= '"'.$user['minor_error'].'",';
				$row .= '"'.$user['satisfy_rapport'].'",';
				$row .= '"'.$user['closing_script'].'",';
				$row .= '"'.$user['overall_score'].'%'.'",'; 
				$row .= '"'.$user['grade'].'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';				
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}else if($campaign=='ob_sales'){
			
			foreach($rr as $user){	
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['tenure'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['incoming_no'].'",';
				$row .= '"'.$user['campaign'].'",';
				$row .= '"'.$user['register_no'].'",';
				$row .= '"'.$user['customer'].'",';
				$row .= '"'.$user['call_link'].'",';
				$row .= '"'.$user['ticket_no'].'",';
				$row .= '"'.$user['call_disconnect_by'].'",';
				$row .= '"'.$user['tagging'].'",';
				$row .= '"'.$user['query_service'].'",';
				$row .= '"'.$user['call_type'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",'; 
				$row .= '"'.$user['standart_call_opening'].'",';
				$row .= '"'.$user['explain_about_product'].'",';
				$row .= '"'.$user['correct_tagging'].'",';
				$row .= '"'.$user['necessary_probing'].'",';
				$row .= '"'.$user['sales_picher'].'",';
				$row .= '"'.$user['active_listening'].'",';
				$row .= '"'.$user['assurance_acknowledge'].'",';
				$row .= '"'.$user['tone_modulation'].'",';
				$row .= '"'.$user['dragging_stammering'].'",';
				$row .= '"'.$user['closing_procedure'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';				
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}else if($campaign=='ob_service'){
			
			foreach($rr as $user){	
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['tenure'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['incoming_no'].'",';
				$row .= '"'.$user['campaign'].'",';
				$row .= '"'.$user['register_no'].'",';
				$row .= '"'.$user['customer'].'",';
				$row .= '"'.$user['call_link'].'",';
				$row .= '"'.$user['ticket_no'].'",';
				$row .= '"'.$user['call_disconnect_by'].'",';
				$row .= '"'.$user['tagging'].'",';
				$row .= '"'.$user['query_service'].'",';
				$row .= '"'.$user['call_type'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",'; 
				$row .= '"'.$user['standard_call_opening'].'",';
				$row .= '"'.$user['necessary_probing'].'",';
				$row .= '"'.$user['explain_about_BNB_Amazon'].'",';
				$row .= '"'.$user['explain_about_Flipkart'].'",';
				$row .= '"'.$user['wrong_call_information'].'",';
				$row .= '"'.$user['active_listening'].'",';
				$row .= '"'.$user['rappo_building'].'",';
				$row .= '"'.$user['tone_modulation'].'",';
				$row .= '"'.$user['dragging_stammering'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';				
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		
		}else if($campaign=='email'){
			
			foreach($rr as $user){	
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['mail_action_date'].'",';
				$row .= '"'.$user['status'].'",';
				$row .= '"'.$user['tat'].'",';
				$row .= '"'.$user['tat_replied_date'].'",';
				$row .= '"'.$user['email_no'].'",';
				$row .= '"'.$user['msisdn'].'",';
				$row .= '"'.$user['email_id'].'",';
				$row .= '"'.$user['interaction_id'].'",';
				$row .= '"'.$user['category'].'",';
				$row .= '"'.$user['sub_category'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",'; 
				$row .= '"'.$user['customer_query_answer'].'",';
				$row .= '"'.$user['correct_process_follow'].'",';
				$row .= '"'.$user['accurate_resolution_given'].'",';
				$row .= '"'.$user['missing_details_for_CSE_call'].'",';
				$row .= '"'.$user['not_given_complete_solution'].'",';
				$row .= '"'.$user['product_process_knowledge'].'",';
				$row .= '"'.$user['empathy_statement_use'].'",';
				$row .= '"'.$user['grammatical_error'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';				
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		
		}
		
	}

///////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////// QA RPM Report ////////////////////////////////////
/////////////////////////////////////////////////////////////////////////////////////
	
	public function qa_rpm_report()
	{
		if(check_logged_in())
		{
			$current_user = get_user_id();
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_rpm_report.php";
			$data["content_js"] = "qa_rpm_sentry_js.php";
			$from_date="";
			$to_date="";
			$action="";
			$agent ="";
			$dn_link="";
			$rpm_data = array();
			
			if($this->input->get('show')=='Show')
			{
				$from_date = $this->input->get('from_date');
				$to_date = $this->input->get('to_date');
				$agent = $this->input->get('agent');
				if($from_date!="" && $to_date!="")
				{
					$rpm_data =	$this->Qa_RPM_Sentry_model->qa_rpm_report(mmddyy2mysql($from_date),mmddyy2mysql($to_date),$agent,$current_user);
				}
				$this->create_qa_rpm_CSV($rpm_data);
				$dn_link = base_url()."reports_qa/download_qa_rpm_CSV";
			}
			$data["from_date"] = $from_date;
            $data["to_date"] = $to_date;
			$data['agent'] = $agent;
			$data['rpm_data'] =	$rpm_data;
			$data['download_link']=$dn_link;
			$data["agent_list"] = $this->Qa_RPM_Sentry_model->get_agent_id(56,68);
			$this->load->view('dashboard',$data);
		}
	}
	/****************QA RPM CSV Generator*****************/
	public function create_qa_rpm_CSV($rr)
	{
		$filename = "./assets/reports/qa_rpm_report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date","Audit Time","Agent","Audit Type","VOC","Caller Title","Caller Name","Caller Phone","Call Type","Disposition Type","Total Score","Total Score Count","Customer Information/Opening","Voice Delivery","Communication Skills","Customer Service","Disposition","Transfer","Protocol","Call Summary","Feedback");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $rdata)
		{	
			$row = '"'.$rdata['auditor_name'].'",';
			$row .= '"'.$rdata['audit_date'].'",';
			$row .= '"'.$rdata['audit_time'].'",';
			$row .= '"'.$rdata['agent_name'].'",';
			$row .= '"'.$rdata['audit_type'].'",';
			$row .= '"'.$rdata['voc'].'",';
			$row .= '"'.$rdata['caller_title'].'",';
			$row .= '"'.$rdata['caller_name'].'",';
			$row .= '"'.$rdata['caller_phone'].'",';
			$row .= '"'.$rdata['call_type'].'",';
			$row .= '"'.$rdata['disposition_type'].'",';
			$row .= '"'.$rdata['overall_score'].'",';
			$row .= '"'.$rdata['total_score_count'].'",';
			$row .= '"'.$rdata['customer_information'].'",';
			$row .= '"'.$rdata['voice_delivery'].'",';
			$row .= '"'.$rdata['communication_skills'].'",';
			$row .= '"'.$rdata['customer_service'].'",';
			$row .= '"'.$rdata['disposition'].'",';
			$row .= '"'.$rdata['transfer'].'",';
			$row .= '"'.$rdata['protocol'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $rdata['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $rdata['feedback'])).'"';	
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}
	public function download_qa_rpm_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/qa_rpm_report".get_user_id().".csv";
		$newfile="QA RPM List-".$currDate.".csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	/****************QA Sentry Report*****************/
	public function qa_sentry_report()
	{
		if(check_logged_in())
		{
			$current_user = get_user_id();
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_sentry_report.php";
			$data["content_js"] = "qa_rpm_sentry_js.php";
			$from_date="";
			$to_date="";
			$action="";
			$agent ="";
			$dn_link="";
			$sentry_data = array();
			
			if($this->input->get('show')=='Show')
			{
				$from_date = $this->input->get('from_date');
				$to_date = $this->input->get('to_date');
				$agent = $this->input->get('agent');
				if($from_date!="" && $to_date!="")
				{
					$sentry_data =	$this->Qa_RPM_Sentry_model->qa_sentry_report(mmddyy2mysql($from_date),mmddyy2mysql($to_date),$agent,$current_user);
				}
				$this->create_qa_sentry_CSV($sentry_data);
				$dn_link = base_url()."reports_qa/download_qa_sentry_CSV";
			}
			$data["from_date"] = $from_date;
            $data["to_date"] = $to_date;
			$data['agent'] = $agent;
			$data['sentry_data'] =	$sentry_data;
			$data['download_link']=$dn_link;
			$data["agent_list"] = $this->Qa_RPM_Sentry_model->get_agent_id(55,174);
			$this->load->view('dashboard',$data);
		}
	}
	/****************QA Sentry CSV Generator*****************/
	public function create_qa_sentry_CSV($rr)
	{
		$filename = "./assets/reports/qa_sentry_report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date","Audit Time","Agent","Audit Type","VOC","Caller Name","Caller Date","Caller Phone","Audit Result","Total Score","Total Score Count","Verified Consumer","Advise Recording","Professional","Speech","Objections","Fluidity","Experience","Call Summary","Feedback");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $rdata)
		{	
		
			
			$row = '"'.$rdata['auditor_name'].'",';
			$row .= '"'.$rdata['audit_date'].'",';
			$row .= '"'.$rdata['audit_time'].'",';
			$row .= '"'.$rdata['agent_name'].'",';
			$row .= '"'.$rdata['audit_type'].'",';
			$row .= '"'.$rdata['voc'].'",';
			$row .= '"'.$rdata['caller_name'].'",';
			$row .= '"'.$rdata['caller_date'].'",';
			$row .= '"'.$rdata['caller_phone'].'",';
			$row .= '"'.$rdata['audit_result'].'",';
			$row .= '"'.$rdata['overall_score'].'",';
			$row .= '"'.$rdata['total_score_count'].'",';
			$row .= $rdata['verified_consumer']==0?'"No",':'"Yes",';
			$row .= $rdata['advise_recording']==0?'"No",':'"Yes",';
			$row .= '"'.$rdata['professional'].'",';
			$row .= '"'.$rdata['speech'].'",';
			$row .= '"'.$rdata['objections'].'",';
			$row .= '"'.$rdata['fluidity'].'",';
			$row .= '"'.$rdata['experience'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $rdata['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $rdata['feedback'])).'"';	
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}
	public function download_qa_sentry_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/qa_sentry_report".get_user_id().".csv";
		$newfile="QA Sentry List-".$currDate.".csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}


	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////	 
////////////////////////////////////// QA RugDoctor REPORT ////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////

	public function qa_rugdoctor_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;			
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_rugdoctor_report.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$audit_type="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			$date_from = $this->input->get('date_from');
			$date_to = $this->input->get('date_to');
			$office_id = $this->input->get('office_id');
			$audit_type = $this->input->get('audit_type');
			
			if($date_from==""){ 
				$date_from=CurrDate();
			}else{
				$date_from = mmddyy2mysql($date_from);
			}
			
			if($date_to==""){ 
				$date_to=CurrDate();
			}else{
				$date_to = mmddyy2mysql($date_to);
			}
			
			$data["qa_rugdoctor_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if($audit_type=="All") $cond .= "";
				else $cond .=" and audit_type='$audit_type'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else if(get_login_type()=="client"){
					$cond1 .=" And audit_type not in ('Operation Audit','Trainer Audit')";
				}else{
					$cond1 .="";
				}
		
			
				$qSql="SELECT * from
					(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name from qa_rugdoctor_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, assigned_to from signin) yy on (xx.agent_id=yy.sid) Left join (Select fd_id, note as agent_note, date(entry_date) as agent_rvw_date from qa_rugdoctor_agent_rvw) zz on (xx.id=zz.fd_id) Left Join (Select fd_id as mgnt_fd_id, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as mgnt_name, note as mgnt_note, date(entry_date) as mgnt_rvw_date from qa_rugdoctor_mgnt_rvw) ww on (xx.id=ww.mgnt_fd_id) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_rugdoctor_list"] = $fullAray;
				$this->create_qa_rugdoctor_CSV($fullAray);	
				$dn_link = base_url()."reports_qa/download_qa_rugdoctor_CSV";
			}	
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['audit_type']=$audit_type;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_rugdoctor_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA RugDoctor Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_rugdoctor_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Phone", "Call Duration", "Customer Name", "Issue", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Greet the caller by Thanking them for the call?", "Comment", "Confirm the customer's identity?", "Comment", "Request for machine serial number?", "Comment", "Identify the correct reason the customer is calling?", "Comment", "Demonstrate active listening skills?", "Comment", "Maintain control of the call?", "Comment", "Words and tone of voice communicates confidence and assurance?", "Comment", "Treat the caller with care?", "Comment", "Avoid long periods of silence?", "Comment", "Follow the correct procedures for telephone handling?", "Comment", "Accurately communicate during the interaction?", "Comment", "Demonstrate efficient and effective use of all systems to handle the call?", "Comment", "Provide correct/complete information based on policies and procedures?", "Comment", "Accurately document the call?", "Comment", "Resolve the customers reason for calling to the extent possible during the interaction?", "Comment", "Offer to provide the customer with their ticket number?", "Comment", "Summarize action taken and ask the customer if there is anything else they need help with?", "Comment", "Educate the customer on self-help options for the future?", "Comment", "Thank the caller for calling?", "Comment", "Overall Score", "Earned Score", "Customer Critical", "Business Critical", "Compliance Critical", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
		
			if($user['greeting_caller']==1) $greeting_caller='Yes';
			else $greeting_caller='No';
			
			if($user['verification_confirm']==2) $verification_confirm='Yes';
			else $verification_confirm='No';
			
			if($user['verification_request']==2) $verification_request='Yes';
			else $verification_request='No';
			
			if($user['discovery_identity']==4) $discovery_identity='Yes';
			else $discovery_identity='No';
			
			if($user['discovery_demo']==1) $discovery_demo='Yes';
			else $discovery_demo='No';
			
			if($user['customer_maintain']==2) $customer_maintain='Yes';
			else $customer_maintain='No';
			
			if($user['customer_word']==3) $customer_word='Yes';
			else $customer_word='No';
			
			if($user['customer_treat']==4) $customer_treat='Yes';
			else $customer_treat='No';
			
			if($user['customer_avoid']==1) $customer_avoid='Yes';
			else $customer_avoid='No';
			
			if($user['customer_follow']==1) $customer_follow='Yes';
			else $customer_follow='No';
			
			if($user['customer_accurate']==1) $customer_accurate='Yes';
			else $customer_accurate='No';
			
			if($user['skill_demo']==2) $skill_demo='Yes';
			else $skill_demo='No';
			
			if($user['resolution_provide']==5) $resolution_provide='Yes';
			else $resolution_provide='No';
			
			if($user['resolution_accurate']==4) $resolution_accurate='Yes';
			else $resolution_accurate='No';
			
			if($user['resolution_resolve']==5) $resolution_resolve='Yes';
			else $resolution_resolve='No';
			
			if($user['closing_offer']==1) $closing_offer='Yes';
			else $closing_offer='No';
			
			if($user['closing_summarize']==1) $closing_summarize='Yes';
			else $closing_summarize='No';
			
			if($user['closing_educate']==1) $closing_educate='Yes';
			else $closing_educate='No';
			
			if($user['closing_thank']==1) $closing_thank='Yes';
			else $closing_thank='No';
			
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",'; 
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['phone'].'",';
			$row .= '"'.$user['call_duration'].'",';
			$row .= '"'.$user['customer_name'].'",';
			$row .= '"'.$user['issue'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$greeting_caller.'",';
			$row .= '"'.$user['greeting_caller_comment'].'",';
			$row .= '"'.$verification_confirm.'",';
			$row .= '"'.$user['verification_confirm_comment'].'",';
			$row .= '"'.$verification_request.'",';
			$row .= '"'.$user['verification_request_comment'].'",';
			$row .= '"'.$discovery_identity.'",';
			$row .= '"'.$user['discovery_identity_comment'].'",';
			$row .= '"'.$discovery_demo.'",';
			$row .= '"'.$user['discovery_demo_comment'].'",';
			$row .= '"'.$customer_maintain.'",';
			$row .= '"'.$user['customer_maintain_comment'].'",';
			$row .= '"'.$customer_word.'",';
			$row .= '"'.$user['customer_word_comment'].'",';
			$row .= '"'.$customer_treat.'",';
			$row .= '"'.$user['customer_treat_comment'].'",';
			$row .= '"'.$customer_avoid.'",';
			$row .= '"'.$user['customer_avoid_comment'].'",';
			$row .= '"'.$customer_follow.'",';
			$row .= '"'.$user['customer_follow_comment'].'",';
			$row .= '"'.$customer_accurate.'",';
			$row .= '"'.$user['customer_accurate_comment'].'",';
			$row .= '"'.$skill_demo.'",';
			$row .= '"'.$user['skill_demo_comment'].'",';
			$row .= '"'.$resolution_provide.'",';
			$row .= '"'.$user['resolution_provide_comment'].'",';
			$row .= '"'.$resolution_accurate.'",';
			$row .= '"'.$user['resolution_accurate_comment'].'",';
			$row .= '"'.$resolution_resolve.'",';
			$row .= '"'.$user['resolution_resolve_comment'].'",';
			$row .= '"'.$closing_offer.'",';
			$row .= '"'.$user['closing_offer_comment'].'",';
			$row .= '"'.$closing_summarize.'",';
			$row .= '"'.$user['closing_summarize_comment'].'",';
			$row .= '"'.$closing_educate.'",';
			$row .= '"'.$user['closing_educate_comment'].'",';
			$row .= '"'.$closing_thank.'",';
			$row .= '"'.$user['closing_thank_comment'].'",';
			$row .= '"'.$user['overall_score'].'",';
			$row .= '"'.$user['point_earned'].'",'; 
			$row .= '"'.$user['rdCustomerTotal'].'",'; 
			$row .= '"'.$user['rdBusinessTotal'].'",'; 
			$row .= '"'.$user['rdComplianceTotal'].'",'; 
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';				
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}


/////////////////////////////////////////////////////////////////////
/////////////////////////////////////////////////////////////////////

		public function dipcheck(){
		if(check_logged_in()){
			 
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/dipcheck.php";
			$data["content_js"] = "qa_dipcheck/dipcheck_js.php";
			
			$SQLtxt ="SELECT * FROM qa_dipcheck ORDER BY id ASC";
			$data_fields = $this->db->query($SQLtxt);
			
			$data['campaign'] = $data_fields->result();
			
			$this->load->view("dashboard",$data);
			
		}
	}
	
	public function download_dipcheck_rep(){
		if(check_logged_in()){
			if($_GET['process_download'] == "Download" &&  $_GET['campaign_id']!=""){ 

				$SQLtxt ="SELECT allotted_set_id, exam_status FROM lt_examination INNER JOIN lt_exam_schedule ON lt_examination.id = lt_exam_schedule.exam_id where lt_exam_schedule.exam_id=". $_GET['campaign_id'] ." GROUP BY allotted_set_id";
				
				$data_fields = $this->db->query($SQLtxt);
				$data['set_count'] = $data_fields->result_array();
											
				$this->generate_dipcheck_xls($_GET['campaign_id'],$_GET['desc'],$data['set_count']);
				
			}else{
				redirect('reports_qa/dipcheck','refresh');
			}
		}
	}
	
	
	private function generate_dipcheck_xls($campaign_id, $heading, $set_count ){
		if(check_logged_in()){
			$this->objPHPExcel->createSheet();
			$this->objPHPExcel->setActiveSheetIndex();
			$objWorksheet = $this->objPHPExcel->getActiveSheet();
			$objWorksheet->setTitle("Exam Result Report");
			 
			// START GRIDLINES HIDE AND SHOW//
			$objWorksheet->setShowGridlines(true);
			// END GRIDLINES HIDE AND SHOW//
			//$this->objPHPExcel->getDefaultStyle()->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);
			
		$this->objPHPExcel->getDefaultStyle()->getAlignment()->setWrapText(true);	
			
	   
			$objWorksheet->getColumnDimension('A')->setWidth(15);
			$objWorksheet->getColumnDimension('B')->setWidth(15);
			$objWorksheet->getColumnDimension('C')->setWidth(15);
			$objWorksheet->getColumnDimension('D')->setWidth(15);
			$objWorksheet->getColumnDimension('E')->setWidth(50);
			$objWorksheet->getColumnDimension('F')->setWidth(50);
			$objWorksheet->getColumnDimension('G')->setWidth(50);
			$objWorksheet->getColumnDimension('H')->setWidth(50);
			$objWorksheet->getColumnDimension('I')->setWidth(50);
			$objWorksheet->getColumnDimension('J')->setWidth(50);
			$objWorksheet->getColumnDimension('K')->setWidth(50);
			$objWorksheet->getColumnDimension('L')->setWidth(50);
			$objWorksheet->getColumnDimension('M')->setWidth(50);
			$objWorksheet->getColumnDimension('N')->setWidth(50);
			$objWorksheet->getColumnDimension('O')->setWidth(50);
			$objWorksheet->getColumnDimension('P')->setWidth(50);
			$objWorksheet->getColumnDimension('Q')->setWidth(50);
			$objWorksheet->getColumnDimension('R')->setWidth(50);
			$objWorksheet->getColumnDimension('S')->setWidth(50);
			$objWorksheet->getColumnDimension('T')->setWidth(50);
			$objWorksheet->getColumnDimension('U')->setWidth(50);
			$objWorksheet->getColumnDimension('V')->setWidth(50);
			
			$style = array(
				'alignment' => array(
					'horizontal' => PHPExcel_Style_Alignment::VERTICAL_CENTER,
				)
			);
			
			$objWorksheet->getStyle("A1:P1")->applyFromArray($style);
			$sheet = $this->objPHPExcel->getActiveSheet();

			unset($style);
	 
			// CELL BACKGROUNG COLOR
			$this->objPHPExcel->getActiveSheet()->getStyle("A2:O2")->getFill()->applyFromArray(
                $styleArray =array(
								'type' => PHPExcel_Style_Fill::FILL_SOLID,
								'startcolor' => array(
									 'rgb' => "F28A8C"
								),
								'horizontal' => PHPExcel_Style_Alignment::HORIZONTAL_CENTER
							)
                );
       
			// CELL FONT AND FONT COLOR 
			$styleArray = array(
			'font'  => array(
				'bold'  => true,
				'color' => array('rgb' => '000000'),
				'size'  => 14,
				'name'  => 'Algerian',
				'horizontal' => PHPExcel_Style_Alignment::HORIZONTAL_CENTER,
			));
			
			$style = array(
				'alignment' => array(
					'horizontal' => PHPExcel_Style_Alignment::HORIZONTAL_CENTER,
				)
			);

			$this->objPHPExcel->getActiveSheet()->getStyle('A1')->applyFromArray($styleArray);
			
			
			$sheet = $this->objPHPExcel->getActiveSheet();
			$sheet->getDefaultStyle()->applyFromArray($style);
			$sheet->setCellValueByColumnAndRow(0, 1, "Dip Check ".$heading);
			$sheet->mergeCells('A1:J1');
					
			
					foreach($set_count as $no_set){
						
					$col1=0;
					$row1=2; 	
						
						$SQLtxt = "Select * from lt_questions where set_id = ". $no_set['allotted_set_id'] ." order by id";
						$data_fields1 = $this->db->query($SQLtxt);
						$data['candidate'] = $data_fields1->result_array();
						
						$header_column = array("SL No","FUSION ID","AGENT NAME","TL Name");
						
							foreach($header_column as $val){
								if($col1 < 4){
									$this->objPHPExcel->getActiveSheet()->setCellValueByColumnAndRow($col1,2,$val);	
									$col1++;
								}
							}
							
							foreach($data['candidate'] as $excel_header){
									
									$this->objPHPExcel->getActiveSheet()->setCellValueByColumnAndRow($col1,$row1,$excel_header['title']);	 
									$col1++; 
									 
							}
							
							/*$this->objPHPExcel->getActiveSheet()->setCellValueByColumnAndRow($col1,$row1,'Score');
							$fcol = $col1;
							$fcol = $col1+1; */
							$this->objPHPExcel->getActiveSheet()->setCellValueByColumnAndRow($col1,$row1,'Score Percentage');
							
					 /*
					    $SQLtxt="Select fusion_id,fname,lname,(Select CONCAT(fname,' ' ,lname) from signin where signin.id=s.assigned_to) as asign_tl, user_id,set_id,exam_id,exam_schedule_id,ques_id,ans_id, (SELECT text FROM lt_questions_ans_options QA_O WHERE QA_O.id = ua.ans_id )AS User_answer from lt_exam_schedule x inner JOIN lt_questions y on y.set_id = x.allotted_set_id
						inner JOIN lt_user_exam_answer ua on ua.exam_schedule_id = x.id and ua.ques_id = y.id
						left JOIN signin s on s.id = x.user_id
						where exam_id =". $campaign_id ." and allotted_set_id = ". $no_set['allotted_set_id'] ."
						order by user_id,ques_id";
					*/
						
					   $SQLtxt="Select fusion_id,fname,lname,(Select CONCAT(fname,' ' ,lname) from signin where signin.id=s.assigned_to) as asign_tl, user_id,set_id,exam_id,exam_schedule_id, ua.ques_id, no_of_question, ans_id, QA_O.text AS User_answer, QA_O.correct_answer from lt_exam_schedule x 
						inner JOIN lt_questions y on y.set_id = x.allotted_set_id
						inner JOIN lt_user_exam_answer ua on ua.exam_schedule_id = x.id and ua.ques_id = y.id
						LEFT JOIN lt_questions_ans_options QA_O ON QA_O.id=ua.ans_id
						left JOIN signin s on s.id = x.user_id
						where exam_id =". $campaign_id ." and allotted_set_id = ". $no_set['allotted_set_id'] ."
						order by user_id,ques_id";
						
						
						$data_fields1 = $this->db->query($SQLtxt); 
						$data['Questions'] = $data_fields1->result_array();
					
						
						$no_of_question=$data['Questions'][0]['no_of_question'];
						
						$col=0;
						$row=2; 
						$cnt=1; 
						
							$correct_answer=0;
							$old_fusion_id=''; 
							/* for($i=0;$i<count($data['Questions']);$i++){ */
							foreach($data['Questions'] as $recRow){
							 if($recRow['User_answer'] =='') $recRow['User_answer'] ="NA";
							 
								//if($data['Questions'][$i]['fusion_id'] != $old_fusion_id){
								if($recRow['fusion_id'] == $old_fusion_id ){
									
									$col++;
									$correct_answer += $recRow['correct_answer'];
									//FOR COLOR TEST LIGHT GREEN 
									if($recRow['correct_answer'] == 1){
										$this->objPHPExcel->getActiveSheet()->getStyleByColumnAndRow($col,$row)->getFill()->setFillType(PHPExcel_Style_Fill::FILL_SOLID)->getStartColor()->setARGB('CCFF99');
									}
									$this->objPHPExcel->getActiveSheet()->setCellValueByColumnAndRow($col,$row, $recRow['User_answer']  );
									 
									//$this->objPHPExcel->getActiveSheet()->getStyleByColumnAndRow($col1, $row)->getNumberFormat()->setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_PERCENTAGE);
									
									$this->objPHPExcel->getActiveSheet()->setCellValueByColumnAndRow($col1,$row, ($correct_answer / $no_of_question));
									
									
								}else{
									
									
									$old_fusion_id =  $recRow['fusion_id'];
									$correct_answer=0;
									$col=0;
									$row++;
									$this->objPHPExcel->getActiveSheet()->setCellValueByColumnAndRow($col,$row, $cnt++ );
									$col++;
									$this->objPHPExcel->getActiveSheet()->setCellValueByColumnAndRow($col,$row, $recRow['fusion_id'] );
									$col++;
									$this->objPHPExcel->getActiveSheet()->setCellValueByColumnAndRow($col,$row, $recRow['fname']." ".$recRow['lname'] );
									$col++;
									$this->objPHPExcel->getActiveSheet()->setCellValueByColumnAndRow($col,$row, $recRow['asign_tl'] );
									$col++;
									//FOR COLOR TEST LIGHT GREEN 
									if($recRow['correct_answer'] == 1){
										$this->objPHPExcel->getActiveSheet()->getStyleByColumnAndRow($col,$row)->getFill()->setFillType(PHPExcel_Style_Fill::FILL_SOLID)->getStartColor()->setARGB('CCFF99');
									}
									
									$this->objPHPExcel->getActiveSheet()->setCellValueByColumnAndRow($col,$row, $recRow['User_answer']  );
									$correct_answer += $recRow['correct_answer'];  
									
									
								}
								
								
								  
							}
							
					}


  
		    ob_end_clean();
            header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
            header('Content-Disposition: attachment;filename="dipcheck_'.$heading.'.xlsx"');
            header('Cache-Control: max-age=0');
            $objWriter = PHPExcel_IOFactory::createWriter($this->objPHPExcel , 'Excel2007');
            $objWriter->setIncludeCharts(TRUE);
            $objWriter->save('php://output');
			exit();  
            	
		}
	}



	///////////////////////////////////////////////////////////////////////////
	
/*------------------QA OYO Report-----------------------------*/	
	public function qa_oyo_report(){
		if(check_logged_in()){
			
			$office_id = "";
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = $this->input->get('office_id');
			if($office_id=="")  $office_id=$user_office_id;
			
			
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_oyo_report.php";
			
			
			$date_from="";
			$date_to="";
			$action="";
			$dn_link="";
			
			
			$pValue = trim($this->input->post('process_id'));
			if($pValue=="") $pValue = trim($this->input->get('process_id'));
			
			$lob = trim($this->input->get('lob'));
			
			
			$data['pValue']=$pValue;
			$data['lob']=$lob;
			
			
			
			$data["qa_oyo_list"] = array();
			
			/* if(get_role_dir()=="super" || $is_global_access==1){
				$data['location_list'] = $this->Common_model->get_office_location_list();
			}else{
				$data['location_list'] = $this->Common_model->get_office_location_session_all($current_user);
			} */
			
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				$field_array = array(
						"date_from"=>$date_from,
						"date_to" => $date_to,
						"office_id" => $office_id,
						"process_id" => $pValue,
						"lob" => $lob,
						"current_user" => $current_user
					);
					
				
				if($pValue=='OYO IBD'){
					$fullAray = $this->reports_model->qa_oyo_report_model($field_array);
					$data["qa_oyo_list"] = $fullAray;
					$this->create_qa_oyo_ibd_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_oyo_ibd_CSV";
				
				}else if($pValue=='OYO SIG'){
					
					$fullAray = $this->reports_model->qa_oyo_report_model($field_array);
					$data["qa_oyo_list"] = $fullAray;
					$this->create_qa_oyo_sig_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_oyo_sig_CSV";
					
				}else if($pValue=='OYO LIFE'){
					
					if($lob=='IB/OB'){
						$fullAray = $this->reports_model->qa_oyo_report_model($field_array);
						$data["qa_oyo_list"] = $fullAray;
						$this->create_qa_oyolife_ibob_CSV($fullAray);	
						$dn_link = base_url()."reports_qa/download_qa_oyolife_ibob_CSV";
					}else{
						$fullAray = $this->reports_model->qa_oyo_report_model($field_array);
						$data["qa_oyo_list"] = $fullAray;
						$this->create_qa_oyolife_followup_CSV($fullAray,$lob);	
						$dn_link = base_url()."reports_qa/download_qa_oyolife_followup_CSV/".$lob;
					}
				
				}else if($pValue=='Social Media RCA'){
					
					$fullAray = $this->reports_model->qa_oyo_report_model($field_array);
					$data["qa_oyo_list"] = $fullAray;
					$this->create_qa_oyo_sme_rca_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_oyo_sme_rca_CSV";
					
				}else if($pValue=='UK/US'){
					
					$fullAray = $this->reports_model->qa_oyo_report_model($field_array);
					$data["qa_oyo_list"] = $fullAray;
					$this->create_qa_oyo_uk_us_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_oyo_uk_us_CSV";
				
				}else if($pValue=='OYOINB'){
					
					$fullAray = $this->reports_model->qa_oyo_report_model($field_array);
					$data["qa_oyo_list"] = $fullAray;
					$this->create_qa_oyoinb_new_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_oyoinb_new_CSV";
					
				}else if($pValue=='OYO SIG New' || $pValue=='oyo_sigchat_service' || $pValue=='oyo_sigchat_escalation'){
					
					$fullAray = $this->reports_model->qa_oyo_report_model($field_array);
					$data["qa_oyo_list"] = $fullAray;
					$this->create_qa_oyosig_new_CSV($fullAray,$pValue);	
					$dn_link = base_url()."reports_qa/download_qa_oyosig_new_CSV/".$pValue;
				
				}else{
				
					$fullAray = $this->reports_model->qa_oyo_report_model($field_array);
					$data["qa_oyo_list"] = $fullAray;
					$this->create_qa_oyo_dsat_rcasig_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_oyo_dsat_rcasig_CSV";
				
				}
				
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			
			$this->load->view('dashboard',$data);
		}
	}
	

/*---------OYO IBD CSS Part Start-----------*/	
	public function download_qa_oyo_ibd_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA OYO International List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_oyo_ibd_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Fusion ID", "Agent Name", "L1 Supervisor", "Phone", "Call Duration", "Recorded Date Time", "Mail ID", "Booking ID", "Audit Date", "Auditor Name", "Call Type", "Campiagn", "opening and Branding", "Acknowledgment", "Personalization", "Verification Process", "Politeness", "Empathy", "Overlapping", "Relevant Probing", "Enthusiasm", "Switch Language", "Voice Clarity", "Intonation", "Grammar", "Transfer", "Dead Air", "Complaint", "Selling Efforts", "Rebuttals", "USPS", " Payment Confirmation", "Retention", "Ownership", "Disclosure", "CRS", "Adherence", "Summarization", "IVR", "Further Assistance", "Closing", "Overall Result", "Overall Score","Call Summary", "Feedback", "Infraction Stat", "Remarks", "Agent Review Date", "Agent Review Comment", "Mgnt Review Date", "Mgnt Review Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			$row = '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['agent_name'].'",'; 
			$row .= '"'.$user['tl_name'].'",'; 
			$row .= '"'.$user['agent_phone'].'",'; 
			$row .= '"'.$user['call_duration'].'",'; 
			$row .= '"'.$user['record_date_time'].'",'; 
			$row .= '"'.$user['mail_id'].'",'; 
			$row .= '"'.$user['booking_id'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['call_type'].'",'; 
			$row .= '"'.$user['process_name'].'",'; 
			$row .= '"'.$user['opening_and_branding'].'",'; 
			$row .= '"'.$user['acknowledgement'].'",'; 
			$row .= '"'.$user['personalization'].'",'; 
			$row .= '"'.$user['verification_process'].'",'; 
			$row .= '"'.$user['politeness'].'",'; 
			$row .= '"'.$user['empathy'].'",'; 
			$row .= '"'.$user['overlapping'].'",'; 
			$row .= '"'.$user['relevant_probing'].'",'; 
			$row .= '"'.$user['enthusiasm'].'",'; 
			$row .= '"'.$user['switch_language'].'",'; 
			$row .= '"'.$user['voice_clarity'].'",'; 
			$row .= '"'.$user['intonation'].'",'; 
			$row .= '"'.$user['grammar'].'",'; 
			$row .= '"'.$user['transfer'].'",'; 
			$row .= '"'.$user['dead_air'].'",'; 
			$row .= '"'.$user['complaint'].'",'; 
			$row .= '"'.$user['selling_efforts'].'",'; 
			$row .= '"'.$user['rebuttals'].'",'; 
			$row .= '"'.$user['usps'].'",'; 
			$row .= '"'.$user['payment_confirmation'].'",'; 
			$row .= '"'.$user['retention'].'",'; 
			$row .= '"'.$user['ownership'].'",'; 
			$row .= '"'.$user['disclosure'].'",'; 
			$row .= '"'.$user['crs'].'",'; 
			$row .= '"'.$user['adherence'].'",'; 
			$row .= '"'.$user['summarization'].'",'; 
			$row .= '"'.$user['ivr'].'",'; 
			$row .= '"'.$user['further_assistance'].'",'; 
			$row .= '"'.$user['closing'].'",'; 
			$row .= '"'.$user['overall_result'].'",'; 
			$row .= '"'.$user['overall_score'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['infraction_stat'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['reason_type'])).'",';
			$row .= '"'.$user['agent_rvw_dt'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw'])).'",';
			$row .= '"'.$user['mgnt_rvw_dt'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw'])).'",';
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}	

	
/*----------------OYO SIG CSS Part Start--------------------*/	
	public function download_qa_oyo_sig_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA OYO SIG List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_oyo_sig_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Fusion ID", "Agent Name", "Tenurity", "Batch Code", "C-zentrix", "L1 Supervisor", "Call Duration", "Recorded Date Time", "Booking ID", "Audit Date", "Auditor Name", "Call Type", "Ticket ID", "Phone", "Campaign", "Audit Type", "VOC", "Overall Score", "Overall Result", "Call Summary", "Feedback", "call Open 5sec", "call Open Self Intro", "call Open Score", "Probing Issue Indetify", "Probing Responce Positively", "Probing Effective", "Probing Score", "Soft Skill Apology", "Soft Skill Voice Intonation", "Soft Skill Active Listening", "Soft Skill Confidence", "Soft Skill Politeness", "Soft Skill Grammar", "Soft Skill Acknowledgment", "Soft Skill Score", "Hold Dead Ask Permission", "Hold Dead Unhold Procedure", "Hold Dead Took Guest Permission *", "Hold Dead do not Refresh *", "Hold Dead avoid Dead Air", "Hold Dead Score", "Resolution Fatal Correct Booking *", "Resolution Fatal Correct Information *", "Resolution Fatal Correct Refund *", "Resolution Fatal Proper Follow up *", "Resolution Fatal Recon Adjustment *", "Resolution Fatal Score", "Resolution Nonfatal gnc Closure", "Resolution Nonfatal Duplicate Ticket", "Resolution Nonfatal ccb Process", "Resolution Nonfatal case Library", "Resolution Nonfatal Email to Sent", "Resolution Nonfatal Score", "Fresh Desk Complete Notes", "Fresh Desk Tagging Issue *", "Fresh Desk Incorrect Shifting *", "Fresh Desk Correct Ticket Status *", "Fresh Desk did Agent Verify *", "Fresh Desk Agent meet Compliant *", "Fresh Desk Score", "Closing Further Assistance", "Closing Done Branding", "Closing G-sat Survey Pitched", "Closing G-sat Survey Avoidance *", "OYO Assist Pitch", "Closing Score", "Wow Factor Call Take Positive", "Agent Review Date", "Agent Comment", "Management Review Date", "Management Comment", "Coach Name");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
		
			if($user['cl_open_5_sec']==2) $cl_open_5_sec='Pass';
			else if($user['cl_open_5_sec']==2.1) $cl_open_5_sec='N/A';
			else $cl_open_5_sec='Fail';
			
			if($user['cl_open_self_intro']==2) $cl_open_self_intro='Pass';
			else if($user['cl_open_self_intro']==2.1) $cl_open_self_intro='N/A';
			else $cl_open_self_intro='Fail';
			
			if($user['probing_issue_indetify']==2) $probing_issue_indetify='Pass';
			else if($user['probing_issue_indetify']==2.1) $probing_issue_indetify='N/A';
			else $probing_issue_indetify='Fail';
			
			if($user['probing_responce_positively']==2) $probing_responce_positively='Pass';
			else if($user['probing_responce_positively']==2.1) $probing_responce_positively='N/A';
			else $probing_responce_positively='Fail';
			
			if($user['probing_effective']==2) $probing_effective='Pass';
			else if($user['probing_effective']==2.1) $probing_effective='N/A';
			else $probing_effective='Fail';
			
			if($user['soft_skill_apology']==3) $soft_skill_apology='Pass';
			else if($user['soft_skill_apology']==3.1) $soft_skill_apology='N/A';
			else $soft_skill_apology='Fail';
			
			if($user['soft_skill_voice_intonation']==1) $soft_skill_voice_intonation='Pass';
			else if($user['soft_skill_voice_intonation']==1.1) $soft_skill_voice_intonation='N/A';
			else $soft_skill_voice_intonation='Fail';
			
			if($user['soft_skill_active_listening']==3) $soft_skill_active_listening='Pass';
			else if($user['soft_skill_active_listening']==3.1) $soft_skill_active_listening='N/A';
			else $soft_skill_active_listening='Fail';
			
			if($user['soft_skill_confidence']==2) $soft_skill_confidence='Pass';
			else if($user['soft_skill_confidence']==2.1) $soft_skill_confidence='N/A';
			else $soft_skill_confidence='Fail';
			
			if($user['soft_skill_politeness']==2) $soft_skill_politeness='Pass';
			else if($user['soft_skill_politeness']==2.1) $soft_skill_politeness='N/A';
			else $soft_skill_politeness='Fail';
			
			if($user['soft_skill_grammar']==2) $soft_skill_grammar='Pass';
			else if($user['soft_skill_grammar']==2.1) $soft_skill_grammar='N/A';
			else $soft_skill_grammar='Fail';
			
			if($user['soft_skill_acknowledgement']==2) $soft_skill_acknowledgement='Pass';
			else if($user['soft_skill_acknowledgement']==2.1) $soft_skill_acknowledgement='N/A';
			else $soft_skill_acknowledgement='Fail';
			
			if($user['hold_dead_ask_permission']==2) $hold_dead_ask_permission='Pass';
			else if($user['hold_dead_ask_permission']==2.1) $hold_dead_ask_permission='N/A';
			else $hold_dead_ask_permission='Fail';
			
			if($user['hold_dead_unhold_procedure']==2) $hold_dead_unhold_procedure='Pass';
			else if($user['hold_dead_unhold_procedure']==2.1) $hold_dead_unhold_procedure='N/A';
			else $hold_dead_unhold_procedure='Fail';
			
			if($user['hold_dead_took_guest_permission']==2) $hold_dead_took_guest_permission='Pass';
			else if($user['hold_dead_took_guest_permission']==2.1) $hold_dead_took_guest_permission='N/A';
			else $hold_dead_took_guest_permission='Fail';
			
			if($user['hold_dead_do_not_refresh']==2) $hold_dead_do_not_refresh='Pass';
			else if($user['hold_dead_do_not_refresh']==2.1) $hold_dead_do_not_refresh='N/A';
			else $hold_dead_do_not_refresh='Fail';
			
			if($user['hold_dead_avoid_dead_air']==2) $hold_dead_avoid_dead_air='Pass';
			else if($user['hold_dead_avoid_dead_air']==2.1) $hold_dead_avoid_dead_air='N/A';
			else $hold_dead_avoid_dead_air='Fail';
			
			if($user['resolution_fatal_correct_booking']==3) $resolution_fatal_correct_booking='Pass';
			else if($user['resolution_fatal_correct_booking']==3.1) $resolution_fatal_correct_booking='N/A';
			else $resolution_fatal_correct_booking='Fail';
			
			if($user['resolution_fatal_correct_information']==3) $resolution_fatal_correct_information='Pass';
			else if($user['resolution_fatal_correct_information']==3.1) $resolution_fatal_correct_information='N/A';
			else $resolution_fatal_correct_information='Fail';
			
			if($user['resolution_fatal_correct_refund']==3) $resolution_fatal_correct_refund='Pass';
			else if($user['resolution_fatal_correct_refund']==3.1) $resolution_fatal_correct_refund='N/A';
			else $resolution_fatal_correct_refund='Fail';
			
			if($user['resolution_fatal_proper_follow_up']==3) $resolution_fatal_proper_follow_up='Pass';
			else if($user['resolution_fatal_proper_follow_up']==3.1) $resolution_fatal_proper_follow_up='N/A';
			else $resolution_fatal_proper_follow_up='Fail';
			
			if($user['resolution_fatal_recon_adjustment']==3) $resolution_fatal_recon_adjustment='Pass';
			else if($user['resolution_fatal_recon_adjustment']==3.1) $resolution_fatal_recon_adjustment='N/A';
			else $resolution_fatal_recon_adjustment='Fail';
			
			if($user['resolution_nonfatal_gnc_closure']==3) $resolution_nonfatal_gnc_closure='Pass';
			else if($user['resolution_nonfatal_gnc_closure']==3.1) $resolution_nonfatal_gnc_closure='N/A';
			else $resolution_nonfatal_gnc_closure='Fail';
			
			if($user['resolution_nonfatal_gnc_closure']==3) $resolution_nonfatal_gnc_closure='Pass';
			else if($user['resolution_nonfatal_gnc_closure']==3.1) $resolution_nonfatal_gnc_closure='N/A';
			else $resolution_nonfatal_gnc_closure='Fail';
			
			if($user['resolution_nonfatal_duplicate_ticket']==3) $resolution_nonfatal_duplicate_ticket='Pass';
			else if($user['resolution_nonfatal_duplicate_ticket']==3.1) $resolution_nonfatal_duplicate_ticket='N/A';
			else $resolution_nonfatal_duplicate_ticket='Fail';
			
			if($user['resolution_nonfatal_ccb_process']==2) $resolution_nonfatal_ccb_process='Pass';
			else if($user['resolution_nonfatal_ccb_process']==2.1) $resolution_nonfatal_ccb_process='N/A';
			else $resolution_nonfatal_ccb_process='Fail';
			
			if($user['resolution_nonfatal_case_library']==4) $resolution_nonfatal_case_library='Pass';
			else if($user['resolution_nonfatal_case_library']==4.1) $resolution_nonfatal_case_library='N/A';
			else $resolution_nonfatal_case_library='Fail';
			
			if($user['resolution_nonfatal_email_to_sent']==4) $resolution_nonfatal_email_to_sent='Pass';
			else if($user['resolution_nonfatal_email_to_sent']==4.1) $resolution_nonfatal_email_to_sent='N/A';
			else $resolution_nonfatal_email_to_sent='Fail';
			
			if($user['fresh_desk_complete_notes']==6) $fresh_desk_complete_notes='Pass';
			else if($user['fresh_desk_complete_notes']==6.1) $fresh_desk_complete_notes='N/A';
			else $fresh_desk_complete_notes='Fail';
			
			if($user['fresh_desk_tagging_issue']==4) $fresh_desk_tagging_issue='Pass';
			else if($user['fresh_desk_tagging_issue']==4.1) $fresh_desk_tagging_issue='N/A';
			else $fresh_desk_tagging_issue='Fail';
			
			if($user['fresh_desk_incorrect_shifting']==3) $fresh_desk_incorrect_shifting='Pass';
			else if($user['fresh_desk_incorrect_shifting']==3.1) $fresh_desk_incorrect_shifting='N/A';
			else $fresh_desk_incorrect_shifting='Fail';
			
			if($user['fresh_desk_correct_ticket_status']==4) $fresh_desk_correct_ticket_status='Pass';
			else if($user['fresh_desk_correct_ticket_status']==4.1) $fresh_desk_correct_ticket_status='N/A';
			else $fresh_desk_correct_ticket_status='Fail';
			
			if($user['fresh_desk_did_agent_verify']==2) $fresh_desk_did_agent_verify='Pass';
			else if($user['fresh_desk_did_agent_verify']==2.1) $fresh_desk_did_agent_verify='N/A';
			else $fresh_desk_did_agent_verify='Fail';
			
			if($user['fresh_desk_agent_meet_compliant']==3) $fresh_desk_agent_meet_compliant='Pass';
			else if($user['fresh_desk_agent_meet_compliant']==3.1) $fresh_desk_agent_meet_compliant='N/A';
			else $fresh_desk_agent_meet_compliant='Fail';
			
			if($user['closing_further_assistance']==2) $closing_further_assistance='Pass';
			else if($user['closing_further_assistance']==2.1) $closing_further_assistance='N/A';
			else $closing_further_assistance='Fail';
			
			if($user['closing_done_branding']==2) $closing_done_branding='Pass';
			else if($user['closing_done_branding']==2.1) $closing_done_branding='N/A';
			else $closing_done_branding='Fail';
			
			if($user['closing_gsat_survey_pitched']==4) $closing_gsat_survey_pitched='Pass';
			else if($user['closing_gsat_survey_pitched']==4.1) $closing_gsat_survey_pitched='N/A';
			else $closing_gsat_survey_pitched='Fail';
			
			if($user['closing_gsat_survey_avoidance']==2) $closing_gsat_survey_avoidance='Pass';
			else if($user['closing_gsat_survey_avoidance']==2.1) $closing_gsat_survey_avoidance='N/A';
			else $closing_gsat_survey_avoidance='Fail';
			
			if($user['oyo_assist_pitch']==2) $oyo_assist_pitch='Pass';
			else if($user['oyo_assist_pitch']==2.1) $oyo_assist_pitch='N/A';
			else $oyo_assist_pitch='Fail';
			
			$row = '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['agent_name'].'",'; 
			$row .= '"'.$user['tenurity'].'",'; 
			$row .= '"'.$user['batch_code'].'",'; 
			$row .= '"'.$user['czentrix'].'",';
			$row .= '"'.$user['tl_name'].'",'; 
			$row .= '"'.$user['call_duration'].'",'; 
			$row .= '"'.$user['record_date_time'].'",';
			$row .= '"'.$user['booking_id'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['call_type'].'",'; 
			$row .= '"'.$user['ticket_id'].'",'; 
			$row .= '"'.$user['guest_phone'].'",'; 
			$row .= '"'.$user['campaign'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['overall_score'].'",'; 
			$row .= '"'.$user['overall_result'].'",'; 
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$cl_open_5_sec.'",'; 
			$row .= '"'.$cl_open_self_intro.'",'; 
			$row .= '"'.$user['cl_open_overall_score'].'",'; 
			$row .= '"'.$probing_issue_indetify.'",'; 
			$row .= '"'.$probing_responce_positively.'",'; 
			$row .= '"'.$probing_effective.'",'; 
			$row .= '"'.$user['probing_overall_score'].'",'; 
			$row .= '"'.$soft_skill_apology.'",'; 
			$row .= '"'.$soft_skill_voice_intonation.'",'; 
			$row .= '"'.$soft_skill_active_listening.'",'; 
			$row .= '"'.$soft_skill_confidence.'",'; 
			$row .= '"'.$soft_skill_politeness.'",'; 
			$row .= '"'.$soft_skill_grammar.'",'; 
			$row .= '"'.$soft_skill_acknowledgement.'",'; 
			$row .= '"'.$user['soft_skill_overall_score'].'",'; 
			$row .= '"'.$hold_dead_ask_permission.'",'; 
			$row .= '"'.$hold_dead_unhold_procedure.'",'; 
			$row .= '"'.$hold_dead_took_guest_permission.'",'; 
			$row .= '"'.$hold_dead_do_not_refresh.'",'; 
			$row .= '"'.$hold_dead_avoid_dead_air.'",'; 
			$row .= '"'.$user['hold_dead_overall_score'].'",'; 
			$row .= '"'.$resolution_fatal_correct_booking.'",'; 
			$row .= '"'.$resolution_fatal_correct_information.'",'; 
			$row .= '"'.$resolution_fatal_correct_refund.'",'; 
			$row .= '"'.$resolution_fatal_proper_follow_up.'",'; 
			$row .= '"'.$resolution_fatal_recon_adjustment.'",'; 
			$row .= '"'.$user['resolution_fatal_overall_score'].'",'; 
			$row .= '"'.$resolution_nonfatal_gnc_closure.'",'; 
			$row .= '"'.$resolution_nonfatal_duplicate_ticket.'",'; 
			$row .= '"'.$resolution_nonfatal_ccb_process.'",'; 
			$row .= '"'.$resolution_nonfatal_case_library.'",'; 
			$row .= '"'.$resolution_nonfatal_email_to_sent.'",'; 
			$row .= '"'.$user['resolution_nonfatal_overall_score'].'",'; 
			$row .= '"'.$fresh_desk_complete_notes.'",'; 
			$row .= '"'.$fresh_desk_tagging_issue.'",'; 
			$row .= '"'.$fresh_desk_incorrect_shifting.'",'; 
			$row .= '"'.$fresh_desk_correct_ticket_status.'",'; 
			$row .= '"'.$fresh_desk_did_agent_verify.'",'; 
			$row .= '"'.$fresh_desk_agent_meet_compliant.'",'; 
			$row .= '"'.$user['fresh_desk_overall_score'].'",'; 
			$row .= '"'.$closing_further_assistance.'",'; 
			$row .= '"'.$closing_done_branding.'",'; 
			$row .= '"'.$closing_gsat_survey_pitched.'",'; 
			$row .= '"'.$closing_gsat_survey_avoidance.'",'; 
			$row .= '"'.$oyo_assist_pitch.'",'; 
			$row .= '"'.$user['closing_overall_score'].'",'; 
			$row .= '"'.$user['wow_factor_cl_take_positive'].'",';
			$row .= '"'.$user['review_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agnt_comnt'])).'",';
			$row .= '"'.$user['mgnt_review_date'].'",'; 
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_comnt'])).'",';
			$row .= '"'.$user['coach_name'].'",'; 
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}
	
	
/*---------OYO RCA CSS Part Start-----------*/	
	public function download_qa_oyo_dsat_rcasig_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA OYO DSAT SIG RCA List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	
	public function create_qa_oyo_dsat_rcasig_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Supervisor", "Ticket ID", "Rating", "Czentrix ID", "Issue Category", "Issue Subcategory", "Guest Call Issue", "Control/Uncontrol", "ACPT", "WHY1", "WHY2", "Call Summary", "Feedback");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['agent_name'].'",'; 
			$row .= '"'.$user['tl_name'].'",'; 
			$row .= '"'.$user['ticket_id'].'",'; 
			$row .= '"'.$user['rating'].'",'; 
			$row .= '"'.$user['czentrix_id'].'",'; 
			$row .= '"'.$user['sigrca_cat'].'",'; 
			$row .= '"'.$user['sigrca_subcat'].'",'; 
			$row .= '"'.$user['guest_call_issue'].'",'; 
			$row .= '"'.$user['control_uncontrol'].'",'; 
			$row .= '"'.$user['acpt'].'",'; 
			$row .= '"'.$user['why1'].'",'; 
			$row .= '"'.$user['why2'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'"';
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}
	
/*---------OYO  Social Media Escalation RCA CSS Part Start-----------*/	
	public function download_qa_oyo_sme_rca_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA OYO Social Media Escalation RCA List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	
	public function create_qa_oyo_sme_rca_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "Campaign", "L1 Supervisor", "Booking ID", "Ticket1", "Ticket2", "Ticket3", "Caller No", "ORM Ticket", "Complaint Type", "Transaction", "Defective Transaction", "Escalated Date", "Week", "Call Date", "Fusion Prevent", "Monetory Loss", "Amount", "ACPT", "WHY1", "WHY2", "Action Policy", "Call Summary", "Feedback");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['agent_name'].'",'; 
			$row .= '"'.$user['campaign'].'",'; 
			$row .= '"'.$user['tl_name'].'",'; 
			$row .= '"'.$user['booking_id'].'",';
			$row .= '"'.$user['ticket1'].'",'; 
			$row .= '"'.$user['ticket2'].'",'; 
			$row .= '"'.$user['ticket3'].'",'; 
			$row .= '"'.$user['caller_no'].'",'; 
			$row .= '"'.$user['orm_ticket'].'",'; 
			$row .= '"'.$user['complaint_type'].'",'; 
			$row .= '"'.$user['transaction'].'",'; 
			$row .= '"'.$user['defective_transaction'].'",'; 
			$row .= '"'.$user['escalated_date'].'",'; 
			$row .= '"'.$user['week'].'",'; 
			$row .= '"'.$user['call_date'].'",'; 
			$row .= '"'.$user['fusion_prevent'].'",'; 
			$row .= '"'.$user['monetory_loss'].'",'; 
			$row .= '"'.$user['amount'].'",'; 
			$row .= '"'.$user['acpt'].'",'; 
			$row .= '"'.$user['why1'].'",'; 
			$row .= '"'.$user['why2'].'",';
			$row .= '"'.$user['action_policy'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'"';
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}	
	

/*----------------OYO LIFE IB/OB CSS Part Start--------------------*/	
	public function download_qa_oyolife_ibob_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA OYO Life Inbound/Outbound List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_oyolife_ibob_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Fusion ID", "Agent Name", "L1 Supervisor", "Campaign", "Auditor", "Audit Date Time", "Call Date Time", "Call Duration", "Phone", "LOB", "Audit Type", "VOC", "Welcome the Customer", "WC Reason", "Know the Customer", "KYC Reason", "Effective Communication", "EC Reason", "Building Rapport", "BR Reason", "Maintain Courtesy", "MC Reason", "Probing Assistance *", "PA Reason *", "Significance of Information *", "SI Reason *", "Action for Solution *", "AS Reason *", "Proper Documentation", "PD Reason", "Zero Tolerance Policy *", "ZTP Reason *", "Overall Score", "Agent Disposition", "Actual Disposition", "Correct/Incorrect", "Opportunity/Non Opportunity", "Rebuttals/Probing Used", "ACPT", "Observation L1", "Audit Observations", "Agent informed the customer about creating a SAV?", "Customer agreed for a SAV?", "Correct property details & Pricing pitched?", "Valid / Invalid?", "Call Summary", "Feedback", "Agent Review Date", "Agent Review Comment", "Mgnt Reviewed By", "Mgnt Review Date", "Mgnt Review Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
		
			if($user['welcome_customer']=='0') $welcome_customer='0%';
			else $welcome_customer='100%';
			if($user['know_customer']=='0') $know_customer='0%';
			else $know_customer='100%';
			if($user['effective_communication']=='0') $effective_communication='0%';
			else $effective_communication='100%';
			if($user['building_rapport']=='0') $building_rapport='0%';
			else $building_rapport='100%';
			if($user['maintain_courtesy']=='0') $maintain_courtesy='0%';
			else $maintain_courtesy='100%';
			if($user['probing_assistance']=='-1') $probing_assistance='0%';
			else $probing_assistance='100%';
			if($user['significance_info']=='-1') $significance_info='0%';
			else $significance_info='100%';
			if($user['action_solution']=='-1') $action_solution='0%';
			else $action_solution='100%';
			if($user['proper_docu']=='0') $proper_docu='0%';
			else $proper_docu='100%';
			
			
			$row = '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['campaign'].'",';
			$row .= '"'.$user['auditor_name'].'",';
			$row .= '"'.$user['audit_date'].'",';
			$row .= '"'.$user['call_date_time'].'",';
			$row .= '"'.$user['call_duration'].'",';
			$row .= '"'.$user['phone'].'",';
			$row .= '"'.$user['lob'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$welcome_customer.'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['wc_reason'])).'",';
			$row .= '"'.$know_customer.'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['kyc_reason'])).'",';
			$row .= '"'.$effective_communication.'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['ec_reason'])).'",';
			$row .= '"'.$building_rapport.'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['br_reason'])).'",';
			$row .= '"'.$maintain_courtesy.'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mc_reason'])).'",';
			$row .= '"'.$probing_assistance.'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['pa_reason'])).'",';
			$row .= '"'.$significance_info.'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['si_reason'])).'",';
			$row .= '"'.$action_solution.'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['as_reason'])).'",';
			$row .= '"'.$proper_docu.'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['pd_reason'])).'",';
			$row .= '"'.$user['zero_tolerance'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['ztp_reason'])).'",';
			$row .= '"'.$user['overall_score'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_disposition'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['actual_dispo'])).'",';
			$row .= '"'.$user['correct_incorrect'].'",';
			$row .= '"'.$user['oppor_nonoppor'].'",';
			$row .= '"'.$user['rebuttals_probing'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['acpt'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['observation_l1'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['audit_observe'])).'",';
			$row .= '"'.$user['agent_info'].'",';
			$row .= '"'.$user['customer_agreed'].'",';
			$row .= '"'.$user['correct_property'].'",';
			$row .= '"'.$user['valid_invalid'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}	
	
/*----------------OYO LIFE FOLLOW UP CSS Part Start--------------------*/	
	public function download_qa_oyolife_followup_CSV($lob)
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		
		if($lob=='Booking'){
			$newfile="QA OYO Life Booking List-'".$currDate."'.csv";
		}else{
			$newfile="QA OYO Life Follow Up List-'".$currDate."'.csv";
		}
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_oyolife_followup_CSV($rr,$lob)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Fusion ID", "Agent Name", "L1 Supervisor", "Auditor", "Audit Date Time", "Call Date Time", "Call Duration", "Phone", "Campaign", "Audit Type", "VOC", "Opening", "Opening Reason", "Product *", "Product Reason *", "Rebuttals *", "Rebuttals Reason *", "Sales Effort *", "Sales Effort Reason *", "Closing", "Closing Reason", "Compliance", "Compliance Reason", "Zero Tolerance Policy *", "ZTP Reason *", "Overall Score", "Agent Disposition", "Actual Disposition", "Correct/Incorrect", "ACPT", "Audit Observations", "L1 Observation", "Call Summary", "Feedback", "Agent Review Date", "Agent Review Comment", "Mgnt Reviewed By", "Mgnt Review Date", "Mgnt Review Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
		
			if($user['opening']=='0') $opening='0%';
			else $opening='100%';
			if($user['product']=='-1') $product='0%';
			else $product='100%';
			if($user['rebuttals']=='-1') $rebuttals='0%';
			else $rebuttals='100%';
			if($user['sales_effort']=='-1') $sales_effort='0%';
			else $sales_effort='100%';
			if($user['closing']=='0') $closing='0%';
			else $closing='100%';
			if($user['compliance']=='0') $compliance='0%';
			else $compliance='100%';
			
			
			$row = '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['auditor_name'].'",';
			$row .= '"'.$user['audit_date'].'",';
			$row .= '"'.$user['call_date_time'].'",';
			$row .= '"'.$user['call_duration'].'",';
			$row .= '"'.$user['phone'].'",';
			$row .= '"'.$user['campaign'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$opening.'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['opening_reason'])).'",';
			$row .= '"'.$product.'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['product_reason'])).'",';
			$row .= '"'.$rebuttals.'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['rebuttals_reason'])).'",';
			$row .= '"'.$sales_effort.'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['sales_effort_reason'])).'",';
			$row .= '"'.$closing.'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['closing_reason'])).'",';
			$row .= '"'.$compliance.'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['compliance_reason'])).'",';
			$row .= '"'.$user['zero_tolerance'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['ztp_reason'])).'",';
			$row .= '"'.$user['overall_score'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_dispo'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['actual_dispo'])).'",';
			$row .= '"'.$user['correct_incorrect'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['acpt'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['audit_observe'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['l1_observe'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}
	
/*----------------OYO UK / US CSS Part Start--------------------*/	
	public function download_qa_oyo_uk_us_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA OYO UK/US Audit List-'".$currDate."'.csv";
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_oyo_uk_us_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Recording Date and Time", "Avaya ID", "Call Duration", "Phone", "Booking ID", "Geography to be audited", "Type of Audit", "Cancellation Sub Type", "ACPT", "Call Type", "Call Sub Type", "Tagging by Agent - Call Type", "agging by Agent - Call Sub Type", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Delayed Opening >10 sec", "Was the opening correct?", "Did the agent ask for further assistance?", "Was the closure correct?", "Was there any grammatical error on the call?", "Was there any MTI observed on the call?", "Did the agent display active listening skills on the call?", "Did the agent do relevant probing?", "Did the agent provide the correct tariff room category etc?", "Did the agent start from the lowest discount?", "Did the agent offer alternate property to the customer?", "Did the agent pitch for additional nights?", "Did the agent create urgency on call?", "Did the agent give the property details with the DID information?", "Did the agent check in lifeline with the right property?", "Did the agent check with the PM?", "Did the agent summarize the call?", "Did the agent effectively pitch for on-call payment?", "Was the tagging/disposition correct?", "Did the agent adhere to the SOP?", "Did the agent provide any incorrect or misleading information to the customer?", "Was there any ZTP observed on the call?", "Did the agent capture correct information of the customer?", "Did the agent give all the mandatory information?", "Did the agent create correct booking?", "Did the agent acknowledge the concern of the customer?", "Was the agent polite/courteous on the call?", "Did the agent show empathy/sympathy/apology when required?", "Did the agent take the name of the customer atleast twice on the call?", "Was there any dead air on the call?", "Did the agent follow hold procedure?", "Was the agent energetic throughout the call?", "Call Summary", "Feedback", "L1", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
		
			if($user['entry_by']!=''){
				$auditorName = $user['auditor_name'];
			}else{
				$auditorName = $user['client_name'];
			}
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$auditorName.'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['avaya_id'].'",';
			$row .= '"'.$user['call_duration'].'",';
			$row .= '"'.$user['phone'].'",';
			$row .= '"'.$user['booking_id'].'",';
			$row .= '"'.$user['geography_audit'].'",';
			$row .= '"'.$user['type_audit'].'",';
			$row .= '"'.$user['cancel_sub_audit_type'].'",';
			$row .= '"'.$user['acpt'].'",';
			$row .= '"'.$user['call_type'].'",';
			$row .= '"'.$user['call_sub_type'].'",';
			$row .= '"'.$user['agent_call_type'].'",';
			$row .= '"'.$user['agent_call_sub_type'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'.$user['delayed_opening'].'",';
			$row .= '"'.$user['was_opening_correct'].'",';
			$row .= '"'.$user['agent_ask_further_assistance'].'",';
			$row .= '"'.$user['was_closure_correct'].'",';
			$row .= '"'.$user['grammatical_error'].'",';
			$row .= '"'.$user['MTI_observed_call'].'",';
			$row .= '"'.$user['display_active_listening'].'",';
			$row .= '"'.$user['agent_relevant_probing'].'",';
			$row .= '"'.$user['agent_provide_correct_tariff'].'",';
			$row .= '"'.$user['start_lowest_discount'].'",';
			$row .= '"'.$user['offer_alternate_property'].'",';
			$row .= '"'.$user['pitch_additional_night'].'",';
			$row .= '"'.$user['create_call_urgency'].'",';
			$row .= '"'.$user['give_property_details'].'",';
			$row .= '"'.$user['agent_check_lifeline'].'",';
			$row .= '"'.$user['check_with_PM'].'",';
			$row .= '"'.$user['agent_summarize_call'].'",';
			$row .= '"'.$user['pitch_for_on_call'].'",';
			$row .= '"'.$user['was_tagging_correct'].'",';
			$row .= '"'.$user['agent_adhere_to_SOP'].'",';
			$row .= '"'.$user['agent_provide_incorrect_info'].'",';
			$row .= '"'.$user['ZTP_call_observe'].'",';
			$row .= '"'.$user['capture_correct_information'].'",';
			$row .= '"'.$user['agent_give_mandatory_info'].'",';
			$row .= '"'.$user['create_correct_booking'].'",';
			$row .= '"'.$user['acknowlegde_the_concern'].'",';
			$row .= '"'.$user['agent_polite_on_call'].'",';
			$row .= '"'.$user['show_emphaty_when_required'].'",';
			$row .= '"'.$user['take_customer_name_twice'].'",';
			$row .= '"'.$user['any_dead_air_on_call'].'",';
			$row .= '"'.$user['follow_hold_procedure'].'",';
			$row .= '"'.$user['energetic_through_call'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['level1_comment'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
			$row .= '"'.$user['client_rvw_date'].'",';
			$row .= '"'.$user['client_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}
	
/*----------------OYO SIG New CSS Part Start--------------------*/	
	public function download_qa_oyosig_new_CSV($pValue)
	{
		if($pValue=='OYO SIG New'){
			$hdr_val='OYO SIG New';
		}else if($pValue=='oyo_sigchat_service'){
			$hdr_val='OYO SIG Chat Service';
		}else if($pValue=='oyo_sigchat_escalation'){
			$hdr_val='OYO SIG Chat Escalation';
		}
		
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA ".$hdr_val." Audit List-'".$currDate."'.csv";
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_oyosig_new_CSV($rr,$pValue)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		if($pValue=='OYO SIG New'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date/Time", "Czentrix ID", "Call Duration", "Phone", "Campaign", "Call Type", "Disconnection Source", "Call ID", "CONF Unique ID", "Monitor File Name", "Czentrix Disposition", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "1.1 Opening within 5 secs", "1.2 Opening with Self Introduction & OYO Branding", "2.1 Effective Probing Done", "2.2 Issue Identified and Paraphrased for guest confirmation", "3.1 Apology & Empathy", "3.2 Voice Intonation Modulation & Rate Of Speech", "3.3 Active Listening Avoid Interruption & Repetitions", "3.4 Confidence and Enthusiasm", "3.5 Politeness & Professionalism", "3.6 Grammar & Sentence Construction", "3.7 Acknowledgement of guest queries and offer assurance", "4.1 Did the agent adhere to Hold Protocol", "4.2 Did the agent adhere to dead air Protocol", "*** 4.3 Legitimate Hold used", "*** 5.1 Correct Information Resolution provided", "5.2 Correct refund", "*** 5.3 Proper follow up with PM/CM/OPS", "5.4 GNC Closure Procedure", "5.5 Agent Assist Adherence", "5.6 Account verification before cancellation/modification", "5.7 Ownership", "5.8 Send correct resolution email", "6.1 Complete and correct notes", "*** 6.2 Accurate Tagging of Issue Category and sub category", "6.3 Call Disposed accurately on Czentrix", "6.4 Correct Ticket Status and tagging of remaining fields in Oyo Desk", "7.1 Pitched Need Help for self help", "7.2 Further Assistance Asked", "7.3 G-Sat Survey Effectively Pitched", "*** 7.4 G- Sat Survey Avoidance", "7.5 Closing done with branding of OYO", "Drop Downs 1.1", "Drop Downs 1.2", "Drop Downs 2.1", "Drop Downs 2.2", "Drop Downs 3.1", "Drop Downs 3.2", "Drop Downs 3.3", "Drop Downs 3.4", "Drop Downs 3.5", "Drop Downs 3.6", "Drop Downs 3.7", "Drop Downs 4.1", "Drop Downs 4.2", "Drop Downs 4.3", "Drop Downs 5.1", "Drop Downs 5.2", "Drop Downs 5.3", "Drop Downs 5.4", "Drop Downs 5.5", "Drop Downs 5.6", "Drop Downs 5.7", "Drop Downs 5.8", "Drop Downs 6.1", "Drop Downs 6.2", "Drop Downs 6.3", "Drop Downs 6.4", "Drop Downs 7.1", "Drop Downs 7.2", "Drop Downs 7.3", "Drop Downs 7.4", "Drop Downs 7.5", "OD-Issue Category", "OD-Sub Category", "OD-Sub Sub Category", "Actual OD-Issue Category", "Actual OD-Sub Category", "Actual OD-Sub Sub Category", "Actual Czentrix Disposition", "Booking ID", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		}else if($pValue=='oyo_sigchat_service'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Chat Date", "Guest Number", "Booking ID", "Chat Link", "Haptik ID", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Earned Score", "Possible Score", "Overall Score", "Opening & Salutation", "Dropdown", "Remarks", "Issue identification/Contact Reason", "Dropdown", "Remarks", "Product/Booking Details", "Dropdown", "Remarks", "USPs", "Dropdown", "Remarks", "CRS Compliance", "Dropdown", "Remarks", "Acknowledgement Time", "Dropdown", "Remarks", "ID Notification", "Dropdown", "Remarks", "Attentive on chat", "Dropdown", "Remarks", "Resolution of guest concern", "Dropdown", "Remarks", "Spacing error/Punctuation", "Dropdown", "Remarks", "Dialect used as per concern", "Dropdown", "Remarks", "Incomplete Sentence", "Dropdown", "Remarks", "Spell Check", "Dropdown", "Remarks", "Courteous Words", "Dropdown", "Remarks", "Choice of Words", "Dropdown", "Remarks", "SMS language", "Dropdown", "Remarks", "Further Assistance", "Dropdown", "Remarks", "Disconnect check", "Dropdown", "Remarks", "Closing", "Dropdown", "Remarks", "Infraction Booking Details", "Dropdown", "Remarks", "Infraction USPs", "Dropdown", "Remarks", "Infraction CRS Compliance", "Dropdown", "Remarks", "Infraction ID Notification", "Dropdown", "Remarks", "Infraction Spell Check", "Dropdown", "Remarks", "Infraction Issue identification", "Dropdown", "Remarks", "Infraction Resolution of guest concern", "Dropdown", "Remarks", "Infraction Incomplete Sentence", "Dropdown", "Remarks", "Infraction Ownership failure", "Dropdown", "Remarks", "Advisor ZTP","Dropdown", "Remarks", "Call Summary", "Feedback", "Agent Review Date", "Agent Review Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Review Comment");
		}else if($pValue=='oyo_sigchat_escalation'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Chat Date", "Guest Number", "Booking ID", "Chat Link", "Escalation Ticket", "Haptik ID", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Earned Score", "Possible Score", "Overall Score", "1.1 Opening & Salutation", "Dropdown", "Remarks", "2.1 Effective Probing Done", "Dropdown", "Remarks", "2.2 Issue Identified or not", "Dropdown", "Remarks", "3.1 Apology & Empathy", "Dropdown", "Remarks", "3.2 Spacing error/Punctuation", "Dropdown", "Remarks", "3.3 Attentiveness", "Dropdown", "Remarks", "3.4 SMS language", "Dropdown", "Remarks", "3.5 Spell check", "Dropdown", "Remarks", "3.6 Courteous Words", "Dropdown", "Remarks", "3.7 Incomplete Sentence", "Dropdown", "Remarks", "3.8 Timely Acknowledgment", "Dropdown", "Remarks", "4.1 Follow up procedure followed", "Dropdown", "Remarks", "4.2 Unnecessary time taken from guest for follow up", "Dropdown", "Remarks", "5.1 Correct Booking Modification", "Dropdown", "Remarks", "5.2 Correct Information", "Dropdown", "Remarks", "5.3 Correct refund", "Dropdown", "Remarks", "5.4 Proper follow up", "Dropdown", "Remarks", "6.1 Duplicate Ticket Merging", "Dropdown", "Remarks", "6.2 Case library Adherence", "Dropdown", "Remarks", "7.1 Complete and correct notes", "Dropdown", "Remarks", "7.2 Tagging of Issue Category and sub category", "Dropdown", "Remarks", "7.3 Incorrect Cancellation", "Dropdown", "Remarks", "7.4 Correct Ticket Status and tagging of remaining fields in freshdesk", "Dropdown", "Remarks", "7.5 Did the agent verify the account before cancellation", "Dropdown", "Remarks", "7.6 Resolution Email to be sent to Guest", "Dropdown", "Remarks", "8.1 Further Assistance Asked", "Dropdown", "Remarks", "8.2 Closing done with branding of OYO", "Dropdown", "Remarks", "8.3 Disconnect check", "Dropdown", "Remarks", "Infraction G-sat avoidance", "Dropdown", "Remarks", "Infraction Sending to Incorrect E-mail ID", "Dropdown", "Remarks", "Infraction Proper follow up", "Dropdown", "Remarks", "Infraction Spell Check", "Dropdown", "Remarks", "Infraction Providing resolution without validating", "Dropdown", "Remarks", "Infraction Incomplete Sentence", "Dropdown", "Remarks", "Infraction Follow up procedure", "Dropdown", "Remarks", "Infraction Issue Identification", "Dropdown", "Remarks", "Infraction Incomplete information", "Dropdown", "Remarks", "Infraction Ownership failure", "Dropdown", "Remarks", "Infraction Sharing internal communication", "Dropdown", "Remarks", "Infraction Process deviation", "Dropdown", "Remarks", "Infraction Incorrect Booking Modification", "Dropdown", "Remarks", "Advisor ZTP", "Dropdown", "Remarks", "Call Summary", "Feedback", "Agent Review Date", "Agent Review Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Review Comment");
		}
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		if($pValue=='OYO SIG New'){
			
			foreach($rr as $user){	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$auditorName.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['czentrix_id'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['phone'].'",';
				$row .= '"'.$user['campaign'].'",';
				$row .= '"'.$user['call_type'].'",';
				$row .= '"'.$user['disconnection_source'].'",';
				$row .= '"'.$user['call_id'].'",';
				$row .= '"'.$user['conf_id'].'",';
				$row .= '"'.$user['monitor_file_name'].'",';
				$row .= '"'.$user['czentrix_disposition'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['call_opening_5sec'].'",';
				$row .= '"'.$user['call_opening_oyo_branding'].'",';
				$row .= '"'.$user['effective_probong'].'",';
				$row .= '"'.$user['issue_identified'].'",';
				$row .= '"'.$user['apology_empathy'].'",';
				$row .= '"'.$user['voice_intonation'].'",';
				$row .= '"'.$user['active_listening'].'",';
				$row .= '"'.$user['confidence_enthusiasm'].'",';
				$row .= '"'.$user['politeness'].'",';
				$row .= '"'.$user['sentence_construction'].'",';
				$row .= '"'.$user['acknowledgement'].'",';
				$row .= '"'.$user['adhere_hold_protocol'].'",';
				$row .= '"'.$user['dead_air_protocol'].'",';
				$row .= '"'.$user['legitimate_hold'].'",';
				$row .= '"'.$user['correct_information'].'",';
				$row .= '"'.$user['correct_refund'].'",';
				$row .= '"'.$user['proper_followup'].'",';
				$row .= '"'.$user['gnc_closure'].'",';
				$row .= '"'.$user['assist_adherence'].'",';
				$row .= '"'.$user['account_verification'].'",';
				$row .= '"'.$user['ownership'].'",';
				$row .= '"'.$user['correct_email'].'",';
				$row .= '"'.$user['correct_notes'].'",';
				$row .= '"'.$user['accurate_tagging'].'",';
				$row .= '"'.$user['call_disposed'].'",';
				$row .= '"'.$user['correct_ticket_status'].'",';
				$row .= '"'.$user['piched_need_help'].'",';
				$row .= '"'.$user['further_assistance'].'",';
				$row .= '"'.$user['Gsat_survey_pitched'].'",';
				$row .= '"'.$user['Gsat_survey_avoidance'].'",';
				$row .= '"'.$user['closing_done_branding'].'",';
				$row .= '"'.$user['remarks1'].'",';
				$row .= '"'.$user['remarks2'].'",';
				$row .= '"'.$user['remarks3'].'",';
				$row .= '"'.$user['remarks4'].'",';
				$row .= '"'.$user['remarks5'].'",';
				$row .= '"'.$user['remarks6'].'",';
				$row .= '"'.$user['remarks7'].'",';
				$row .= '"'.$user['remarks8'].'",';
				$row .= '"'.$user['remarks9'].'",';
				$row .= '"'.$user['remarks10'].'",';
				$row .= '"'.$user['remarks11'].'",';
				$row .= '"'.$user['remarks12'].'",';
				$row .= '"'.$user['remarks13'].'",';
				$row .= '"'.$user['remarks14'].'",';
				$row .= '"'.$user['remarks15'].'",';
				$row .= '"'.$user['remarks16'].'",';
				$row .= '"'.$user['remarks17'].'",';
				$row .= '"'.$user['remarks18'].'",';
				$row .= '"'.$user['remarks19'].'",';
				$row .= '"'.$user['remarks20'].'",';
				$row .= '"'.$user['remarks21'].'",';
				$row .= '"'.$user['remarks22'].'",';
				$row .= '"'.$user['remarks23'].'",';
				$row .= '"'.$user['remarks24'].'",';
				$row .= '"'.$user['remarks25'].'",';
				$row .= '"'.$user['remarks26'].'",';
				$row .= '"'.$user['remarks27'].'",';
				$row .= '"'.$user['remarks28'].'",';
				$row .= '"'.$user['remarks29'].'",';
				$row .= '"'.$user['remarks30'].'",';
				$row .= '"'.$user['remarks31'].'",';
				$row .= '"'.$user['issue_category'].'",';
				$row .= '"'.$user['sub_category'].'",';
				$row .= '"'.$user['sub_sub_category'].'",';
				$row .= '"'.$user['actual_issue_category'].'",';
				$row .= '"'.$user['actual_sub_category'].'",';
				$row .= '"'.$user['actual_sub_sub_category'].'",';
				$row .= '"'.$user['actual_czentrix_dispo'].'",';
				$row .= '"'.$user['booking_id'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}else if($pValue=='oyo_sigchat_service'){
			
			foreach($rr as $user){	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$auditorName.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['guest_number'].'",';
				$row .= '"'.$user['booking_id'].'",';
				$row .= '"'.$user['chat_link'].'",';
				$row .= '"'.$user['haptik_id'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['earned_score'].'",';
				$row .= '"'.$user['possible_score'].'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['opening'].'",';
				$row .= '"'.$user['dd_val1'].'",';
				$row .= '"'.$user['cmt1'].'",';
				$row .= '"'.$user['issue_identification'].'",';
				$row .= '"'.$user['dd_val2'].'",';
				$row .= '"'.$user['cmt2'].'",';
				$row .= '"'.$user['booking_details'].'",';
				$row .= '"'.$user['dd_val3'].'",';
				$row .= '"'.$user['cmt3'].'",';
				$row .= '"'.$user['USPs'].'",';
				$row .= '"'.$user['dd_val4'].'",';
				$row .= '"'.$user['cmt4'].'",';
				$row .= '"'.$user['CRS_compliance'].'",';
				$row .= '"'.$user['dd_val5'].'",';
				$row .= '"'.$user['cmt5'].'",';
				$row .= '"'.$user['acknowledge_time'].'",';
				$row .= '"'.$user['dd_val6'].'",';
				$row .= '"'.$user['cmt6'].'",';
				$row .= '"'.$user['ID_notification'].'",';
				$row .= '"'.$user['dd_val7'].'",';
				$row .= '"'.$user['cmt7'].'",';
				$row .= '"'.$user['attentive_on_chat'].'",';
				$row .= '"'.$user['dd_val8'].'",';
				$row .= '"'.$user['cmt8'].'",';
				$row .= '"'.$user['resolution_guest_concern'].'",';
				$row .= '"'.$user['dd_val9'].'",';
				$row .= '"'.$user['cmt9'].'",';
				$row .= '"'.$user['punctuation'].'",';
				$row .= '"'.$user['dd_val10'].'",';
				$row .= '"'.$user['cmt10'].'",';
				$row .= '"'.$user['dialect_used_concern'].'",';
				$row .= '"'.$user['dd_val11'].'",';
				$row .= '"'.$user['cmt11'].'",';
				$row .= '"'.$user['sentence_structure'].'",';
				$row .= '"'.$user['dd_val12'].'",';
				$row .= '"'.$user['cmt12'].'",';
				$row .= '"'.$user['spell_check'].'",';
				$row .= '"'.$user['dd_val13'].'",';
				$row .= '"'.$user['cmt13'].'",';
				$row .= '"'.$user['courteous_word'].'",';
				$row .= '"'.$user['dd_val14'].'",';
				$row .= '"'.$user['cmt14'].'",';
				$row .= '"'.$user['word_choice'].'",';
				$row .= '"'.$user['dd_val15'].'",';
				$row .= '"'.$user['cmt15'].'",';
				$row .= '"'.$user['SMS_language'].'",';
				$row .= '"'.$user['dd_val16'].'",';
				$row .= '"'.$user['cmt16'].'",';
				$row .= '"'.$user['further_assistance'].'",';
				$row .= '"'.$user['dd_val17'].'",';
				$row .= '"'.$user['cmt17'].'",';
				$row .= '"'.$user['disconnect_check'].'",';
				$row .= '"'.$user['dd_val18'].'",';
				$row .= '"'.$user['cmt18'].'",';
				$row .= '"'.$user['closing'].'",';
				$row .= '"'.$user['dd_val19'].'",';
				$row .= '"'.$user['cmt19'].'",';
				$row .= '"'.$user['infraction_booking_details'].'",';
				$row .= '"'.$user['dd_val20'].'",';
				$row .= '"'.$user['cmt20'].'",';
				$row .= '"'.$user['infraction_USPs'].'",';
				$row .= '"'.$user['dd_val21'].'",';
				$row .= '"'.$user['cmt21'].'",';
				$row .= '"'.$user['infraction_CRS_compliance'].'",';
				$row .= '"'.$user['dd_val22'].'",';
				$row .= '"'.$user['cmt22'].'",';
				$row .= '"'.$user['infraction_ID_notification'].'",';
				$row .= '"'.$user['dd_val23'].'",';
				$row .= '"'.$user['cmt23'].'",';
				$row .= '"'.$user['infraction_spell_check'].'",';
				$row .= '"'.$user['dd_val24'].'",';
				$row .= '"'.$user['cmt24'].'",';
				$row .= '"'.$user['infraction_issue_identify'].'",';
				$row .= '"'.$user['dd_val25'].'",';
				$row .= '"'.$user['cmt25'].'",';
				$row .= '"'.$user['infraction_guest_concern'].'",';
				$row .= '"'.$user['dd_val26'].'",';
				$row .= '"'.$user['cmt26'].'",';
				$row .= '"'.$user['infraction_incomplete_sentence'].'",';
				$row .= '"'.$user['dd_val27'].'",';
				$row .= '"'.$user['cmt27'].'",';
				$row .= '"'.$user['infraction_ownership_failure'].'",';
				$row .= '"'.$user['dd_val28'].'",';
				$row .= '"'.$user['cmt28'].'",';
				$row .= '"'.$user['advisor_ZTP'].'",';
				$row .= '"'.$user['dd_val29'].'",';
				$row .= '"'.$user['cmt29'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}else if($pValue=='oyo_sigchat_escalation'){
		
			foreach($rr as $user){	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$auditorName.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['guest_number'].'",';
				$row .= '"'.$user['booking_id'].'",';
				$row .= '"'.$user['chat_link'].'",';
				$row .= '"'.$user['escalation_ticket'].'",';
				$row .= '"'.$user['haptik_id'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['earned_score'].'",';
				$row .= '"'.$user['possible_score'].'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['opening_salutation'].'",';
				$row .= '"'.$user['dd_val1'].'",';
				$row .= '"'.$user['cmt1'].'",';
				$row .= '"'.$user['effective_probing'].'",';
				$row .= '"'.$user['dd_val2'].'",';
				$row .= '"'.$user['cmt2'].'",';
				$row .= '"'.$user['issue_identified'].'",';
				$row .= '"'.$user['dd_val3'].'",';
				$row .= '"'.$user['cmt3'].'",';
				$row .= '"'.$user['apology_empathy'].'",';
				$row .= '"'.$user['dd_val4'].'",';
				$row .= '"'.$user['cmt4'].'",';
				$row .= '"'.$user['spacing_error_punctuation'].'",';
				$row .= '"'.$user['dd_val5'].'",';
				$row .= '"'.$user['cmt5'].'",';
				$row .= '"'.$user['attentiveness'].'",';
				$row .= '"'.$user['dd_val6'].'",';
				$row .= '"'.$user['cmt6'].'",';
				$row .= '"'.$user['SMS_language'].'",';
				$row .= '"'.$user['dd_val7'].'",';
				$row .= '"'.$user['cmt7'].'",';
				$row .= '"'.$user['spell_check'].'",';
				$row .= '"'.$user['dd_val8'].'",';
				$row .= '"'.$user['cmt8'].'",';
				$row .= '"'.$user['courteous_words'].'",';
				$row .= '"'.$user['dd_val9'].'",';
				$row .= '"'.$user['cmt9'].'",';
				$row .= '"'.$user['incomplete_sentence'].'",';
				$row .= '"'.$user['dd_val10'].'",';
				$row .= '"'.$user['cmt10'].'",';
				$row .= '"'.$user['time_acknowledge'].'",';
				$row .= '"'.$user['dd_val11'].'",';
				$row .= '"'.$user['cmt11'].'",';
				$row .= '"'.$user['procedure_followed'].'",';
				$row .= '"'.$user['dd_val12'].'",';
				$row .= '"'.$user['cmt12'].'",';
				$row .= '"'.$user['unnecessary_time_taken'].'",';
				$row .= '"'.$user['dd_val13'].'",';
				$row .= '"'.$user['cmt13'].'",';
				$row .= '"'.$user['correct_booking'].'",';
				$row .= '"'.$user['dd_val14'].'",';
				$row .= '"'.$user['cmt14'].'",';
				$row .= '"'.$user['correct_information'].'",';
				$row .= '"'.$user['dd_val15'].'",';
				$row .= '"'.$user['cmt15'].'",';
				$row .= '"'.$user['correct_refund'].'",';
				$row .= '"'.$user['dd_val16'].'",';
				$row .= '"'.$user['cmt16'].'",';
				$row .= '"'.$user['proper_followup'].'",';
				$row .= '"'.$user['dd_val17'].'",';
				$row .= '"'.$user['cmt17'].'",';
				$row .= '"'.$user['duplicate_ticket_merging'].'",';
				$row .= '"'.$user['dd_val18'].'",';
				$row .= '"'.$user['cmt18'].'",';
				$row .= '"'.$user['case_library_adherence'].'",';
				$row .= '"'.$user['dd_val19'].'",';
				$row .= '"'.$user['cmt19'].'",';
				$row .= '"'.$user['complete_notes'].'",';
				$row .= '"'.$user['dd_val20'].'",';
				$row .= '"'.$user['cmt20'].'",';
				$row .= '"'.$user['tagging_issue_category'].'",';
				$row .= '"'.$user['dd_val21'].'",';
				$row .= '"'.$user['cmt21'].'",';
				$row .= '"'.$user['incorrect_cancelation'].'",';
				$row .= '"'.$user['dd_val22'].'",';
				$row .= '"'.$user['cmt22'].'",';
				$row .= '"'.$user['cottect_ticket_status'].'",';
				$row .= '"'.$user['dd_val23'].'",';
				$row .= '"'.$user['cmt23'].'",';
				$row .= '"'.$user['verify_account_before_cancel'].'",';
				$row .= '"'.$user['dd_val24'].'",';
				$row .= '"'.$user['cmt24'].'",';
				$row .= '"'.$user['resolution_email'].'",';
				$row .= '"'.$user['dd_val25'].'",';
				$row .= '"'.$user['cmt25'].'",';
				$row .= '"'.$user['further_assistance'].'",';
				$row .= '"'.$user['dd_val26'].'",';
				$row .= '"'.$user['cmt26'].'",';
				$row .= '"'.$user['OYO_branding_closing_done'].'",';
				$row .= '"'.$user['dd_val27'].'",';
				$row .= '"'.$user['cmt27'].'",';
				$row .= '"'.$user['disconnect_check'].'",';
				$row .= '"'.$user['dd_val28'].'",';
				$row .= '"'.$user['cmt28'].'",';
				$row .= '"'.$user['infraction_Gsat'].'",';
				$row .= '"'.$user['dd_val29'].'",';
				$row .= '"'.$user['cmt29'].'",';
				$row .= '"'.$user['infraction_incorrect_email'].'",';
				$row .= '"'.$user['dd_val30'].'",';
				$row .= '"'.$user['cmt30'].'",';
				$row .= '"'.$user['infraction_followup'].'",';
				$row .= '"'.$user['dd_val31'].'",';
				$row .= '"'.$user['cmt31'].'",';
				$row .= '"'.$user['infraction_spell_check'].'",';
				$row .= '"'.$user['dd_val32'].'",';
				$row .= '"'.$user['cmt32'].'",';
				$row .= '"'.$user['infraction_resolution_provide'].'",';
				$row .= '"'.$user['dd_val33'].'",';
				$row .= '"'.$user['cmt33'].'",';
				$row .= '"'.$user['infraction_sentence_structure'].'",';
				$row .= '"'.$user['dd_val34'].'",';
				$row .= '"'.$user['cmt34'].'",';
				$row .= '"'.$user['infraction_procedure_not_follow'].'",';
				$row .= '"'.$user['dd_val35'].'",';
				$row .= '"'.$user['cmt35'].'",';
				$row .= '"'.$user['infraction_issue_identify'].'",';
				$row .= '"'.$user['dd_val36'].'",';
				$row .= '"'.$user['cmt36'].'",';
				$row .= '"'.$user['infraction_incorrect_information'].'",';
				$row .= '"'.$user['dd_val37'].'",';
				$row .= '"'.$user['cmt37'].'",';
				$row .= '"'.$user['infraction_ownership_failure'].'",';
				$row .= '"'.$user['dd_val38'].'",';
				$row .= '"'.$user['cmt38'].'",';
				$row .= '"'.$user['infraction_share_communication'].'",';
				$row .= '"'.$user['dd_val39'].'",';
				$row .= '"'.$user['cmt39'].'",';
				$row .= '"'.$user['infraction_process_deviation'].'",';
				$row .= '"'.$user['dd_val40'].'",';
				$row .= '"'.$user['cmt40'].'",';
				$row .= '"'.$user['infraction_incorrect_booking'].'",';
				$row .= '"'.$user['dd_val41'].'",';
				$row .= '"'.$user['cmt41'].'",';
				$row .= '"'.$user['advisor_ZTP'].'",';
				$row .= '"'.$user['dd_val42'].'",';
				$row .= '"'.$user['cmt42'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}
	}


	/////////////////////////////////////OYOINB///////////////////////////
	
	public function headerDetails(){

		return $arrayName = array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Phone","Call Date","Call Duration","Campaign","Booking Id","APCT","Audit Type","Auditor Type","VOC","Czentrix","AT_calltype","AT_subtype","Correct Calltype","Correct Subtype","Lead conversion Done","Non Conversion Reason","L1","L2","Service Score","Soft Skill Score","Overall Result","Overall Score","Booking Details","Guest Understand","Complete Resolution","Objection Handling","Retention Efforts","Ownership Resolve","Customer Issue","Effective Probing","Sale Future","Selling Skills","Customer Objection","Hotel Amenities","Multiple Option","Whatsapp Option","Lifeline Compliance","OYO Assist","Escalation Metrix","SIG CID","Greet Customer Branding","Courtesy Confidence","Apology Empathy","Interruption","Active Listening","Switch Language","Grammar Sentence","Guest Permission","Verbiage Followed","Dead Air","Does Infraction Exist","Choose Reason","Tier","Attempt","Equivalent_to","Call Summary","BOD","Feedback","Entry By","Entry Date","Audit Start Date","Client entry by","Mgnt review by","Mgnt review note","Mgnt review date","Agent review note","Agent review date","Client review by","Client review note","Client_rvw_date");

	}

	public function download_qa_oyoinb_new_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA oyo_inb New Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}

	public function create_qa_oyoinb_new_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");		
		$header=$this->headerDetails();
		$field_name="SHOW FULL COLUMNS FROM qa_oyoinb_feedback WHERE Comment!=''";
		$field_name=$this->Common_model->get_query_result_array($field_name);
		$fld_cnt=count($field_name);
		for($i=0;$i<$fld_cnt;$i++){
						$val=$field_name[$i]['Field'];
						if($val!=""){
							$field_val[]=$val;
						}		
					 }
		
		array_unshift($field_val ,"auditor_name");
		$key = array_search ('agent_id', $field_val);
		array_splice($field_val, $key, 0, 'fusion_id');
		$field_val=array_values($field_val);

		$count_for_field=count($field_val);

		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		$row = "";
		// print_r($rr);
		// die;
		foreach($rr as $user)
		{	
			for($z=0;$z<$count_for_field;$z++){
				
				if($field_val[$z]==="auditor_name"){
					$row = '"'.$user['auditor_name'].'",';
				}elseif($field_val[$z]==="fusion_id"){
					$row .= '"'.$user['fusion_id'].'",';
				}elseif($field_val[$z]==="agent_id"){
					$row .= '"'.$user['fname']." ".$user['lname'].'",';
				}elseif($field_val[$z]==="tl_id"){
					$row .= '"'.$user['tl_name'].'",';	
				}elseif(in_array($field_val[$z], array('call_summary','feedback','agent_rvw_note','mgnt_rvw_note'))) {
    			
    			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user[$field_val[$z]])).'",';

				}else{
					$row .= '"'.$user[$field_val[$z]].'",';	
				}
				
			}
				
				fwrite($fopen,$row."\r\n");
				$row = "";
		}
		
		fclose($fopen);
	}

	//////////////////////// CARPARTS SALES////////////////////

	public function qa_process_report($process){

		if(check_logged_in()){
			
			$office_id = "";
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["download_link1"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_".$process."_report.php";
			$data["content_js"] = "qa_".$process."_js.php";
			if (in_array($process, array('carddata','creditsafe','solucia'))) {
						$data["content_js"] = "qa_grille_js.php";
					}
			$data['page']=$process;

			$date_from="";
			$date_to="";
			$office_id="";
			$action="";
			$dn_link="";
			$dn_link1="";
			$cond1='';
			
			$data["qa_".$process."_list"] = array();			
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				$job = $this->input->get('process');
				$table=$process;

				if (!empty($job)) {
						if ($job!="") {
							$table=$job;
							$data['campaign']=$job;
						}
					}
				
				if($date_from !="" && $date_to!=="" )  $cond1= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
				if($office_id != "") $cond1 .= " and office_id='$office_id'";
				
					$qSql="SELECT * from (Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, (select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name from qa_".$table."_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, get_process_names(id) as campaign, DATEDIFF(CURDATE(), doj) as tenure, assigned_to from signin) yy on (xx.agent_id=yy.sid) $cond1 order by audit_date";

					$fullAray = $this->Common_model->get_query_result_array($qSql);
					$data["qa_".$process."_list"] = $fullAray;
					
					$header_arr=$this->Common_model->get_query_result_array("SELECT column_comment FROM information_schema.COLUMNS WHERE table_name = 'qa_".$table."_feedback' and `table_schema` = 'femsdev'");
					$cnt=count($header_arr);

					for($i=0;$i<$cnt;$i++){
					$val=$this->getval($header_arr[$i],'column_comment');
					if($val!=""){
					$header[]=$val;
					}
					}
					array_unshift($header ,"Auditor Name");
					$key = array_search ('Agent', $header);
					array_splice($header, $key, 0, 'Fusion Id');
					// print_r($header);
					// die;
					if (in_array($job, array('telaidsa','telaidta','cis_contracts','cis_proposal','awareness_email','awareness_call','grille_cashCollection','grille_serviceCommercial','itel_inb','itel_ob'))) {
						$header=$job."Header";
					}else{
						$header=$process."Header";
					}
					
					$header=$this->$header();
					
					$this->create_qa_process_new_CSV($fullAray,$header,$table);		
					$dn_link = base_url()."reports_qa/download_qa_process_new_CSV/".$table;
			}
			
			$data['download_link']=$dn_link;
			$data['download_link1']=$dn_link1;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id'] = $office_id;	
			
			$this->load->view('dashboard',$data);
		}
	}	
	
	public function download_qa_process_new_CSV($param)
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA ".ucfirst($param)." New Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	} 
	
	public function sales_carpartHeader()
	{
		return $arrayName = Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","Call Duration","Call Type","Audit Type","Auditor Type","VOC","Overall Score","Possible Score","Earned Score","Customer Score","Business Score","Compliance Score","Auto Fail","Sales Call Type","Non-Sale","Introduction","Active Listening","Questioning","Presentation","Closing the Sale","CPP","Related Parts","Shipping Options","Shipping and Billing","YMMSE","Part Name(s)","Total Price of the order","Rebranding","Tracking Email","Overcoming Objections","Discount Rules","Account Verification","Documentation","Comments 1","Comments 2","Comments 3","Comments 4","Comments 5","Comments 6","Comments 7","Comments 8","Comments 9","Comments 10","Comments 11","Comments 12","Comments 13","Comments 14","Comments 15","Comments 16","Comments 17","Comments 18","Call Summary","Feedback","Entry By","Entry Date","Audit Start Time","Client entry by","Mgnt review by","Mgnt review note","Mgnt review date","Agent review note","Agent review date","Client review by","Client review note","Client_rvw_date");
	}

	public function itel_inbHeader()
	{
		return $arrayName = Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","Call Duration","Call Type","Audit Type ","Auditor Type ","VOC ","ACPT ","Business Score ","Customer Score ","Compliance Score ","Overall Score ","Possible Score ","Earned Score ","Did the agent use the right opening spiel? ","Did the agent open it in a lively manner? ","Was the call answered within 5 seconds? ","Did the agent sound enthusiastic on the call? ","Was the agent clear and can be easily understood? ","Was the agent attentively listened to the caller? ","Was the agent confident in delivering the information? ","Did the agent avoid interrupting the customer? ","Did the agent empathized on the call? ","Was there dead air in any part of the call? ","Did the agent followed the hold guideliness? ","Did the agent use courteous and polite words when talking to the customer? ","Did the agent escalated the concern of the customer (Only applicable if the customer asked for a supervisor) ","Did the agent have full control over the call? ","Is this a First Call Resolution call? (If applicable) ","Was the tracker Updated? ","Did the agent use the right disposition on the tracker? ","Did the agent give complete and accurate information? ","Did the agent asked for further assistance? ","Did the agent use the right closing script? ","Is the agent rude on the call? ","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","Comments 8 ","Comments 9 ","Comments 10 ","Comments 11 ","Comments 12 ","Comments 13 ","Comments 14 ","Comments 15 ","Comments 16 ","Comments 17 ","Comments 18 ","Comments 19 ","Comments 20 ","Comments 21 ","Call Summary ","Feedback ","Entry By ","Entry Date ","Audit Start Time ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date");
	}

	public function itel_obHeader()
	{
		return $arrayName = Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","Call Duration","Call Type","Audit Type ","Auditor Type ","VOC ","ACPT ","Business Score ","Customer Score ","Compliance Score ","Overall Score ","Possible Score ","Earned Score ","Did the agent do the right opening spiel and looked for the actual customer? ","Did the agent ask if the customer is available to take the survey? ","Did the delivered the disclaimer spiel? ","Did the agent politely ask what is the best time for her to call back? (if Applicable) ","Did the agent sound enthusiastic on the call? ","Was the agent s rate of speech just right? ","Was the agent actively listening to the caller? ","Was the agent polite on the call? ","Did the agent avoid interrupting the customer? ","Did the agent empathized to the customer? (If applicable) ","Did the agent escalated the concern of the customer? (Only applicable if the customer asked for a supervisor) ","Were all applicable questions on the survey asked? ","Did the agent tag all questions correctly? ","Did the agent ask if they want a call back from CarlCare? ","Did the agent give out closing disclaimer? ","Did the agent use the right closing spiel? ","Is the agent rude on the call? ","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","Comments 8 ","Comments 9 ","Comments 10 ","Comments 11 ","Comments 12 ","Comments 13 ","Comments 14 ","Comments 15 ","Comments 16 ","Comments 17 ","Call Summary ","Feedback ","Entry By ","Entry Date ","Audit Start Time ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date");
	}

	public function trapolloHeader(){

	return Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Phone","Call Date","Call Duration","Audit Type","Auditor Type","VOC","File No.", "Overall Score","Possible Score","Earned Score","1.1 Did the rep greet the caller promptly and properly? ","1.2 Did the rep ask if it is a good time to talk? ","1.3 Did the rep advise that the call is recorded? ","2.1 Did the rep try all phone numbers on file prior to reaching back out to the customer? ","2.2 Did the rep verify the member correctly? ","2.3 Did the agent correctly check availability of box? ","2.4 Did the rep correctly check availability of tape? ","2.5 Did the rep refer the caller to the instructions in the box? ","2.6 Did the rep confirm the address? ","2.7 Was the correct call tag initiated and pick up by date specified? ","3.1 Did the agent reassure the caller that everything would be handled effectively? ","3.3 Did the agent address the member by name at least once? ","3.4 Did the agent use 'please' and 'thank you' throughout the call? ","3.5 Did the agent minimize extended silences throughout the call? ","3.6 Did the agent speak with sincere warmth in his/her voice? (empathy) ","3.7 Did the agent speak clearly? ","4.1 Did the rep repeat or reiterate the instructions so that they are clear? ","4.2 Did the rep ask if the member had any questions or was clear on the process? ","4.3 Did the rep ask if there was anything else we could help with? ","4.4 Did the rep collect a good call back number? ","4.5 Did the rep leave complete detailed notes in documentation in TMC following the 5 'w s?' ","4.1 Did the rep have all information updated correctly in the ticket note? ","4.2 If a callback was promised was this done on time? ","4.3 Did the rep treat the customer with both empathy and respect and behave professionally? ","4.4 Did the rep call the correct member? ","4.5 Did the rep initiate the call tag as promised? ","4.6 Did the agent confirm the address? ","4.7 Did the agent use the proper greeting? ","4.8 Did the agent advise that the call was recorded? ","4.9 Did the agent document using the 4 'w s?' ","4.10 Did the rep initiate the call tag as promised? ","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","Comments 8 ","Comments 9 ","Comments 10 ","Comments 11 ","Comments 12 ","Comments 13 ","Comments 14 ","Comments 15 ","Comments 16 ","Comments 17 ","Comments 18 ","Comments 19 ","Comments 20 ","Comments 21 ","Comments 22 ","Comments 23 ","Comments 24 ","Comments 25 ","Comments 26 ","Comments 27 ","Comments 28 ","Comments 29 ","Comments 30 ","Comments 31 ","Call Summary ","Feedback ","Entry By ","Entry Date ","Audit Start Time ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date");

	}

	public function awareness_callHeader(){
		return Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","ACPT","Channel","Call Duration ","Call Type ","Audit Type ","Auditor Type ","VOC ","Overall Score ","Possible Score ","Earned Score ","Customer Score ","Business Score ","Compliance Score ","Agent verify Username / Email Address for correct account. ","Setting proper expectation to the customer. ","Did the agent ask if there is anything that they can do to enhance customer experience before interaction ends? ","Did the agent follow correct / proper procedure based on company policy and/or mandated guidelines? ","Provided accurate and complete information. This could be about the product functionality pricing services offered and etc. ","The agent greet and identified themselves to the customer. Warm and genuine tone of voice must be displayed to show willingness to assist. ","Ask customer name and use it appropriately. ","Paraphrase demonstrate active listening and acknowledge all statements / concerns. ","Agent should paced match that of the customer. ","The agent refrains from negative or derogatory comments about customers fellow employees or products and services. ","Must display confidence and act professional throughout the call. ","Acknowledges and responds to the customer’s emotional statements. Expresses empathy appropriately. ","Stays focus and concise with directions and allows customers to complete tasks prior to moving to next steps. ","Accurately communicates to the customer. Thought and sentence construction must be understandable enough not to confuse the customer. ","Perform logical troubleshooting steps and uses targeted probing questions. Pays attention to key words and phrases to quickly determine the issue and all questions are tailored fit to the customer. ","Refrain from an excessive dead air or awkward silence. ","The agent must thank the customer for contacting to properly end the call. ","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","Comments 8 ","Comments 9 ","Comments 10 ","Comments 11 ","Comments 12 ","Comments 13 ","Comments 14 ","Comments 15 ","Comments 16 ","Comments 17 ","Call Summary ","Feedback ","Entry By ","Entry Date ","Audit Start Time ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date");
	}

	public function carddataHeader(){
		return Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","Call Duration","Call Type","Audit Type ","Auditor Type ","VOC ","Overall Score ","Possible Score ","Earned Score ","Presentation ","search for the interlocutor ","Product mastery ","Handling objections ","Validation of the customer agreement ","Call history ","Active / attentive listening ","Level of language & expression ","Voice rate ","Courtesy ","Smile ","Directivity ","Validation of understanding ","Personalized leave ","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","Comments 8 ","Comments 9 ","Comments 10 ","Comments 11 ","Comments 12 ","Comments 13 ","Comments 14 ","Call Summary ","Feedback ","Entry By ","Entry Date ","Audit Start Time ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date");
	}

	public function creditsafeHeader(){
		return Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","Call Duration","Call Type","Audit Type ","Auditor Type ","VOC ","Overall Score ","Possible Score ","Earned Score ","Presentation of the company and the agent ","Identification of the decision-maker ","Product mastery ","Objection handling ","Discovery phase questioning ","Validation of the customer agreement ","Call history ","Active / attentive listening ","Level of language & expression ","Voice rate ","Courtesy ","Smile ","Directivity ","Personalization ","Personalized leave ","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","Comments 8 ","Comments 9 ","Comments 10 ","Comments 11 ","Comments 12 ","Comments 13 ","Comments 14 ","Comments 15 ","Call Summary ","Feedback ","Entry By ","Entry Date ","Audit Start Time ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date");
	}

	public function soluciaHeader(){
		return Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","Call Duration","Call Type","Audit Type ","Auditor Type ","VOC ","Overall Score ","Possible Score ","Earned Score ","Presentation ","search for the interlocutor ","Validation of entry to the home ","Presentation of the subject of the call ","Treatment refusal to answer ","Making appointments ","Personalization of maintenance ","Situation ","Knowledge of the product ","Knowledge of the insurance industry and administrations ","Highlighting product advantages ","Discovery of the need ","Ability to establish dialogue ","Active listening ","Ability to rebound ","Validation of the customer understanding ","Validation of interest ","Validation of the client budget ","Proposal phrase ","Do not sell the withdrawal period ","Understanding the objection ","Rewording ","Questioning / discovery ","Treatment of the objection ","Verification of address / mobile & email ","Respect of the validation sentences of the script ","validation of the commercial IN opt ","Smile / dynamism ","Directivity ","Speech rate ","Verb in the present tense / clear concise speech / positive wording ","Empathy ","Silence management ","Personalized leave courtesy ","Proposition to visit the website ","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","Comments 8 ","Comments 9 ","Comments 10 ","Comments 11 ","Comments 12 ","Comments 13 ","Comments 14 ","Comments 15 ","Comments 16 ","Comments 17 ","Comments 18 ","Comments 19 ","Comments 20 ","Comments 21 ","Comments 22 ","Comments 23 ","Comments 24 ","Comments 25 ","Comments 26 ","Comments 27 ","Comments 28 ","Comments 29 ","Comments 30 ","Comments 31 ","Comments 32 ","Comments 33 ","Comments 34 ","Comments 35 ","Call Summary ","Feedback ","Entry By ","Entry Date ","Audit Start Time ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date");
	}

	public function awareness_emailHeader(){
		return Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","ACPT","Channel","Case/Ticket ","Product ","Cust Rate ","Call Duration ","Call Type ","Audit Type ","Auditor Type ","VOC ","Overall Score ","Possible Score ","Earned Score ","Customer Score ","Business Score ","Compliance Score ","Setting proper expectation to the customer. ","Did the agent tag the interaction accordingly? ","Did the agent ask if there is anything that they can do to enhance customer experience before interaction ends? ","Did the agent follow correct / proper procedure? ","Provide accurate information. ","The agent showed politeness courtesy and professionalism throughout interaction. ","Acknowledges and responds to the customer’s emotional statements. Expresses empathy appropriately. ","Response time must be within 6 hours from the last time the agent grab the ticket. ","Must address all concern in an interaction if already provided by the customer without letting them to repeat it. ","Accurately communicates to the customer. Thought and sentence construction must be understandable enough not to confuse the customer. ","Perform logical troubleshooting steps and uses targeted probing questions. Pays attention to key words and phrases to quickly determine the issue and all questions are tailored fit to the customer. ","Refrains from using language that could be interpreted as offensive or controversial to a customer. ","Did the agent comply with agreed upon follow-up when scheduled. ","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","Comments 8 ","Comments 9 ","Comments 10 ","Comments 11 ","Comments 12 ","Comments 13 ","Call Summary ","Feedback ","Entry By ","Entry Date ","Audit Start Time ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date");
	}

	public function nordnetHeader(){
		return Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","L1 DRILL DOWN","Call Date","Call Duration","Possible DSAT Reason","L2 DRILL DOWN","Audit Type ","Auditor Type ","VOC ","Overall Score ","Possible Score ","Earned Score ","How is the vocabulary of the agent? ","Attitude on the call ","Hold Time on call ","Quality of the response ","Quality of the historization ","Relevance Of the Answer ","Tool Usage ","Welcome of the call ","Summarizing the resolution ","Conclusion of the call ","Call Summary ","Feedback ","Entry By ","Entry Date ","Audit Start Time ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date");
	}

	public function freedom_financialHeader(){
		return Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","Call Duration","Call Type","Audit Type ","Auditor Type ","VOC ","Business Score ","Customer Score ","Compliance Score ","Overall Score ","Possible Score ","Earned Score ","Intro/Opening ","Account Balance/Payments ","System Knowledge ","Notes/NLS Updates ","Summary/Closing ","Reason for delinquency ","Negotiation ","Ask probing/ open ended questions ","Questions or objections appropriately addressed. ","Disparaging comments about partners or internal 5 departments avoided. ","ACH Payment ","Contact Info V 15 erificatio ","Acknowledgement empathy or empathetic tone used as necessary. ","Language or tone used that prevented a negative perception. ","Concern/Reason for Call Addressed ","Demonstrates professional call etiquette ","Expectations set for follow up actions/next interaction. ","Manages hold time & dead air ","Respectfully attempt to re-engage borrower if 0 questioning overall ","Call Recorded Disclosure ","Unfair 0 Deceptive Misleading or Inaccurate Information ","Call Time ","Collection Disclosures ","Locate Borrower (applicable for calls to third parties) ","Detect/Respond to SCRA ","Verify Identity ","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","Comments 8 ","Comments 9 ","Comments 10 ","Comments 11 ","Comments 12 ","Comments 13 ","Comments 14 ","Comments 15 ","Comments 16 ","Comments 17 ","Comments 18 ","Comments 19 ","Comments 20 ","Comments 21 ","Comments 22 ","Comments 23 ","Comments 24 ","Comments 25 ","Comments 26 ","Call Summary ","Feedback ","Entry By ","Entry Date ","Audit Start Time ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date");
	}

public function grilleHeader(){
	return Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","Call Duration","Call Type","Audit Type ","Auditor Type ","VOC ","Overall Score ","Possible Score ","Earned Score ","1 - Accueil ","2 - Ecoute du besoin client ","3 - Présentation - Respect de la charte d'accueil ","4 - Authentification du client ","5. Reformulation de la demande ","6 -Recueil des éléments essentiels au traitement de la demande ","7. Recueil des éléments complémentaires ","8. Consultation du dossier client ","9. Prise de congé ","10. Reprise de ligne ","11. Aisance de l'expression / Élocution - Vocabulaire ","12. Directivité ","13. Positivisme du langage ","14. Dynamisme - Rythme de la voix ","15. Courtoisie / Convivialité de l'entretien ","16. Sens du service / Implication ","17. Capacité à désamorcer l'insatisfaction ","18. Ton sourire ","19. Recherche de la procédure appropriée ","20. Respect de la procédure ","21. Clarté des explications fournies ","22. Traçage de l'appel conforme (Message COM Mail etc) ","23. Transfert conforme ","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","Comments 8 ","Comments 9 ","Comments 10 ","Comments 11 ","Comments 12 ","Comments 13 ","Comments 14 ","Comments 15 ","Comments 16 ","Comments 17 ","Comments 18 ","Comments 19 ","Comments 20 ","Comments 21 ","Comments 22 ","Comments 23 ","Call Summary ","Feedback ","Entry By ","Entry Date ","Audit Start Time ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date");
}

public function grille_cashCollectionHeader(){
	return Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","Call Duration","Call Type","Audit Type ","Auditor Type ","VOC ","Overall Score ","Possible Score ","Earned Score ","Company and agent presentation","Client identification","Call object","Process control","Product mastery","Validation Promise and or Invoice Sending","Listen","Speech","Smile","Directivity","Taking leave","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","Comments 8 ","Comments 9 ","Comments 10 ","Comments 11 ","Call Summary ","Feedback ","Entry By ","Entry Date ","Audit Start Time ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date");
}

public function grille_serviceCommercialHeader(){
	return Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","Call Duration","Call Type","Audit Type ","Auditor Type ","VOC ","Overall Score ","Possible Score ","Earned Score ","Company and agent presentation","Client identification","Questioning & discovery of needs","Rewording","Presentation of the offer and highlighting its advantages","Validation of understanding","Handling of objections","Product product knowledge","Lock (interest validation + reminder appointment)","Active & attentive listening","Speech ","Friendliness courtesy smile and dynamism","Directivity","Taking leave","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","Comments 8 ","Comments 9 ","Comments 10 ","Comments 11 ","Comments 12 ","Comments 13 ","Comments 14 ","Call Summary ","Feedback ","Entry By ","Entry Date ","Audit Start Time ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date");
}

public function telaidsaHeader(){
	return Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","Call Duration","Call Type","Audit Type ","Auditor Type ","VOC ","Overall Score ","Possible Score ","Earned Score ","Customer Score ","Business Score ","Compliance Score ","Did the agent execute properly any of the Escalation? ","Documentation: Properly filled case fields ","Did the agent follow proper call handling? ","Product Information and Scope of Support ","Soft Skills: courtesy positive tone and active listening ","Soft Skills: Setting expectations during the interaction ","Soft Skills: Communication ","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","Call Summary ","Feedback ","Entry By ","Entry Date ","Audit Start Time ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date") ;
}

public function cis_contractsHeader(){
	return Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","Call Duration","Call Type","Audit Type ","Auditor Type ","VOC ","Block Code ","Channel ","Overall Score ","Possible Score ","Earned Score ","Customer Score ","Business Score ","Compliance Score ","Did the agent check that we have all sufficient information to send out a contract? ","Did the agent check the function diary ensure that we still have the meeting space available? ","Did the agent change the Status on S&C to PRO? ","Did the agent complete the contract with all the correct contact property and date information? ","Did the agent ensure that the correct main meeting room syndicates layout and attendees were stated? ","Was the Packages Description section correctly filled with the appropriate information? (If applicable) ","Was the Catering section correctly filled with the appropriate information? (If applicable) ","Was the Equipment section correctly filled with the appropriate information? (If applicable) ","Was the Additional Info section correctly filled with the appropriate information? (If applicable) ","Was the Accommodation section correctly filled with the appropriate information? (If applicable) ","Did the agent ensure that the Rate Description Rate Amount Days and Delegates added up correctly for the total amount payable? ","Did the agent state their name and date at the bottom of the contract? ","Did the agent use the correct template for sending out contracts? ","Did the agent attached the contract and meeting T&C’s? ","Did the agent use their signature at the end of the email? ","If non-live property did the agent email the hotel asking them to place the space on hold and then proceed with the contract? ","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","comments 8 ","comments 9 ","comments 10 ","comments 11 ","comments 12 ","comments 13 ","comments 14 ","comments 15 ","comments 16 ","Call Summary ","Feedback ","Entry By ","Entry Date ","Audit Start Time ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date");
}

public function cis_proposalHeader(){
	return Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","Call Duration","Call Type","Audit Type ","Auditor Type ","VOC ","Block Code ","Channel ","Overall Score ","Possible Score ","Earned Score ","Customer Score ","Business Score ","Compliance Score ","Did the agent check that the enquiry has all details? (such as correct meeting date delegates and layout) ","Did the agent check the caps and dims to ensure that we have a suitable room type to offer? ","Did the agent load the block for the correct property and dates? ","Was the function diary checked before loading the block? ","Did the agent choose the correct profile/email profiles if a profile doesn’t exist? ","Is the market segments correctly inputted? (Status Market Source Origin Type) ","Did the agent load bedrooms on the grid correctly? (If applicable) ","Did the agent load the meeting block correctly? (Separate Charges / DDR) ","Did the agent add block notes to what was offered? ","Did the agent add a trace to the block with the correct chase date? ","Did the agent check smart space and quote to the appropriate demand? ","Did the agent compose the proposal in the correct formant font and colour? ","Did the Contact and Meeting information table have all the correct detail on? ","Was the rate section correct and simple to read for the client? ","Did the agent amend the subject line accordingly? ","Did the the agent quote in the correct currency? ","Did the agent send it from the ‘meet’ Inbox? ","Did the agent use their signature at the end of the email? ","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","Comments 8 ","Comments 9 ","Comments 10 ","Comments 11 ","Comments 12 ","Comments 13 ","Comments 14 ","Comments 15 ","Comments 16 ","Comments 17 ","Comments 18 ","Call Summary ","Feedback ","Entry By ","Entry Date ","Audit Start Time ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date");
}

public function telaidtaHeader(){
	return Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","Call Duration","Call Type","Audit Type ","Auditor Type ","VOC ","Overall Score ","Possible Score ","Earned Score ","Customer Score ","Business Score ","Compliance Score ","Did the agent execute properly any of the Escalation? ","Documentation: Properly filled case fields ","Documentation: Complete and Accurate case comments ","Did the agent followed proper call handling? ","Product Information and Scope of Support ","Soft Skills: courtesy positive tone and active listening ","Soft Skills: Setting expectations during the interaction ","Soft Skills: Communication ","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","Comments 8 ","Call Summary ","Feedback ","Entry By ","Entry Date ","Audit Start Time ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date")  ;
}

/////////////// Awareness Tech Header /////////////////////////////////

public function awarenessHeader(){
	return $arrayName = Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","ACPT","Channel","Case/Ticket ","Product ","Cust Rate ","Call Duration ","Call Type ","Audit Type ","Auditor Type ","VOC ","Overall Score ","Possible Score ","Earned Score ","Customer Score ","Business Score ","Compliance Score ","Agent verify Username / Email Address for correct account. ","Setting proper expectation to the customer. ","Did the agent ask if there is anything that they can do to enhance customer experience before interaction ends? ","Did the agent follow correct / proper procedure? ","Giving accurate information. ","Did the agent create a case and document properly. Agent put appropriate tagging to every interaction? ","The agent greet and identified themselves to the customer. ","The agent showed politeness courtesy and professionalism throughout interaction. Showed empathy as appropriate. ","Stays focus and concise with directions and allows customers to complete tasks prior to moving to next steps. ","Accurately communicates to the customer. ","Perform logical troubleshooting steps and uses targeted probing questions. ","The agent follow correct procedures for placing the customer on hold ","The agent must thank the customer for contacting at the end of every chat session. ","Others ","Incomplete notes ","No Case Created ","Before Resolution ","During Resolution ","After Resolution ","IEAT ","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","Comments 8 ","Comments 9 ","Comments 10 ","Comments 11 ","Comments 12 ","Comments 13 ","Comments 14 ","Comments 15 ","Comments 16 ","Comments 17 ","Comments 18 ","Comments 19 ","Comments 20 ","Call Summary ","Feedback ","Entry By ","Entry Date ","Audit Start Time ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date");
}
		
// // /////////////////// combine carparts NEW /////////////////////
	
	public function serviceHeader(){
		return $arrayName = Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","Call Duration","Call Type","Audit Type","Auditor Type","VOC","Overall Score","Possible Score","Earned Score","Customer Score","Business Score","Compliance Score","Auto Fail","Call Opening","Account Verification","Concern and Assurance","Pace Tone and Energy","Rapport and Empathy","Probing","Conveyance and Resolution","Proper Hold Procedure","Recap and Closing Statement","Objections Handling","Returns Tagging","Documentation","Actions Taken","Comments 1","Comments 2","Comments 3","Comments 4","Comments 5","Comments 6","Comments 7","Comments 8","Comments 9","Comments 10","Comments 11","Comments 12","Comments 13","Call Summary","Feedback","Entry By","Entry Date","Audit Start Time","Client entry by","Mgnt review by","Mgnt review note","Mgnt review date","Agent review note","Agent review date","Client review by","Client review note","Client_rvw_date" );
	}

// 	public function deltaHeader(){

// 		return $arrayName = Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","Call Duration","Call Type","Audit Type","Auditor Type","VOC","Overall Score","Possible Score","Earned Score","Did CER appropriately greet the caller?","Did CER use a pleasant respectful tone and use the caller's name at least once during the call?","Did CER answer in a timely manner?","Did CER obtain 3 pieces of PHI?","Did CER obtain member's information first and then provider's if on provider call?","If Non-Covered Parent did the caller answer yes to all 3 questions on Guidelines tab?","Did CER ask appropriate questions to determine the purpose of the call?","Did CER assess all information before responding to the caller? (BVN)","Did CER pose appropriate questions to clarify the caller's issue? (Restate Issue)","Did CER utilize active listening skills throughout the inquiry?","Did CER demonstrate use of call control techniques?","Did CER refrain from interrupting the caller?","Did CER speak clearly and concisely and at an appropriate pace?","Did CER avoid use of internal terms technical terms slang and jargon?","Did CER demonstrate confidence in responses?","Did CER minimize silences and use fillers to obtain additional information?","Did CER provide accurate information and/or demonstrate knowledge of client's benefit programs?","Did CER take correct action to resolve the caller's issues?","Did CER promote self-service options where appropriate?","Did CER answer questions clearly and completely?","Was CER proactive by anticipating additional needs of the caller?","Did CER accurately and completely document the call's outcome?","Did the CER document the callers phone number name call type CITS code etc?","Did CER close CITS if it did not require a follow up?","Did CER confirm resolution of the caller's question?","Did CER ask if any additional information could be provided?","Did CER thank the individual for calling and release the call within 5 seconds","Comments 1","Comments 2","Comments 3","Comments 4","Comments 5","Comments 6","Comments 7","Comments 8","Comments 9","Comments 10","Comments 11","Comments 12","Comments 13","Comments 14","Comments 15","Comments 16","Comments 17","Comments 18","Comments 19","Comments 20","Comments 21","Comments 22","Comments 23","Comments 24","Comments 25","Comments 26","Comments 27","Call Summary","Feedback","Entry By","Entry Date","Audit Start Time","Client entry by","Mgnt review by","Mgnt review note","Mgnt review date","Agent review note","Agent review date","Client review by","Client review note","Client_rvw_date");
// 	}

	public function create_qa_process_new_CSV($rr,$header,$table)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$field_name="SHOW FULL COLUMNS FROM qa_".$table."_feedback WHERE Comment!=''";
		$field_name=$this->Common_model->get_query_result_array($field_name);
		$fld_cnt=count($field_name);
		for($i=0;$i<$fld_cnt;$i++){
						$val=$field_name[$i]['Field'];
						if($val!=""){
							$field_val[]=$val;
						}		
					 }
		
		array_unshift($field_val ,"auditor_name");
		$key = array_search ('agent_id', $field_val);
		array_splice($field_val, $key, 0, 'fusion_id');
		$field_val=array_values($field_val);

		$count_for_field=count($field_val);

		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		$row = "";
		// print_r($rr);
		// die;
		foreach($rr as $user)
		{	
			for($z=0;$z<$count_for_field;$z++){
				
				if($field_val[$z]==="auditor_name"){
					$row = '"'.$user['auditor_name'].'",';
				}elseif($field_val[$z]==="fusion_id"){
					$row .= '"'.$user['fusion_id'].'",';
				}elseif($field_val[$z]==="agent_id"){
					$row .= '"'.$user['fname']." ".$user['lname'].'",';
				}elseif($field_val[$z]==="tl_id"){
					$row .= '"'.$user['tl_name'].'",';	
				}elseif(in_array($field_val[$z], array('call_summary','feedback','agent_rvw_note','mgnt_rvw_note'))) {
    			
    			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user[$field_val[$z]])).'",';

				}else{
					$row .= '"'.$user[$field_val[$z]].'",';	
				}
				
			}
				
				fwrite($fopen,$row."\r\n");
				$row = "";
		}
		
		fclose($fopen);
	}

	/******************** END CARPARTS SALES Report Section *******************/




		/******************** Report Section *******************/
	
	public function qa_welcome_pickup_report()
	{
		if(check_logged_in()){
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_welcome_pickup_reports.php";
			$from_date="";
			$to_date="";
			$action="";
			$form_type ="";
			$dn_link="";
			$welcome_pickup_data = array();
			
			if($this->input->get('show')=='Show')
			{
				$from_date = $this->input->get('start_date');
				$to_date = $this->input->get('end_date');
				$form_type = $this->input->get('type');
				if($from_date!="" && $to_date!="")
				{
					$welcome_pickup_data =	$this->Qa_welcomepickup_model->qa_welcome_pickup_report_model($form_type,mmddyy2mysql($from_date),mmddyy2mysql($to_date));
				}
				$this->create_qa_welcome_pickup_CSV($welcome_pickup_data,$form_type);
				$dn_link = base_url()."reports_qa/download_qa_welcome_pickup_CSV/".$form_type;
			}
			$data["start_date"] = $from_date;
            $data["end_date"] = $to_date;
			$data['type'] = $form_type;
			$data['welcome_pickup_data'] =	$welcome_pickup_data;
			$data['download_link']=$dn_link;
			$this->load->view("dashboard",$data);
		}
	}
	/****************QA Welcome pickup CSV Generator*****************/
	public function create_qa_welcome_pickup_CSV($rr,$form_type)
	{
		if($form_type == 1)
			$type = "Ticket";
		elseif($form_type == 2)
			$type = "Call";
		$filename = "./assets/reports/qa_welcome_pickup_report-".$type."-".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		if($form_type == 1)
		{
			$header = array("Auditor Name", "Audit Date","Audit Time","Agent Name","Ticket No","Order No","Caller Title","Caller Name","Caller Date","Audit Type","VOC","Overall Score","Greeting - Followed proper greeting","Realistic Acknowledgment - Provided appropriate responses and timely acknowledgment","Empathy - Used appropriate empathy statement","Comprehension - Understood the customers questions and answered it thoroughly","Probing - Made appropriate use of probing questions","Order Verification - Asked and verified at least one or two customers data points (email address or order no etc.)","Tools and Resources - Used all the resources available to determine the root cause of the problem/possible resolution and sought assistance from others as needed when unsure","Resolution and Processes/Guidelines - Used good judgment and decision making while resolving the issue conveyed every detail of the process clearly and accurately","Usage of Macro - Used the correct macro if there's one applicable and modified it appropriately","Ticket Status and Tagging- Used the correct ticket status and tagging","Documentation - Documented the necessary information during the email interaction if needed","Grammar - Used grammatically correct English","Look back and Learn - Proactive and offered additional assistance","Call Summary","Feedback","Form Type","Created On","Greeting - Followed proper greeting Comment","Realistic Acknowledgment - Provided appropriate responses and timely acknowledgment Comment","Empathy - Used appropriate empathy statement Comment","Comprehension - Understood the customers questions and answered it thoroughly Comment","Probing - Made appropriate use of probing questions Comment","Order Verification - Asked and verified at least one or two customers data points (email address or order no etc.) Comment","Tools and Resources - Used all the resources available to determine the root cause of the problem/possible resolution and sought assistance from others as needed when unsure Comment","Resolution and Processes/Guidelines - Used good judgment and decision making while resolving the issue conveyed every detail of the process clearly and accurately Comment","Usage of Macro - Used the correct macro if there's one applicable and modified it appropriately Comment","Ticket Status and Tagging- Used the correct ticket status and tagging Comment","Documentation - Documented the necessary information during the email interaction if needed Comment","Grammar - Used grammatically correct English Comment","Look back and Learn - Proactive and offered additional assistance Comment");
		}
		elseif($form_type == 2)
		{
			$header = array("Auditor Name", "Audit Date","Audit Time","Agent Name","Ticket No","Order No","Caller Title","Caller Name","Caller Date","Audit Type","VOC","Overall Score","Greeting - Followed proper greeting","Assistance - Offered sincere and immediate assistance and let the customer feel important","Pace - Adapted to caller's style and pace and put the customer at ease","Empathy - Used empathy statement in a timely manner","Active Listening - Actively listened to the customer and responded appropriately","Paraphrasing and Probing - Paraphrased the concern and made appropriate use of probing questions","Comprehension - Understand the customers' questions and answered it thoroughly","Order Verification - Asked and verified at least one or two customers' data points (email address or order no etc.)","Tools and Resources - Used all the resources available to determine the root cause of the problem/possible resolution and sought assistance from others as needed when unsure","Resolution and Processes/Guidelines - Used good judgment and decision making while resolving the issue conveyed every detail of the process clearly and accurately","Documentation - Documented the necessary information during the interaction if needed","GDPR Compliance - Delivered the GDPR Script onset of the call","Pronunciation and Right Verbiage - Spoke to the customer using correct English grammar","Look back and Learn - Proactive and offered additional assistance","Closing Spiel- Thanked the customer for calling","Call Summary","Feedback","Form Type","Created On","Greeting - Followed proper greeting Comment","Assistance - Offered sincere and immediate assistance and let the customer feel important Comment","Pace - Adapted to caller's style and pace and put the customer at ease Comment","Empathy - Used empathy statement in a timely manner Comment","Active Listening - Actively listened to the customer and responded appropriately Comment","Paraphrasing and Probing - Paraphrased the concern and made appropriate use of probing questions Comment","Comprehension - Understand the customers' questions and answered it thoroughly Comment","Order Verification - Asked and verified at least one or two customers data points (email address or order no etc.) Comment","Tools and Resources - Used all the resources available to determine the root cause of the problem/possible resolution and sought assistance from others as needed when unsure Comment","Resolution and Processes/Guidelines - Used good judgment and decision making while resolving the issue conveyed every detail of the process clearly and accurately Comment","Documentation - Documented the necessary information during the interaction if needed Comment","GDPR Compliance - Delivered the GDPR Script onset of the call Comment","Pronunciation and Right Verbiage - Spoke to the customer using correct English grammar Comment","Look back and Learn - Proactive and offered additional assistance Comment","Closing Spiel- Thanked the customer for calling Comment");
		}

		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		if($form_type == 1)
		{
			foreach($rr as $rdata)
			{	
				
				$row = '"'.$rdata['auditor_name'].'",';
				$row .= '"'.$rdata['audit_date'].'",';
				$row .= '"'.$rdata['audit_time'].'",';
				$row .= '"'.$rdata['agent_name'].'",';
				$row .= '"'.$rdata['ticket_no'].'",';
				$row .= '"'.$rdata['order_no'].'",';
				$row .= '"'.$rdata['caller_title'].'",';
				$row .= '"'.$rdata['caller_name'].'",';
				$row .= '"'.$rdata['caller_date'].'",';
				$row .= '"'.$rdata['audit_type'].'",';
				$row .= '"'.$rdata['voc'].'",';
				$row .= '"'.$rdata['overall_score'].'",';

				$row .= '"'.$rdata['approach_greeting_1'].'",';
				$row .= '"'.$rdata['approach_greeting_2'].'",';
				$row .= '"'.$rdata['approach_greeting_3'].'",';
				$row .= '"'.$rdata['discovery_1'].'",';
				$row .= '"'.$rdata['discovery_2'].'",';
				$row .= '"'.$rdata['verification'].'",';
				$row .= '"'.$rdata['process_1'].'",';
				$row .= '"'.$rdata['process_2'].'",';
				$row .= '"'.$rdata['process_3'].'",';
				$row .= '"'.$rdata['process_4'].'",';
				$row .= '"'.$rdata['process_5'].'",';
				$row .= '"'.$rdata['communication_1'].'",';
				$row .= '"'.$rdata['closing_1'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $rdata['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $rdata['feedback'])).'",';	
				$row .= '"'.$form_type.'",';
				$row .= '"'.$rdata['entry_date'].'",';
				
				$row .= '"'.$rdata['approach_greeting_1_cmt'].'",';
				$row .= '"'.$rdata['approach_greeting_2_cmt'].'",';
				$row .= '"'.$rdata['approach_greeting_3_cmt'].'",';
				$row .= '"'.$rdata['discovery_1_cmt'].'",';
				$row .= '"'.$rdata['discovery_2_cmt'].'",';
				$row .= '"'.$rdata['verification_cmt'].'",';
				$row .= '"'.$rdata['process_1_cmt'].'",';
				$row .= '"'.$rdata['process_2_cmt'].'",';
				$row .= '"'.$rdata['process_3_cmt'].'",';
				$row .= '"'.$rdata['process_4_cmt'].'",';
				$row .= '"'.$rdata['process_5_cmt'].'",';
				$row .= '"'.$rdata['communication_1_cmt'].'",';
				$row .= '"'.$rdata['closing_1_cmt'].'"';
				
				fwrite($fopen,$row."\r\n");
			}
			
			fclose($fopen);
		}
		elseif($form_type == 2)
		{	foreach($rr as $rdata)
			{	
				
				$row = '"'.$rdata['auditor_name'].'",';
				$row .= '"'.$rdata['audit_date'].'",';
				$row .= '"'.$rdata['audit_time'].'",';
				$row .= '"'.$rdata['agent_name'].'",';
				$row .= '"'.$rdata['ticket_no'].'",';
				$row .= '"'.$rdata['order_no'].'",';
				$row .= '"'.$rdata['caller_title'].'",';
				$row .= '"'.$rdata['caller_name'].'",';
				$row .= '"'.$rdata['caller_date'].'",';
				$row .= '"'.$rdata['audit_type'].'",';
				$row .= '"'.$rdata['voc'].'",';
				$row .= '"'.$rdata['overall_score'].'",';
				
				$row .= '"'.$rdata['approach_greeting_1'].'",';
				$row .= '"'.$rdata['approach_greeting_2'].'",';
				$row .= '"'.$rdata['approach_greeting_3'].'",';
				$row .= '"'.$rdata['approach_greeting_4'].'",';
				$row .= '"'.$rdata['discovery_1'].'",';
				$row .= '"'.$rdata['discovery_2'].'",';
				$row .= '"'.$rdata['discovery_3'].'",';
				$row .= '"'.$rdata['verification'].'",';
				$row .= '"'.$rdata['process_1'].'",';
				$row .= '"'.$rdata['process_2'].'",';
				$row .= '"'.$rdata['process_3'].'",';
				$row .= '"'.$rdata['process_4'].'",';
				$row .= '"'.$rdata['communication_1'].'",';
				$row .= '"'.$rdata['closing_1'].'",';
				$row .= '"'.$rdata['closing_2'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $rdata['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $rdata['feedback'])).'",';	
				$row .= '"'.$form_type.'",';
				$row .= '"'.$rdata['entry_date'].'"';
				
				$row .= '"'.$rdata['approach_greeting_1_cmt'].'",';
				$row .= '"'.$rdata['approach_greeting_2_cmt'].'",';
				$row .= '"'.$rdata['approach_greeting_3_cmt'].'",';
				$row .= '"'.$rdata['approach_greeting_4_cmt'].'",';
				$row .= '"'.$rdata['discovery_1_cmt'].'",';
				$row .= '"'.$rdata['discovery_2_cmt'].'",';
				$row .= '"'.$rdata['discovery_3_cmt'].'",';
				$row .= '"'.$rdata['verification_cmt'].'",';
				$row .= '"'.$rdata['process_1_cmt'].'",';
				$row .= '"'.$rdata['process_2_cmt'].'",';
				$row .= '"'.$rdata['process_3_cmt'].'",';
				$row .= '"'.$rdata['process_4_cmt'].'",';
				$row .= '"'.$rdata['communication_1_cmt'].'",';
				$row .= '"'.$rdata['closing_1_cmt'].'",';
				$row .= '"'.$rdata['closing_2_cmt'].'",';
				
				fwrite($fopen,$row."\r\n");
			}
			
			fclose($fopen);
		}
		
	}
	public function download_qa_welcome_pickup_CSV($form_type)
	{
		if($form_type == 1)
			$type = "Ticket";
		elseif($form_type == 2)
			$type = "Call";
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/qa_welcome_pickup_report-".$type."-".get_user_id().".csv";
		$newfile="QA Welcome Pickup ".$type." List-".$currDate.".csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}


	///////////////////////////////////////////////////////////////////////////////////////////	 
////////////////////////////////////// QA VRS REPORT //////////////////////////////////////	
///////////////////////////////////////////////////////////////////////////////////////////

	public function qa_vrs_report(){
		if(check_logged_in()){
			
			$office_id = "";
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["download_link1"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			
			/* $office_id = $this->input->get('office_id');
			if($office_id=="")  $office_id=$user_office_id; */
			
			
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_vrs_report.php";
			
			
			$date_from="";
			$date_to="";
			$action="";
			$dn_link="";
			$dn_link1="";
			$cond1='';
			
			/* $cValue = trim($this->input->post('client_id'));
			if($cValue=="") $cValue = trim($this->input->get('client_id')); */
			
			$pValue = trim($this->input->post('process_id'));
			if($pValue=="") $pValue = trim($this->input->get('process_id'));
			
			//$data['cValue']=$cValue;
			$data['pValue']=$pValue;
			
			
			
			$data["qa_vrs_list"] = array();
			$data["qa_vrs_cpta_data"] = array();
			
			if(get_role_dir()=="super" || $is_global_access==1){
				$data['location_list'] = $this->Common_model->get_office_location_list();
			}else{
				$data['location_list'] = $this->Common_model->get_office_location_session_all($current_user);
			}
			
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				//$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond1= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
				
				$field_array = array(
					"date_from"=>$date_from,
					"date_to" => $date_to,
					//"office_id" => $office_id,
					"process_id" => $pValue,
					"current_user" => $current_user
				);
					
				if($pValue=='Right Party'){
					
					$fullAray = $this->Qa_vrs_model->qa_vrs_report_model($field_array);
					$data["qa_vrs_list"] = $fullAray;
					$this->create_qa_vrs_rp_CSV($fullAray);
					$dn_link = base_url()."reports_qa/download_qa_vrs_rp_CSV";
				
				}else if($pValue=='Left Message'){
					
					$fullAray = $this->Qa_vrs_model->qa_vrs_report_model($field_array);
					$data["qa_vrs_list"] = $fullAray;
					$this->create_qa_vrs_lm_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_vrs_lm_CSV";
				
				}else if($pValue=='Cavalry'){
					$fullAray = $this->Qa_vrs_model->qa_vrs_report_model($field_array);
					$data["qa_vrs_list"] = $fullAray;
					$this->create_qa_vrs_cav_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_vrs_cav_CSV";
				
				}else if($pValue=='CPTA'){
					$fullAray = $this->Qa_vrs_model->qa_vrs_report_model($field_array);
					$data["qa_vrs_list"] = $fullAray;
					$this->create_qa_vrs_cpta_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_vrs_cpta_CSV";
				///////////	
					$qSql="SELECT * from
						(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name from qa_vrs_cpta_feedback $cond1) xx Left Join (Select id as sid, fname, lname, fusion_id, assigned_to from signin) yy on (xx.agent_id=yy.sid) Left Join (Select fd_id as mgnt_fd_id, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as mgnt_name, note as mgnt_note, date(entry_date) as mgnt_rvw_date from qa_vrs_cpta_mgnt_rvw) ww on (xx.id=ww.mgnt_fd_id) order by audit_date";
					$fullAray1 = $this->Common_model->get_query_result_array($qSql);
					$data["qa_vrs_cpta_data"] = $fullAray1;
					$this->create_qa_vrs_cptaAll_CSV($fullAray1);	
					$dn_link1 = base_url()."reports_qa/download_qa_vrs_cptaAll_CSV";
					
				}else if($pValue=='JRPA'){
					$fullAray = $this->Qa_vrs_model->qa_vrs_report_model($field_array);
					$data["qa_vrs_list"] = $fullAray;
					$this->create_qa_vrs_jrpa_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_vrs_jrpa_CSV";
					
				}elseif($pValue=='Analysis'){
					$fullAray = $this->Qa_vrs_model->qa_vrs_report_model($field_array);
					$data["qa_vrs_list"] = $fullAray;
					$this->create_qa_vrs_rp_anslysis_right_party_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_vrs_rp_analysis_CSV";
				
				}elseif($pValue=='VRS New'){
					$qSql="SELECT * from (Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, (select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name from qa_vrs_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, get_process_names(id) as campaign, DATEDIFF(CURDATE(), doj) as tenure, assigned_to from signin) yy on (xx.agent_id=yy.sid) $cond1 order by audit_date";
					$fullAray = $this->Common_model->get_query_result_array($qSql);
					$data["qa_vrs_list"] = $fullAray;
					$this->create_qa_vrs_new_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_vrs_new_CSV";
				}
			}
			
			$data['download_link']=$dn_link;
			$data['download_link1']=$dn_link1;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			//$data['office_id']=$office_id;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 
	
//////////////////Right Party///////////////////
	public function download_qa_vrs_rp_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA VRS RP Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_vrs_rp_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Phone", "Contact Date", "Contact Duration", "VSI Account", "ACPT", "ACPT Option", "ACPT Others", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Identify himself/herself by first and last name at the beginning of the call?", "Provide the Quality Assurance Statement verbatim", "State Vital Recovery Services with no deviation?", "Verify that he/she was speaking to a right party according to the client requirements?", "Verify two pieces of demographics information on an outbound call", "Provide the Mini Miranda disclosure verbatim?", "State the client name and the purpose of the communication?", "Sate/Ask for balance due?", "Ask about consumers employment status and POE Information?", "Ask about income sources?", "Ask if the consumer rents or owns his/her home?", "Ask if the consumer a valid checking account or credit/debit card?", "Ask for a reason for delinquence/intention to resolve the account?", "Negotiate in order with discussion of each option?", "Offer a balance over time?", "Offer a one payment lump sum settlement appropriately?", "Offer a 3 to 12 month settlement appropriately?", "Offer a payment plan with significant down payment?", "Offer a small good faith payment?", "Recoment an urgency payment as the first payment option?", "Advise of the payment processing fee before the payment was taken", "Attempt to negotiate the first payment within 10 days?", "Demonstrate Active Listening?", "Anticipate and overcome objections?", "Ask open ended questions when appropriate?", "Establish a sence of urgency?", "Set appropriate timelines and expectations for follow up?", "Keep the call on task?", "Represent the company and the client in a positive manner?", "Escalate the call to a supervisor upon the first request of a consumer?", "Misrepresent their identity or authorization?", "Threaten to take actions that VRS or the client cannot legally take?", "Misrepresent the status of the consumers account?", "Make any faulse representations regarding the nature of the communication?", "Contact the consumer at any unusual times (sate regulations) or outside the hours of 8:00 am and 9:00 pm at the consumers location?", "Communicate with the consumer at work if it is known or there is reason to know that such calls are prohibited?", "Communicate with the consumer after learning the consumer is represented by an attorney?", "Adhere to the cell phone policy/TCPA regulations and policy regarding contacting consumers via cell?", "Adhere to policy regarding third parties for the sole purpose of obtaining location information for the consumer?", "Enter dialer disposition codes correctly to ensure that inappropriate dialing does not take place?", "Make any statement that could constitute unfair?", "Communicate or threaten to communicate false credit information or information which should be known to be false?", "Handle the consumer's dispute correctly and take appropriate action including providing the consumer with the correct contact information to submit?", "Obtain permission from the consumer to initiate electronic checking or credit /debit card transactions AND get supervisor verification if needed?", "Discuss or imply that any type of legal actions will be taken or property repossessed?", "Discuss legal action on time barred accounts?", "Make the required statement on time barred accounts", "Fully comply with any additional FDCPA requirements?", "Make any statement that could be considered discriminatory towards a consumer or a violation of VRS ECOA policy?", "Did the collectors adhere to the State Restrictions?", "Summarize the call?", "Restate the payment arrangement to the consumer?", "Educate the consumer about correspondence being sent?", "Close the call Professionally?", "Use the proper action code?", "Use the proper result code?", "Document thoroughly the context of the conversation?", "Remove any phone numbers known to be incorrect?", "Update address information if appropriate?", "Change the status of the account if appropriate?", "Escalate the account to a supervisor for handling?", "Opening Score", "Opening Possible Score", "Effort Score", "Effort Possible Score", "Call Control Score", "Call Control Possible Score", "Compliance Score", "Compliance Possible Score", "Closing Score", "Closing Possible Score", "Document Score", "Document Possible Score", "Overall Score", "Point Earned", "Call Summary", "Feedback", "Audit Time", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			if($user['opening_call']==10) $opening_call='Yes';
			else if($user['opening_call']==-10) $opening_call='No';
			else $opening_call='N/A';
			
			if($user['opening_verbatim']==10) $opening_verbatim='Yes';
			else if($user['opening_verbatim']==-10) $opening_verbatim='No';
			else $opening_verbatim='N/A';
			
			if($user['opening_vrs']==10) $opening_vrs='Yes';
			else if($user['opening_vrs']==-10) $opening_vrs='No';
			else $opening_vrs='N/A';
			
			if($user['opening_rightparty']==10) $opening_rightparty='Yes';
			else if($user['opening_rightparty']==0) $opening_rightparty='No';
			else $opening_rightparty='N/A';
			
			if($user['opening_demographics']==10) $opening_demographics='Yes';
			else if($user['opening_demographics']==0) $opening_demographics='No';
			else $opening_demographics='N/A';
			
			if($user['opening_miranda']==10) $opening_miranda='Yes';
			else if($user['opening_miranda']==-10) $opening_miranda='No';
			else $opening_miranda='N/A';
			
			if($user['opening_communication']==10) $opening_communication='Yes';
			else if($user['opening_communication']==0) $opening_communication='No';
			else $opening_communication='N/A';
			
			if($user['effort_balance']==10) $effort_balance='Yes';
			else if($user['effort_balance']==0) $effort_balance='No';
			else $effort_balance='N/A';
			
			if($user['effort_poe']==10) $effort_poe='Yes';
			else if($user['effort_poe']==0) $effort_poe='No';
			else $effort_poe='N/A';
			
			if($user['effort_income']==10) $effort_income='Yes';
			else if($user['effort_income']==0) $effort_income='No';
			else $effort_income='N/A';
			
			if($user['effort_rent']==10) $effort_rent='Yes';
			else if($user['effort_rent']==0) $effort_rent='No';
			else $effort_rent='N/A';
			
			if($user['effort_account']==10) $effort_account='Yes';
			else if($user['effort_account']==0) $effort_account='No';
			else $effort_account='N/A';
			
			if($user['effort_intension']==10) $effort_intension='Yes';
			else if($user['effort_intension']==0) $effort_intension='No';
			else $effort_intension='N/A';
			
			if($user['effort_payment']==10) $effort_payment='Yes';
			else if($user['effort_payment']==0) $effort_payment='No';
			else $effort_payment='N/A';
			
			if($user['effort_offer']==10) $effort_offer='Yes';
			else if($user['effort_offer']==0) $effort_offer='No';
			else $effort_offer='N/A';
			
			if($user['effort_lump']==10) $effort_lump='Yes';
			else if($user['effort_lump']==0) $effort_lump='No';
			else $effort_lump='N/A';
			
			if($user['effort_settlement']==10) $effort_settlement='Yes';
			else if($user['effort_settlement']==0) $effort_settlement='No';
			else $effort_settlement='N/A';
			
			if($user['effort_significant']==10) $effort_significant='Yes';
			else if($user['effort_significant']==0) $effort_significant='No';
			else $effort_significant='N/A';
			
			if($user['effort_good']==10) $effort_good='Yes';
			else if($user['effort_good']==0) $effort_good='No';
			else $effort_good='N/A';
			
			if($user['effort_recoment']==10) $effort_recoment='Yes';
			else if($user['effort_recoment']==0) $effort_recoment='No';
			else $effort_recoment='N/A';
			
			if($user['effort_advise']==10) $effort_advise='Yes';
			else if($user['effort_advise']==-10) $effort_advise='No';
			else $effort_advise='N/A';
			
			if($user['effort_negotiate']==10) $effort_negotiate='Yes';
			else if($user['effort_negotiate']==0) $effort_negotiate='No';
			else $effort_negotiate='N/A';
			
			if($user['callcontrol_demo']==10) $callcontrol_demo='Yes';
			else if($user['callcontrol_demo']==0) $callcontrol_demo='No';
			else $callcontrol_demo='N/A';
			
			if($user['callcontrol_anticipate']==10) $callcontrol_anticipate='Yes';
			else if($user['callcontrol_anticipate']==0) $callcontrol_anticipate='No';
			else $callcontrol_anticipate='N/A';
			
			if($user['callcontrol_question']==10) $callcontrol_question='Yes';
			else if($user['callcontrol_question']==0) $callcontrol_question='No';
			else $callcontrol_question='N/A';
			
			if($user['callcontrol_establist']==10) $callcontrol_establist='Yes';
			else if($user['callcontrol_establist']==0) $callcontrol_establist='No';
			else $callcontrol_establist='N/A';
			
			if($user['callcontrol_timelines']==10) $callcontrol_timelines='Yes';
			else if($user['callcontrol_timelines']==0) $callcontrol_timelines='No';
			else $callcontrol_timelines='N/A';
			
			if($user['callcontrol_task']==10) $callcontrol_task='Yes';
			else if($user['callcontrol_task']==0) $callcontrol_task='No';
			else $callcontrol_task='N/A';
			
			if($user['callcontrol_company']==10) $callcontrol_company='Yes';
			else if($user['callcontrol_company']==0) $callcontrol_company='No';
			else $callcontrol_company='N/A';
			
			if($user['callcontrol_escalate']==10) $callcontrol_escalate='Yes';
			else if($user['callcontrol_escalate']==0) $callcontrol_escalate='No';
			else $callcontrol_escalate='N/A';
			
			if($user['compliance_mispresent']==10) $compliance_mispresent='No';
			else if($user['compliance_mispresent']==-10) $compliance_mispresent='Yes';
			else $compliance_mispresent='N/A';
			
			if($user['compliance_threaten']==10) $compliance_threaten='No';
			else if($user['compliance_threaten']==-10) $compliance_threaten='Yes';
			else $compliance_threaten='N/A';
			
			if($user['compliance_account']==10) $compliance_account='No';
			else if($user['compliance_account']==-10) $compliance_account='Yes';
			else $compliance_account='N/A';
			
			if($user['compliance_faulse']==10) $compliance_faulse='No';
			else if($user['compliance_faulse']==-10) $compliance_faulse='Yes';
			else $compliance_faulse='N/A';
			
			if($user['compliance_contact']==10) $compliance_contact='No';
			else if($user['compliance_contact']==-10) $compliance_contact='Yes';
			else $compliance_contact='N/A';
			
			if($user['compliance_communicate']==10) $compliance_communicate='No';
			else if($user['compliance_contact']==-10) $compliance_communicate='Yes';
			else $compliance_communicate='N/A';
			
			if($user['compliance_consumer']==10) $compliance_consumer='No';
			else if($user['compliance_consumer']==-10) $compliance_consumer='Yes';
			else $compliance_consumer='N/A';
			
			if($user['compliance_policy']==10) $compliance_policy='No';
			else if($user['compliance_policy']==-10) $compliance_policy='Yes';
			else $compliance_policy='N/A';
			
			if($user['compliance_location']==10) $compliance_location='No';
			else if($user['compliance_location']==-10) $compliance_location='Yes';
			else $compliance_location='N/A';
			
			if($user['compliance_dialer']==10) $compliance_dialer='No';
			else if($user['compliance_dialer']==-10) $compliance_dialer='Yes';
			else $compliance_dialer='N/A';
			
			if($user['compliance_unfair']==10) $compliance_unfair='Yes';
			else if($user['compliance_unfair']==-10) $compliance_unfair='No';
			else $compliance_unfair='N/A';
			
			if($user['compliance_credit']==10) $compliance_credit='No';
			else if($user['compliance_credit']==-10) $compliance_credit='Yes';
			else $compliance_credit='N/A';
			
			if($user['compliance_disput']==10) $compliance_disput='Yes';
			else if($user['compliance_disput']==-10) $compliance_disput='No';
			else $compliance_disput='N/A';
			
			if($user['compliance_obtain']==10) $compliance_obtain='Yes';
			else if($user['compliance_obtain']==-10) $compliance_obtain='No';
			else $compliance_obtain='N/A';
			
			if($user['compliance_imply']==10) $compliance_imply='Yes';
			else if($user['compliance_imply']==-10) $compliance_imply='No';
			else $compliance_imply='N/A';
			
			if($user['compliance_legal']==10) $compliance_legal='Yes';
			else if($user['compliance_legal']==-10) $compliance_legal='No';
			else $compliance_legal='N/A';
			
			if($user['compliance_barred']==10) $compliance_barred='Yes';
			else if($user['compliance_barred']==-10) $compliance_barred='No';
			else $compliance_barred='N/A';
			
			if($user['compliance_fdcpa']==10) $compliance_fdcpa='Yes';
			else if($user['compliance_fdcpa']==-10) $compliance_fdcpa='No';
			else $compliance_fdcpa='N/A';
			
			if($user['compliance_consider']==10) $compliance_consider='No';
			else if($user['compliance_consider']==-10) $compliance_consider='Yes';
			else $compliance_consider='N/A';
			
			if($user['compliance_collector']==10) $compliance_collector='Yes';
			else if($user['compliance_collector']==-10) $compliance_collector='No';
			else $compliance_collector='N/A';
			
			if($user['closing_call']==10) $closing_call='Yes';
			else if($user['closing_call']==0) $closing_call='No';
			else $closing_call='N/A';
			
			if($user['closing_restate']==10) $closing_restate='Yes';
			else if($user['closing_restate']==0) $closing_restate='No';
			else $closing_restate='N/A';
			
			if($user['closing_educate']==10) $closing_educate='Yes';
			else if($user['closing_educate']==0) $closing_educate='No';
			else $closing_educate='N/A';
			
			if($user['closing_profession']==10) $closing_profession='Yes';
			else if($user['closing_profession']==0) $closing_profession='No';
			else $closing_profession='N/A';
			
			if($user['document_action']==10) $document_action='Yes';
			else if($user['document_action']==-10) $document_action='No';
			else $document_action='N/A';
			
			if($user['document_result']==10) $document_result='Yes';
			else if($user['document_result']==-10) $document_result='No';
			else $document_result='N/A';
			
			if($user['document_context']==10) $document_context='Yes';
			else if($user['document_context']==0) $document_context='No';
			else $document_context='N/A';
			
			if($user['document_remove']==10) $document_remove='Yes';
			else if($user['document_remove']==-10) $document_remove='No';
			else $document_remove='N/A';
			
			if($user['document_update']==10) $document_update='Yes';
			else if($user['document_update']==-10) $document_update='No';
			else $document_update='N/A';
			
			if($user['document_change']==10) $document_change='Yes';
			else if($user['document_change']==-10) $document_change='No';
			else $document_change='N/A';
			
			if($user['document_escalate']==10) $document_escalate='Yes';
			else if($user['document_escalate']==0) $document_escalate='No';
			else $document_escalate='N/A';
			
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",'; 
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['phone'].'",';
			$row .= '"'.$user['contact_date'].'",';
			$row .= '"'.$user['contact_duration'].'",';
			$row .= '"'.$user['vsi_account'].'",';
			$row .= '"'.$user['acpt'].'",';
			$row .= '"'.$user['acpt_option'].'",';
			$row .= '"'.$user['acpt_other'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$opening_call.'",'; 
			$row .= '"'.$opening_verbatim.'",';
			$row .= '"'.$opening_vrs.'",';
			$row .= '"'.$opening_rightparty.'",';
			$row .= '"'.$opening_demographics.'",';
			$row .= '"'.$opening_miranda.'",';
			$row .= '"'.$opening_communication.'",';
			$row .= '"'.$effort_balance.'",';
			$row .= '"'.$effort_poe.'",';
			$row .= '"'.$effort_income.'",';
			$row .= '"'.$effort_rent.'",';
			$row .= '"'.$effort_account.'",';
			$row .= '"'.$effort_intension.'",';
			$row .= '"'.$effort_payment.'",';
			$row .= '"'.$effort_offer.'",';
			$row .= '"'.$effort_lump.'",';
			$row .= '"'.$effort_settlement.'",';
			$row .= '"'.$effort_significant.'",';
			$row .= '"'.$effort_good.'",';
			$row .= '"'.$effort_recoment.'",';
			$row .= '"'.$effort_advise.'",';
			$row .= '"'.$effort_negotiate.'",';
			$row .= '"'.$callcontrol_demo.'",';
			$row .= '"'.$callcontrol_anticipate.'",';
			$row .= '"'.$callcontrol_question.'",';
			$row .= '"'.$callcontrol_establist.'",';
			$row .= '"'.$callcontrol_timelines.'",';
			$row .= '"'.$callcontrol_task.'",';
			$row .= '"'.$callcontrol_company.'",';
			$row .= '"'.$callcontrol_escalate.'",';
			$row .= '"'.$compliance_mispresent.'",';
			$row .= '"'.$compliance_threaten.'",';
			$row .= '"'.$compliance_account.'",';
			$row .= '"'.$compliance_faulse.'",';
			$row .= '"'.$compliance_contact.'",';
			$row .= '"'.$compliance_communicate.'",';
			$row .= '"'.$compliance_consumer.'",';
			$row .= '"'.$compliance_policy.'",';
			$row .= '"'.$compliance_location.'",';
			$row .= '"'.$compliance_dialer.'",';
			$row .= '"'.$compliance_unfair.'",';
			$row .= '"'.$compliance_credit.'",';
			$row .= '"'.$compliance_disput.'",';
			$row .= '"'.$compliance_obtain.'",';
			$row .= '"'.$compliance_imply.'",';
			$row .= '"'.$compliance_legal.'",';
			$row .= '"'.$compliance_barred.'",';
			$row .= '"'.$compliance_fdcpa.'",';
			$row .= '"'.$compliance_consider.'",';
			$row .= '"'.$compliance_collector.'",';
			$row .= '"'.$closing_call.'",';
			$row .= '"'.$closing_restate.'",';
			$row .= '"'.$closing_educate.'",';
			$row .= '"'.$closing_profession.'",';
			$row .= '"'.$document_action.'",';
			$row .= '"'.$document_result.'",';
			$row .= '"'.$document_context.'",';
			$row .= '"'.$document_remove.'",';
			$row .= '"'.$document_update.'",';
			$row .= '"'.$document_change.'",';
			$row .= '"'.$document_escalate.'",';
			$row .= '"'.$user['opening_score'].'",';
			$row .= '"'.$user['opening_possible_scr'].'",';
			$row .= '"'.$user['effort_score'].'",';
			$row .= '"'.$user['effort_possible_scr'].'",';
			$row .= '"'.$user['callcontrol_score'].'",';
			$row .= '"'.$user['callcontrol_possible_scr'].'",';
			$row .= '"'.$user['compliance_score'].'",';
			$row .= '"'.$user['compliance_possible_scr'].'",';
			$row .= '"'.$user['closing_score'].'",';
			$row .= '"'.$user['closing_possible_scr'].'",';
			$row .= '"'.$user['document_score'].'",';
			$row .= '"'.$user['document_possible_scr'].'",';
			$row .= '"'.$user['overall_score'].'",';
			$row .= '"'.$user['point_earned'].'",';
			
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['entry_time'].'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';				
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}
	
	
/////////////////// VRS NEW /////////////////////
	public function download_qa_vrs_new_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA VRS New Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_vrs_new_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Phone", "Fusion ID", "Agent Name", "L1 Super", "Client Name", "Contact Date", "Contact Duration", "VSI Account", "ACPT", "ACPT Option", "ACPT Others", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "QA Type", "Call ID", "Overall Score", "Identify himself/herself by first and last name at the beginning of the call?", "Provide the Quality Assurance Statement verbatim before any specific account information was discussed?", "State VRS with no deviation?", "Verify that he/she was speaking to a right party according to the client requirements?", "Verify one/two pieces of demographics information on an outbound call and one/two pieces on an inbound call?", "Provide the Mini Miranda disclosure verbatim before any specific account information was discussed?", "State the client name and the purpose of the communication?", "Sate/Ask for balance due?", "Ask for a reason for delinquency/intention to resolve the account?", "Full and Complete information taken?", "Ask for the payment over the phone?", "Ask for a post dated payment?", "Followed the previous conversations on the account for the follow-up call", "Able to take a promise to pay on the account?", "Offer to split the balance in part?", "Offer a one/three/lump sum settlement appropriately?", "Offer a payment plan with significant down payment?", "Did Collector follow proper negotiation sequence to provide settelment options?", "Did Collector try to negotiate effectively to convince the customer for payment?", "Offer a small good faith payment?", "Did not Misrepresent their identity or authorization and status of the consumers account?", "Did not Discuss or imply that any type of legal actions - will be taken or property repossessed?", "Did not Make any false representations regarding the nature of the communication?", "Did not Contact the consumer at any unusual times?", "Did not Communicate with the consumer at work if it is known or there is reason to know that such calls are prohibited?", "Did not Communicate with the consumer after learning the consumer is represented by an attorney?", "Adhere to the cell phone policy/TCPA regulations and policy regarding contacting consumers via cell phone email and fax?", "Adhere to policy regarding third parties for the sole purpose of obtaining location information for the consumer?", "Enter Status code/disposition codes correctly to ensure that inappropriate dialing does not take place?", "Did not Make any statement that could constitute unfair deceptive or abusive acts?", "Did not Communicate or threaten to communicate false credit information or information which should be known to be false?", "Handle the consumers dispute correctly and take appropriate action", "Did not Make the required statement on time barred accounts?", "Adhere to FDCPA laws?", "Did not Make any statement that could be considered discriminatory towards a consumer?", "Did the collectors adhere to the State Restrictions?", "Confirm with consumer if he/she is the authorized user of the debit or credit card/checking account?", "Recap the call by verifying consumers Name Address CC/AP information?", "Stated the proper payment script before processing payment?", "Advise of the payment processing fee before the payment was taken?", "Obtain permission from the consumer to initiate electronic credit /debit card transactions?", "Educate the consumer about correspondence being sent?", "Provide the consumer with the confirmation code?", "Demonstrate Active Listening?", "Represent the company and the client in a positive manner?", "Anticipate and overcome objections?", "Summarize the call?", "Provided VRS call back number?", "Set appropriate timelines and expectations for follow up?", "Close the call Professionally?", "Use the proper action code?", "Use the proper result code?", "Document thoroughly the context of the conversation?", "Remove any phone numbers known to be incorrect?", "Update address information if appropriate?", "Change the status of the account if appropriate?", "Escalate the account to a supervisor for handling if appropriate?", "Opening Score", "Effort Score", "Negotiation Score", "Compliance Score", "Payment Script Score", "Call Control Score", "Closing Score", "Documentation Score", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['phone'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",'; 
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['c_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['call_duration'].'",';
			$row .= '"'.$user['vsi_account'].'",';
			$row .= '"'.$user['acpt'].'",';
			$row .= '"'.$user['acpt_option'].'",';
			$row .= '"'.$user['acpt_other'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['qa_type'].'",';
			$row .= '"'.$user['call_id'].'",';
			$row .= '"'.$user['overall_score'].'",';
			$row .= '"'.$user['identifynameatbeginning'].'",';
			$row .= '"'.$user['assurancetsatementverbatim'].'",';
			$row .= '"'.$user['VRSwithnodeviation'].'",';
			$row .= '"'.$user['speakingtorightparty'].'",';
			$row .= '"'.$user['demographicsinformation'].'",';
			$row .= '"'.$user['minimirandadisclosure'].'",';
			$row .= '"'.$user['statetheclientname'].'",';
			$row .= '"'.$user['askforbalancedue'].'",';
			$row .= '"'.$user['reasonfordelinquency'].'",';
			$row .= '"'.$user['completeinformationtaken'].'",';
			$row .= '"'.$user['askforpaymentonphone'].'",';
			$row .= '"'.$user['askforpostdelaypayment'].'",';
			$row .= '"'.$user['accountforfollowupcall'].'",';
			$row .= '"'.$user['promisetopayaccount'].'",';
			$row .= '"'.$user['splitbalanceinpart'].'",';
			$row .= '"'.$user['offersumsettlement'].'",';
			$row .= '"'.$user['paymentplanwithpayment'].'",';
			$row .= '"'.$user['collectorfollowpropernegotiation'].'",';
			$row .= '"'.$user['collectortrynegotiatepayment'].'",';
			$row .= '"'.$user['offergoodfaithpayment'].'",';
			$row .= '"'.$user['misrepresentidentity'].'",';
			$row .= '"'.$user['discussoflegalaction'].'",';
			$row .= '"'.$user['makeanyfalserepresentation'].'",';
			$row .= '"'.$user['contactcustomerusualtime'].'",';
			$row .= '"'.$user['communicateconsumeratwork'].'",';
			$row .= '"'.$user['communicateconsumeranattorney'].'",';
			$row .= '"'.$user['adheretocellphonepolicy'].'",';
			$row .= '"'.$user['adhereto3rdpartypolicy'].'",';
			$row .= '"'.$user['enterstatuscodecorrectly'].'",';
			$row .= '"'.$user['raiseUDAAPconcerns'].'",';
			$row .= '"'.$user['communicatefalsecreditinformation'].'",';
			$row .= '"'.$user['handleconsumerdispute'].'",';
			$row .= '"'.$user['maketimebarredaccounts'].'",';
			$row .= '"'.$user['adhereFDCPAlaws'].'",';
			$row .= '"'.$user['discriminatoryECOApolicy'].'",';
			$row .= '"'.$user['adherestaterestriction'].'",';
			$row .= '"'.$user['confirmauthoriseduser'].'",';
			$row .= '"'.$user['recapthecallverify'].'",';
			$row .= '"'.$user['properpaymentscript'].'",';
			$row .= '"'.$user['paymentprocessingfee'].'",';
			$row .= '"'.$user['obtainpermissionfromconsumer'].'",';
			$row .= '"'.$user['educatetheconsumer'].'",';
			$row .= '"'.$user['consumerconfirmationcode'].'",';
			$row .= '"'.$user['demonstrateactivelistening'].'",';
			$row .= '"'.$user['representclientandcompany'].'",';
			$row .= '"'.$user['anticipateovercomeobjection'].'",';
			$row .= '"'.$user['summarizethecall'].'",';
			$row .= '"'.$user['provideVRScallbacknumber'].'",';
			$row .= '"'.$user['setappropiatetimeline'].'",';
			$row .= '"'.$user['closecallprofessionally'].'",';
			$row .= '"'.$user['useproperactioncode'].'",';
			$row .= '"'.$user['useproperresultcode'].'",';
			$row .= '"'.$user['contextoftheconversation'].'",';
			$row .= '"'.$user['removeanyphonenumber'].'",';
			$row .= '"'.$user['updateaddressinformation'].'",';
			$row .= '"'.$user['changestateofAccount'].'",';
			$row .= '"'.$user['superviserforhandle'].'",';
			$row .= '"'.$user['openingscore'].'",';
			$row .= '"'.$user['effortscore'].'",';
			$row .= '"'.$user['negotiationscore'].'",';
			$row .= '"'.$user['compliancescore'].'",';
			$row .= '"'.$user['paymentscriptscore'].'",';
			$row .= '"'.$user['callcontrolscore'].'",';
			$row .= '"'.$user['closingscore'].'",';
			$row .= '"'.$user['documentationscore'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';				
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}	


	// VRS RP ANALYSIS RIGHT PARTY //////////////////////////////////////////////////////
	
	//////////////////Right Party///////////////////
	public function download_qa_vrs_rp_analysis_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA VRS RP Analysis Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_vrs_rp_anslysis_right_party_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Phone", "Contact Date", "Contact Duration", "VSI Account", "ACPT", "ACPT Option", "ACPT Others", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Identify himself/herself by first and last name at the beginning of the call?", "Provide the Quality Assurance Statement verbatim", "State Vital Recovery Services with no deviation?", "Verify that he/she was speaking to a right party according to the client requirements?", "Verify two pieces of demographics information on an outbound call", "Provide the Mini Miranda disclosure verbatim?", "State the client name and the purpose of the communication?", "Sate/Ask for balance due?", "Ask about consumers employment status and POE Information?", "Ask about income sources?", "Ask if the consumer rents or owns his/her home?", "Ask if the consumer a valid checking account or credit/debit card?", "Ask for a reason for delinquence/intention to resolve the account?", "Negotiate in order with discussion of each option?", "Offer a balance over time?", "Offer a one payment lump sum settlement appropriately?", "Offer a 3 to 12 month settlement appropriately?", "Offer a payment plan with significant down payment?", "Offer a small good faith payment?", "Recoment an urgency payment as the first payment option?", "Advise of the payment processing fee before the payment was taken", "Attempt to negotiate the first payment within 10 days?", "Demonstrate Active Listening?", "Anticipate and overcome objections?", "Ask open ended questions when appropriate?", "Establish a sence of urgency?", "Set appropriate timelines and expectations for follow up?", "Keep the call on task?", "Represent the company and the client in a positive manner?", "Escalate the call to a supervisor upon the first request of a consumer?", "Misrepresent their identity or authorization?", "Threaten to take actions that VRS or the client cannot legally take?", "Misrepresent the status of the consumers account?", "Make any faulse representations regarding the nature of the communication?", "Contact the consumer at any unusual times (sate regulations) or outside the hours of 8:00 am and 9:00 pm at the consumers location?", "Communicate with the consumer at work if it is known or there is reason to know that such calls are prohibited?", "Communicate with the consumer after learning the consumer is represented by an attorney?", "Adhere to the cell phone policy/TCPA regulations and policy regarding contacting consumers via cell?", "Adhere to policy regarding third parties for the sole purpose of obtaining location information for the consumer?", "Enter dialer disposition codes correctly to ensure that inappropriate dialing does not take place?", "Make any statement that could constitute unfair?", "Communicate or threaten to communicate false credit information or information which should be known to be false?", "Handle the consumer's dispute correctly and take appropriate action including providing the consumer with the correct contact information to submit?", "Obtain permission from the consumer to initiate electronic checking or credit /debit card transactions AND get supervisor verification if needed?", "Discuss or imply that any type of legal actions will be taken or property repossessed?", "Discuss legal action on time barred accounts?", "Make the required statement on time barred accounts", "Fully comply with any additional FDCPA requirements?", "Make any statement that could be considered discriminatory towards a consumer or a violation of VRS ECOA policy?", "Did the collectors adhere to the State Restrictions?", "Summarize the call?", "Restate the payment arrangement to the consumer?", "Educate the consumer about correspondence being sent?", "Close the call Professionally?", "Use the proper action code?", "Use the proper result code?", "Document thoroughly the context of the conversation?", "Remove any phone numbers known to be incorrect?", "Update address information if appropriate?", "Change the status of the account if appropriate?", "Escalate the account to a supervisor for handling?", "Opening Score", "Opening Possible Score", "Effort Score", "Effort Possible Score", "Call Control Score", "Call Control Possible Score", "Compliance Score", "Compliance Possible Score", "Closing Score", "Closing Possible Score", "Document Score", "Document Possible Score", "Overall Score", "Point Earned", "Call Summary", "Feedback", "Audit Time", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			if($user['opening_call']==10) $opening_call='Yes';
			else if($user['opening_call']==-10) $opening_call='No';
			else $opening_call='N/A';
			
			if($user['opening_verbatim']==10) $opening_verbatim='Yes';
			else if($user['opening_verbatim']==-10) $opening_verbatim='No';
			else $opening_verbatim='N/A';
			
			if($user['opening_vrs']==10) $opening_vrs='Yes';
			else if($user['opening_vrs']==-10) $opening_vrs='No';
			else $opening_vrs='N/A';
			
			if($user['opening_rightparty']==10) $opening_rightparty='Yes';
			else if($user['opening_rightparty']==0) $opening_rightparty='No';
			else $opening_rightparty='N/A';
			
			if($user['opening_demographics']==10) $opening_demographics='Yes';
			else if($user['opening_demographics']==0) $opening_demographics='No';
			else $opening_demographics='N/A';
			
			if($user['opening_miranda']==10) $opening_miranda='Yes';
			else if($user['opening_miranda']==-10) $opening_miranda='No';
			else $opening_miranda='N/A';
			
			if($user['opening_communication']==10) $opening_communication='Yes';
			else if($user['opening_communication']==0) $opening_communication='No';
			else $opening_communication='N/A';
			
			if($user['effort_balance']==10) $effort_balance='Yes';
			else if($user['effort_balance']==0) $effort_balance='No';
			else $effort_balance='N/A';
			
			if($user['effort_poe']==10) $effort_poe='Yes';
			else if($user['effort_poe']==0) $effort_poe='No';
			else $effort_poe='N/A';
			
			if($user['effort_income']==10) $effort_income='Yes';
			else if($user['effort_income']==0) $effort_income='No';
			else $effort_income='N/A';
			
			if($user['effort_rent']==10) $effort_rent='Yes';
			else if($user['effort_rent']==0) $effort_rent='No';
			else $effort_rent='N/A';
			
			if($user['effort_account']==10) $effort_account='Yes';
			else if($user['effort_account']==0) $effort_account='No';
			else $effort_account='N/A';
			
			if($user['effort_intension']==10) $effort_intension='Yes';
			else if($user['effort_intension']==0) $effort_intension='No';
			else $effort_intension='N/A';
			
			if($user['effort_payment']==10) $effort_payment='Yes';
			else if($user['effort_payment']==0) $effort_payment='No';
			else $effort_payment='N/A';
			
			if($user['effort_offer']==10) $effort_offer='Yes';
			else if($user['effort_offer']==0) $effort_offer='No';
			else $effort_offer='N/A';
			
			if($user['effort_lump']==10) $effort_lump='Yes';
			else if($user['effort_lump']==0) $effort_lump='No';
			else $effort_lump='N/A';
			
			if($user['effort_settlement']==10) $effort_settlement='Yes';
			else if($user['effort_settlement']==0) $effort_settlement='No';
			else $effort_settlement='N/A';
			
			if($user['effort_significant']==10) $effort_significant='Yes';
			else if($user['effort_significant']==0) $effort_significant='No';
			else $effort_significant='N/A';
			
			if($user['effort_good']==10) $effort_good='Yes';
			else if($user['effort_good']==0) $effort_good='No';
			else $effort_good='N/A';
			
			if($user['effort_recoment']==10) $effort_recoment='Yes';
			else if($user['effort_recoment']==0) $effort_recoment='No';
			else $effort_recoment='N/A';
			
			if($user['effort_advise']==10) $effort_advise='Yes';
			else if($user['effort_advise']==-10) $effort_advise='No';
			else $effort_advise='N/A';
			
			if($user['effort_negotiate']==10) $effort_negotiate='Yes';
			else if($user['effort_negotiate']==0) $effort_negotiate='No';
			else $effort_negotiate='N/A';
			
			if($user['callcontrol_demo']==10) $callcontrol_demo='Yes';
			else if($user['callcontrol_demo']==0) $callcontrol_demo='No';
			else $callcontrol_demo='N/A';
			
			if($user['callcontrol_anticipate']==10) $callcontrol_anticipate='Yes';
			else if($user['callcontrol_anticipate']==0) $callcontrol_anticipate='No';
			else $callcontrol_anticipate='N/A';
			
			if($user['callcontrol_question']==10) $callcontrol_question='Yes';
			else if($user['callcontrol_question']==0) $callcontrol_question='No';
			else $callcontrol_question='N/A';
			
			if($user['callcontrol_establist']==10) $callcontrol_establist='Yes';
			else if($user['callcontrol_establist']==0) $callcontrol_establist='No';
			else $callcontrol_establist='N/A';
			
			if($user['callcontrol_timelines']==10) $callcontrol_timelines='Yes';
			else if($user['callcontrol_timelines']==0) $callcontrol_timelines='No';
			else $callcontrol_timelines='N/A';
			
			if($user['callcontrol_task']==10) $callcontrol_task='Yes';
			else if($user['callcontrol_task']==0) $callcontrol_task='No';
			else $callcontrol_task='N/A';
			
			if($user['callcontrol_company']==10) $callcontrol_company='Yes';
			else if($user['callcontrol_company']==0) $callcontrol_company='No';
			else $callcontrol_company='N/A';
			
			if($user['callcontrol_escalate']==10) $callcontrol_escalate='Yes';
			else if($user['callcontrol_escalate']==0) $callcontrol_escalate='No';
			else $callcontrol_escalate='N/A';
			
			if($user['compliance_mispresent']==10) $compliance_mispresent='No';
			else if($user['compliance_mispresent']==-10) $compliance_mispresent='Yes';
			else $compliance_mispresent='N/A';
			
			if($user['compliance_threaten']==10) $compliance_threaten='No';
			else if($user['compliance_threaten']==-10) $compliance_threaten='Yes';
			else $compliance_threaten='N/A';
			
			if($user['compliance_account']==10) $compliance_account='No';
			else if($user['compliance_account']==-10) $compliance_account='Yes';
			else $compliance_account='N/A';
			
			if($user['compliance_faulse']==10) $compliance_faulse='No';
			else if($user['compliance_faulse']==-10) $compliance_faulse='Yes';
			else $compliance_faulse='N/A';
			
			if($user['compliance_contact']==10) $compliance_contact='No';
			else if($user['compliance_contact']==-10) $compliance_contact='Yes';
			else $compliance_contact='N/A';
			
			if($user['compliance_communicate']==10) $compliance_communicate='No';
			else if($user['compliance_contact']==-10) $compliance_communicate='Yes';
			else $compliance_communicate='N/A';
			
			if($user['compliance_consumer']==10) $compliance_consumer='No';
			else if($user['compliance_consumer']==-10) $compliance_consumer='Yes';
			else $compliance_consumer='N/A';
			
			if($user['compliance_policy']==10) $compliance_policy='No';
			else if($user['compliance_policy']==-10) $compliance_policy='Yes';
			else $compliance_policy='N/A';
			
			if($user['compliance_location']==10) $compliance_location='No';
			else if($user['compliance_location']==-10) $compliance_location='Yes';
			else $compliance_location='N/A';
			
			if($user['compliance_dialer']==10) $compliance_dialer='No';
			else if($user['compliance_dialer']==-10) $compliance_dialer='Yes';
			else $compliance_dialer='N/A';
			
			if($user['compliance_unfair']==10) $compliance_unfair='Yes';
			else if($user['compliance_unfair']==-10) $compliance_unfair='No';
			else $compliance_unfair='N/A';
			
			if($user['compliance_credit']==10) $compliance_credit='No';
			else if($user['compliance_credit']==-10) $compliance_credit='Yes';
			else $compliance_credit='N/A';
			
			if($user['compliance_disput']==10) $compliance_disput='Yes';
			else if($user['compliance_disput']==-10) $compliance_disput='No';
			else $compliance_disput='N/A';
			
			if($user['compliance_obtain']==10) $compliance_obtain='Yes';
			else if($user['compliance_obtain']==-10) $compliance_obtain='No';
			else $compliance_obtain='N/A';
			
			if($user['compliance_imply']==10) $compliance_imply='Yes';
			else if($user['compliance_imply']==-10) $compliance_imply='No';
			else $compliance_imply='N/A';
			
			if($user['compliance_legal']==10) $compliance_legal='Yes';
			else if($user['compliance_legal']==-10) $compliance_legal='No';
			else $compliance_legal='N/A';
			
			if($user['compliance_barred']==10) $compliance_barred='Yes';
			else if($user['compliance_barred']==-10) $compliance_barred='No';
			else $compliance_barred='N/A';
			
			if($user['compliance_fdcpa']==10) $compliance_fdcpa='Yes';
			else if($user['compliance_fdcpa']==-10) $compliance_fdcpa='No';
			else $compliance_fdcpa='N/A';
			
			if($user['compliance_consider']==10) $compliance_consider='No';
			else if($user['compliance_consider']==-10) $compliance_consider='Yes';
			else $compliance_consider='N/A';
			
			if($user['compliance_collector']==10) $compliance_collector='Yes';
			else if($user['compliance_collector']==-10) $compliance_collector='No';
			else $compliance_collector='N/A';
			
			if($user['closing_call']==10) $closing_call='Yes';
			else if($user['closing_call']==0) $closing_call='No';
			else $closing_call='N/A';
			
			if($user['closing_restate']==10) $closing_restate='Yes';
			else if($user['closing_restate']==0) $closing_restate='No';
			else $closing_restate='N/A';
			
			if($user['closing_educate']==10) $closing_educate='Yes';
			else if($user['closing_educate']==0) $closing_educate='No';
			else $closing_educate='N/A';
			
			if($user['closing_profession']==10) $closing_profession='Yes';
			else if($user['closing_profession']==0) $closing_profession='No';
			else $closing_profession='N/A';
			
			if($user['document_action']==10) $document_action='Yes';
			else if($user['document_action']==-10) $document_action='No';
			else $document_action='N/A';
			
			if($user['document_result']==10) $document_result='Yes';
			else if($user['document_result']==-10) $document_result='No';
			else $document_result='N/A';
			
			if($user['document_context']==10) $document_context='Yes';
			else if($user['document_context']==0) $document_context='No';
			else $document_context='N/A';
			
			if($user['document_remove']==10) $document_remove='Yes';
			else if($user['document_remove']==-10) $document_remove='No';
			else $document_remove='N/A';
			
			if($user['document_update']==10) $document_update='Yes';
			else if($user['document_update']==-10) $document_update='No';
			else $document_update='N/A';
			
			if($user['document_change']==10) $document_change='Yes';
			else if($user['document_change']==-10) $document_change='No';
			else $document_change='N/A';
			
			if($user['document_escalate']==10) $document_escalate='Yes';
			else if($user['document_escalate']==0) $document_escalate='No';
			else $document_escalate='N/A';
			
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",'; 
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['phone'].'",';
			$row .= '"'.$user['contact_date'].'",';
			$row .= '"'.$user['contact_duration'].'",';
			$row .= '"'.$user['vsi_account'].'",';
			$row .= '"'.$user['acpt'].'",';
			$row .= '"'.$user['acpt_option'].'",';
			$row .= '"'.$user['acpt_other'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$opening_call.'",'; 
			$row .= '"'.$opening_verbatim.'",';
			$row .= '"'.$opening_vrs.'",';
			$row .= '"'.$opening_rightparty.'",';
			$row .= '"'.$opening_demographics.'",';
			$row .= '"'.$opening_miranda.'",';
			$row .= '"'.$opening_communication.'",';
			$row .= '"'.$effort_balance.'",';
			$row .= '"'.$effort_poe.'",';
			$row .= '"'.$effort_income.'",';
			$row .= '"'.$effort_rent.'",';
			$row .= '"'.$effort_account.'",';
			$row .= '"'.$effort_intension.'",';
			$row .= '"'.$effort_payment.'",';
			$row .= '"'.$effort_offer.'",';
			$row .= '"'.$effort_lump.'",';
			$row .= '"'.$effort_settlement.'",';
			$row .= '"'.$effort_significant.'",';
			$row .= '"'.$effort_good.'",';
			$row .= '"'.$effort_recoment.'",';
			$row .= '"'.$effort_advise.'",';
			$row .= '"'.$effort_negotiate.'",';
			$row .= '"'.$callcontrol_demo.'",';
			$row .= '"'.$callcontrol_anticipate.'",';
			$row .= '"'.$callcontrol_question.'",';
			$row .= '"'.$callcontrol_establist.'",';
			$row .= '"'.$callcontrol_timelines.'",';
			$row .= '"'.$callcontrol_task.'",';
			$row .= '"'.$callcontrol_company.'",';
			$row .= '"'.$callcontrol_escalate.'",';
			$row .= '"'.$compliance_mispresent.'",';
			$row .= '"'.$compliance_threaten.'",';
			$row .= '"'.$compliance_account.'",';
			$row .= '"'.$compliance_faulse.'",';
			$row .= '"'.$compliance_contact.'",';
			$row .= '"'.$compliance_communicate.'",';
			$row .= '"'.$compliance_consumer.'",';
			$row .= '"'.$compliance_policy.'",';
			$row .= '"'.$compliance_location.'",';
			$row .= '"'.$compliance_dialer.'",';
			$row .= '"'.$compliance_unfair.'",';
			$row .= '"'.$compliance_credit.'",';
			$row .= '"'.$compliance_disput.'",';
			$row .= '"'.$compliance_obtain.'",';
			$row .= '"'.$compliance_imply.'",';
			$row .= '"'.$compliance_legal.'",';
			$row .= '"'.$compliance_barred.'",';
			$row .= '"'.$compliance_fdcpa.'",';
			$row .= '"'.$compliance_consider.'",';
			$row .= '"'.$compliance_collector.'",';
			$row .= '"'.$closing_call.'",';
			$row .= '"'.$closing_restate.'",';
			$row .= '"'.$closing_educate.'",';
			$row .= '"'.$closing_profession.'",';
			$row .= '"'.$document_action.'",';
			$row .= '"'.$document_result.'",';
			$row .= '"'.$document_context.'",';
			$row .= '"'.$document_remove.'",';
			$row .= '"'.$document_update.'",';
			$row .= '"'.$document_change.'",';
			$row .= '"'.$document_escalate.'",';
			$row .= '"'.$user['opening_score'].'",';
			$row .= '"'.$user['opening_possible_scr'].'",';
			$row .= '"'.$user['effort_score'].'",';
			$row .= '"'.$user['effort_possible_scr'].'",';
			$row .= '"'.$user['callcontrol_score'].'",';
			$row .= '"'.$user['callcontrol_possible_scr'].'",';
			$row .= '"'.$user['compliance_score'].'",';
			$row .= '"'.$user['compliance_possible_scr'].'",';
			$row .= '"'.$user['closing_score'].'",';
			$row .= '"'.$user['closing_possible_scr'].'",';
			$row .= '"'.$user['document_score'].'",';
			$row .= '"'.$user['document_possible_scr'].'",';
			$row .= '"'.$user['overall_score'].'",';
			$row .= '"'.$user['point_earned'].'",';
			
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['entry_date'].'",'; 
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';				
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}
	
	
//////////////////VRS Left Message///////////////////
	public function download_qa_vrs_lm_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA VRS LM Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_vrs_lm_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Phone", "Contact Date", "Contact Duration", "VSI Account", "ACPT", "ACPT Option", "ACPT Others", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "State the Zortman with no deviation or did not leave any message", "Leave the appropriate message with a 3rd party?", "State Vital Recovery Services with no deviation?", "Misrepresent their identity?", "Make any false representations about the nature of the call", "Make an attempt at any unusual times (state restrictions) or outside the hours of 8am and 9pm?", "Make an attempt at a work number if it is known or there is reason to know that such calls are prohibited?", "Make an attempt after learning that the consumer is represented by an attorney?", "Adhere to policy regarding third parties and third party disclosure?", "Enter dialer disposition codes correctly to ensure that inappropriate dialing does not take place?", "Remove any numbers known to be incorrect?", "Close the call professionally?", "Use the proper Action Code?", "Use the proper Result Code?", "Document the account thoroughly?", "Overall Score", "Point Earned", "Call Summary", "Feedback", "Audit Time", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			if($user['zortman_deviation']==10) $zortman_deviation='Yes';
			else if($user['zortman_deviation']==0) $zortman_deviation='No';
			else $zortman_deviation='N/A';
			
			if($user['leave_message']==10) $leave_message='Yes';
			else if($user['leave_message']==0) $leave_message='No';
			else $leave_message='N/A';
			
			if($user['vrs_deviation']==10) $vrs_deviation='Yes';
			else if($user['vrs_deviation']==0) $vrs_deviation='No';
			else $vrs_deviation='N/A';
			
			if($user['misprepresent_identity']==10) $misprepresent_identity='No';
			else if($user['misprepresent_identity']==0) $misprepresent_identity='Yes';
			else $misprepresent_identity='N/A';
			
			if($user['make_false']==10) $make_false='No';
			else if($user['make_false']==0) $make_false='Yes';
			else $make_false='N/A';
			
			if($user['make_attempt']==10) $make_attempt='No';
			else if($user['make_attempt']==0) $make_attempt='Yes';
			else $make_attempt='N/A';
			
			if($user['work_number']==10) $work_number='No';
			else if($user['work_number']==0) $work_number='Yes';
			else $work_number='N/A';
			
			if($user['learning_attorney']==10) $learning_attorney='No';
			else if($user['learning_attorney']==0) $learning_attorney='Yes';
			else $learning_attorney='N/A';
			
			if($user['adhere_policy']==10) $adhere_policy='Yes';
			else if($user['adhere_policy']==0) $adhere_policy='No';
			else $adhere_policy='N/A';
			
			if($user['dialer_disposition']==10) $dialer_disposition='Yes';
			else if($user['dialer_disposition']==0) $dialer_disposition='No';
			else $dialer_disposition='N/A';
			
			if($user['remove_number']==10) $remove_number='Yes';
			else if($user['remove_number']==0) $remove_number='No';
			else $remove_number='N/A';
			
			if($user['close_call']==10) $close_call='Yes';
			else if($user['close_call']==0) $close_call='No';
			else $close_call='N/A';
			
			if($user['action_code']==10) $action_code='Yes';
			else if($user['action_code']==0) $action_code='No';
			else $action_code='N/A';
			
			if($user['result_code']==10) $result_code='Yes';
			else if($user['result_code']==0) $result_code='No';
			else $result_code='N/A';
			
			if($user['docu_account']==10) $docu_account='Yes';
			else if($user['docu_account']==0) $docu_account='No';
			else $docu_account='N/A';
			
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",'; 
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['phone'].'",';
			$row .= '"'.$user['contact_date'].'",';
			$row .= '"'.$user['contact_duration'].'",';
			$row .= '"'.$user['vsi_account'].'",';
			$row .= '"'.$user['acpt'].'",';
			$row .= '"'.$user['acpt_option'].'",';
			$row .= '"'.$user['acpt_other'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$zortman_deviation.'",'; 
			$row .= '"'.$leave_message.'",'; 
			$row .= '"'.$vrs_deviation.'",'; 
			$row .= '"'.$misprepresent_identity.'",'; 
			$row .= '"'.$make_false.'",'; 
			$row .= '"'.$make_attempt.'",'; 
			$row .= '"'.$work_number.'",'; 
			$row .= '"'.$learning_attorney.'",'; 
			$row .= '"'.$adhere_policy.'",'; 
			$row .= '"'.$dialer_disposition.'",'; 
			$row .= '"'.$remove_number.'",'; 
			$row .= '"'.$close_call.'",'; 
			$row .= '"'.$action_code.'",'; 
			$row .= '"'.$result_code.'",'; 
			$row .= '"'.$docu_account.'",'; 
			$row .= '"'.$user['overall_score'].'",'; 
			$row .= '"'.$user['point_earned'].'",'; 
			
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['entry_time'].'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';				
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}
	
//////////////////VRS Cavalry///////////////////////////////////////////
	public function download_qa_vrs_cav_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA VRS Cavalry Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_vrs_cav_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Call Date", "Call Length", "ACPT", "ACPT Option", "ACPT Others", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Point Earned", "Customer Service / Treated customer with courtesy and respect","Avoided third party disclosure/ properly verified identity","Gave all required disclosures effectively","Followed state or local requirements","Commented account according to call","Avoided making misleading or deceptive statements","Avoided improper credit report discussion","Avoided improper 3rd party communication","Avoided not honoring dispute or attorney representation","Avoided improper legal talk off or legal threats","Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			if($user['customer_service_with_respect']==10) $customer_service_with_respect='Yes';
			else if($user['customer_service_with_respect']==0) $customer_service_with_respect='No';
			else $customer_service_with_respect='N/A';
			if($user['avoided_third_party_disclosure']==10) $avoided_third_party_disclosure='Yes';
			else if($user['avoided_third_party_disclosure']==0) $avoided_third_party_disclosure='No';
			else $avoided_third_party_disclosure='N/A';
			if($user['gave_all_required_disclosures']==10) $gave_all_required_disclosures='Yes';
			else if($user['gave_all_required_disclosures']==0) $gave_all_required_disclosures='No';
			else $gave_all_required_disclosures='N/A';
			if($user['followed_local_requirement']==10) $followed_local_requirement='Yes';
			else if($user['followed_local_requirement']==0) $followed_local_requirement='No';
			else $followed_local_requirement='N/A';
			if($user['commented_account']==10) $commented_account='Yes';
			else if($user['commented_account']==0) $commented_account='No';
			else $commented_account='N/A';
			if($user['avoided_making_misleading']==10) $avoided_making_misleading='Yes';
			else if($user['avoided_making_misleading']==0) $avoided_making_misleading='No';
			else $avoided_making_misleading='N/A';
			if($user['avoided_improper_credit']==10) $avoided_improper_credit='Yes';
			else if($user['avoided_improper_credit']==0) $avoided_improper_credit='No';
			else $avoided_improper_credit='N/A';
			if($user['avoided_improper_3rd_party']==10) $avoided_improper_3rd_party='Yes';
			else if($user['avoided_improper_3rd_party']==0) $avoided_improper_3rd_party='No';
			else $avoided_improper_3rd_party='N/A';
			if($user['avoided_not_honoring']==10) $avoided_not_honoring='Yes';
			else if($user['avoided_not_honoring']==0) $avoided_not_honoring='No';
			else $avoided_not_honoring='N/A';
			if($user['avoided_improper_legal_talk']==10) $avoided_improper_legal_talk='Yes';
			else if($user['avoided_improper_legal_talk']==0) $avoided_improper_legal_talk='No';
			else $avoided_improper_legal_talk='N/A';
			
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",'; 
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['call_length'].'",';
			$row .= '"'.$user['acpt'].'",';
			$row .= '"'.$user['acpt_option'].'",';
			$row .= '"'.$user['acpt_other'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['overall_score'].'",'; 
			$row .= '"'.$user['point_earned'].'",'; 
			$row .= '"'.$customer_service_with_respect.'",'; 
			$row .= '"'.$avoided_third_party_disclosure.'",'; 
			$row .= '"'.$gave_all_required_disclosures.'",'; 
			$row .= '"'.$followed_local_requirement.'",'; 
			$row .= '"'.$commented_account.'",'; 
			$row .= '"'.$avoided_making_misleading.'",'; 
			$row .= '"'.$avoided_improper_credit.'",'; 
			$row .= '"'.$avoided_improper_3rd_party.'",'; 
			$row .= '"'.$avoided_not_honoring.'",'; 
			$row .= '"'.$avoided_improper_legal_talk.'",'; 
			
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';				
			
			fwrite($fopen,$row."\r\n");
			$row = "";
		}
		
		fclose($fopen);
	}
	
//////////////////////VRS CPTA//////////////////////////////////////////
	public function download_qa_vrs_cpta_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA VRS CPTA Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_vrs_cpta_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Audit Date", "Agent Audited", "Total Audit", "No. of Connect", "No. of Transfer", "Right Party Contact", "No of Correct Verbatim Given", "% of Correct Verbatim", "No of Incorrect Verbatim Given", "% of Incorrect Verbatim", "No. of Correct Transfer", "No. of Incorrect Transfer", "No. of Warm Transfer", "% of Warm Transfer", "No. of Cold Transfer", "% of Cold Transfer");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			$correctVerbatim=round(($user['correct_verbatim'] / $user['total_audit']) * 100, 2);
			$incorrectVerbatim=round(($user['incorrect_verbatim'] / $user['total_audit']) * 100, 2);
			$warmTransfer=round(($user['warm_transfer'] / $user['total_audit']) * 100, 2);
			$coldTransfer=round(($user['cold_transfer'] / $user['total_audit']) * 100, 2);
			
			$row = '"'.$user['audit_date'].'",';
			$row .= '"'.$user['agent_audited'].'",'; 
			$row .= '"'.$user['total_audit'].'",'; 
			$row .= '"'.$user['no_connect'].'",'; 
			$row .= '"'.$user['no_transfer'].'",'; 
			$row .= '"'.$user['rp_contact'].'",'; 
			$row .= '"'.$user['correct_verbatim'].'",'; 
			$row .= '"'.$correctVerbatim.'%'.'",';
			$row .= '"'.$user['incorrect_verbatim'].'",';
			$row .= '"'.$incorrectVerbatim.'%'.'",';
			$row .= '"'.$user['correct_transfer'].'",';
			$row .= '"'.$user['incorrect_transfer'].'",';
			$row .= '"'.$user['warm_transfer'].'",';
			$row .= '"'.$warmTransfer.'%'.'",';
			$row .= '"'.$user['cold_transfer'].'",';
			$row .= '"'.$coldTransfer.'%'.'"';
			
			fwrite($fopen,$row."\r\n");
			$row = "";
		}
		
		fclose($fopen);
	}
	
//////////////////////VRS CPTA ALL Data//////////////////////////////////////////
	public function download_qa_vrs_cptaAll_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA VRS CPTA All Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_vrs_cptaAll_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Audit Date", "Auditor Name", "Agent", "L1Super", "Call Date", "Customer Name", "Phone", "Call Duration", "Connect Type", "Correct Verbatim Given", "Correct/Incorrect Transfer", "Transfer Type", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "QA Note");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$user['audit_date'].'",';
			$row .= '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",'; 
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['customer'].'",';
			$row .= '"'.$user['phone'].'",';
			$row .= '"'.$user['call_duration'].'",';
			$row .= '"'.$user['connect_type'].'",';
			$row .= '"'.$user['verbatim'].'",';
			$row .= '"'.$user['transfer'].'",';
			$row .= '"'.$user['transfer_type'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['qa_comment'].'",';
			
			fwrite($fopen,$row."\r\n");
			$row = "";
		}
		
		fclose($fopen);
	}
	
//////////////////JRPA Right Party///////////////////
	public function download_qa_vrs_jrpa_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA VRS JRPA Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_vrs_jrpa_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Phone", "Contact Date", "Contact Duration", "VSI Account", "ACPT", "ACPT Option", "ACPT Others", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Identify himself/herself by first and last name at the beginning of the call?","Provide the Quality Assurance Statement verbatim before any specific account information was discussed?","State Vital Recovery Services with no deviation?","Verify that he/she was speaking to a right party according to the client requirements (First and Last Name) and before providing the disclosures?","Verify two pieces of demographics information on an outbound call and two pieces on an inbound call? 1) must abide by client requirements and 2) Consumer must provide information unless there is a resistance. 3)Must be completed before disclosures.","Provide the Mini Miranda disclosure verbatim before any specific account information was discussed?","State the client name and the purpose of the communication?","Sate/Ask for balance due?","Ask for a reason for delinquency/intention to resolve the account?","Full and Complete information taken?","Ask for the payment over the phone?","Ask for a post dated payment?","Able to take a promise to pay on the account?","Offer to split the balance in part?", "Offer a one/three/monthly payment lump sum settlement appropriately?", "Offer a payment plan with significant down payment?", "Offer a small good faith payment?","Did not  Misrepresent their identity or authorization?","Did not Threaten to take actions that VRS or the client cannot legally take?","Did not Misrepresent the status of the consumer's account?","Did not Make any faulse representations regarding the nature of the communication?","Did not Contact the consumer at any unusual times (sate regulations) or outside the hours of 8:00 am and 9:00 pm at the consumer's location?","Did not Communicate with the consumer at work if it is known or there is reason to know that such calls are prohibited?","Did not Communicate with the consumer after learning the consumer is represented by an attorney unless a permissible reason exists?","Adhere to the cell phone policy/TCPA regulations and policy regarding contacting consumers via cell phone email and fax?","Adhere to policy regarding third parties for the sole purpose of obtaining location information for the consumer?","Enter dialer disposition codes correctly to ensure that inappropriate dialing does not take place?","Did not Make any statement that could constitute unfair deceptive or abusive acts or practices that may raise UDAAP concerns?","Did not Communicate or threaten to communicate false credit information or information which should be known to be false?","Handle the consumer's dispute correctly and take appropriate action including providing the consumer with the correct contact information to submit a written dispute or complaint or offer to escalate the call?","Did not Discuss or imply that any type of legal actions will be taken or property repossessed?","Did not Discuss legal action on time barred accounts?","Did not Make the required statement on time barred accounts indicating that the consumer cannot be pursued with legal action?","Adhere to FDCPA  laws?","Make any statement that could be considered discriminatory towards a consumer or a violation of VRS ECOA policy?","Did the collectors adhere to the State Restrictions?","Recap the call by verifying Name Address CC/AP information?", "Followed the proper authorization script before processing payment?", "Advise of the payment processing fee before the payment was taken and take appropriate steps if the consumer pushed back?", "Educate the consumer about correspondence being sent (Receipts PIF SIF Confirmations etc)?", "Provide the consumer with the confirmation code?","Demonstrate Active Listening?","Anticipate and overcome objections?","Summarize the call?","Provided VRS call back number?", "Set appropriate timelines and expectations for follow up?","Close the call Professionally?", "Use the proper action code?","Use the proper result code?","Document thoroughly the context of the conversation?", "Remove any phone numbers known to be incorrect?","Update address information if appropriate?","Change the status of the account if appropriate?" , "Escalate the account to a supervisor for handling if appropriate?/ Escalate the account to a supervisor for handling if appropriate?", "Opening Score", "Opening Possible Score", "Effort Score", "Effort Possible Score", "Negotiation Score", "Negotiation Possible Score", "Compliance Score", "Compliance Possible Score", "Payment Script Score" , "Payment Script Possible" , "Call Control Score", "Call Control Possible Score", "Closing Score", "Closing Possible Score", "Document Score", "Document Possible Score", "Overall Score", "Point Earned", "Call Summary", "Feedback", "Audit Time", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			if($user['opening_call']==1.25) $opening_call='Yes';
			else if($user['opening_call']==0) $opening_call='No';
			else $opening_call='N/A';
			
			if($user['opening_verbatim']==1.25) $opening_verbatim='Yes';
			else if($user['opening_verbatim']==0) $opening_verbatim='No';
			else $opening_verbatim='N/A';
			
			if($user['opening_vrs']==1.25) $opening_vrs='Yes';
			else if($user['opening_vrs']==0) $opening_vrs='No';
			else $opening_vrs='N/A';
			
			if($user['opening_rightparty']==1.25) $opening_rightparty='Yes';
			else if($user['opening_rightparty']==0) $opening_rightparty='No';
			else $opening_rightparty='N/A';
			
			if($user['opening_demographics']==1.25) $opening_demographics='Yes';
			else if($user['opening_demographics']==0) $opening_demographics='No';
			else $opening_demographics='N/A';
			
			if($user['opening_miranda']==1.25) $opening_miranda='Yes';
			else if($user['opening_miranda']==0) $opening_miranda='No';
			else $opening_miranda='N/A';
			
			if($user['opening_communication']==1.25) $opening_communication='Yes';
			else if($user['opening_communication']==0) $opening_communication='No';
			else $opening_communication='N/A';
			
			if($user['opening_balance_due']==1.25) $opening_balance_due='Yes';
			else if($user['opening_balance_due']==0) $opening_balance_due='No';
			else $opening_balance_due='N/A';
			
			if($user['effort_delinquency']==5) $effort_delinquency='Yes';
			else if($user['effort_delinquency']==0) $effort_delinquency='No';
			else $effort_delinquency='N/A';
			
			if($user['effort_complete_information']==5) $effort_complete_information='Yes';
			else if($user['effort_complete_information']==0) $effort_complete_information='No';
			else $effort_complete_information='N/A';
			
			if($user['effort_payment_over_phone']==5) $effort_payment_over_phone='Yes';
			else if($user['effort_payment_over_phone']==0) $effort_payment_over_phone='No';
			else $effort_payment_over_phone='N/A';
			
			if($user['effort_post_dated_payment']==5) $effort_post_dated_payment='Yes';
			else if($user['effort_post_dated_payment']==0) $effort_post_dated_payment='No';
			else $effort_post_dated_payment='N/A';
			
			if($user['effort_promise_to_pay']==5) $effort_promise_to_pay='Yes';
			else if($user['effort_promise_to_pay']==0) $effort_promise_to_pay='No';
			else $effort_promise_to_pay='N/A';
 
			if($user['negotiation_split_balance']==5) $negotiation_split_balance='Yes';
			else if($user['negotiation_split_balance']==0) $negotiation_split_balance='No';
			else $negotiation_split_balance='N/A';
			
			if($user['negotiation_monthly_payment']==5) $negotiation_monthly_payment='Yes';
			else if($user['negotiation_monthly_payment']==0) $negotiation_monthly_payment='No';
			else $negotiation_monthly_payment='N/A';
			
			if($user['negotiation_payment_plan']==5) $negotiation_payment_plan='Yes';
			else if($user['negotiation_payment_plan']==0) $negotiation_payment_plan='No';
			else $negotiation_payment_plan='N/A';
			
			if($user['negotiation_faith_payment']==5) $negotiation_faith_payment='Yes';
			else if($user['negotiation_faith_payment']==0) $negotiation_faith_payment='No';
			else $negotiation_faith_payment='N/A';
			
 
			if($user['compliance_mispresent']==0.52) $compliance_mispresent='Yes';
			else if($user['compliance_mispresent']==0) $compliance_mispresent='No';
			else $compliance_mispresent='N/A';
			
			if($user['compliance_threaten']==0.52) $compliance_threaten='Yes';
			else if($user['compliance_threaten']==0) $compliance_threaten='No';
			else $compliance_threaten='N/A';
			
			if($user['compliance_faulse']==0.52) $compliance_faulse='Yes';
			else if($user['compliance_faulse']==0) $compliance_faulse='No';
			else $compliance_faulse='N/A';
			
			if($user['compliance_account']==0.52) $compliance_account='Yes';
			else if($user['compliance_account']==0) $compliance_account='No';
			else $compliance_account='N/A';
			 
			if($user['compliance_contact']==0.52) $compliance_contact='Yes';
			else if($user['compliance_contact']==0) $compliance_contact='No';
			else $compliance_contact='N/A';
			
			if($user['compliance_communicate']==0.52) $compliance_communicate='Yes';
			else if($user['compliance_contact']==0) $compliance_communicate='No';
			else $compliance_communicate='N/A';
			
			if($user['compliance_consumer']==0.52) $compliance_consumer='Yes';
			else if($user['compliance_consumer']==0) $compliance_consumer='No';
			else $compliance_consumer='N/A';
			
			if($user['compliance_policy']==0.52) $compliance_policy='Yes';
			else if($user['compliance_policy']==0) $compliance_policy='No';
			else $compliance_policy='N/A';
			
			if($user['compliance_location']==0.52) $compliance_location='Yes';
			else if($user['compliance_location']==0) $compliance_location='No';
			else $compliance_location='N/A';
			
			if($user['compliance_dialer']==0.52) $compliance_dialer='Yes';
			else if($user['compliance_dialer']==0) $compliance_dialer='No';
			else $compliance_dialer='N/A';
			
			if($user['compliance_unfair']==0.52) $compliance_unfair='No';
			else if($user['compliance_unfair']==0) $compliance_unfair='Yes';
			else $compliance_unfair='N/A';
			
			if($user['compliance_credit']==0.52) $compliance_credit='Yes';
			else if($user['compliance_credit']==0) $compliance_credit='No';
			else $compliance_credit='N/A';
			
			if($user['compliance_disput']==0.52) $compliance_disput='Yes';
			else if($user['compliance_disput']==0) $compliance_disput='No';
			else $compliance_disput='N/A';
			
			if($user['compliance_obtain']==0.52) $compliance_obtain='Yes';
			else if($user['compliance_obtain']==0) $compliance_obtain='No';
			else $compliance_obtain='N/A';
			
			if($user['compliance_imply']==0.52) $compliance_imply='Yes';
			else if($user['compliance_imply']==0) $compliance_imply='No';
			else $compliance_imply='N/A';
			
			if($user['compliance_legal']==0.52) $compliance_legal='Yes';
			else if($user['compliance_legal']==0) $compliance_legal='No';
			else $compliance_legal='N/A';
			
			if($user['compliance_barred']==0.52) $compliance_barred='Yes';
			else if($user['compliance_barred']==0) $compliance_barred='No';
			else $compliance_barred='N/A';
			
			if($user['compliance_fdcpa']==0.52) $compliance_fdcpa='Yes';
			else if($user['compliance_fdcpa']==0) $compliance_fdcpa='No';
			else $compliance_fdcpa='N/A';
			
			if($user['compliance_consider']==0.52) $compliance_consider='Yes';
			else if($user['compliance_consider']==0) $compliance_consider='No';
			else $compliance_consider='N/A';
			
		/* 	if($user['compliance_collector']==0.52) $compliance_collector='No';
			else if($user['compliance_collector']==0) $compliance_collector='Yes';
			else $compliance_collector='N/A';  */
			 
			if($user['payment_script_recap']==2) $payment_script_recap='No';
			else if($user['payment_script_recap']==0) $payment_script_recap='Yes';
			else $payment_script_recap='N/A';
			
			if($user['payment_script_authorization']==2) $payment_script_authorization='Yes';
			else if($user['payment_script_authorization']==0) $payment_script_authorization='No';
			else $payment_script_authorization='N/A';
			
			if($user['payment_script_advice']==2) $payment_script_advice='Yes';
			else if($user['payment_script_advice']==0) $payment_script_advice='No';
			else $payment_script_advice='N/A';
			
			if($user['payment_script_educate']==2) $payment_script_educate='Yes';
			else if($user['payment_script_educate']==0) $payment_script_educate='No';
			else $payment_script_educate='N/A';
			
			if($user['payment_script_confirmation_code']==2) $payment_script_confirmation_code='Yes';
			else if($user['payment_script_confirmation_code']==0) $payment_script_confirmation_code='No';
			else $payment_script_confirmation_code='N/A';
			
			 
			if($user['callcontrol_demo']==2.5) $callcontrol_demo='No';
			else if($user['callcontrol_demo']==0) $callcontrol_demo='Yes';
			else $callcontrol_demo='N/A';
			
			if($user['callcontrol_anticipate']==2.5) $callcontrol_anticipate='Yes';
			else if($user['callcontrol_anticipate']==0) $callcontrol_anticipate='No';
			else $callcontrol_anticipate='N/A';
			
			 
			
			if($user['closing_call']==1.25) $closing_call='Yes';
			else if($user['closing_call']==0) $closing_call='No';
			else $closing_call='N/A';
			
			if($user['closing_restate']==1.25) $closing_restate='Yes';
			else if($user['closing_restate']==0) $closing_restate='No';
			else $closing_restate='N/A';
			
			if($user['closing_educate']==1.25) $closing_educate='Yes';
			else if($user['closing_educate']==0) $closing_educate='No';
			else $closing_educate='N/A';
			
			if($user['closing_profession']==1.25) $closing_profession='Yes';
			else if($user['closing_profession']==0) $closing_profession='No';
			else $closing_profession='N/A';
			
			
			if($user['document_action']==1.42) $document_action='Yes';
			else if($user['document_action']==0) $document_action='No';
			else $document_action='N/A';
			
			if($user['document_result']==1.42) $document_result='Yes';
			else if($user['document_result']==0) $document_result='No';
			else $document_result='N/A';
			
			if($user['document_context']==1.42) $document_context='Yes';
			else if($user['document_context']==0) $document_context='No';
			else $document_context='N/A';
			
			if($user['document_remove']==1.42) $document_remove='Yes';
			else if($user['document_remove']==0) $document_remove='No';
			else $document_remove='N/A';
			
			if($user['document_update']==1.42) $document_update='Yes';
			else if($user['document_update']==0) $document_update='No';
			else $document_update='N/A';
			
			if($user['document_change']==1.42) $document_change='Yes';
			else if($user['document_change']==0) $document_change='No';
			else $document_change='N/A';
			
			if($user['document_escalate']==1.42) $document_escalate='Yes';
			else if($user['document_escalate']==0) $document_escalate='No';
			else $document_escalate='N/A';
			
			
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",'; 
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['phone'].'",';
			$row .= '"'.$user['contact_date'].'",';
			$row .= '"'.$user['contact_duration'].'",';
			$row .= '"'.$user['vsi_account'].'",';
			$row .= '"'.$user['acpt'].'",';
			$row .= '"'.$user['acpt_option'].'",';
			$row .= '"'.$user['acpt_other'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$opening_call.'",'; 
			$row .= '"'.$opening_verbatim.'",';
			$row .= '"'.$opening_vrs.'",';
			$row .= '"'.$opening_rightparty.'",';
			$row .= '"'.$opening_demographics.'",';
			$row .= '"'.$opening_miranda.'",';
			$row .= '"'.$opening_communication.'",';
			$row .= '"'.$opening_balance_due.'",';
			$row .= '"'.$effort_delinquency.'",';
			$row .= '"'.$effort_complete_information.'",';
			$row .= '"'.$effort_payment_over_phone.'",';
			$row .= '"'.$effort_post_dated_payment.'",';
			$row .= '"'.$effort_promise_to_pay.'",';
			$row .= '"'.$negotiation_split_balance.'",';
			$row .= '"'.$negotiation_monthly_payment.'",';
			$row .= '"'.$negotiation_payment_plan.'",';
			$row .= '"'.$negotiation_faith_payment.'",';
			$row .= '"'.$compliance_mispresent.'",';
			$row .= '"'.$compliance_threaten.'",';
			$row .= '"'.$compliance_account.'",';
			$row .= '"'.$compliance_faulse.'",';
			$row .= '"'.$compliance_contact.'",';
			$row .= '"'.$compliance_communicate.'",';
			$row .= '"'.$compliance_consumer.'",';
			$row .= '"'.$compliance_policy.'",';
			$row .= '"'.$compliance_location.'",';
			$row .= '"'.$compliance_dialer.'",';
			$row .= '"'.$compliance_unfair.'",';
			$row .= '"'.$compliance_credit.'",';
			$row .= '"'.$compliance_disput.'",';
			$row .= '"'.$compliance_obtain.'",';
			$row .= '"'.$compliance_imply.'",';
			$row .= '"'.$compliance_legal.'",';
			$row .= '"'.$compliance_barred.'",';
			$row .= '"'.$compliance_fdcpa.'",';
			$row .= '"'.$compliance_consider.'",';
			/*$row .= '"'.$compliance_collector.'",'; */
			$row .= '"'.$payment_script_recap.'",';
			$row .= '"'.$payment_script_authorization.'",';
			$row .= '"'.$payment_script_advice.'",';
			$row .= '"'.$payment_script_educate.'",';
			$row .= '"'.$payment_script_confirmation_code.'",';
			$row .= '"'.$callcontrol_demo.'",';
			$row .= '"'.$callcontrol_anticipate.'",';
			$row .= '"'.$closing_call.'",';
			$row .= '"'.$closing_restate.'",';
			$row .= '"'.$closing_educate.'",';
			$row .= '"'.$closing_profession.'",';
			$row .= '"'.$document_action.'",';
			$row .= '"'.$document_result.'",';
			$row .= '"'.$document_context.'",';
			$row .= '"'.$document_remove.'",';
			$row .= '"'.$document_update.'",';
			$row .= '"'.$document_change.'",';
			$row .= '"'.$document_escalate.'",';
			$row .= '"'.$user['opening_score'].'",';
			$row .= '"'.$user['opening_possible_scr'].'",';
			$row .= '"'.$user['effort_score'].'",';
			$row .= '"'.$user['effort_possible_scr'].'",';
			$row .= '"'.$user['negotiation_score'].'",';
			$row .= '"'.$user['negotiation_possible_score'].'",';
			$row .= '"'.$user['payment_script_score'].'",';
			$row .= '"'.$user['payment_script_possible_score'].'",';
			$row .= '"'.$user['compliance_score'].'",';
			$row .= '"'.$user['compliance_possible_scr'].'",';
			$row .= '"'.$user['callcontrol_score'].'",';
			$row .= '"'.$user['callcontrol_possible_scr'].'",';
			$row .= '"'.$user['closing_score'].'",';
			$row .= '"'.$user['closing_possible_scr'].'",';
			$row .= '"'.$user['document_score'].'",';
			$row .= '"'.$user['document_possible_scr'].'",';
			$row .= '"'.$user['overall_score'].'",';
			$row .= '"'.$user['point_earned'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['entry_time'].'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';			
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}


///////////////////////////////////////////////////////////////////////////////////////////	 
/////////////////////////////////////// Viberides REPORT //////////////////////////////////	
///////////////////////////////////////////////////////////////////////////////////////////
	public function qa_viberides_report(){
		if(check_logged_in()){
			$office_id = "";
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["download_link1"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_viberides_report.php";
			$data["content_js"] = "qa_viberides_js.php";

			$date_from="";
			$date_to="";
			$office_id="";
			$campaign="";
			$action="";
			$dn_link="";
			$dn_link1="";
			$cond1='';
			
			$campaign = $this->input->get('campaign');
			
			$data["qa_viberides_list"] = array();
			
			if(get_role_dir()=="super" || $is_global_access==1){
				$data['location_list'] = $this->Common_model->get_office_location_list();
			}else{
				$data['location_list'] = $this->Common_model->get_office_location_session_all($current_user);
			}
			
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond1= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
				if($office_id != "") $cond1 .= " and office_id='$office_id'";
				
				if($campaign=='vibe_old'){
					$qSql="SELECT * from (Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, (select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name from qa_viberides_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, get_process_names(id) as campaign, DATEDIFF(CURDATE(), doj) as tenure, assigned_to from signin) yy on (xx.agent_id=yy.sid) $cond1 order by audit_date";
					$fullAray = $this->Common_model->get_query_result_array($qSql);
					$data["qa_viberides_list"] = $fullAray;
					$this->create_qa_viberides_new_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_viberides_new_CSV";
				}else if($campaign=='vibe'){
					$qSql="SELECT * from 
					(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, 
					(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, 
					(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
					(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_rvw_by) as client_rvw_name from qa_viberides_new_feedback) xx Left Join 
					(Select id as sid, fname, lname, fusion_id, office_id, get_process_names(id) as campaign, DATEDIFF(CURDATE(), doj) as tenure, assigned_to from signin) yy on (xx.agent_id=yy.sid) $cond1 order by audit_date";
					$fullAray = $this->Common_model->get_query_result_array($qSql);
					$data["qa_viberides_list"] = $fullAray;
					$this->create_qa_vibe_new_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_vibe_new_CSV";
				}
				
			}
			
			$data['download_link']=$dn_link;
			$data['download_link1']=$dn_link1;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id'] = $office_id;	
			$data['campaign'] = $campaign;	
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_viberides_new_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Viberides New Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function viberides_headerDetails(){
		return $arrayName = array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","Call Duration","Audit Type","Auditor Type","VOC","Call Type","Overall Score","Used Customer's Name in Opening","Thank Customer for Contacting","Took Ownership & Assured Resolution","Restated the Customer's Issue","Provided Step-by-Step Resolution","Use of Proper Verbiage","Resolution Provided is Best Resolution","Uses Please and Thank You in response","If follow up needed set appropriate customer expectations","Took Ownership of Ticket and provided First Contact Resolution","Apologized when necessary","Used appropriate verbiage","Referenced KB article or Terms and Conditions","Reviewed Next Steps","Used Correct Closing","Comprehensive Notes","Verify Profile Picture","Verify email address and phone number","Verify and classify car information and pictures","Verify driver's license front/back picture","Verify Insurance Information","Verify State inspection","Verify Vibe Inspection","Dispositioning Background check","Review note on approved profiles before making changes","Detailed notes once entering a driver profile","Marking tickets as resolved/closed incorrectly","Responding with canned response that does not answer/address questions","Not getting clarity from ticket/question from driver/rider before responding","All drivers must be reviewed","Profanity","Dishonesty","Disconnected Without Reason","Incorrect information in ticket response","Not following updates and instructions","Incorrect/Not Filling Property Box","Incomplete answers for questions","Address driver by his/her name/Vibedriver or Viberider","Approving/Declining driver before verified regarding BGC","Changing/Deleting information without authority or justification e.g. Profile Approvals","Not Including KB Link","Not removing watermark in email","Comments 1","Comments 2","Comments 3","Comments 4","Comments 5","Comments 6","Comments 7","Comments 8","Comments 9","Comments 10","Comments 11","Comments 12","Comments 13","Comments 14","Comments 15","Comments 16","Comments 17","Comments 18","Comments 19","Comments 20","Comments 21","Comments 22","Comments 23","Comments 24","Comments 25","Comments 26","Comments 27","Comments 28","Comments 29","Comments 30","Comments 31","Comments 32","Comments 33","Comments 34","Comments 35","Comments 36","Comments 37","Comments 38","Comments 39","Comments 40","Comments 41","Comments 42","Call Summary","Feedback","Entry By","Entry Date","Client entry by","Mgnt review by","Mgnt review note","Mgnt review date","Agent review note","Agent review date","Client review by","Client review note","Client_rvw_date");
	}

	public function create_qa_viberides_new_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");		
		$header=$this->viberides_headerDetails();
		$field_name="SHOW FULL COLUMNS FROM qa_viberides_feedback WHERE Comment!=''";
		$field_name=$this->Common_model->get_query_result_array($field_name);
		$fld_cnt=count($field_name);
		for($i=0;$i<$fld_cnt;$i++){
						$val=$field_name[$i]['Field'];
						if($val!=""){
							$field_val[]=$val;
						}		
					 }
		
		array_unshift($field_val ,"auditor_name");
		$key = array_search ('agent_id', $field_val);
		array_splice($field_val, $key, 0, 'fusion_id');
		$field_val=array_values($field_val);

		$count_for_field=count($field_val);

		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		$row = "";
		// print_r($rr);
		// die;
		foreach($rr as $user)
		{	
			for($z=0;$z<$count_for_field;$z++){
				
				if($field_val[$z]==="auditor_name"){
					$row = '"'.$user['auditor_name'].'",';
				}elseif($field_val[$z]==="fusion_id"){
					$row .= '"'.$user['fusion_id'].'",';
				}elseif($field_val[$z]==="agent_id"){
					$row .= '"'.$user['fname']." ".$user['lname'].'",';
				}elseif($field_val[$z]==="tl_id"){
					$row .= '"'.$user['tl_name'].'",';	
				}elseif(in_array($field_val[$z], array('call_summary','feedback','agent_rvw_note','mgnt_rvw_note'))) {
    			
    			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user[$field_val[$z]])).'",';

				}else{
					$row .= '"'.$user[$field_val[$z]].'",';	
				}
				
			}
				
				fwrite($fopen,$row."\r\n");
				$row = "";
		}
		
		fclose($fopen);
	}

/*--------- NEW Viberides Report ----------*/	
	public function download_qa_vibe_new_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Viberides Audit List-'".$currDate."'.csv";
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_vibe_new_CSV($rr)
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		$header = array("Auditor Name", "Audit Date", "Agent", "Fusion ID", "L1 Super", "Call Date", "Call Type", "Call ID", "Contact Duration", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Earned Score", "Possible Score", "Used Customers Name in Opening", "Thank Customer for Contacting", "Took Ownership & Assured Resolution", "Follow-up questions to ensure they understood the problem", "Provided Step-by-Step Resolution", "Information provided is correct", "Use of proper verbiage spelling and grammar", "Reviewed Next Steps", "Used Correct Closing", "Comprehensive Notes", "Verify Profile Picture email address and phone number", "Verify and classify vehicle information and documentation", "Verify drivers license", "Verify vehicle pictures", "Verify Background Check", "Detailed notes once entering a driver profile", "Marking tickets as resolved/closed incorrectly", "Review note on approved profiles before making changes", "Profanity", "Dishonesty", "Disconnected Without Reason", "Incorrect information in ticket response", "Not following updates and instructions", "Incorrect/Not Filling Property Box", "Incomplete answers for questions", "Address driver by his/her nickname/Vibedriver or Viberider", "Approving/Declining driver before verified", "Changing/Deleting information without authority or justification", "Not Including KB Link", "Not removing watermark in email", "GREETING Comment 1", "GREETING Comment 2", "GREETING Comment 3", "SOFT SKILL Comment 1", "SOFT SKILL Comment 2", "SOFT SKILL Comment 3", "SOFT SKILL Comment 4", "SOFT SKILL Comment 5", "SOFT SKILL Comment 6", "SOFT SKILL Comment 7", "BACKOFFICE Comment 1", "BACKOFFICE Comment 2", "BACKOFFICE Comment 3", "BACKOFFICE Comment 4", "BACKOFFICE Comment 5", "BACKOFFICE Comment 6", "BACKOFFICE Comment 7", "BACKOFFICE Comment 8", "AUTOFAILS Comment 1", "AUTOFAILS Comment 2", "AUTOFAILS Comment 3", "AUTOFAILS Comment 4", "AUTOFAILS Comment 5", "AUTOFAILS Comment 6", "AUTOFAILS Comment 7", "AUTOFAILS Comment 8", "AUTOFAILS Comment 9", "AUTOFAILS Comment 10", "AUTOFAILS Comment 11", "AUTOFAILS Comment 12", "Call Summary", "Feedback", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user){	
			if($user['entry_by']!=''){
				$auditorName = $user['auditor_name'];
			}else{
				$auditorName = $user['client_name'];
			}
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$auditorName.'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['fusion_id'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['call_type'].'",';
			$row .= '"'.$user['call_id'].'",';
			$row .= '"'.$user['call_duration'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'.$user['earned_score'].'",';
			$row .= '"'.$user['possible_score'].'",';
			$row .= '"'.$user['use_customer_name'].'",';
			$row .= '"'.$user['customer_contacting'].'",';
			$row .= '"'.$user['took_ownership'].'",';
			$row .= '"'.$user['followup_question'].'",';
			$row .= '"'.$user['provide_resolution'].'",';
			$row .= '"'.$user['correct_information_provide'].'",';
			$row .= '"'.$user['use_proper_verbiage'].'",';
			$row .= '"'.$user['review_next_step'].'",';
			$row .= '"'.$user['use_correct_closing'].'",';
			$row .= '"'.$user['comprehensive_note'].'",';
			$row .= '"'.$user['verify_profile_picture'].'",';
			$row .= '"'.$user['classify_vehicle'].'",';
			$row .= '"'.$user['verify_driver_license'].'",';
			$row .= '"'.$user['verify_vehicle_picture'].'",';
			$row .= '"'.$user['verify_background_check'].'",';
			$row .= '"'.$user['driver_profile_details'].'",';
			$row .= '"'.$user['making_resolved_ticket'].'",';
			$row .= '"'.$user['approve_changes_profile'].'",';
			$row .= '"'.$user['profanity'].'",';
			$row .= '"'.$user['dishonesty'].'",';
			$row .= '"'.$user['disconected_without_reason'].'",';
			$row .= '"'.$user['incorrect_information'].'",';
			$row .= '"'.$user['not_following_update'].'",';
			$row .= '"'.$user['not_filling_property_box'].'",';
			$row .= '"'.$user['incomplete_answer'].'",';
			$row .= '"'.$user['viberider_driver_address'].'",';
			$row .= '"'.$user['driver_verify_approve_decline'].'",';
			$row .= '"'.$user['changing_information_without_authority'].'",';
			$row .= '"'.$user['not_include_KB_link'].'",';
			$row .= '"'.$user['not_remove_email_watermark'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt16'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt17'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt18'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt19'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt20'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt21'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt22'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt23'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt24'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt25'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt26'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt27'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt28'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt29'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt30'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agnt_fd_acpt'].'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
			$row .= '"'.$user['client_rvw_date'].'",';
			$row .= '"'.$user['client_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
			
			fwrite($fopen,$row."\r\n");
		}
		fclose($fopen);
		
	}


///////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////// QA VERSO REPORT ////////////////////////////////////	
///////////////////////////////////////////////////////////////////////////////////////////

	public function qa_verso_report(){
		if(check_logged_in()){
			
			$office_id = "";
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			
			/* $office_id = $this->input->get('office_id');
			if($office_id=="")  $office_id=$user_office_id; */
			
			
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_verso_report.php";
			
			
			$date_from="";
			$date_to="";
			$action="";
			$dn_link="";
			
			/* $cValue = trim($this->input->post('client_id'));
			if($cValue=="") $cValue = trim($this->input->get('client_id')); */
			
			$pValue = trim($this->input->post('process_id'));
			if($pValue=="") $pValue = trim($this->input->get('process_id'));
			
			//$data['cValue']=$cValue;
			$data['pValue']=$pValue;
			
			
			
			$data["qa_verso_list"] = array();
			
			if(get_role_dir()=="super" || $is_global_access==1){
				$data['location_list'] = $this->Common_model->get_office_location_list();
			}else{
				$data['location_list'] = $this->Common_model->get_office_location_session_all($current_user);
			}
			
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				$field_array = array(
						"date_from"=>$date_from,
						"date_to" => $date_to,
						//"office_id" => $office_id,
						"process_id" => $pValue,
						"current_user" => $current_user
					);
					
				
				if($pValue=='Customer Care'){
					
					$fullAray = $this->Qa_verso_model->qa_verso_report_model($field_array);
					$data["qa_verso_list"] = $fullAray;
					$this->create_qa_verso_inbound_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_verso_inbound_CSV";
				
				}else if($pValue=='Full Call'){
					
					$fullAray = $this->Qa_verso_model->qa_verso_report_model($field_array);
					$data["qa_verso_list"] = $fullAray;
					$this->create_qa_verso_ob_fca_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_verso_ob_fca_CSV";
				
				}else{
					
					$fullAray = $this->Qa_verso_model->qa_verso_report_model($field_array);
					$data["qa_verso_list"] = $fullAray;
					$this->create_qa_verso_ob_sca_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_verso_ob_sca_CSV";
				
				}
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			
			$this->load->view('dashboard',$data);
		}
	}

/*------VERSO Customer Care Audit(Inbound)-------*/
	public function download_qa_verso_inbound_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Verso Customer Care Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_verso_inbound_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Phone", "Campaign", "Audit Type", "VOC", "Agent CRM ID", "Site", "Call ID", "Call Date", "Call Opening", "Apology/ Empathy", "Enthusiasm", "Politeness and Courtesy", "Fluency", "Complete & Accurate Resolution", "Correct CRM Entry/CRM Accuracy", "Closing", "Active Listening", "Hold Protocol", "Effective Probing", "Overall Score", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Management Review Date", "Management Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
		
			if($user['call_opening']==10) $call_opening='Yes';
			else if($user['call_opening']==10.1) $call_opening='N/A';
			else $call_opening='No';
			
			if($user['apology_empathy']==10) $apology_empathy='Yes';
			else if($user['apology_empathy']==10.1) $apology_empathy='N/A';
			else $apology_empathy='No';
			
			if($user['enthusiasm']==10) $enthusiasm='Yes';
			else if($user['enthusiasm']==10.1) $enthusiasm='N/A';
			else $enthusiasm='No';
			
			if($user['politeness_courtesy']==10) $politeness_courtesy='Yes';
			else if($user['politeness_courtesy']==10.1) $politeness_courtesy='N/A';
			else $politeness_courtesy='No';
			
			if($user['fluency']==10) $fluency='Yes';
			else if($user['fluency']==10.1) $fluency='N/A';
			else $fluency='No';
			
			if($user['accurate_resolution']==10) $accurate_resolution='Yes';
			else if($user['accurate_resolution']==10.1) $accurate_resolution='N/A';
			else $accurate_resolution='No';
			
			if($user['crm_accuracy']==10) $crm_accuracy='Yes';
			else if($user['crm_accuracy ']==10.1) $crm_accuracy='N/A';
			else $crm_accuracy='No';
			
			if($user['closing']==10) $closing='Yes';
			else if($user['closing']==10.1) $closing='N/A';
			else $closing='No';
			
			if($user['active_listening']==10) $active_listening='Yes';
			else if($user['active_listening']==10.1) $active_listening='N/A';
			else $active_listening='No';
			
			if($user['hold_protocol']==5) $hold_protocol='Yes';
			else if($user['hold_protocol']==5.1) $hold_protocol='N/A';
			else $hold_protocol='No';
			
			if($user['effective_probing']==5) $effective_probing='Yes';
			else if($user['effective_probing']==5.1) $effective_probing='N/A';
			else $effective_probing='No';
			
			
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",'; 
			$row .= '"'.$user['tl_name'].'",'; 
			$row .= '"'.$user['phone'].'",'; 
			$row .= '"'.$user['campaign'].'",'; 
			$row .= '"'.$user['audit_type'].'",'; 
			$row .= '"'.$user['voc'].'",'; 
			$row .= '"'.$user['agent_crm_id'].'",'; 
			$row .= '"'.$user['site'].'",'; 
			$row .= '"'.$user['call_id'].'",'; 
			$row .= '"'.$user['call_date'].'",'; 
			$row .= '"'.$call_opening.'",'; 
			$row .= '"'.$apology_empathy.'",'; 
			$row .= '"'.$enthusiasm.'",'; 
			$row .= '"'.$politeness_courtesy.'",'; 
			$row .= '"'.$fluency.'",'; 
			$row .= '"'.$accurate_resolution.'",'; 
			$row .= '"'.$crm_accuracy.'",'; 
			$row .= '"'.$closing.'",'; 
			$row .= '"'.$active_listening.'",'; 
			$row .= '"'.$hold_protocol.'",'; 
			$row .= '"'.$effective_probing.'",'; 
			$row .= '"'.$user['overall_score'].'",'; 
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",'; 
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",'; 
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}
	

/*------VERSO Full Call Audit(Outbound)-------*/
	public function download_qa_verso_ob_fca_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Verso Full Call Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_verso_ob_fca_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Agent CRM ID", "Phone", "Campaign", "Audit Type", "VOC", "Site", "Revenue", "Tag Error", "Probing Error", "Other Error", "Fallout", "Fallout Comment", "Overall Score", "ZTP", "Call Status", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Management Review Date", "Management Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
		
			if($user['tag_error']==40) $tag_error='No';
			else $call_opening='Yes';
			
			if($user['probing_error']==40) $probing_error='No';
			else $probing_error='Yes';
			
			if($user['other_error']==10) $other_error='No';
			else $other_error='Yes';
			
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",'; 
			$row .= '"'.$user['tl_name'].'",'; 
			$row .= '"'.$user['agent_crm_id'].'",'; 
			$row .= '"'.$user['phone'].'",'; 
			$row .= '"'.$user['campaign'].'",'; 
			$row .= '"'.$user['audit_type'].'",'; 
			$row .= '"'.$user['voc'].'",'; 
			$row .= '"'.$user['site'].'",'; 
			$row .= '"'.$user['revenue'].'",'; 
			$row .= '"'.$tag_error.'",'; 
			$row .= '"'.$probing_error.'",'; 
			$row .= '"'.$other_error.'",'; 
			$row .= '"'.$user['fallout'].'",'; 
			$row .= '"'.$user['fallout_comment'].'",'; 
			$row .= '"'.$user['overall_score'].'",'; 
			$row .= '"'.$user['ztp'].'",'; 
			$row .= '"'.$user['call_status'].'",'; 
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",'; 
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",'; 
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}

/*------VERSO Special Call Audit(Outbound)-------*/
	public function download_qa_verso_ob_sca_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Verso Special Call Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_verso_ob_sca_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Agent CRM ID", "Phone", "Campaign", "Audit Type", "VOC", "Site", "Question Code", "Call Status", "Reject Reason", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Management Review Date", "Management Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
		
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",'; 
			$row .= '"'.$user['tl_name'].'",'; 
			$row .= '"'.$user['agent_crm_id'].'",'; 
			$row .= '"'.$user['phone'].'",'; 
			$row .= '"'.$user['campaign'].'",'; 
			$row .= '"'.$user['audit_type'].'",'; 
			$row .= '"'.$user['voc'].'",'; 
			$row .= '"'.$user['site'].'",'; 
			$row .= '"'.$user['question_code'].'",';
			$row .= '"'.$user['call_status'].'",'; 
			$row .= '"'.$user['reject_reason'].'",'; 
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",'; 
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",'; 
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}

	////////////////////////////////////////////// VFS Report //////////////////////////////////////////////////

	public function qa_us_da_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_usda_report.php";
			$data["content_js"] = "qa_od_js.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$campaign="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			$data["qa_usda_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
		
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_us_da_feedback) xx Left Join
				(Select id as sid, fname, lname, fusion_id, office_id, assigned_to, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_usda_list"] = $fullAray;
				$this->create_qa_usda_CSV($fullAray,$campaign);	
				$dn_link = base_url()."reports_qa/download_qa_usda_CSV";
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_usda_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA US DA Audit List-'".$currDate."'.csv";
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	
	public function create_qa_usda_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Opening", "Listening", "Search", "Fulfillment", "Closing", "Attitude", "Professionalism", "Call Summary", "Feedback", "Agent Review Status", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user){	
			if($user['entry_by']!=''){
				$auditorName = $user['auditor_name'];
			}else{
				$auditorName = $user['client_name'];
			}
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
		
			$row = '"'.$auditorName.'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['call_duration'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'.$user['opening'].'",';
			$row .= '"'.$user['listening'].'",';
			$row .= '"'.$user['search'].'",';
			$row .= '"'.$user['fulfillment'].'",';
			$row .= '"'.$user['closing'].'",';
			$row .= '"'.$user['attitude'].'",';
			$row .= '"'.$user['professionalism'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_fd_acpt'].'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
			$row .= '"'.$user['client_rvw_date'].'",';
			$row .= '"'.$user['client_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';	
			fwrite($fopen,$row."\r\n");
		}
		fclose($fopen);
		
	}

	///////////////////////////////////////////////////////////////////////////////////// 
/////////////////////////////// QA SXC REPORT ////////////////////////////////	
/////////////////////////////////////////////////////////////////////////////////////

	public function qa_sxc_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_sxc_report.php";
			$data["content_js"] = "qa_metropolis_js.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			
			$data["qa_sxc_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
		
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_sxc_feedback) xx Left Join
				(Select id as sid, fname, lname, fusion_id, assigned_to, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_sxc_list"] = $fullAray;
				$this->create_qa_sxc_CSV($fullAray);	
				$dn_link = base_url()."reports_qa/download_qa_sxc_CSV";
				
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_sxc_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA SXC Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_sxc_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Date of Evaluation", "Agent", "Fusion ID", "L1 Super", "Date/Time of Response", "Ticket Number", "Issue/Concern", "Audit Type", "VOC", "Overall Score", "Asking probing questions to assist", "Accuracy and appropriateness of information", "Did the agent review the previous conversation?", "Empathy and Enthusiasm (offer apology only when needed)", "Simplicity and Politeness", "Grammar and Punctuation", "Are the thoughts and instructions on the email properly organized?", "Salutation", "Closing", "Did the agent respond or acknowledge the customers issue?", "Did the agent follow through with concerned channels or dept to resolve the issue?", "Did the agent follow up with customer within the agreed timeline?", "Did the agent properly reassign or tag the ticket?", "Did the agent properly document important information on the ticket?", "Did the agent adequately resolved the customers issue or provided a timeframe for resolution?", "BODY OF THE EMAIL Comment1", "BODY OF THE EMAIL Comment2", "BODY OF THE EMAIL Comment3", "FORMAT AND TONE Comment1", "FORMAT AND TONE Comment2", "FORMAT AND TONE Comment3", "FORMAT AND TONE Comment4", "FORMAT AND TONE Comment5", "FORMAT AND TONE Comment6", "FOLLOW-UP OR ACTIONS TAKEN Comment1", "FOLLOW-UP OR ACTIONS TAKEN Comment2", "FOLLOW-UP OR ACTIONS TAKEN Comment3", "FOLLOW-UP OR ACTIONS TAKEN Comment4", "FOLLOW-UP OR ACTIONS TAKEN Comment5", "FOLLOW-UP OR ACTIONS TAKEN Comment6", "Call Summary", "Feedback", "Agent Review Date", "Agent cmtent", "Mgnt Review Date","Mgnt Review By", "Mgnt cmtent", "Client Review Date", "Client Review Name", "Client Review Note");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			if($user['entry_by']!=''){
				$auditorName = $user['auditor_name'];
			}else{
				$auditorName = $user['client_name'];
			}
		
			$row = '"'.$auditorName.'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['fusion_id'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['ticket_no'].'",';
			$row .= '"'.$user['issue_concern'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'.$user['askingProbingQuestion'].'",';
			$row .= '"'.$user['accuracyandAppropiateness'].'",';
			$row .= '"'.$user['agentReviewPreviousConversation'].'",';
			$row .= '"'.$user['empathyandEnthusiasm'].'",';
			$row .= '"'.$user['simplycityandPoliteness'].'",';
			$row .= '"'.$user['grammerandPunctuation'].'",';
			$row .= '"'.$user['instructionEmailProperly'].'",';
			$row .= '"'.$user['salutation'].'",';
			$row .= '"'.$user['closing'].'",';
			$row .= '"'.$user['agentRespondCustomer'].'",';
			$row .= '"'.$user['agentFollowConcernChannel'].'",';
			$row .= '"'.$user['agentFollowUpCustomer'].'",';
			$row .= '"'.$user['agentProperlyReassign'].'",';
			$row .= '"'.$user['agentProperlyDocument'].'",';
			$row .= '"'.$user['agentAdequatelyResolved'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
			$row .= '"'.$user['client_rvw_date'].'",';
			$row .= '"'.$user['client_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}

	/////////////////////////////////////// Swiggy Report /////////////////////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////////////////////
	public function qa_swiggy_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_swiggy_report.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			
			$data["qa_swiggy_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (date(audit_date) >= '$date_from' and date(audit_date) <= '$date_to' ) ";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
		
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name from qa_swiggy_omt_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, get_process_names(id) as campaign, assigned_to from signin) yy on (xx.agent_id=yy.sid) Left join (Select fd_id, note as agent_note, date(entry_date) as agent_rvw_date from qa_swiggy_omt_agent_rvw) zz on (xx.id=zz.fd_id) Left Join (Select fd_id as mgnt_fd_id, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as mgnt_name, note as mgnt_note, date(entry_date) as mgnt_rvw_date from qa_swiggy_omt_mgnt_rvw) ww on (xx.id=ww.mgnt_fd_id) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_swiggy_list"] = $fullAray;
				$this->create_qa_swiggy_omt_CSV($fullAray);	
				$dn_link = base_url()."reports_qa/download_qa_swiggy_omt_CSV";
				
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_swiggy_omt_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Swiggy OMT Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_swiggy_omt_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Call Date", "Monitoring Type", "Order ID", "Call ID", "Call Duration", "Disposition", "Category", "Call Party", "Language", "Audit Type", "VOC", "Greeting", "Greeting Reason If Rated No/Fatal", "Greeting Reason", "Greeting - What went well?", "Greeting - What could have been better?", "Identification", "Identification Reason If Rated No/Fatal", "Identification Reason", "Identification - What went well?", "Identification - What could have been better?", "Call Intro", "Call Intro Reason If Rated No/Fatal", "Call Intro Reason", "Call Intro - What went well?", "Call Intro - What could have been better?", "Language Adher", "Language Adher Reason If Rated No/Fatal", "Language Adher Reason", "Language Adher - What went well?", "Language Adher - What could have been better?", "Confirm", "Confirm Reason If Rated No/Fatal", "Confirm Reason", "Confirm - What went well?", "Confirm - What could have been better?", "System Valid", "System Valid Reason If Rated No/Fatal", "System Valid Reason", "System Valid - What went well?", "System Valid - What could have been better?", "Probing", "Probing Reason If Rated No/Fatal", "Probing Reason", "Probing - What went well?", "Probing - What could have been better?", "Taking Owner", "Taking Owner Reason If Rated No/Fatal", "Taking Owner Reason", "Taking Owner - What went well?", "Taking Owner - What could have been better?", "Information Sharing", "Information Sharing Reason If Rated No/Fatal", "Information Sharing Reason", "Information Sharing - What went well?", "Information Sharing - What could have been better?", "Right Action", "Right Action Reason If Rated No/Fatal", "Right Action Reason", "Right Action - What went well?", "Right Action - What could have been better?", "Call Control", "Call Control Reason If Rated No/Fatal", "Call Control Reason", "Call Control - What went well?", "Call Control - What could have been better?", "Soft Skill", "Soft Skill Reason If Rated No/Fatal", "Soft Skill Reason", "Soft Skill - What went well?", "Soft Skill - What could have been better?", "Hold Procedure", "Hold Procedure Reason If Rated No/Fatal", "Hold Procedure Reason", "Hold Procedure - What went well?", "Hold Procedure - What could have been better?", "Language Switch", "Language Switch Reason If Rated No/Fatal", "Language Switch Reason", "Language Switch - What went well?", "Language Switch - What could have been better?", "Active Listening", "Active Listening Reason If Rated No/Fatal", "Active Listening Reason", "Active Listening - What went well?", "Active Listening - What could have been better?", "Right Fit", "Right Fit Reason If Rated No/Fatal", "Right Fit Reason", "Right Fit - What went well?", "Right Fit - What could have been better?", "Further Assist", "Further Assist Reason If Rated No/Fatal", "Further Assist Reason", "Further Assist - What went well?", "Further Assist - What could have been better?", "Call Close", "Call Close Reason If Rated No/Fatal", "Call Close Reason", "Call Close - What went well?", "Call Close - What could have been better?", "ZTP", "ZTP Reason If Rated No/Fatal", "ZTP Reason", "ZTP - What went well?", "ZTP - What could have been better?", "Overall Score", "Was the Agent able to resolve the breakage in order Life Cycle", "Order Fulfillment - ACPT", "Order Fulfillment - RCA", "Order Fulfillment -  Remarks", "Call Category", "High Background Noice evident in the call", "Opportunity for AHT Reduction", "AHT - ACPT", "AHT - Remarks", "Will this call lead to repeat?", "Repeat Call - ACPT", "Repeat Call - Remarks", "Was the call transferred to IVR?", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			if($user['greeting']==3) $greeting='Yes';
			else $greeting='No';
			if($user['identification']==3) $identification='Yes';
			else $identification='No';
			if($user['callintro']==3) $callintro='Yes';
			else $callintro='No';
			if($user['languageadher']==3) $languageadher='Yes';
			else $languageadher='No';
			if($user['confirm']==3) $confirm='Yes';
			else $confirm='No';
			if($user['systemvalid']==6) $systemvalid='Yes';
			else $systemvalid='No';
			if($user['probing']==6) $probing='Yes';
			else $probing='No';
			if($user['takingowner']==8) $takingowner='Yes';
			else if($user['takingowner']==0) $takingowner='No';
			else $takingowner='Fatal';
			if($user['infosharing']==23) $infosharing='Yes';
			else $infosharing='Fatal';
			if($user['rightaction']==12) $rightaction='Yes';
			else if($user['rightaction']==0) $rightaction='No';
			else $rightaction='Fatal';
			if($user['callcontrol']==4) $callcontrol='Yes';
			else $callcontrol='No';
			if($user['softskill']==4) $softskill='Yes';
			else $softskill='No';
			if($user['holdprocedure']==2) $holdprocedure='Yes';
			else $holdprocedure='No';
			if($user['languageswitch']==2) $languageswitch='Yes';
			else $languageswitch='No';
			if($user['activelisten']==4) $activelisten='Yes';
			else $activelisten='No';
			if($user['rightfit']==4) $rightfit='Yes';
			else if($user['rightfit']==0) $rightfit='No';
			else $rightfit='Fatal';
			if($user['furtherassist']==5) $furtherassist='Yes';
			else $furtherassist='No';
			if($user['callclose']==5) $callclose='Yes';
			else $callclose='No';
			
			
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",'; 
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['monitoring_type'].'",';
			$row .= '"'.$user['order_id'].'",';
			$row .= '"'.$user['call_id'].'",';
			$row .= '"'.$user['call_duration'].'",';
			$row .= '"'.$user['disposition'].'",';
			$row .= '"'.$user['category'].'",';
			$row .= '"'.$user['call_party'].'",';
			$row .= '"'.$user['language'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$greeting.'",';
			$row .= '"'.$user['greeting_reason'].'",';
			$row .= '"'.$user['greeting_reason2'].'",';
			$row .= '"'.$user['greeting_www'].'",';
			$row .= '"'.$user['greeting_wcb'].'",';
			$row .= '"'.$identification.'",';
			$row .= '"'.$user['identification_reason'].'",';
			$row .= '"'.$user['identification_reason2'].'",';
			$row .= '"'.$user['identification_www'].'",';
			$row .= '"'.$user['identification_wcb'].'",';
			$row .= '"'.$callintro.'",';
			$row .= '"'.$user['callintro_reason'].'",';
			$row .= '"'.$user['callintro_reason2'].'",';
			$row .= '"'.$user['callintro_www'].'",';
			$row .= '"'.$user['callintro_wcb'].'",';
			$row .= '"'.$languageadher.'",';
			$row .= '"'.$user['languageadher_reason'].'",';
			$row .= '"'.$user['languageadher_reason2'].'",';
			$row .= '"'.$user['languageadher_www'].'",';
			$row .= '"'.$user['languageadher_wcb'].'",';
			$row .= '"'.$confirm.'",';
			$row .= '"'.$user['confirm_reason'].'",';
			$row .= '"'.$user['confirm_reason2'].'",';
			$row .= '"'.$user['confirm_www'].'",';
			$row .= '"'.$user['confirm_wcb'].'",';
			$row .= '"'.$systemvalid.'",';
			$row .= '"'.$user['systemvalid_reason'].'",';
			$row .= '"'.$user['systemvalid_reason2'].'",';
			$row .= '"'.$user['systemvalid_www'].'",';
			$row .= '"'.$user['systemvalid_wcb'].'",';
			$row .= '"'.$probing.'",';
			$row .= '"'.$user['probing_reason'].'",';
			$row .= '"'.$user['probing_reason2'].'",';
			$row .= '"'.$user['probing_www'].'",';
			$row .= '"'.$user['probing_wcb'].'",';
			$row .= '"'.$takingowner.'",';
			$row .= '"'.$user['takingowner_reason'].'",';
			$row .= '"'.$user['takingowner_reason2'].'",';
			$row .= '"'.$user['takingowner_www'].'",';
			$row .= '"'.$user['takingowner_wcb'].'",';
			$row .= '"'.$infosharing.'",';
			$row .= '"'.$user['infosharing_reason'].'",';
			$row .= '"'.$user['infosharing_reason2'].'",';
			$row .= '"'.$user['infosharing_www'].'",';
			$row .= '"'.$user['infosharing_wcb'].'",';
			$row .= '"'.$rightaction.'",';
			$row .= '"'.$user['rightaction_reason'].'",';
			$row .= '"'.$user['rightaction_reason2'].'",';
			$row .= '"'.$user['rightaction_www'].'",';
			$row .= '"'.$user['rightaction_wcb'].'",';
			$row .= '"'.$callcontrol.'",';
			$row .= '"'.$user['callcontrol_reason'].'",';
			$row .= '"'.$user['callcontrol_reason2'].'",';
			$row .= '"'.$user['callcontrol_www'].'",';
			$row .= '"'.$user['callcontrol_wcb'].'",';
			$row .= '"'.$softskill.'",';
			$row .= '"'.$user['softskill_reason'].'",';
			$row .= '"'.$user['softskill_reason2'].'",';
			$row .= '"'.$user['softskill_www'].'",';
			$row .= '"'.$user['softskill_wcb'].'",';
			$row .= '"'.$holdprocedure.'",';
			$row .= '"'.$user['holdprocedure_reason'].'",';
			$row .= '"'.$user['holdprocedure_reason2'].'",';
			$row .= '"'.$user['holdprocedure_www'].'",';
			$row .= '"'.$user['holdprocedure_wcb'].'",';
			$row .= '"'.$languageswitch.'",';
			$row .= '"'.$user['languageswitch_reason'].'",';
			$row .= '"'.$user['languageswitch_reason2'].'",';
			$row .= '"'.$user['languageswitch_www'].'",';
			$row .= '"'.$user['languageswitch_wcb'].'",';
			$row .= '"'.$activelisten.'",';
			$row .= '"'.$user['activelisten_reason'].'",';
			$row .= '"'.$user['activelisten_reason2'].'",';
			$row .= '"'.$user['activelisten_www'].'",';
			$row .= '"'.$user['activelisten_wcb'].'",';
			$row .= '"'.$rightfit.'",';
			$row .= '"'.$user['rightfit_reason'].'",';
			$row .= '"'.$user['rightfit_reason2'].'",';
			$row .= '"'.$user['rightfit_www'].'",';
			$row .= '"'.$user['rightfit_wcb'].'",';
			$row .= '"'.$furtherassist.'",';
			$row .= '"'.$user['furtherassist_reason'].'",';
			$row .= '"'.$user['furtherassist_reason2'].'",';
			$row .= '"'.$user['furtherassist_www'].'",';
			$row .= '"'.$user['furtherassist_wcb'].'",';
			$row .= '"'.$callclose.'",';
			$row .= '"'.$user['callclose_reason'].'",';
			$row .= '"'.$user['callclose_reason2'].'",';
			$row .= '"'.$user['callclose_www'].'",';
			$row .= '"'.$user['callclose_wcb'].'",';
			$row .= '"'.$user['ztp'].'",';
			$row .= '"'.$user['ztp_reason'].'",';
			$row .= '"'.$user['ztp_reason2'].'",';
			$row .= '"'.$user['ztp_www'].'",';
			$row .= '"'.$user['ztp_wcb'].'",';
			$row .= '"'.$user['overall_score'].'%'.'",'; 
			$row .= '"'.$user['was_agent_resolve'].'",';
			$row .= '"'.$user['order_acpt'].'",';
			$row .= '"'.$user['order_rca'].'",';
			$row .= '"'.$user['order_remarks'].'",';
			$row .= '"'.$user['call_category'].'",';
			$row .= '"'.$user['high_background'].'",';
			$row .= '"'.$user['aht_reduction'].'",';
			$row .= '"'.$user['aht_acpt'].'",';
			$row .= '"'.$user['aht_remarks'].'",';
			$row .= '"'.$user['will_call_lead'].'",';
			$row .= '"'.$user['repeat_call_acpt'].'",';
			$row .= '"'.$user['repeat_call_remarks'].'",';
			$row .= '"'.$user['ivr_call_transfer'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';				
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}


///////////////////////////////////////////////////////////////////////////////////// 
/////////////////////////////// QA Super Daily REPORT ////////////////////////////////	
/////////////////////////////////////////////////////////////////////////////////////

	public function qa_superdaily_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_superdaily_report.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$audit_type="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			
			$data["qa_superdaily_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				$audit_type = $this->input->get('audit_type');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if($audit_type=="All") $cond .= "";
				else $cond .=" and audit_type='$audit_type'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else if(get_login_type()=="client"){
					$cond1 .=" And audit_type not in ('Operation Audit','Trainer Audit')";
				}else{
					$cond1 .="";
				}

				//$table=($this->input->get('department_id')=='sd_audit')?"qa_superdaily_feedback":"qa_superdaily_call_feedback";
				if($this->input->get('department_id')=='sd_audit'){
					$table='qa_superdaily_feedback';
				}else if($this->input->get('department_id')=='sd_call_audit'){
					$table='qa_superdaily_call_new_feedback';
				}else if($this->input->get('department_id')=='sd_new_audit'){
					$table='qa_superdaily_new_feedback';
				}else if($this->input->get('department_id')=='spdl_imgval'){
					$table='qa_superdaily_image_validate_new';
				}else if($this->input->get('department_id')=='spdl_imgval_old'){
					$table='qa_superdaily_image_validate';
				}else if($this->input->get('department_id')=='spdl_reso'){
					$table='qa_superdaily_complaint_resolution';
				}

				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from $table) xx Left Join
				(Select id as sid, fname, lname, fusion_id, assigned_to, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_superdaily_list"] = $fullAray;
				$data['dep_id']=$this->input->get('department_id');
				
				if($this->input->get('department_id')=='sd_audit'){
					$this->create_qa_superdaily_CSV($fullAray);	
				}else if($this->input->get('department_id')=='sd_call_audit'){
					$this->create_qa_superdaily_call_CSV($fullAray);	
				}else if($this->input->get('department_id')=='sd_new_audit'){
					$this->create_qa_superdaily_new_CSV($fullAray);	
				}else if($this->input->get('department_id')=='spdl_imgval'){
					$this->create_qa_superdaily_imgval_new_CSV($fullAray);	
				}else if($this->input->get('department_id')=='spdl_imgval_old'){
					$this->create_qa_superdaily_imgval_CSV($fullAray);	
				}else if($this->input->get('department_id')=='spdl_reso'){
					$this->create_qa_superdaily_reso_CSV($fullAray);	
				}

				$dn_link = base_url()."reports_qa/download_qa_superdaily_CSV";


			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['audit_type']=$audit_type;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_superdaily_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Super Daily Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_superdaily_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");

		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Chat Date", "Contact No", "Customer ID", "Chat Weblink", "Chat Type", "Chat Disposition", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Communication", "Resolution", "Chat Opening", "Chat Opening Comment", "Chat Closure", "Chat Closure Comment", "Acknowledgement Comprehension", "Acknowledgement Comprehension Comment", "Rapport buliding and Empathy", "Rapport buliding and Empathy Comment", "Probing", "Probing Comment", "Grammar and Choice of Words", "Grammar and Choice of Words Comment", "Problem Solving Abilities", "Problem Solving Abilities Comment", "Providing complete and accurate information", "Providing complete and accurate information Comment", "Ownership", "Ownership Comment", "Incorrect Labelling", "Incorrect Labelling Comment", "Raised relevant complaint", "Raised relevant complaint Comment", "ZTP", "ZTP Comment", "Callback Offered/Required", "Callback Offered/Required Comment", "Retool Accuracy", "Retool Accuracy Comment", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			if($user['entry_by']!=''){
				$auditorName = $user['auditor_name'];
			}else{
				$auditorName = $user['client_name'];
			}
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
		
			$row = '"'.$auditorName.'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['chat_date'].'",';
			$row .= '"'.$user['contact_no'].'",';
			$row .= '"'.$user['customer_id'].'",';
			$row .= '"'.$user['chat_weblink'].'",';
			$row .= '"'.$user['chat_type'].'",';
			$row .= '"'.$user['chat_dispo'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'.$user['communication_score'].'%'.'",';
			$row .= '"'.$user['resolution_score'].'%'.'",';
			$row .= '"'.$user['communicationchatopening'].'",';
			$row .= '"'.$user['comm1'].'",';
			$row .= '"'.$user['communicationchatclose'].'",';
			$row .= '"'.$user['comm2'].'",';
			$row .= '"'.$user['communicationcomprehension'].'",';
			$row .= '"'.$user['comm3'].'",';
			$row .= '"'.$user['communicationrapportbuild'].'",';
			$row .= '"'.$user['comm4'].'",';
			$row .= '"'.$user['communicationprobing'].'",';
			$row .= '"'.$user['comm5'].'",';
			$row .= '"'.$user['communicationgrammer'].'",';
			$row .= '"'.$user['comm6'].'",';
			$row .= '"'.$user['resolutionproblemsolving'].'",';
			$row .= '"'.$user['reso1'].'",';
			$row .= '"'.$user['resolutioncustomerinformation'].'",';
			$row .= '"'.$user['reso2'].'",';
			$row .= '"'.$user['resolutionowenership'].'",';
			$row .= '"'.$user['reso3'].'",';
			$row .= '"'.$user['resolutionincorrectlebel'].'",';
			$row .= '"'.$user['reso4'].'",';
			$row .= '"'.$user['resolutionraisedtool'].'",';
			$row .= '"'.$user['reso5'].'",';
			$row .= '"'.$user['resolutionztp'].'",';
			$row .= '"'.$user['reso6'].'",';
			$row .= '"'.$user['resolutioncallbackoffer'].'",';
			$row .= '"'.$user['reso7'].'",';
			$row .= '"'.$user['resolutionretoolaccuracy'].'",';
			$row .= '"'.$user['reso8'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
			$row .= '"'.$user['client_rvw_date'].'",';
			$row .= '"'.$user['client_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}

	public function create_qa_superdaily_call_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");

		$header = array("Evaluator Name", "Audit Date", "Fusion ID", "Agent", "TL/AM Name", "Call Date/Time","Customer No", "Channel", "Call Type", "Chat Link", "Actual Disposition", "Week", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Understood Customer Problem", "Took necessary action to solve problem", "Customer understood what is being done", "Was helpful to customer", "1.1 Interruption", "1.1 Comment", "1.2 Listening Comprehension", "1.2 Comment", "1.3 Made the customer repeat unnecessarily", "1.3 Comment", "1.4 Asked necessary questions", "1.4 Comment", "1.5 Acknowledge where necessary", "1.5 Comment", "2.1 Complaint created or Updated", "2.1 Comment", "2.2 Complaint creation post call or chat", "2.2 Comment", "2.3 Escalation", "2.3 Comment", "2.4 Entry into any sheets", "2.4 Comment", "2.5 Follow-up", "2.5 Comment", "2.6 Hold used", "2.6 Comment", "2.7 Correct or complete information given", "2.7 Comment", "2.8 Hold time in secs", "2.8 Comment", "2.9 Dead air in sec", "2.9 Comment", "2.10 Possibility Customer calling back", "2.10 Comment", "3.1 Explained what is the current situation", "3.1 Comment", "3.2 Informed customer what we have now done", "3.2 Comment", "3.3 Follow-up done", "3.3 Comment", "3.4 Spoke or chatted to the Customer", "3.4 Comment", "3.5 Asked permission for hold", "3.5 Comment", "4.1 Answered any other questions patiently", "4.1 Comment", "4.2 Asked for further assistance if relevant", "4.2 Comment", "4.3 Eager to wrap up call or chat", "4.3 Comment", "4.4 Polite", "4.4 Comment", "4.5 Empathetic", "4.5 Comment", "4.6 Tone", "4.6 Comment", "*** 5.1 Rude", "5.1 Comment", "*** 5.2 Sarcastic", "5.1 Comment", "*** 5.3 Deliberate Disconnect", "5.3 Comment", "*** 6.1 Abusive", "6.1 Comment", "*** 6.2 Inappropriate language", "6.2 Comment", "Agent did not action as required", "Comment", "Product Quality damage expired quantity mismatch", "Comment", "SOP followed - to be explained in brief", "Comment", "Customer Expecting more than what can be done", "Comment", "Technology App issues like app does not load", "Comment", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			if($user['entry_by']!=''){
				$auditorName = $user['auditor_name'];
			}else{
				$auditorName = $user['client_name'];
			}
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$auditorName.'",'; 
			$row .= '"'.$user['audit_date'].'",';  
			$row .= '"'.$user['fusion_id'].'",';  
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['contact_no'].'",';
			$row .= '"'.$user['channel'].'",';
			$row .= '"'.$user['call_type'].'",';
			$row .= '"'.$user['customer_id'].'",';
			$row .= '"'.$user['actual_dispo'].'",';
			$row .= '"'.$user['week'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'.$user['ucp_score'].'%'.'",';
			$row .= '"'.$user['tna_score'].'%'.'",';
			$row .= '"'.$user['cu_score'].'%'.'",';
			$row .= '"'.$user['hc_score'].'%'.'",';
			$row .= '"'.$user['interruption'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
			$row .= '"'.$user['listening_comprehension'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
			$row .= '"'.$user['repeat_customer_unnecessary'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
			$row .= '"'.$user['asked_necessary_question'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
			$row .= '"'.$user['necessary_acknowledge'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
			$row .= '"'.$user['complaint_created'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
			$row .= '"'.$user['complaint_post_call'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
			$row .= '"'.$user['escalation'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
			$row .= '"'.$user['entry_into_sheet'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
			$row .= '"'.$user['follow_up'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
			$row .= '"'.$user['hold_used'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
			$row .= '"'.$user['complete_information'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
			$row .= '"'.$user['hold_time_in_sec'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
			$row .= '"'.$user['dead_air'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
			$row .= '"'.$user['customer_calling_back'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
			$row .= '"'.$user['explain_current_situation'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt16'])).'",';
			$row .= '"'.$user['informed_customer'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt17'])).'",';
			$row .= '"'.$user['follow_up_done'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt18'])).'",';
			$row .= '"'.$user['spoke_chatted'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt19'])).'",';
			$row .= '"'.$user['ask_hold_permission'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt20'])).'",';
			$row .= '"'.$user['answer_any_question'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt21'])).'",';
			$row .= '"'.$user['ask_further_assistance'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt22'])).'",';
			$row .= '"'.$user['wrap_up_call'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt23'])).'",';
			$row .= '"'.$user['polite'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt24'])).'",';
			$row .= '"'.$user['emphathetic'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt25'])).'",';
			$row .= '"'.$user['tone'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt26'])).'",';
			$row .= '"'.$user['rude'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt27'])).'",';
			$row .= '"'.$user['sarcastic'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt28'])).'",';
			$row .= '"'.$user['deliberate_disconnect'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt29'])).'",';
			$row .= '"'.$user['abusive'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt30'])).'",';
			$row .= '"'.$user['inappropiate_language'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt31'])).'",';
			$row .= '"'.$user['agent_not_action'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt32'])).'",';
			$row .= '"'.$user['product_damage'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt33'])).'",';
			$row .= '"'.$user['policy_process'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt34'])).'",';
			$row .= '"'.$user['customer_fraud'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt35'])).'",';
			$row .= '"'.$user['not_recieve_OTP'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt36'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
			$row .= '"'.$user['client_rvw_date'].'",';
			$row .= '"'.$user['client_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
			// echo $row;
			// die;
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}
	
///////////////// Superdaily New (main QA sheet)//////////////////////
	public function create_qa_superdaily_new_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");

		$header = array("Evaluator Name", "Audit Date", "Fusion ID", "Agent", "TL/AM Name", "Call Date/Time", "Customer No", "Chat Link", "Audit Category", "Disposition", "Actual Disposition", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Understood Customers Problem", "Took necessary action to solve problem", "Customer understood what is being done", "Was helpful to customer", "Overall Score", "1.1 Interruption", "1.1 Comment", "1.2 Listening Comprehension", "1.2 Comment", "1.3 Made the customer repeat unnecessarily", "1.3 Comment", "1.4 Asked necessary questions", "1.4 Comment", "1.5 Acknowledge where necessary", "1.5 Comment", "1.6 Personalization", "1.6 Comment", "2.1 Complaint created or Updated", "2.1 Comment", "2.2 Retool comments (customer VOC)", "2.2 Comment", "2.3 Escalation", "2.3 Comment", "2.4 Entry into any sheets", "2.4 Comment", "2.5 Follow-up", "2.5 Comment", "2.6 Hold used", "2.6 Comment", "2.7 Correct or complete information given", "2.7 Comment", "2.8 Hold time in secs", "2.8 Comment", "2.9 Dead air in sec", "2.9 Comment", "2.10 Possibility Customer calling back", "2.10 Comment", "3.1 Explained what is the current situation", "3.1 Comment", "3.2 Informed customer what we have now done", "3.2 Comment", "3.3 Follow-up done", "3.3 Comment", "3.4 Spoke or chatted to the Customer", "3.4 Comment", "3.5 Asked permission for hold", "3.5 Comment", "4.1 Answered any other questions patiently", "4.1 Comment", "4.2 Asked for further assistance if relevant", "4.2 Comment", "4.3 Eager to wrap up call or chat", "4.3 Comment", "4.4 Polite", "4.4 Comment", "4.5 Empathetic", "4.5 Comment", "4.6 Tone", "4.6 Comment", "*** 5.1 Fatal", "5.1 Comment", "*** 5.2 ZTP", "5.2 Comment", "ACPT", "WHY1", "WHY2", "Classify the Audit", "Call Summary", "Feedback", "Agent_Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			if($user['entry_by']!=''){
				$auditorName = $user['auditor_name'];
			}else{
				$auditorName = $user['client_name'];
			}
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$auditorName.'",'; 
			$row .= '"'.$user['audit_date'].'",';  
			$row .= '"'.$user['fusion_id'].'",';  
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['contact_no'].'",';
			$row .= '"'.$user['chat_link'].'",';
			$row .= '"'.$user['audit_category'].'",';
			$row .= '"'.$user['disposition'].'",';
			$row .= '"'.$user['actual_dispo'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['ucp_score'].'%'.'",';
			$row .= '"'.$user['tna_score'].'%'.'",';
			$row .= '"'.$user['cu_score'].'%'.'",';
			$row .= '"'.$user['hc_score'].'%'.'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'.$user['interruption'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
			$row .= '"'.$user['listening_comprehension'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
			$row .= '"'.$user['repeat_customer_unnecessary'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
			$row .= '"'.$user['asked_necessary_question'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
			$row .= '"'.$user['necessary_acknowledge'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
			$row .= '"'.$user['personalization'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
			$row .= '"'.$user['complaint_created'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
			$row .= '"'.$user['retool_comment'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
			$row .= '"'.$user['escalation'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
			$row .= '"'.$user['entry_into_sheet'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
			$row .= '"'.$user['follow_up'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
			$row .= '"'.$user['hold_used'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
			$row .= '"'.$user['complete_information'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
			$row .= '"'.$user['hold_time_in_sec'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
			$row .= '"'.$user['dead_air'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
			$row .= '"'.$user['customer_calling_back'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt16'])).'",';
			$row .= '"'.$user['explain_current_situation'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt17'])).'",';
			$row .= '"'.$user['informed_customer'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt18'])).'",';
			$row .= '"'.$user['follow_up_done'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt19'])).'",';
			$row .= '"'.$user['spoke_chatted'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt20'])).'",';
			$row .= '"'.$user['ask_hold_permission'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt21'])).'",';
			$row .= '"'.$user['answer_any_question'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt22'])).'",';
			$row .= '"'.$user['ask_further_assistance'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt23'])).'",';
			$row .= '"'.$user['wrap_up_call'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt24'])).'",';
			$row .= '"'.$user['polite'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt25'])).'",';
			$row .= '"'.$user['emphathetic'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt26'])).'",';
			$row .= '"'.$user['tone'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt27'])).'",';
			$row .= '"'.$user['Fatal'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt28'])).'",';
			$row .= '"'.$user['ZTP'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt29'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['acpt'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['why1'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['why2'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['classify_audit'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agnt_fd_acpt'].'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
			$row .= '"'.$user['client_rvw_date'].'",';
			$row .= '"'.$user['client_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
			// echo $row;
			// die;
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}
	
///////////////// Superdaily Image Validation //////////////////////
	public function create_qa_superdaily_imgval_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");

		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "TL/AM Name", "Call Date/Time", "Contact No", "Chat Link", "Audit Category", "Disposition", "Actual Disposition", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Understood Customers Problem", "Took necessary action to solve problem", "Understood what is being done", "Overall Score", "1.1 Was agent able to identify the validity of image properly?", "1.2 If NO what should be the actual status of image?", "2.1 Was call Required in this case?", "2.2 Was call attempt made?", "2.3 POD Check done", "2.4 Have we refunded/credit amount given for the exact quantity", "3.1 Are retool comments clear", "**4.1 Fatal", "**4.2 ZTP", "1.1 Reason", "1.2 Reason", "2.1 Reason", "2.2 Reason", "2.3 Reason", "2.4 Reason", "3.1 Reason", "4.1 Reason", "4.2 Reason", "Call Summary", "Feedback", "Agent_Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			if($user['entry_by']!=''){
				$auditorName = $user['auditor_name'];
			}else{
				$auditorName = $user['client_name'];
			}
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$auditorName.'",'; 
			$row .= '"'.$user['audit_date'].'",';  
			$row .= '"'.$user['fusion_id'].'",';  
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['contact_no'].'",';
			$row .= '"'.$user['chat_link'].'",';
			$row .= '"'.$user['audit_category'].'",';
			$row .= '"'.$user['disposition'].'",';
			$row .= '"'.$user['actual_dispo'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['ucp_score'].'%'.'",';
			$row .= '"'.$user['tna_score'].'%'.'",';
			$row .= '"'.$user['uwbd_score'].'%'.'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'.$user['identify_image_validity'].'",';
			$row .= '"'.$user['actual_image_status'].'",';
			$row .= '"'.$user['was_call_required'].'",';
			$row .= '"'.$user['was_call_attempt'].'",';
			$row .= '"'.$user['POD_check_done'].'",';
			$row .= '"'.$user['credit_amount_given'].'",';
			$row .= '"'.$user['retool_comment_clear'].'",';
			$row .= '"'.$user['fatal'].'",';
			$row .= '"'.$user['ztp'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agnt_fd_acpt'].'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
			$row .= '"'.$user['client_rvw_date'].'",';
			$row .= '"'.$user['client_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}
	
///////////////// Superdaily Image Validation (NEW) //////////////////////
	public function create_qa_superdaily_imgval_new_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");

		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "TL/AM Name", "Call Date/Time", "Customer No", "Complaint ID", "Audit Category", "RCA", "Accurate RCA", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Understood customers problem", "Took necessary action to solve problem", "Customer understood what is being done", "Agent validated the image properly", "1.1 Reason", "Correct complaint status updated by the agent", "2.1 Reason", "Valid call attempts", "2.2 Reason", "Proof of delivery check done for QED and WOD", "2.3 Reason", "Refunded as per the SOP/exact amount", "2.4 Reason", "Guided the customer properly for the invalid and rejected complaints", "3.1 Reason", "If the call went unanswered notification sent to the customer", "3.2 Reason", "Accurate retool comments", "3.3 Reason", "Fatal", "4.1 Reason", "ZTP", "4.2 Reason", "ACPT", "WHY1", "WHY2", "Classify Audit", "Call Summary", "Feedback", "Agent_Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			if($user['entry_by']!=''){
				$auditorName = $user['auditor_name'];
			}else{
				$auditorName = $user['client_name'];
			}
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$auditorName.'",'; 
			$row .= '"'.$user['audit_date'].'",';  
			$row .= '"'.$user['fusion_id'].'",';  
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['contact_no'].'",';
			$row .= '"'.$user['complaint_id'].'",';
			$row .= '"'.$user['audit_category'].'",';
			$row .= '"'.$user['rca'].'",';
			$row .= '"'.$user['accurate_rca'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'.$user['ucp_score'].'%'.'",';
			$row .= '"'.$user['tna_score'].'%'.'",';
			$row .= '"'.$user['uwbd_score'].'%'.'",';
			$row .= '"'.$user['agent_validate_image'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
			$row .= '"'.$user['correct_complaint_status'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
			$row .= '"'.$user['valid_call_attempt'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
			$row .= '"'.$user['delivary_check_proof'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
			$row .= '"'.$user['refunded_SOP'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
			$row .= '"'.$user['customer_guided_properly'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
			$row .= '"'.$user['call_notification_sent'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
			$row .= '"'.$user['acurate_retool_comment'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
			$row .= '"'.$user['fatal'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
			$row .= '"'.$user['ztp'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
			$row .= '"'.$user['acpt'].'",';
			$row .= '"'.$user['why1'].'",';
			$row .= '"'.$user['why2'].'",';
			$row .= '"'.$user['classify_audit'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agnt_fd_acpt'].'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
			$row .= '"'.$user['client_rvw_date'].'",';
			$row .= '"'.$user['client_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}
	
///////////////// Superdaily Complaint Resolution //////////////////////
	public function create_qa_superdaily_reso_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");

		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "TL/AM Name", "Call Date/Time", "Customer No", "Complaint ID", "Audit Category", "RCA", "Accurate RCA", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Understood Customers Problem", "Took necessary action to solve problem", "Customer understood what is being done", "Was helpful to customer", "1.1 Interruption", "1.1 Reason", "1.2 Listening Comprehension", "1.2 Comment", "1.3 Asked necessary questions", "1.3 Reason", "1.4 Acknowledge where necessary", "1.4 Reason", "1.5 Personalization", "1.5 Reason", "2.1 Complaint created/Updated", "2.1 Reason", "2.2 Retool comments", "2.2 Reason", "2.3 Correct RCA updated", "2.3 Reason", "2.4 Correct Proof of delivery feedback", "2.4 Reason", "2.5 DE call attempt", "2.5 Reason", "2.6 Customer call attempt", "2.6 Reason", "2.7 Correct/complete information given", "2.7 Reason", "2.8 Correct Refund Processed", "2.8 Reason", "2.9 Possibility Customer calling back", "2.9 Reason", "3.1 Explained what is the current situation", "3.1 Reason", "3.2 Informed customer what we have now done", "3.2 Reason", "3.3 Spoke/chatted in a way that is understandable to the custome", "3.3 Reason", "3.4 Asked permission for hold/mute etc", "3.4 Reason", "4.1 Answered any other questions patiently", "4.1 Reason", "4.2 Asked for further assistance if relevant", "4.2 Reason", "4.3 Eager to wrap up call/chat", "4.3 Reason", "4.4 Polite", "4.4 Reason", "4.5 Empathetic", "4.5 Reason", "4.6 Tone", "4.6 Reason", "5.1 FATAL", "5.1 Reason", "5.2 ZTP", "5.2 Reason", "ACPT", "WHY1", "WHY2", "Classify Audit", "Call Summary", "Feedback", "Agent_Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			if($user['entry_by']!=''){
				$auditorName = $user['auditor_name'];
			}else{
				$auditorName = $user['client_name'];
			}
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$auditorName.'",'; 
			$row .= '"'.$user['audit_date'].'",';  
			$row .= '"'.$user['fusion_id'].'",';  
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['contact_no'].'",';
			$row .= '"'.$user['complaint_id'].'",';
			$row .= '"'.$user['audit_category'].'",';
			$row .= '"'.$user['rca'].'",';
			$row .= '"'.$user['accurate_rca'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'.$user['ucp_score'].'%'.'",';
			$row .= '"'.$user['tna_score'].'%'.'",';
			$row .= '"'.$user['cu_score'].'%'.'",';
			$row .= '"'.$user['hc_score'].'%'.'",';
			$row .= '"'.$user['interruption'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
			$row .= '"'.$user['listening_comprehension'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
			$row .= '"'.$user['asked_necessary_question'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
			$row .= '"'.$user['necessary_acknowledge'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
			$row .= '"'.$user['personalization'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
			$row .= '"'.$user['complaint_created'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
			$row .= '"'.$user['retool_comment'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
			$row .= '"'.$user['correct_RCA_update'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
			$row .= '"'.$user['proof_of_delivery'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
			$row .= '"'.$user['DE_call_attempt'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
			$row .= '"'.$user['customer_call_attempt'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
			$row .= '"'.$user['correct_information'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
			$row .= '"'.$user['correct_refund'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
			$row .= '"'.$user['cutomer_call_back'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
			$row .= '"'.$user['current_situation_explain'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
			$row .= '"'.$user['inform_customer_what_we_done'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt16'])).'",';
			$row .= '"'.$user['spoke_chatted'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt17'])).'",';
			$row .= '"'.$user['ask_hold_permission'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt18'])).'",';
			$row .= '"'.$user['answer_any_question'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt19'])).'",';
			$row .= '"'.$user['ask_further_assistance'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt20'])).'",';
			$row .= '"'.$user['wrap_up_call'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt21'])).'",';
			$row .= '"'.$user['polite'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt22'])).'",';
			$row .= '"'.$user['emphathetic'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt23'])).'",';
			$row .= '"'.$user['tone'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt24'])).'",';
			$row .= '"'.$user['Fatal'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt25'])).'",';
			$row .= '"'.$user['ZTP'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt26'])).'",';
			$row .= '"'.$user['acpt'].'",';
			$row .= '"'.$user['why1'].'",';
			$row .= '"'.$user['why2'].'",';
			$row .= '"'.$user['classify_audit'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agnt_fd_acpt'].'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
			$row .= '"'.$user['client_rvw_date'].'",';
			$row .= '"'.$user['client_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}

///////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////// Outsource Order ////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////

	public function qa_outsource_order_report(){

		if(check_logged_in()){
			
			$office_id = "";
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["download_link1"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_outsource_order_report.php";
			$data["content_js"] = "qa_outsource_order_js.php";
						
			$date_from="";
			$date_to="";
			$office_id="";
			$action="";
			$dn_link="";
			$dn_link1="";
			$cond1='';
			
			$data["qa_outsource_order_list"] = array();
			
			// if(get_role_dir()=="super" || $is_global_access==1){
				$data['location_list'] = $this->Common_model->get_office_location_list();
			// }else{
			// 	$data['location_list'] = $this->Common_model->get_office_location_session_all($current_user);
			// }
			
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond1= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
				if($office_id != "") $cond1 .= " and office_id='$office_id'";
				
					$qSql="SELECT * from (Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, (select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name from qa_outsource_order_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, get_process_names(id) as campaign, DATEDIFF(CURDATE(), doj) as tenure, assigned_to from signin) yy on (xx.agent_id=yy.sid) $cond1 order by audit_date";
					$fullAray = $this->Common_model->get_query_result_array($qSql);
					$data["qa_outsource_order_list"] = $fullAray;
					$this->create_qa_outsource_order_new_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_outsource_order_new_CSV";
			}
			
			$data['download_link']=$dn_link;
			$data['download_link1']=$dn_link1;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id'] = $office_id;	
			
			$this->load->view('dashboard',$data);
		}
	}	
	 
		
///////////////////// MSB NEW ///////////////////////
	public function download_qa_outsource_order_new_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Outsource Order New Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	

	public function headerDetails1(){
		return $arrayName = array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Phone","Call Date","Call Id","Record ID","ANI Number","Customer Name","Audit Type","Auditor Type","VOC","Call Type","Overall Score","Greeting Statement","Item Description","Item Reservation Pricing and Payment Terms","Pop-Up and Promos","Additional Items","Closing Statement","Phone Number","Name","Address","E-Mail","Credit Card","Customer Rapport","Professional Telephone Etiquette","Pronunciation & Grammar","Call Control","Order Summary","One Call Resolution","Comments 1","Comments 2","Comments 3","Comments 4","Call Summary","Feedback","Entry By","Entry Date","Client entry by","Mgnt review by","Mgnt review note","Mgnt review date","Agent review note","Agent review date","Client review by","Client review note","Client_rvw_date");
	}

	public function create_qa_outsource_order_new_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");		
		$header=$this->headerDetails1();
		$field_name="SHOW FULL COLUMNS FROM qa_outsource_order_feedback WHERE Comment!=''";
		$field_name=$this->Common_model->get_query_result_array($field_name);
		$fld_cnt=count($field_name);
		for($i=0;$i<$fld_cnt;$i++){
						$val=$field_name[$i]['Field'];
						if($val!=""){
							$field_val[]=$val;
						}		
					 }
		
		array_unshift($field_val ,"auditor_name");
		$key = array_search ('agent_id', $field_val);
		array_splice($field_val, $key, 0, 'fusion_id');
		$field_val=array_values($field_val);

		$count_for_field=count($field_val);

		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		$row = "";
		// print_r($rr);
		// die;
		foreach($rr as $user)
		{	
			for($z=0;$z<$count_for_field;$z++){
				
				if($field_val[$z]==="auditor_name"){
					$row = '"'.$user['auditor_name'].'",';
				}elseif($field_val[$z]==="fusion_id"){
					$row .= '"'.$user['fusion_id'].'",';
				}elseif($field_val[$z]==="agent_id"){
					$row .= '"'.$user['fname']." ".$user['lname'].'",';
				}elseif($field_val[$z]==="tl_id"){
					$row .= '"'.$user['tl_name'].'",';	
				}elseif(in_array($field_val[$z], array('call_summary','feedback','agent_rvw_note','mgnt_rvw_note'))) {
    			
    			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user[$field_val[$z]])).'",';

				}else{
					$row .= '"'.$user[$field_val[$z]].'",';	
				}
				
			}
				
				fwrite($fopen,$row."\r\n");
				$row = "";
		}
		
		fclose($fopen);
	}


		public function qaod_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qaod_report.php";
			$data["content_js"] = "qa_od_js.php";
			
			$data["get_agent_id_list"] = $this->Qa_od_model->get_agent_id(42);
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$agent_id="";
			$audit_type="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			$date_from=$this->input->get('date_from');
			$date_to=$this->input->get('date_to');
			
			if($date_from==""){ 
				$date_from=CurrDate();
			}else{
				$date_from = mmddyy2mysql($date_from);
			}
			
			if($date_to==""){ 
				$date_to=CurrDate();
			}else{
				$date_to = mmddyy2mysql($date_to);
			}
			
			$data["qa_od_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = $date_from;
				$date_to = $date_to;
				$office_id = $this->input->get('office_id');
				$agent_id = $this->input->get('agent_id');
				$audit_type = $this->input->get('audit_type');
				
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
				if($agent_id!="") $cond .=" and agent_id='$agent_id'";
				if($audit_type!="")	$cond .=" and audit_type='$audit_type'";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
		
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, (select concat(fname, ' ', lname) as name from signin s where s.id=(select assigned_to from signin where id=agent_id)) as tl_name from qa_od_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, get_process_names(id) as campaign, DATEDIFF(CURDATE(), doj) as tenure, batch_code, assigned_to from signin) yy on (xx.agent_id=yy.sid) Left join (Select fd_id, note as agent_note,agent_fd_acpt, date(entry_date) as agent_rvw_date from qa_od_agent_review) zz on (xx.id=zz.fd_id) Left Join (Select fd_id as mgnt_fd_id, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as mgnt_name, note as mgnt_note, date(entry_date) as mgnt_rvw_date from qa_od_mgnt_review) ww on (xx.id=ww.mgnt_fd_id) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_od_list"] = $fullAray;
				$this->create_qaod_CSV($fullAray);	
				$dn_link = base_url()."reports_qa/download_qaod_CSV";
				
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['agent_id']=$agent_id;
			$data['audit_type']=$audit_type;
			
			$this->load->view('dashboard',$data);
		}
	}
	
	public function download_qaod_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Office Depot Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qaod_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "WAVE", "Session ID/ANI", "Chat Date", "Customer ID", "Audit Type", "VOC", "Call Pass/Fail", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Earned Score", "Possible Score", "Acknowledged the chat customer", "Made the customer feel important", "Appropriate and sincere use of empathy", "Customer clearly understood the CSR", "The CCP must ASK FOR THE SALE", "Read acknowledged and understood the customer", "Used proper guidelines followed account level", "Noted appropriately", "Agent maintained control of the chat", "Verified information as appropriate to the chat", "Was the offer micro-conversion accepted", "Was the proper disposition code used on the chat", "Call Summary", "Feedback","Agent Review Status","Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
		
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['tl_name'].'",'; 
			$row .= '"'.$user['batch_code'].'",'; 
			$row .= '"'.$user['ani'].'",'; 
			$row .= '"'.$user['chat_date'].'",'; 
			$row .= '"'.$user['customer_id'].'",'; 
			$row .= '"'.$user['audit_type'].'",'; 
			$row .= '"'.$user['voc'].'",'; 
			$row .= '"'.$user['call_pass_fail'].'",'; 
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['overall_score'].'%'.'",'; 
			$row .= '"'.$user['score'].'",';
			$row .= '"'.$user['possible_score'].'",'; 
			$row .= '"'.$user['ack_chat_cust'].'",'; 
			$row .= '"'.$user['made_cust_feel_imp'].'",'; 
			$row .= '"'.$user['appro_sin_empathy'].'",'; 
			$row .= '"'.$user['cust_clr_understood_crs'].'",'; 
			$row .= '"'.$user['ccp_ask_sale'].'",'; 
			$row .= '"'.$user['read_ack_understood_cust'].'",'; 
			$row .= '"'.$user['used_proper_guidelines'].'",'; 
			$row .= '"'.$user['noted_appropriately'].'",'; 
			$row .= '"'.$user['agent_maintained_control_chat'].'",'; 
			$row .= '"'.$user['verified_info_appropriate_chat'].'",'; 
			$row .= '"'.$user['was_the_offer'].'",'; 
			$row .= '"'.$user['was_the_proper_dispo'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_fd_acpt'].'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';				
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}


/////////////////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////// QA NOVASOM REPORT /////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////

	public function qa_novasom_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_novasom_report.php";
			
			$office_id = $this->input->get('office_id');
			if($office_id=="")  $office_id=$user_office_id;
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$campaign="";
			$audit_type="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			$campaign=$this->input->get('campaign');
			
			$data["qa_novasom_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$audit_type = $this->input->get('audit_type');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
				
				if($audit_type=="All") $cond .= "";
				else $cond .=" and audit_type='$audit_type'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else if(get_login_type()=="client"){
					$cond1 .=" And audit_type not in ('Operation Audit','Trainer Audit')";	
				}else{
					$cond1 .="";
				}
				
				if($campaign=='bioserenity'){
				$qSql = "SELECT * from
					(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
					(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
					(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
					(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name
					from qa_bioserenity_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, get_process_names(id) as campaign, DATEDIFF(CURDATE(), doj) as tenure, assigned_to from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				}else if($campaign=='novasom'){
					$qSql="SELECT * from
					(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, DATE_FORMAT(entry_date,'%m-%Y') AS m_Y from qa_novasom_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, assigned_to from signin) yy on (xx.agent_id=yy.sid) Left join (Select fd_id, note as agent_note, date(entry_date) as agent_rvw_date from qa_novasom_agent_rvw) zz on (xx.id=zz.fd_id) Left Join (Select fd_id as mgnt_fd_id, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as mgnt_name, note as mgnt_note, date(entry_date) as mgnt_rvw_date from qa_novasom_mgnt_rvw) ww on (xx.id=ww.mgnt_fd_id) $cond $cond1 order by audit_date";
				}
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_novasom_list"] = $fullAray;
				$this->create_qa_novasom_CSV($fullAray,$campaign);	
				$dn_link = base_url()."reports_qa/download_qa_novasom_CSV/".$campaign;			
				
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['campaign']=$campaign;
			$data['audit_type']=$audit_type;
			
			$this->load->view('dashboard',$data);
		}
	}
	
	public function download_qa_novasom_CSV($campaign)
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA ".$campaign." Audit List-'".$currDate."'.csv";

		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_novasom_CSV($rr,$campaign)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		if($campaign=='novasom'){
			$header = array("Auditor Name","Audit Date","Agent","Customer Name","Order Number","Evaluation Date","Audit Type","VOC","Earned Score","Total Score","Incorrect entry/Did not add patient's phone # alternate phone #s employment phone #/work phone #/emergency contact #","Incorrect entry/Did not add patient's street address apartment # city state and zip code","Incorrect entry of patient's first and last name","Incorrect entry of patient's date of birth","Incorrect entry of patient's gender","Incorrect entry of patient's language","Failure to update physician status in their profile (from pending to active)","Wrong physician selected","Did not update physician’s practice address phone # and fax #/wrong physician's office selected","Order was flagged for Missing Physician even if the physician was in the attachment","DME not entered/DME fax number selected did not match on the order form","Wrong order type selected/did not update order type","Placed the order into Sales Follow-up but the order wasn’t missing anything","Failure to uncheck “Missing Info” after attaching MR (MI)","Attached medical records/keyed in an order that includes MR but did not flag order for MR review (did not check off “Medical Record for Internal Review”) even if there’s form error “Medical Records Needed from Dr”","Did not flag the order for attestation (did not check off Accept Medical Judgment or did not check off Missing Physician Signed order)","Accepted attestation/Checked off “Accept Medical Judgment” on an unsigned order form","Order was placed into Sales Follow-up even if the missing info such as insurance info address etc are found on the previous order","Unable to add available symptoms/diagnosis","Epworth score was not added","Failure to add needed ICD 10 code","Incorrect entry of patient's height and weight","Did not select No for CPAP and No for Oxygen even if it’s indicated on the attachment","Unable to add/update insurance info to the order","Insurance info was added but order was not marked for Insurance Verification","Order was flagged for Insurance Verification. Failed to uncheck “Needs Insurance Verification” when there’s missing insurance info","Failure to mark of “Offer Cash Price” for Self-Pay order","Failure to uncheck “Needs Insurance Verification” for Self-Pay order","Did not add secondary insurance info","Unchecked “Needs Insurance Verification” even if the order has never got verified for insurance","Referral flag was removed when it should not have been","Changed the insurance info even if the insurance is already verified e.g. changed the carrier name and subscriber id #","Failure to send physician fax confirmation","Wrong fax attachment disposition","Wrong attachment to order belonging to another patient","Creation of duplicate order","Creation of new order for a patient but the attached order form is for a different patient","New referral attached to old order but did not key in new order","HIPAA violation – rep mistakenly fax document to incorrect physician or practice address","Failure to attach the records/documents needed for each order worked out","Failure to save the orders in the Shared Drive","Putting faxes on non-order but not working on it","Unworked assigned pods that are 3 days old","Cherry picking/Processing on faxes with unapproved receiving date","Putting notes on the order that refaxing was done but none was actually faxed","Call Summary","Feedback","Agent Review Date","Agent Note","Management Review Date","Management Name","Management Note");
		}else if($campaign=='bioserenity'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "TL Name", "Customer Name", "Order Number", "Evaluation Date", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Earned Score", "Possible Score", "Total Score", "1)PATIENT INFORMATION", "Q1 - Comment1", "Q1 - Comment2", "Q1 - Comment3", "Q1 - Comment4", "Q1 - Comment5", "Q1 - Comment6", "Q1 - Comment7", "2)PHYSICIAN", "Q2 - Comment1", "Q2 - Comment2", "Q2 - Comment3", "Q2 - Comment4", "Q2 - Comment5", "Q2 - Comment6", "3)ORDER INFORMATION", "Q3 - Comment1", "Q3 - Comment2", "Q3 - Comment3", "Q3 - Comment4", "Q3 - Comment5", "Q3 - Comment6", "Q3 - Comment7", "Q3 - Comment8", "4)DIAGNOSTIC", "Q4 - Comment1", "Q4 - Comment2", "Q4 - Comment3", "Q4 - Comment4", "Q4 - Comment5", "Q4 - Comment6", "5)INSURANCE", "Q5 - Comment1", "Q5 - Comment2", "Q5 - Comment3", "Q5 - Comment4", "Q5 - Comment5", "Q5 - Comment6", "Q5 - Comment7", "Q5 - Comment8", "Q5 - Comment9", "6)ORDER HISTORY", "Q6 - Comment", "7)ATTACHMENT", "Q7 - Comment1", "Q7 - Comment2", "8)ORDER CREATION", "Q8 - Comment1", "Q8 - Comment2", "Q8 - Comment3", "** 9)MAJOR ERRORS", "Q9 - Comment1", "Q9 - Comment2", "Q9 - Comment3", "Q9 - Comment4", "Q9 - Comment5", "Q9 - Comment6", "Q9 - Comment7", "Q9 - Comment8", "Call Summary", "Feedback", "Agent Review Date", "Agent Note", "Management Rerview By", "Management Review Date", "Management Review Note");
		}
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		$row	=	"";
		
		if($campaign=='novasom'){
			
			foreach($rr as $user){
				$row .= '"'.$user["auditor_name"].'",';
				$row .= '"'.$user["audit_date"].'",';
				$row .= '"'.$user["fname"]." ".$user["lname"].'",';
				$row .= '"'.$user["customer_name"].'",';
				$row .= '"'.$user["order_number"].'",';
				$row .= '"'.$user["evaluation_date"].'",';
				$row .= '"'.$user["audit_type"].'",';
				$row .= '"'.$user["voc"].'",';
				$row .= '"'.$user["earned_score"].'",';
				$row .= '"'.$user["overall_score"].'",';
				$row .= '"'.$user["incorrect_entry_contact"].'",';
				$row .= '"'.$user["incorrect_entry_address"].'",';
				$row .= '"'.$user["incorrect_entry_name"].'",';
				$row .= '"'.$user["incorrect_entry_dob"].'",';
				$row .= '"'.$user["incorrect_entry_gender"].'",';
				$row .= '"'.$user["incorrect_entry_lang"].'",';
				$row .= '"'.$user["physician_update"].'",';
				$row .= '"'.$user["wrong_physician"].'",';
				$row .= '"'.$user["physician_address"].'",';
				$row .= '"'.$user["physician_attachment"].'",';
				$row .= '"'.$user["dme_fax_mismatch"].'",';
				$row .= '"'.$user["wrong_order_type"].'",';
				$row .= '"'.$user["order_was_not_missing"].'",';
				$row .= '"'.$user["failure_uncheck"].'",';
				$row .= '"'.$user["mr_flag"].'",';
				$row .= '"'.$user["did_not_flag_attestation"].'",';
				$row .= '"'.$user["attestation_accepted"].'",';
				$row .= '"'.$user["placed_order_missing_info"].'",';
				$row .= '"'.$user["unable_to_add_symptom"].'",';
				$row .= '"'.$user["epworth_score"].'",';
				$row .= '"'.$user["failure_to_add_icd"].'",';
				$row .= '"'.$user["incorrect_entry_height_weight"].'",';
				$row .= '"'.$user["no_cpap_oxygen"].'",';
				$row .= '"'.$user["unable_to_update_insurance"].'",';
				$row .= '"'.$user["insurance_not_marked"].'",';
				$row .= '"'.$user["insurance_uncheck"].'",';
				$row .= '"'.$user["failure_self_pay"].'",';
				$row .= '"'.$user["self_pay_uncheck"].'",';
				$row .= '"'.$user["secondary_insurance"].'",';
				$row .= '"'.$user["uncheck_insurance_verification"].'",';
				$row .= '"'.$user["referral_flag_removed"].'",';
				$row .= '"'.$user["changed_verified_insurance_info"].'",';
				$row .= '"'.$user["confirm_fax_failure_physician"].'",';
				$row .= '"'.$user["wrong_fax_disposition"].'",';
				$row .= '"'.$user["wrong_attachment_another_patient"].'",';
				$row .= '"'.$user["creation_duplicate_order"].'",';
				$row .= '"'.$user["wrong_attachment_different_patient"].'",';
				$row .= '"'.$user["new_referrel_to_old_order"].'",';
				$row .= '"'.$user["hipaa_violation"].'",';
				$row .= '"'.$user["failure_to_attach_workout"].'",';
				$row .= '"'.$user["failure_to_save_shared_drive"].'",';
				$row .= '"'.$user["putting_faxes_not_working"].'",';
				$row .= '"'.$user["unworked_assigned_three_days_old"].'",';
				$row .= '"'.$user["cherry_picking_unapproved_date"].'",';
				$row .= '"'.$user["refaxing"].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';		
				fwrite($fopen,$row."\r\n");
				$row	=	"";
			}
			fclose($fopen);
		
		}else if($campaign=='bioserenity'){
			
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row .= '"'.$user["auditor_name"].'",';
				$row .= '"'.$user["audit_date"].'",';
				$row .= '"'.$user["fusion_id"].'",';
				$row .= '"'.$user["fname"]." ".$user["lname"].'",';
				$row .= '"'.$user["tl_name"].'",';
				$row .= '"'.$user["customer_name"].'",';
				$row .= '"'.$user["order_number"].'",';
				$row .= '"'.$user["call_date"].'",';
				$row .= '"'.$user["audit_type"].'",';
				$row .= '"'.$user["voc"].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user["earned_score"].'",';
				$row .= '"'.$user["possible_score"].'",';
				$row .= '"'.$user["overall_score"].'%'.'",';
				$row .= '"'.$user["patient_information"].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
				$row .= '"'.$user["physician"].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
				$row .= '"'.$user["order_information"].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt16'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt17'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt18'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt19'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt20'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt21'])).'",';
				$row .= '"'.$user["diagnostic"].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt22'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt23'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt24'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt25'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt26'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt27'])).'",';
				$row .= '"'.$user["insurance"].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt28'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt29'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt30'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt31'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt32'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt33'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt34'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt35'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt36'])).'",';
				$row .= '"'.$user["order_history"].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt37'])).'",';
				$row .= '"'.$user["attachment"].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt38'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt39'])).'",';
				$row .= '"'.$user["order_creation"].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt40'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt41'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt42'])).'",';
				$row .= '"'.$user["major_errors"].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt43'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt44'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt45'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt46'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt47'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt48'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt49'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt50'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",'; 
				$row .= '"'.$user['mgnt_rvw_date'].'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				fwrite($fopen,$row."\r\n");
				$row	=	"";
			}
			fclose($fopen);
			
		}	
	
	}



//////////////////////////////////////////////////////////////////////////////////////////// 
/////////////////////////////////////// QA MSB REPORT /////////////////////////////////////	
//////////////////////////////////////////////////////////////////////////////////////////

	public function getval($arrs, $k) {
    foreach($arrs as $key=>$val) {
        if( $key === $k ) {
            return $val;
        }
        else {
            if(is_array($val)) {
                $ret = $this->getval($val, $k);
                if($ret !== NULL) {
                    return $ret;
                }
            }
        }
    }
    return NULL;
	}


	public function qa_msb_report(){

		if(check_logged_in()){
			
			$office_id = "";
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["download_link1"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_msb_report.php";
						
			$date_from="";
			$date_to="";
			$office_id="";
			$action="";
			$dn_link="";
			$dn_link1="";
			$cond1='';
			
			$data["qa_msb_list"] = array();
			
			if(get_role_dir()=="super" || $is_global_access==1){
				$data['location_list'] = $this->Common_model->get_office_location_list();
			}else{
				$data['location_list'] = $this->Common_model->get_office_location_session_all($current_user);
			}
			
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond1= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
				if($office_id != "") $cond1 .= " and office_id='$office_id'";
				
					$qSql="SELECT * from (Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, (select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name from qa_msb_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, get_process_names(id) as campaign, DATEDIFF(CURDATE(), doj) as tenure, assigned_to from signin) yy on (xx.agent_id=yy.sid) $cond1 order by audit_date";
					$fullAray = $this->Common_model->get_query_result_array($qSql);
					$data["qa_msb_list"] = $fullAray;
					// $header_arr=$this->Common_model->get_query_result_array("SELECT column_comment FROM information_schema.COLUMNS WHERE table_name = 'qa_msb_feedback'");
					// $cnt=count($header_arr);

					//  for($i=0;$i<$cnt;$i++){
					// 	$val=$this->getval($header_arr[$i],'column_comment');
					// 	if($val!=""){
					// 		$header[]=$val;
					// 	}		
					//  }
					// array_unshift($header ,"Auditor Name");
					// $key = array_search ('Agent', $header);
					// array_splice($header, $key, 0, 'Fusion Id');
					// print_r($header);
					// die;
					$this->create_qa_msb_new_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_msb_new_CSV";
			}
			
			$data['download_link']=$dn_link;
			$data['download_link1']=$dn_link1;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id'] = $office_id;	
			
			$this->load->view('dashboard',$data);
		}
	}	
	 
		
// /////////////////// MSB NEW /////////////////////
	public function download_qa_msb_new_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA MSB New Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_msb_new_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");		
		$header=array ( "Auditor Name ","Audit Date ","Fusion Id ","Agent ","L1 Super ","Phone ","Call Date ","Call Duration ","ACPT ","ACPT Option ","ACPT Others ","QA Type ","Audit Type ","Auditor Type ","VOC ","Client Name ","Overall Score ","Identify himself/herself by first and last name at the beginning of the call? **SQ** ","Provide the Quality Assurance Statement verbatim before any specific account information was discussed?**SQ** ","State 'MSB Financial' with no deviation? **SQ** ","Verify that he/she was speaking to a right party according to the client requirements (First and Last Name) and before providing the disclosures? ","Verify one/two pieces of demographics information on an outbound call ","Provide the Mini Miranda disclosure verbatim ","State the client name and the purpose of the communication? ","Sate/Ask for balance due? ","Opening Score ","Full and Complete information taken? ","Ask for the payment over the phone? ","Ask for a post dated payment (except for the states MA or RI)? ","Followed the previous conversations on the account for the follow-up call ","Able to take a promise to pay on the account? ","Effort Score ","Offer to split the balance in part? ","Offer a one/three/lump sum settlement appropriately? ","Offer a payment plan with significant down payment? ","Did Collector follow proper negotiation sequence to provide settelment options? ","Did Collector try to negotiate effectively to convince the customer for payment? ","Offer a small good faith payment? ","Negotiation Score ","Did not Misrepresent their identity or authorization and status of the consumer's account? ","Did not Discuss or imply that any type of legal actions ","Did not Make any false representations regarding the nature of the communication? ","Did not Contact the consumer at any unusual times (sate regulations) or outside the hours of 8:00 am and 9:00 pm at the consumer's location? ","Did not Communicate with the consumer at work if it is known or there is reason to know that such calls are prohibited? ","Did not Communicate with the consumer after learning the consumer is represented by an attorney ","Adhere to the cell phone policy/TCPA regulations and policy regarding contacting consumers via cell phone email and fax? ","Adhere to policy regarding third parties for the sole purpose of obtaining location information for the consumer? ","Enter Status code/disposition codes correctly to ensure that inappropriate dialing does not take place? ","Did not Make any statement that could constitute unfair ","Did not Communicate or threaten to communicate false credit information or information which should be known to be false and utilized the proper CBR script whenever a consumer enquires about that? ","Handle the consumer's dispute correctly and take appropriate action including providing the consumer with the correct contact information to submit a written dispute or complaint ","Did not Make the required statement on time barred accounts ","Adhere to FDCPA laws? ","Did not Make any statement that could be considered discriminatory towards a consumer? ","Did collector stated state compliance disclosures (ex. OOS) ","Did the collectors adhere to the State Restrictions? ","Compliance Score ","Confirm with consumer if he/she is the authorized user of the debit or credit card / checking account? ","Recap the call by verifying consumer's Name ","Stated the proper payment script before processing payment? ","Advise of the payment processing fee before the payment was taken ","Obtain permission from the consumer to initiate electronic credit /debit card transactions or through checking account and get supervisor verification if needed?**SQ** ","Educate the consumer about correspondence being sent (Receipts ","Provide the consumer with the confirmation code? ","Payment Script Score ","Demonstrate Active Listening? ","Represent the company and the client in a positive manner? ","Anticipate and overcome objections? ","Call Control Score ","Summarize the call? ","Provide our Toll free number ","Set appropriate timelines and expectations for follow up? ","Did collector follow proper hold and transfer procedure? ","Close the call Professionally? ","Closing Score ","Use the proper action code? ","Use the proper result code? ","Document thoroughly the context of the conversation? ","Remove any phone numbers known to be incorrect?**SQ** ","Update address information ","Change the status of the account ","Escalate the account to a supervisor for handling if appropriate?/ Escalate the account to a supervisor for handling if appropriate? ","Documentation Score ","Call Summary ","Feedback ","Entry By ","Entry Date ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date");
		$field_name="SHOW FULL COLUMNS FROM qa_msb_feedback WHERE Comment!=''";
		$field_name=$this->Common_model->get_query_result_array($field_name);
		$fld_cnt=count($field_name);
		for($i=0;$i<$fld_cnt;$i++){
						$val=$field_name[$i]['Field'];
						if($val!=""){
							$field_val[]=$val;
						}		
					 }
		
		array_unshift($field_val ,"auditor_name");
		$key = array_search ('agent_id', $field_val);
		array_splice($field_val, $key, 0, 'fusion_id');
		$field_val=array_values($field_val);

		$count_for_field=count($field_val);

		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		$row = "";
		// print_r($rr);
		// die;
		foreach($rr as $user)
		{	
			for($z=0;$z<$count_for_field;$z++){
				
				if($field_val[$z]==="auditor_name"){
					$row = '"'.$user['auditor_name'].'",';
				}elseif($field_val[$z]==="fusion_id"){
					$row .= '"'.$user['fusion_id'].'",';
				}elseif($field_val[$z]==="agent_id"){
					$row .= '"'.$user['fname']." ".$user['lname'].'",';
				}elseif($field_val[$z]==="tl_id"){
					$row .= '"'.$user['tl_name'].'",';	
				}elseif(in_array($field_val[$z], array('call_summary','feedback','agent_rvw_note','mgnt_rvw_note'))) {
    			
    			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user[$field_val[$z]])).'",';

				}else{
					$row .= '"'.$user[$field_val[$z]].'",';	
				}
				
			}
				
				fwrite($fopen,$row."\r\n");
				$row = "";
		}
		
		fclose($fopen);
	}


	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////	 
////////////////////////////////////// QA Metropolis REPORT //////////////////////////////	
///////////////////////////////////////////////////////////////////////////////////////////

	public function qa_metropolis_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_metropolis_report.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			
			$data["qa_metropolis_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
		
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, (select disposition from qa_metropolis_disposition as agntdisp where agntdisp.id=agent_dispo) as agentDispo, (select disposition from qa_metropolis_disposition as actldisp where actldisp.id=actual_dispo) as actualDispo from qa_metropolis_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, get_process_names(id) as campaign, assigned_to from signin) yy on (xx.agent_id=yy.sid) Left join (Select fd_id, note as agent_note, date(entry_date) as agent_rvw_date from qa_metropolis_agent_rvw) zz on (xx.id=zz.fd_id) Left Join (Select fd_id as mgnt_fd_id, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as mgnt_name, note as mgnt_note, date(entry_date) as mgnt_rvw_date from qa_metropolis_mgnt_rvw) ww on (xx.id=ww.mgnt_fd_id) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_metropolis_list"] = $fullAray;
				$this->create_qa_metropolis_CSV($fullAray);	
				$dn_link = base_url()."reports_qa/download_qa_metropolis_CSV";
				
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_metropolis_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Metropolis Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_metropolis_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Call Date/Time", "Call Duration", "Phone", "Campaign", "Audit Type", "VOC", "Agent Disposition", "Actual Disposition", "Customer Voice", "Welcome the Customer", "Know the Customer", "Effective Communication", "Building Rapport", "Maintain Courtesy", "Probing Assistance", "Significance of Information", "Action for Solution", "Proper Documentation", "ZTP", "Welcome the Customer Comment", "Know the Customer Comment", "Effective Communication Comment", "Building Rapport Comment", "Maintain Courtesy Comment", "Probing Assistance Comment", "Significance of Information Comment", "Action for Solution Comment", "Proper Documentation Comment", "ZTP Comment", "Overall Score", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			if($user['welcome_customer']==5) $welcome_customer='100%';
			else $welcome_customer='0%';
			
			if($user['know_customer']==5) $know_customer='100%';
			else $know_customer='0%';
			
			if($user['effective_communication']==10) $effective_communication='100%';
			else $effective_communication='0%';
			
			if($user['building_rapport']==15) $building_rapport='100%';
			else $building_rapport='0%';
			
			if($user['maintain_courtesy']==10) $maintain_courtesy='100%';
			else $maintain_courtesy='0%';
			
			if($user['probing_assistance']==10) $probing_assistance='100%';
			else $probing_assistance='0%';
			
			if($user['significance_info']==20) $significance_info='100%';
			else $significance_info='0%';
			
			if($user['action_solution']==15) $action_solution='100%';
			else $action_solution='0%';
			
			if($user['proper_docu']==10) $proper_docu='100%';
			else $proper_docu='0%';
			
			
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",'; 
			$row .= '"'.$user['tl_name'].'",'; 
			$row .= '"'.$user['call_date_time'].'",';
			$row .= '"'.$user['call_duration'].'",';
			$row .= '"'.$user['phone'].'",';
			$row .= '"'.$user['campaign'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['agentDispo'].'",';
			$row .= '"'.$user['actualDispo'].'",';
			$row .= '"'.$user['customer_voice'].'",';
			$row .= '"'.$welcome_customer.'",'; 
			$row .= '"'.$know_customer.'",'; 
			$row .= '"'.$effective_communication.'",'; 
			$row .= '"'.$building_rapport.'",'; 
			$row .= '"'.$maintain_courtesy.'",'; 
			$row .= '"'.$probing_assistance.'",'; 
			$row .= '"'.$significance_info.'",'; 
			$row .= '"'.$action_solution.'",'; 
			$row .= '"'.$proper_docu.'",'; 
			$row .= '"'.$user['zero_tolerance'].'",';
			$row .= '"'.$user['welcome_customer_comment'].'",';
			$row .= '"'.$user['know_customer_comment'].'",';
			$row .= '"'.$user['effective_communi_comment'].'",';
			$row .= '"'.$user['building_rapport_comment'].'",';
			$row .= '"'.$user['maintain_curtsey_comment'].'",';
			$row .= '"'.$user['probing_assistance_comment'].'",';
			$row .= '"'.$user['significance_info_comment'].'",';
			$row .= '"'.$user['action_solution_comment'].'",';
			$row .= '"'.$user['proper_docu_comment'].'",';
			$row .= '"'.$user['zero_tolerance_comment'].'",';
			$row .= '"'.$user['overall_score'].'%'.'",'; 
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';				
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}


///////////////////////////////////////////////////////////////////////////////////////////	 
///////////////////////////////////// QA MEESHO REPORT ////////////////////////////////////	
///////////////////////////////////////////////////////////////////////////////////////////

	public function qa_meesho_report(){
		if(check_logged_in()){
			
			$office_id = "";
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_meesho_report.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$date_from="";
			$date_to="";
			$audit_type="";
			$action="";
			$dn_link="";
			$cond='';
			$cond1='';
			$camp_cond='';
			
			$pValue = trim($this->input->post('process_id'));
			if($pValue=="") $pValue = trim($this->input->get('process_id'));
			
			$data['pValue']=$pValue;
			
			$data["qa_meesho_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				$audit_type = $this->input->get('audit_type');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (date(audit_date) >= '$date_from' and date(audit_date) <= '$date_to' ) ";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if($audit_type=="All") $cond .= "";
				else $cond .=" and audit_type='$audit_type'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else if(get_login_type()=="client"){
					$cond1 .=" And audit_type not in ('Operation Audit','Trainer Audit')";
				}else{
					$cond1 .="";
				}	
				
				if($pValue=='Inbound'){
					$camp_cond='qa_meesho_inbound_feedback';
				}else if($pValue=='Supplier_Support'){
					$camp_cond='qa_meesho_supplier_feedback';
				}else if($pValue=='Supplier_Support_CMB'){
					$camp_cond='qa_meesho_supplier_cmb_feedback';
				}else if($pValue=='Supplier_Support_Onboarding'){
					$camp_cond='qa_meesho_supplier_onboarding_feedback';
				}else if($pValue=='Email'){
					$camp_cond='qa_meesho_email_feedback';
				}else if($pValue=='Pop Shop'){
					$camp_cond='qa_meesho_popshop_feedback';
				}
				
				$qSql="SELECT * from (Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				(select email_id_off from info_personal ip where ip.user_id=entry_by) as auditor_email,
				(select email_id from signin_client sce where sce.id=client_entryby) as client_email,
				(select email_id_off from info_personal ips where ips.user_id=agent_id) as agent_email,
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from $camp_cond) xx Left Join
				(Select id as sid, concat(fname, ' ', lname) as agent_name, fusion_id, doj, office_id, assigned_to, get_process_names(id) as campaign, DATEDIFF(CURDATE(), doj) as tenure from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 ";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_meesho_list"] = $fullAray;
				$this->create_qa_meesho_CSV($fullAray,$pValue);	
				$dn_link = base_url()."reports_qa/download_qa_meesho_CSV/".$pValue;
				
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['audit_type']=$audit_type;
			
			$this->load->view('dashboard',$data);
		}
	}
	

	public function download_qa_meesho_CSV($pid)
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Meesho ".$pid." List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_meesho_CSV($rr,$pid)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		if($pid=='Inbound'){
			$header = array("Auditor Name", "Auditor Email", "Audit Date/Time", "Agent Name", "L1 Super", "Tenure", "Agent Status", "Record No", "Order No", "Phone", "Campaign", "Audit Center", "Agent Center", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Language", "Recording ID", "Call Date/Time",  "Week", "Contact Audit", "Satisfaction QA Rating", "AHT in secs", "Agent Disposition", "Correct Disposition", "Call Opening", "Call Opening Comment", "Identification", "Identification Comment", "Security Check", "Security Check Comment", "Hold Procedure", "Hold Procedure Comment", "Closing Script", "Closing Script Comment", "Active Listening", "Active Listening Comment", "Effective Probing", "Effective Probing Comment", "Accurate Resolution Process", "Accurate Resolution Process Comment", "Politeness Courtesy", "Politeness Courtesy Comment", "Apology Empathy", "Apology Empathy Comment", "Enthusiasm", "Enthusiasm Comment", "CRM accuracy", "CRM accuracy Comment", "Additional Info", "Additional Info Comment", "Total Score", "AHT Duration Reduction", "Will this Lead to Repeat Call for same Order", "ZTP", "Voice of customer any", "Resolution Requires an outbound call", "Call Summary", "Feedback", "Satisfaction level of the customer with resolution", "Will the customer call for the same issue again ?", "What would be the reason for repeat ?", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Management Review By", "Management Review Date", "Management Comment", "Client Review By", "Client Review Commnet", "Client Review Date");
		}else if($pid=='Email'){
			$header = array("Auditor Name", "Auditor Email", "Audit Date", "Agent Name", "L1 Super", "Tenure", "Agent Status", "Order No", "Phone", "Campaign", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Language", "Email Date/Time", "Week", "Audit Center", "Agent Center", "Contact Audit", "ZD Ticket ID", "Satisfaction rating", "Agent Disposition", "Correct Disposition", "ZTP", "Opening Personalization", "Opening Personalization Comment", "Validation Customer info", "Validation Customer info Comment", "Acknowledge Assure", "Acknowledge Assure Comment", "Effective Probing", "Effective Probing Comment", "Accurate Resolution", "Accurate Resolution Comment", "Managed delayed with grace", "Managed delayed with grace Comment", "Provided Additional Info", "Provided Additional Info Comment", "Used Templates correctly", "Used Templates correctly Comment", "Used Customization Templates", "Used Customization Templates Comment", "Use Correct Spelling", "Use Correct Spelling Comment", "CRM accuracy", "CRM accuracy Comment", "Closing Statement", "Closing Statement Comment", "Total Score", "Voice of Customer any", "Resolution Requires an outbound call", "Call Summary", "Feedback", "Satisfaction level of the customer with resolution", "Will the customer call for the same issue again ?", "What would be the reason for repeat ?", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Management Review By", "Management Review Date", "Management Comment", "Client Review By", "Client Review Commnet", "Client Review Date");
		}else if($pid=='Supplier_Support'){
			$header = array("Edit Audits", "QA name", "Process", "Agent Name", "TL Name", "Agent Status", "Tenurity", "Quality Score", "PreFatal Score", "Fatal", "Week", "Audit Center", "Agent Center", "Audit Date", "Employee ID", "Email Address", "Type of Contact Audit", "Email Date & Time", "Ticket ID", "Agent Selected Disposition", "Correct Disposition", "Call Summary", "Score", "Mobile No", "Language", "Order No", "Q1- Opening/Personalization", "Q1- Remarks", "Q2- Validation of customer information", "Q2- Reamarks", "Q3- Acknowledge", "Q3- Remarks", "Q4- Effecting Probing", "Q4- Remarks", "Q5- Accurate Resolution", "Q5- Remarks", "Q6- Managed delays with grace", "Q6- Remarks", "Q7- Provided self help", "Q7- Remarks", "Q8- Leverage System Tools", "Q8- Remarks", "Q9- Accurate Follow up", "Q9- Remarks", "Q10- Use correct spelling", "Q10- Remarks", "Q11- CRM accuracy", "Q11- Remarks", "Q12- Closing Statement", "Q12- Remarks", "Q13- Professionalism", "Q13- Remarks", "Voice of customer any", "Resolution Requires an outbound call", "Satisfaction level of the customer", "Will the customer call for the same issue again ?", "Remarks yes for repeat call", "What would be the reason for repeat ?", "ACPT", "L2", "L3", "L4", "Edit Audit", "Blank", "Blank", "Blank", "Blank", "Audit Date", "Tenurity(Date of certification)", "Tenure Days", "Fatal Count", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Management Review By", "Management Review Date", "Management Comment", "Client Review By", "Client Review Commnet", "Client Review Date", "Record No", "FCR", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Feedback");
		}else if($pid=='Supplier_Support_CMB'){
			$header = array("Edit Audits", "QA name", "Process", "Agent Name", "TL Name", "Agent Status", "Tenurity", "Quality Score", "PreFatal Score", "Fatal", "Week", "Audit Center", "Agent Center", "Audit Date", "Employee ID", "Email Address", "Type of Contact Audit", "Email Date & Time", "Mobile No", "Agent Selected Disposition", "Correct Disposition", "Call Summary", "Score", "Recording ID", "Language", "AHT", "Q1- Appropriate call opening", "Q1- Remarks", "Q2- Rate of speech/Grammar", "Q2- Remarks", "Q3- Avoid Interruption", "Q3- Remarks", "Q4- Hold Procedure", "Q4- Remarks", "Q5- Dead Air", "Q5- Remarks", "Q6- Casual on the call or not", "Q6- Remarks", "Q7 - Empathy", "Q7- Remarks", "Q8- Accurate Resolution as per the SOP", "Q8- Remarks", "Q9- comments/cases uses properly", "Q9- Remarks", "Q10- Updating forms in trackers", "Q10- Remarks", "Q11- Provide Proactive Information", "Q11- Remarks", "Q12- Survey pitch for solved cases", "Q12- Remarks", "Q13- Additional Information", "Q13- Remarks", "Voice of customer any", "Resolution Requires an outbound call", "Satisfaction level of the customer", "Will the customer call for the same issue again ?", "Remarks yes for repeat call", "What would be the reason for repeat ?", "ACPT", "L2", "L3", "L4", "Edit Audit", "Blank", "Blank", "Blank", "Blank", "Audit Date", "Tenurity(Date of certification)", "Tenure Days", "Fatal Count", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Management Review By", "Management Review Date", "Management Comment", "Client Review By", "Client Review Commnet", "Client Review Date", "Ticket ID", "Order No", "FCR", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Feedback");
		}else if($pid=='Supplier_Support_Onboarding'){
			$header = array("Edit Audits", "QA name", "Process", "Agent Name", "TL Name", "Agent Status", "Tenurity", "Quality Score", "PreFatal Score", "Fatal", "Week", "Audit Center", "Agent Center", "Audit Date", "Employee ID", "Email Address", "Type of Contact Audit", "Email Date & Time", "Supplier ID", "Agent Selected Disposition", "Correct Disposition", "Call Summary", "Score", "Recording ID", "Language", "Order No", "Q1- Call Opening", "Q1- Remarks", "Q2- Identification", "Q2- Remarks", "Q3- Active listening", "Q3- Remarks", "Q4- Patience", "Q4- Remarks", "Q5- Supplier Info", "Q5- Remarks", "Q6 - Catalog Creation and stock", "Q6- Remarks", "Q7 - Order management", "Q7- Remarks", "Q8 - Logistic Process", "Q8- Remarks", "Q9 - Return related issues and dashboard", "Q9- Remarks", "Q10 - Payments and penalties", "Q10- Remarks", "Q11 - Closing Statement", "Q11- Remarks", "Q12-Apology/Empathy", "Q12- Remarks", "Voice of customer any", "Resolution Requires an outbound call", "Satisfaction level of the customer", "Will the customer call for the same issue again ?", "Remarks yes for repeat call", "What would be the reason for repeat ?", "Blank", "Blank", "Blank", "Blank", "Blank", "Edit Audit", "Blank", "Blank", "Blank", "Blank", "Audit Date", "Tenurity(Date of certification)", "Tenure Days", "Fatal Count", "ACPT", "L2", "L3", "L4", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Management Review By", "Management Review Date", "Management Comment", "Client Review By", "Client Review Commnet", "Client Review Date", "Mobile No", "FCR", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Feedback");
		}else if($pid=='Pop Shop'){
			$header = array("Auditor Name", "Audit Date", "Agent Name", "L1 Super", "Phone", "Record No", "Order No", "Ticket ID", "Advisor Tagging", "Correct Tagging", "ACPT", "ACPT Reason", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Opening", "Identification", "Security check", "Hold Procedure", "Closing Script", "Active Listening", "Effective Probing", "**Accurate Resolution as per the SOP", "Professionalism", "Apology/Empathy", "**Politeness & Courtesy", "CRM accuracy", "Additional Information", "Opening Remarks", "Identification Remarks", "Security check Remarks", "Hold Procedure Remarks", "Closing Script Remarks", "Active Listening Remarks", "Effective Probing Remarks", "**Accurate Resolution as per the SOP Remarks", "Professionalism Remarks", "Apology/Empathy Remarks", "**Politeness & Courtesy Remarks", "CRM accuracy Remarks", "Additional Information Remarks", "Call Summary", "Feedback", "Fatal Reason", "Agent Feedback Status", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Management Review By", "Management Review Date", "Management Comment", "Client Review By", "Client Review Commnet", "Client Review Date");
		}
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		
		if($pid=='Inbound'){
		
			foreach($rr as $user){
			
				if($user['call_opening']==5) $call_opening='Yes';
				else if($user['call_opening']==5.1) $call_opening='N/A';
				else $call_opening='No';
				
				if($user['identification']==5) $identification='Yes';
				else if($user['identification']==5.1) $identification='N/A';
				else $identification='No';
				
				if($user['security_check']==5) $security_check='Yes';
				else if($user['security_check']==5.1) $security_check='N/A';
				else $security_check='No';
				
				if($user['hold_procedure']==10) $hold_procedure='Yes';
				else if($user['hold_procedure']==10.1) $hold_procedure='N/A';
				else $hold_procedure='No';
				
				if($user['closing_script']==5) $closing_script='Yes';
				else if($user['closing_script']==5.1) $closing_script='N/A';
				else $closing_script='No';
				
				if($user['active_listening']==8) $active_listening='Yes';
				else if($user['active_listening']==8.1) $active_listening='N/A';
				else $active_listening='No';
				
				if($user['effective_probing']==5) $effective_probing='Yes';
				else if($user['effective_probing']==5.1) $effective_probing='N/A';
				else $effective_probing='No';
				
				if($user['accurate_resolution_process']==15) $accurate_resolution_process='Yes';
				else if($user['accurate_resolution_process']==15.1) $accurate_resolution_process='N/A';
				else $accurate_resolution_process='No';
				
				if($user['politeness_courtesy']==10) $politeness_courtesy='Yes';
				else if($user['politeness_courtesy']==10.1) $politeness_courtesy='N/A';
				else $politeness_courtesy='No';
				
				if($user['apology_empathy']==8) $apology_empathy='Yes';
				else if($user['apology_empathy']==8.1) $apology_empathy='N/A';
				else $apology_empathy='No';
				
				if($user['enthusiasm']==12) $enthusiasm='Yes';
				else if($user['enthusiasm']==12.1) $enthusiasm='N/A';
				else $enthusiasm='No';
				
				/* if($user['fluency_structure']==5) $fluency_structure='Yes';
				else if($user['fluency_structure']==5.1) $fluency_structure='N/A';
				else $fluency_structure='No';
				
				if($user['mentorship_pitch']==5) $mentorship_pitch='Yes';
				else if($user['mentorship_pitch']==5.1) $mentorship_pitch='N/A';
				else $mentorship_pitch='No'; */
				
				if($user['crm_accuracy']==10) $crm_accuracy='Yes';
				else if($user['crm_accuracy']==10.1) $crm_accuracy='N/A';
				else $crm_accuracy='No';
				
				if($user['addition_info']==2) $addition_info='Yes';
				else if($user['addition_info']==2.1) $addition_info='N/A';
				else $addition_info='No';
				
				if($user['tenure']>='30'){
					$agentStatus='BAU';
				}else{
					$agentStatus='OJT';
				}
				
				if($user['entry_by']!=''){
					$name_audt = $user['auditor_name'];
					$email_audt = $user['auditor_email'];
				}else{
					$name_audt = $user['client_name'].' [Client]';
					$email_audt = $user['client_email'];
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$name_audt.'",'; 
				$row .= '"'.$email_audt.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['agent_name'].'",';
				$row .= '"'.$user['tl_name'].'",'; 
				$row .= '"'.$user['tenure'].'",'; 
				$row .= '"'.$agentStatus.'",'; 
				$row .= '"'.$user['record_no'].'",'; 
				$row .= '"'.$user['order_no'].'",'; 
				$row .= '"'.$user['phone'].'",'; 
				$row .= '"'.$user['campaign'].'",'; 
				$row .= '"'.$user['audit_center'].'",'; 
				$row .= '"'.$user['agent_center'].'",'; 
				$row .= '"'.$user['audit_type'].'",'; 
				$row .= '"'.$user['voc'].'",'; 
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['language'].'",'; 
				$row .= '"'.$user['recording_id'].'",'; 
				$row .= '"'.$user['call_date_time'].'",';  
				$row .= '"'.$user['week'].'",';
				$row .= '"'.$user['contact_audit'].'",';
				$row .= '"'.$user['satis_rating'].'",';
				$row .= '"'.$user['aht_sec'].'",';
				$row .= '"'.$user['agent_dispo'].'",';
				$row .= '"'.$user['correct_dispo'].'",';
				$row .= '"'.$call_opening.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_opening_comment'])).'",';
				$row .= '"'.$identification.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['identification_comment'])).'",';
				$row .= '"'.$security_check.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['security_check_comment'])).'",';
				$row .= '"'.$hold_procedure.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['hold_procedure_comment'])).'",';
				$row .= '"'.$closing_script.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['closing_script_comment'])).'",';
				$row .= '"'.$active_listening.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['active_listening_comment'])).'",';
				$row .= '"'.$effective_probing.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['effective_probing_comment'])).'",';
				$row .= '"'.$accurate_resolution_process.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['accurate_resolution_process_comment'])).'",';
				$row .= '"'.$politeness_courtesy.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['politeness_courtesy_comment'])).'",';
				$row .= '"'.$apology_empathy.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['apology_empathy_comment'])).'",';
				$row .= '"'.$enthusiasm.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['enthusiasm_comment'])).'",';
				/* $row .= '"'.$fluency_structure.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['fluency_structure_comment'])).'",';
				$row .= '"'.$mentorship_pitch.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mentorship_pitch_comment'])).'",'; */
				$row .= '"'.$crm_accuracy.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['crm_accuracy_comment'])).'",';
				$row .= '"'.$addition_info.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['addition_info_comment'])).'",';
				$row .= '"'.$user['overall_score'].'",';
				$row .= '"'.$user['aht_duration'].'",';
				$row .= '"'.$user['lead_repeat_call'].'",';
				$row .= '"'.$user['ztp'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['voice_of_customer'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['resolution_required_ob_call'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['customer_satisfaction'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['customer_issue_again'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['reason_for_repeat'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",'; 
				$row .= '"'.$user['agent_rvw_date'].'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",'; 
				$row .= '"'.$user['mgnt_rvw_date'].'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_name'].'",'; 
				$row .= '"'.$user['client_rvw_date'].'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
				
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		
		}else if($pid=='Email'){
			
			foreach($rr as $user){
		
				if($user['oprning_personalization']==5) $oprning_personalization='Yes';
				else if($user['oprning_personalization']==5.1) $oprning_personalization='N/A';
				else $oprning_personalization='No';
				
				if($user['validation_customer_info']==5) $validation_customer_info='Yes';
				else if($user['validation_customer_info']==5.1) $validation_customer_info='N/A';
				else $validation_customer_info='No';
				
				if($user['acknowledge_align_assure']==5) $acknowledge_align_assure='Yes';
				else if($user['acknowledge_align_assure']==5.1) $acknowledge_align_assure='N/A';
				else $acknowledge_align_assure='No';
				
				if($user['effective_probing']==5) $effective_probing='Yes';
				else if($user['effective_probing']==5.1) $effective_probing='N/A';
				else $effective_probing='No';
				
				if($user['accurate_resolution']==10) $accurate_resolution='Yes';
				else if($user['accurate_resolution']==10.1) $accurate_resolution='N/A';
				else $accurate_resolution='No';
				
				if($user['manage_delay_grace']==5) $manage_delay_grace='Yes';
				else if($user['manage_delay_grace']==5.1) $manage_delay_grace='N/A';
				else $manage_delay_grace='No';
				
				if($user['provide_self_help']==10) $provide_self_help='Yes';
				else if($user['provide_self_help']==10.1) $provide_self_help='N/A';
				else $provide_self_help='No';
				
				if($user['used_template_correctly']==10) $used_template_correctly='Yes';
				else if($user['used_template_correctly']==10.1) $used_template_correctly='N/A';
				else $used_template_correctly='No';
				
				if($user['used_necessary_custom']==15) $used_necessary_custom='Yes';
				else if($user['used_necessary_custom']==15.1) $used_necessary_custom='N/A';
				else $used_necessary_custom='No';
				
				if($user['used_correct_spelling']==15) $used_correct_spelling='Yes';
				else if($user['used_correct_spelling']==15.1) $used_correct_spelling='N/A';
				else $used_correct_spelling='No';
				
				if($user['crm_accuracy']==10) $crm_accuracy='Yes';
				else if($user['crm_accuracy']==10.1) $crm_accuracy='N/A';
				else $crm_accuracy='No';
				
				if($user['closing_statement']==5) $closing_statement='Yes';
				else if($user['closing_statement']==5.1) $closing_statement='N/A';
				else $closing_statement='No';
				
				/* if($user['agent_write_brand_voice']==7) $agent_write_brand_voice='Yes';
				else if($user['agent_write_brand_voice']==7.1) $agent_write_brand_voice='N/A';
				else $agent_write_brand_voice='No'; */
				
				if($user['tenure']>='30'){
					$agentStatus='BAU';
				}else{
					$agentStatus='OJT';
				}
				
				if($user['entry_by']!=''){
					$name_audt = $user['auditor_name'];
					$email_audt = $user['auditor_email'];
				}else{
					$email_audt = $user['client_email'];
					$name_audt = $user['client_name'];
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				
				$row = '"'.$name_audt.'",'; 
				$row .= '"'.$email_audt.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['agent_name'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['tenure'].'",';
				$row .= '"'.$agentStatus.'",'; 
				$row .= '"'.$user['order_no'].'",'; 
				$row .= '"'.$user['phone'].'",'; 
				$row .= '"'.$user['campaign'].'",'; 
				$row .= '"'.$user['audit_type'].'",'; 
				$row .= '"'.$user['voc'].'",'; 
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['language'].'",';
				$row .= '"'.$user['email_date_time'].'",'; 
				$row .= '"'.$user['week'].'",'; 
				$row .= '"'.$user['audit_center'].'",'; 
				$row .= '"'.$user['agent_center'].'",';
				$row .= '"'.$user['contact_audit'].'",';
				$row .= '"'.$user['zd_id'].'",';  
				$row .= '"'.$user['satis_rating'].'",'; 
				$row .= '"'.$user['agent_dispo'].'",'; 
				$row .= '"'.$user['correct_dispo'].'",'; 
				$row .= '"'.$user['ztp'].'",'; 
				$row .= '"'.$oprning_personalization.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['oprning_personalization_comment'])).'",';
				$row .= '"'.$validation_customer_info.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['validation_customer_info_comment'])).'",';
				$row .= '"'.$acknowledge_align_assure.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['acknowledge_align_assure_comment'])).'",';
				$row .= '"'.$effective_probing.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['effective_probing_comment'])).'",';
				$row .= '"'.$accurate_resolution.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['accurate_resolution_comment'])).'",';
				$row .= '"'.$manage_delay_grace.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['manage_delay_grace_comment'])).'",';
				$row .= '"'.$provide_self_help.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['provide_self_help_comment'])).'",';
				$row .= '"'.$used_template_correctly.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['used_template_correctly_comment'])).'",';
				$row .= '"'.$used_necessary_custom.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['used_necessary_custom_comment'])).'",';
				$row .= '"'.$used_correct_spelling.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['used_correct_spelling_comment'])).'",';
				$row .= '"'.$crm_accuracy.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['crm_accuracy_comment'])).'",';
				$row .= '"'.$closing_statement.'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['closing_statement_comment'])).'",';
				//$row .= '"'.$agent_write_brand_voice.'",'; 
				//$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_write_brand_voice_comment'])).'",';
				$row .= '"'.$user['overall_score'].'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['voice_of_customer'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['resolution_required_ob_call'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['customer_satisfaction'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['customer_issue_again'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['reason_for_repeat'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",'; 
				$row .= '"'.$user['agent_rvw_date'].'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",'; 
				$row .= '"'.$user['mgnt_rvw_date'].'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_name'].'",'; 
				$row .= '"'.$user['client_rvw_date'].'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
				
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}else if($pid=='Supplier_Support'){
		
			foreach($rr as $user){
				$blank='';
				
				if($user['mgnt_rvw_by']!=''){
					$edit_audit='Edited';
				}else{
					$edit_audit='';
				}
				
				if($user['tenure']>='30'){
					$agentStatus='BAU';
				}else{
					$agentStatus='OJT';
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				if($user['overall_score']==0){
					$fatal=100;
				}else{
					$fatal=0;
				}
				
				$row = '"'.$edit_audit.'",'; 
				$row .= '"'.$user['auditor_name'].'",'; 
				$row .= '"'.$user['campaign'].'",'; 
				$row .= '"'.$user['agent_name'].'",'; 
				$row .= '"'.$user['tl_name'].'",'; 
				$row .= '"'.$agentStatus.'",';
				$row .= '"'.$user['tenure'].' Days'.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['pre_fatal_score'].'%'.'",';
				$row .= '"'.$fatal.'%'.'",';
				$row .= '"'.$user['week'].'",';
				$row .= '"'.$user['audit_center'].'",';
				$row .= '"'.$user['agent_center'].'",';
				$row .= '"'.$user['audit_date'].'",';
				$row .= '"'.$user['fusion_id'].'",';
				$row .= '"'.$user['agent_email'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['ticket_id'].'",';
				$row .= '"'.$user['case_type'].'",';
				$row .= '"'.$user['sub_type'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['phone'].'",';
				$row .= '"'.$user['language'].'",';
				$row .= '"'.$user['order_no'].'",';
				$row .= '"'.$user['opening'].'",';
				$row .= '"'.$user['comm1'].'",';
				$row .= '"'.$user['validateinfo'].'",';
				$row .= '"'.$user['comm2'].'",';
				$row .= '"'.$user['acknowledge'].'",';
				$row .= '"'.$user['comm3'].'",';
				$row .= '"'.$user['effectiveprobing'].'",';
				$row .= '"'.$user['comm4'].'",';
				$row .= '"'.$user['accurateresolution'].'",';
				$row .= '"'.$user['comm5'].'",';
				$row .= '"'.$user['managedelay'].'",';
				$row .= '"'.$user['comm6'].'",';
				$row .= '"'.$user['provideselfhelp'].'",';
				$row .= '"'.$user['comm7'].'",';
				$row .= '"'.$user['leveragesystem'].'",';
				$row .= '"'.$user['comm8'].'",';
				$row .= '"'.$user['accurateowenship'].'",';
				$row .= '"'.$user['comm9'].'",';
				$row .= '"'.$user['correctspelling'].'",';
				$row .= '"'.$user['comm10'].'",';
				$row .= '"'.$user['crmaccuracy'].'",';
				$row .= '"'.$user['comm11'].'",';
				$row .= '"'.$user['closingstatement'].'",';
				$row .= '"'.$user['comm12'].'",';
				$row .= '"'.$user['professionalism'].'",';
				$row .= '"'.$user['comm13'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['customer_voice'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['outbound_call'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['satisfaction_level'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['customer_callissue'])).'",';
				$row .= '"'.$user['remarks_yes_repeat_call'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['repeat_reason'])).'",';
				$row .= '"'.$user['acpt'].'",';
				$row .= '"'.$user['l2_acpt'].'",';
				$row .= '"'.$user['l3_acpt'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['l4_acpt'])).'",';
				$row .= '"'.$edit_audit.'",';
				$row .= '"'.$blank.'",';
				$row .= '"'.$blank.'",';
				$row .= '"'.$blank.'",';
				$row .= '"'.$blank.'",';
				$row .= '"'.$user['audit_date'].'",';
				$row .= '"'.$user['doj'].'",';
				$row .= '"'.$user['tenure'].' Days'.'",';
				$row .= '"'.$user['fatal_count'].'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",'; 
				$row .= '"'.$user['agent_rvw_date'].'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",'; 
				$row .= '"'.$user['mgnt_rvw_date'].'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_name'].'",'; 
				$row .= '"'.$user['client_rvw_date'].'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'",';
				$row .= '"'.$user['record_no'].'",';
				$row .= '"'.$user['fcr'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}else if($pid=='Supplier_Support_CMB'){
		
			foreach($rr as $user){
				$blank='';
				
				if($user['mgnt_rvw_by']!=''){
					$edit_audit='Edited';
				}else{
					$edit_audit='';
				}
				
				if($user['tenure']>='30'){
					$agentStatus='BAU';
				}else{
					$agentStatus='OJT';
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				if($user['overall_score']==0){
					$fatal=100;
				}else{
					$fatal=0;
				}
				
				$row = '"'.$edit_audit.'",'; 
				$row .= '"'.$user['auditor_name'].'",'; 
				$row .= '"'.$user['campaign'].'",'; 
				$row .= '"'.$user['agent_name'].'",'; 
				$row .= '"'.$user['tl_name'].'",'; 
				$row .= '"'.$agentStatus.'",';
				$row .= '"'.$user['tenure'].' Days'.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['pre_fatal_score'].'%'.'",';
				$row .= '"'.$fatal.'%'.'",';
				$row .= '"'.$user['week'].'",';
				$row .= '"'.$user['audit_center'].'",';
				$row .= '"'.$user['agent_center'].'",';
				$row .= '"'.$user['audit_date'].'",';
				$row .= '"'.$user['fusion_id'].'",';
				$row .= '"'.$user['agent_email'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['phone'].'",';
				$row .= '"'.$user['case_type'].'",';
				$row .= '"'.$user['sub_type'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['record_no'].'",';
				$row .= '"'.$user['language'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['call_opening'].'",';
				$row .= '"'.$user['comm1'].'",';
				$row .= '"'.$user['rate_of_speech'].'",';
				$row .= '"'.$user['comm2'].'",';
				$row .= '"'.$user['avoid_interruption'].'",';
				$row .= '"'.$user['comm3'].'",';
				$row .= '"'.$user['hold_procedure_follow'].'",';
				$row .= '"'.$user['comm4'].'",';
				$row .= '"'.$user['dead_air'].'",';
				$row .= '"'.$user['comm5'].'",';
				$row .= '"'.$user['casual_on_the_call'].'",';
				$row .= '"'.$user['comm6'].'",';
				$row .= '"'.$user['empathy_rude'].'",';
				$row .= '"'.$user['comm7'].'",';
				$row .= '"'.$user['provide_accrurate'].'",';
				$row .= '"'.$user['comm8'].'",';
				$row .= '"'.$user['cases_properly'].'",';
				$row .= '"'.$user['comm9'].'",';
				$row .= '"'.$user['updating_forms'].'",';
				$row .= '"'.$user['comm10'].'",';
				$row .= '"'.$user['proactive_information'].'",';
				$row .= '"'.$user['comm11'].'",';
				$row .= '"'.$user['survey_pitch'].'",';
				$row .= '"'.$user['comm12'].'",';
				$row .= '"'.$user['call_closing'].'",';
				$row .= '"'.$user['comm13'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['customer_voice'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['outbound_call'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['satisfaction_level'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['customer_callissue'])).'",';
				$row .= '"'.$user['remarks_yes_repeat_call'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['repeat_reason'])).'",';
				$row .= '"'.$user['acpt'].'",';
				$row .= '"'.$user['l2_acpt'].'",';
				$row .= '"'.$user['l3_acpt'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['l4_acpt'])).'",';
				$row .= '"'.$edit_audit.'",';
				$row .= '"'.$blank.'",';
				$row .= '"'.$blank.'",';
				$row .= '"'.$blank.'",';
				$row .= '"'.$blank.'",';
				$row .= '"'.$user['audit_date'].'",';
				$row .= '"'.$user['doj'].'",';
				$row .= '"'.$user['tenure'].' Days'.'",';
				$row .= '"'.$user['fatal_count'].'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",'; 
				$row .= '"'.$user['agent_rvw_date'].'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",'; 
				$row .= '"'.$user['mgnt_rvw_date'].'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_name'].'",'; 
				$row .= '"'.$user['client_rvw_date'].'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'",';
				$row .= '"'.$user['ticket_id'].'",';
				$row .= '"'.$user['order_no'].'",';
				$row .= '"'.$user['fcr'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}else if($pid=='Supplier_Support_Onboarding'){
		
			foreach($rr as $user){
				$blank='';
				
				if($user['mgnt_rvw_by']!=''){
					$edit_audit='Edited';
				}else{
					$edit_audit='';
				}
				
				if($user['tenure']>='30'){
					$agentStatus='BAU';
				}else{
					$agentStatus='OJT';
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				if($user['overall_score']==0){
					$fatal=100;
				}else{
					$fatal=0;
				}
				
				$row = '"'.$edit_audit.'",'; 
				$row .= '"'.$user['auditor_name'].'",'; 
				$row .= '"'.$user['campaign'].'",'; 
				$row .= '"'.$user['agent_name'].'",'; 
				$row .= '"'.$user['tl_name'].'",'; 
				$row .= '"'.$agentStatus.'",';
				$row .= '"'.$user['tenure'].' Days'.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['pre_fatal_score'].'%'.'",';
				$row .= '"'.$fatal.'%'.'",';
				$row .= '"'.$user['week'].'",';
				$row .= '"'.$user['audit_center'].'",';
				$row .= '"'.$user['agent_center'].'",';
				$row .= '"'.$user['audit_date'].'",';
				$row .= '"'.$user['fusion_id'].'",';
				$row .= '"'.$user['agent_email'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['ticket_id'].'",';
				$row .= '"'.$user['case_type'].'",';
				$row .= '"'.$user['sub_type'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['record_no'].'",';
				$row .= '"'.$user['language'].'",';
				$row .= '"'.$user['order_no'].'",';
				$row .= '"'.$user['call_opening'].'",';
				$row .= '"'.$user['comm1'].'",';
				$row .= '"'.$user['identification'].'",';
				$row .= '"'.$user['comm2'].'",';
				$row .= '"'.$user['active_listening'].'",';
				$row .= '"'.$user['comm3'].'",';
				$row .= '"'.$user['patience'].'",';
				$row .= '"'.$user['comm4'].'",';
				$row .= '"'.$user['supplier_info'].'",';
				$row .= '"'.$user['comm6'].'",';
				$row .= '"'.$user['catalog_creation'].'",';
				$row .= '"'.$user['comm7'].'",';
				$row .= '"'.$user['order_management'].'",';
				$row .= '"'.$user['comm8'].'",';
				$row .= '"'.$user['logistic_process'].'",';
				$row .= '"'.$user['comm9'].'",';
				$row .= '"'.$user['return_issue'].'",';
				$row .= '"'.$user['comm10'].'",';
				$row .= '"'.$user['payment'].'",';
				$row .= '"'.$user['comm11'].'",';
				$row .= '"'.$user['closing_statement'].'",';
				$row .= '"'.$user['comm12'].'",';
				$row .= '"'.$user['apology_empathy'].'",';
				$row .= '"'.$user['comm5'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['customer_voice'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['outbound_call'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['satisfaction_level'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['customer_callissue'])).'",';
				$row .= '"'.$user['remarks_yes_repeat_call'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['repeat_reason'])).'",';
				$row .= '"'.$blank.'",';
				$row .= '"'.$blank.'",';
				$row .= '"'.$blank.'",';
				$row .= '"'.$blank.'",';
				$row .= '"'.$blank.'",';
				$row .= '"'.$edit_audit.'",';
				$row .= '"'.$blank.'",';
				$row .= '"'.$blank.'",';
				$row .= '"'.$blank.'",';
				$row .= '"'.$blank.'",';
				$row .= '"'.$user['audit_date'].'",';
				$row .= '"'.$user['doj'].'",';
				$row .= '"'.$user['tenure'].' Days'.'",';
				$row .= '"'.$user['fatal_count'].'",';
				$row .= '"'.$user['acpt'].'",';
				$row .= '"'.$user['l2_acpt'].'",';
				$row .= '"'.$user['l3_acpt'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['l4_acpt'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",'; 
				$row .= '"'.$user['agent_rvw_date'].'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",'; 
				$row .= '"'.$user['mgnt_rvw_date'].'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_name'].'",'; 
				$row .= '"'.$user['client_rvw_date'].'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'",';
				$row .= '"'.$user['phone'].'",';
				$row .= '"'.$user['fcr'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		
		}else if($pid=='Pop Shop'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",'; 
				$row .= '"'.$user['audit_date'].'",';
				$row .= '"'.$user['agent_name'].'",'; 
				$row .= '"'.$user['tl_name'].'",'; 
				$row .= '"'.$user['phone'].'",';
				$row .= '"'.$user['record_no'].'",';
				$row .= '"'.$user['order_no'].'",';
				$row .= '"'.$user['ticket_id'].'",';
				$row .= '"'.$user['advisor_tagging'].'",';
				$row .= '"'.$user['correct_tagging'].'",';
				$row .= '"'.$user['acpt'].'",';
				$row .= '"'.$user['acpt_reason'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'",';
				$row .= '"'.$user['opening'].'",';
				$row .= '"'.$user['identification'].'",';
				$row .= '"'.$user['security_check'].'",';
				$row .= '"'.$user['hold_procedure'].'",';
				$row .= '"'.$user['closing_script'].'",';
				$row .= '"'.$user['active_listening'].'",';
				$row .= '"'.$user['effective_probing'].'",';
				$row .= '"'.$user['accurate_resolution'].'",';
				$row .= '"'.$user['professionalism'].'",';
				$row .= '"'.$user['apology_empathy'].'",';
				$row .= '"'.$user['politeness_courtesy'].'",';
				$row .= '"'.$user['CRM_accuracy'].'",';
				$row .= '"'.$user['additional_information'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['fatal_reason'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",'; 
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",'; 
				$row .= '"'.$user['mgnt_rvw_date'].'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_name'].'",'; 
				$row .= '"'.$user['client_rvw_date'].'",'; 
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		
		}
		
	}

//////////////////////////////////////////////////////////////////////////////////////////////
// ////////////////////////////////////// QA MSB REPORT //////////////////////////////////////	
// ///////////////////////////////////////////////////////////////////////////////////////////


	public function qa_layway_report(){

		if(check_logged_in()){
			
			$office_id = "";
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["download_link1"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_layway_report.php";
			$data["content_js"] = "qa_layway_js.php";
						
			$date_from="";
			$date_to="";
			$office_id="";
			$action="";
			$dn_link="";
			$dn_link1="";
			$cond1='';
			
			$data["qa_layway_list"] = array();
			
			if(get_role_dir()=="super" || $is_global_access==1){
				$data['location_list'] = $this->Common_model->get_office_location_list();
			}else{
				$data['location_list'] = $this->Common_model->get_office_location_session_all($current_user);
			}
			
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond1= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
				if($office_id != "") $cond1 .= " and office_id='$office_id'";
				
					$qSql="SELECT * from (Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, (select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name from qa_layway_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, get_process_names(id) as campaign, DATEDIFF(CURDATE(), doj) as tenure, assigned_to from signin) yy on (xx.agent_id=yy.sid) $cond1 order by audit_date";
					$fullAray = $this->Common_model->get_query_result_array($qSql);
					$data["qa_layway_list"] = $fullAray;
					$this->create_qa_layway_new_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_layway_new_CSV";
			}
			
			$data['download_link']=$dn_link;
			$data['download_link1']=$dn_link1;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id'] = $office_id;	
			
			$this->load->view('dashboard',$data);
		}
	}	
	 
		
// /////////////////// MSB NEW /////////////////////
	public function download_qa_layway_new_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA LayaWay Depot New Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function headerDetails2(){
		return $arrayName = array ( "Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","Call Duration","Audit Type","Auditor Type","VOC","Call Type","Overall Score","1. Agent answered the call within 6 secs and follow opening spiel","2. Agent delivered either empathy or assurance statement","3. Agent followed complete verification spiel","1. Agent was easy to understand?","2. Caller did not asked for a different operator because of agent's communication skills?","3. Agent used appropriate rate of speech?","1. Agent empathize in a timely manner or able to deliver assurance statement","2. Agent did not interrupted the caller and/or asked for an apology if there is an instance?","3. Agent's tone was pleasant /not weary/showed enthusiasm all throughout the call","4. Agent acknowledged the information provided by the caller?","5. Agent asked caller's permission before placing the call on hold","6. Agent waited for caller's confirmation before putting the call on hold","7. Hold time was less than 120 seconds","8. No Dead air of more than 20 seconds or multiple dead airs","1. Agent provided complete and accurate information","2. Agent write complete and accurate Notes","3. Agent updates the account if request was approved (For Follow up)","4. Agent disposed the call correctly","1. Agent ask additional assistance","2. Agent deliver closing spiel","Comments 1","Comments 2","Comments 3","Comments 4","Comments 5","Call Summary","Feedback","Entry By","Entry Date","Client entry by","Mgnt review by","Mgnt review note","Mgnt review date","Agent review note","Agent review date","Client review by","Client review note","Client_rvw_date" );
	}

	public function create_qa_layway_new_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");		
		$header=$this->headerDetails2();
		$field_name="SHOW FULL COLUMNS FROM qa_layway_feedback WHERE Comment!=''";
		$field_name=$this->Common_model->get_query_result_array($field_name);
		$fld_cnt=count($field_name);
		for($i=0;$i<$fld_cnt;$i++){
						$val=$field_name[$i]['Field'];
						if($val!=""){
							$field_val[]=$val;
						}		
					 }
		
		array_unshift($field_val ,"auditor_name");
		$key = array_search ('agent_id', $field_val);
		array_splice($field_val, $key, 0, 'fusion_id');
		$field_val=array_values($field_val);

		$count_for_field=count($field_val);

		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		$row = "";
		// print_r($rr);
		// die;
		foreach($rr as $user)
		{	
			for($z=0;$z<$count_for_field;$z++){
				
				if($field_val[$z]==="auditor_name"){
					$row = '"'.$user['auditor_name'].'",';
				}elseif($field_val[$z]==="fusion_id"){
					$row .= '"'.$user['fusion_id'].'",';
				}elseif($field_val[$z]==="agent_id"){
					$row .= '"'.$user['fname']." ".$user['lname'].'",';
				}elseif($field_val[$z]==="tl_id"){
					$row .= '"'.$user['tl_name'].'",';	
				}elseif(in_array($field_val[$z], array('call_summary','feedback','agent_rvw_note','mgnt_rvw_note'))) {
    			
    			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user[$field_val[$z]])).'",';

				}else{
					$row .= '"'.$user[$field_val[$z]].'",';	
				}
				
			}
				
				fwrite($fopen,$row."\r\n");
				$row = "";
		}
		
		fclose($fopen);
	}


	////////////////////////////////////// QA KIWI REPORT ////////////////////////////////	
///////////////////////////////////////////////////////////////////////////////////////////

	public function qa_kiwi_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_kiwi_report.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			
			$data["qa_kiwi_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
		
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name from qa_kiwi_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, get_process_names(id) as campaign, assigned_to from signin) yy on (xx.agent_id=yy.sid) Left join (Select fd_id, note as agent_note, date(entry_date) as agent_rvw_date from qa_kiwi_agent_rvw) zz on (xx.id=zz.fd_id) Left Join (Select fd_id as mgnt_fd_id, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as mgnt_name, note as mgnt_note, date(entry_date) as mgnt_rvw_date from qa_kiwi_mgnt_rvw) ww on (xx.id=ww.mgnt_fd_id) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				//print_r($fullAray);
				$data["qa_kiwi_list"] = $fullAray;
				$this->create_qa_kiwi_CSV($fullAray);	
				$dn_link = base_url()."reports_qa/download_qa_kiwi_CSV";
				
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_kiwi_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA KIWI Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_kiwi_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Call Date/Time", "Call Duration", "BID", "Campaign","site", "Call ID", "Audit Type","Auditor Type", "VOC", "1.1 Verification", "1.2 Impact on customer","1.3 Impact on Kiwi.com", "Comments", "2.1 Adherence to the script", "2.2 Adherence to the procedure","2.3 Soft skills", "2.4 Comments", "3.1 General Feedback", "Achieved score", "Possible score", "Quality score","Call Summary","Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['call_duration'].'",';
			$row .= '"'.$user['bid'].'",';
			$row .= '"'.$user['campaign'].'",';
			$row .= '"'.$user['site'].'",';
			$row .= '"'.$user['case_id'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['auditor_type'].'",';
			$row .= '"'.$user['voc'].'",';
			
			$row .= '"'.$user['Verification_1_1'].'",';
			$row .= '"'.$user['Impact_on_customer_1_2'].'",';
			$row .= '"'.$user['Impact_on_Kiwi_1_3'].'",';
			$row .= '"'.$user['comment'].'",';
			$row .= '"'.$user['Adherence_to_script_2_1'].'",';
			$row .= '"'.$user['Adherence_to_procedure_2_2'].'",';
			$row .= '"'.$user['Soft_skills_2_3'].'",';
			$row .= '"'.$user['comment_2'].'",';
			$row .= '"'.$user['comment_3'].'",';
			$row .= '"'.$user['earned_score'].'",';
			$row .= '"'.$user['possible_score'].'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';				
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}


	///////////////////////////////////////////////////////////////////////////////////// 
/////////////////////////////// QA Kabbage REPORT ////////////////////////////////	
/////////////////////////////////////////////////////////////////////////////////////

	public function qa_kabbage_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_kabbage_report.php";
			$data["content_js"] = "qa_kabbage_js.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$campaign="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			$data["qa_kabbage_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				$campaign = $this->input->get('campaign');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
		
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_".$campaign."_feedback) xx Left Join
				(Select id as sid, fname, lname, fusion_id, office_id, assigned_to, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_kabbage_list"] = $fullAray;
				$this->create_qa_kabbage_CSV($fullAray,$campaign);	
				$dn_link = base_url()."reports_qa/download_qa_kabbage_CSV";	
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['campaign']=$campaign;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_kabbage_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Kabbage Audit List-'".$currDate."'.csv";
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	
	public function create_qa_kabbage_CSV($rr,$campaign)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		if($campaign=='kabbage'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Event", "Call Duration", "Audit Type", "VOC", "Call Type", "KUSERID", "Ticket ID", "Auto Fail", "Overall Score", "1) Did the agent answer the call with their name?", "2) Did the agent request all appropriate documents from the caller", "3) Did the agent document all systems appropriately?", "4) Did the agent ask how they could help the customer?", "5) Did the agent verify all information is good?", "Procedural Earned Score", "Procedural Possible Score", "Procedural Score", "6) Did the agent ask the caller for their Kabbage User Name?", "7) Did the agent ask the caller for the last four digits of their Social Security Number?", "8) Did the agent refrain from disclosing account specific information", "9) Did the agent abide by all legal and regulatory requirements?", "Compliance Earned Score", "Compliance Possible Score", "Compliance Score", "10) Did the agent provide the caller with accurate information", "11) Did the agent do everything necessary and reasonable to create a single contact", "12) Was the agent engaged in the call with the caller in an effort to resolve the callers issue?", "13) Did the agent maintain a friendly professional tone?", "14) Did the agent keep holds and distractions to a minimum?", "15) Did the agent ask the caller if all their issues were resolved prior to ending the call?", "16) Did the agent thank the caller for choosing Kabbage?", "Customer Experience Earned Score", "Customer Experience Possible Score", "Customer Experience Score", "Procedural Comment1", "Procedural Comment2", "Procedural Comment3", "Procedural Comment4", "Procedural Comment5", "Compliance Comment1", "Compliance Comment2", "Compliance Comment3", "Compliance Comment4", "Customer Experience Comment1", "Customer Experience Comment2", "Customer Experience Comment3", "Customer Experience Comment4", "Customer Experience Comment5", "Customer Experience Comment6", "Customer Experience Comment7", "Customer Experience Comment8", "Call Summary", "Feedback", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		}else if($campaign=='kabbage_new'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Event", "Call Duration", "Audit Type", "VOC", "Call Type", "KUSERID", "Ticket ID", "Auto Fail", "Overall Score", "1) Did the agent answer the call with their name and the name of the product?", "2) Identified the correct reason for calling", "3) Did the agent show empathy and maintain professional tone", "4) Did the agent ask how they could help the customer?", "5) Did the agent keep holds and distractions to a minimum?", "5) Checkbox 1", "5) Checkbox 2", "5) Checkbox 3", "6) Demonstrated Active Listening", "7) Did the agent thank the caller for choosing Kabbage?", "8) Did the agent request all appropriate documents from the caller?", "9) Did the agent verify all information is good?", "9) Checkbox 1", "9) Checkbox 2", "9) Checkbox 3", "9) Checkbox 4", "9) Checkbox 5", "10) Refrain from disclosing account specific information", "11) Abide By All Legal and Regulatory Requirements", "12) Gave Correct and Complete Information", "13) Documented the call properly", "13) Checkbox 1", "13) Checkbox 2", "13) Checkbox 3", "13) Checkbox 4", "13) Checkbox 5", "13) Checkbox 6", "13) Checkbox 7", "14) Did the agent do everything necessary and reasonable to create a single contact", "15) Asked for Other Concerns", "Connect Overall(%)", "Resolve Overall(%)", "Made Easy Overall(%)", "Connect Comment1", "Connect Comment2", "Connect Comment3", "Connect Comment4", "Connect Comment5", "Connect Comment6", "Connect Comment7", "Resolve Comment8", "Resolve Comment9", "Resolve Comment10", "Resolve Comment11", "Resolve Comment12", "Resolve Comment13", "Made it easy Comment14", "Made it easy Comment15", "Call Summary", "Feedback", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		}
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		if($campaign=='kabbage'){
			
			foreach($rr as $user){	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
			
				$row = '"'.$auditorName.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['event'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['call_type'].'",';
				$row .= '"'.$user['kuserid'].'",';
				$row .= '"'.$user['ticket_id'].'",';
				$row .= '"'.$user['auto_fail'].'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['agentanswerthecall'].'",';
				$row .= '"'.$user['agentrequestdocuments'].'",';
				$row .= '"'.$user['documentallsystem'].'",';
				$row .= '"'.$user['agentasktohelpcustomer'].'",';
				$row .= '"'.$user['agentverifyallinformation'].'",';
				$row .= '"'.$user['procedural_possible'].'",';
				$row .= '"'.$user['procedural_earned'].'",';
				$row .= '"'.$user['procedural_score'].'%'.'",';
				$row .= '"'.$user['agentaskkabbagename'].'",';
				$row .= '"'.$user['agentaskcallerforSSnumber'].'",';
				$row .= '"'.$user['agentrefraindisclosingAccount'].'",';
				$row .= '"'.$user['agentabideallrequirement'].'",';
				$row .= '"'.$user['compliance_possible'].'",';
				$row .= '"'.$user['compliance_earned'].'",';
				$row .= '"'.$user['compliance_score'].'%'.'",';
				$row .= '"'.$user['agentprovideaccurateinformation'].'",';
				$row .= '"'.$user['agentcreatesinglecontact'].'",';
				$row .= '"'.$user['agentengagedincall'].'",';
				$row .= '"'.$user['agentmaintainfriendlytone'].'",';
				$row .= '"'.$user['agentkeepdistractions'].'",';
				$row .= '"'.$user['agentasktoendcall'].'",';
				$row .= '"'.$user['agentthankthecaller'].'",';
				//$row .= '"'.$user['agentencouragetotalecash'].'",';
				$row .= '"'.$user['customerexp_possible'].'",';
				$row .= '"'.$user['customerexp_earned'].'",';
				$row .= '"'.$user['customerexp_score'].'%'.'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt16'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt17'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_date'].'",';
				$row .= '"'.$user['client_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';	
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		
		}else if($campaign=='kabbage_new'){
			
			foreach($rr as $user){	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
			
				$row = '"'.$auditorName.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['event'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['call_type'].'",';
				$row .= '"'.$user['kuserid'].'",';
				$row .= '"'.$user['ticket_id'].'",';
				$row .= '"'.$user['auto_fail'].'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['answer_the_call'].'",';
				$row .= '"'.$user['reason_for_calling'].'",';
				$row .= '"'.$user['show_empathy'].'",';
				$row .= '"'.$user['how_help_customer'].'",';
				$row .= '"'.$user['hold_distraction'].'",';
				$row .= '"'.$user['hold_distraction_chk1'].'",';
				$row .= '"'.$user['hold_distraction_chk2'].'",';
				$row .= '"'.$user['hold_distraction_chk3'].'",';
				$row .= '"'.$user['demonstrate_active_listening'].'",';
				$row .= '"'.$user['thank_caller_choosing_Kabbage'].'",';
				$row .= '"'.$user['request_appropiate_document'].'",';
				$row .= '"'.$user['verify_information'].'",';
				$row .= '"'.$user['verify_information_chk1'].'",';
				$row .= '"'.$user['verify_information_chk2'].'",';
				$row .= '"'.$user['verify_information_chk3'].'",';
				$row .= '"'.$user['verify_information_chk4'].'",';
				$row .= '"'.$user['verify_information_chk5'].'",';
				$row .= '"'.$user['disclosing_account'].'",';
				$row .= '"'.$user['abide_legal_reruirement'].'",';
				$row .= '"'.$user['gave_correct_information'].'",';
				$row .= '"'.$user['documented_call'].'",';
				$row .= '"'.$user['documented_call_chk1'].'",';
				$row .= '"'.$user['documented_call_chk2'].'",';
				$row .= '"'.$user['documented_call_chk3'].'",';
				$row .= '"'.$user['documented_call_chk4'].'",';
				$row .= '"'.$user['documented_call_chk5'].'",';
				$row .= '"'.$user['documented_call_chk6'].'",';
				$row .= '"'.$user['documented_call_chk7'].'",';
				$row .= '"'.$user['necessary_single_contact'].'",';
				$row .= '"'.$user['ask_other_concern'].'",';
				$row .= '"'.$user['connect_overall'].'",';
				$row .= '"'.$user['resolve_overall'].'",';
				$row .= '"'.$user['madeeasy_overall'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_date'].'",';
				$row .= '"'.$user['client_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';	
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}
	}
	


///////////////////////////////////////////////////////////////////////////////////// 
///////////////////////////////// QA Jurys Inn REPORT ///////////////////////////////	
/////////////////////////////////////////////////////////////////////////////////////

	public function qa_jurys_inn_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_jurys_inn_report.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$lob="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			
			$data["qa_jurys_inn_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				$lob = $this->input->get('lob');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
				
				if($lob=="cis"){
					$qSql="SELECT * from
						(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
						(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
						(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
						(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
						(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_jurys_inn_feedback) xx Left Join
						(Select id as sid, fname, lname, fusion_id, assigned_to, office_id, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				}else if($lob=="email_cis"){
					$qSql="SELECT * from
						(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
						(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
						(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
						(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
						(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_jurysinn_email_feedback) xx Left Join
						(Select id as sid, fname, lname, fusion_id, assigned_to, office_id, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				}else if($lob=="me_cis"){
					$qSql="SELECT * from
						(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
						(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
						(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
						(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
						(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_jurysinn_me_cis_feedback) xx Left Join
						(Select id as sid, fname, lname, fusion_id, assigned_to, office_id, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				}else if($lob=="cis_contracts"){
					$qSql="SELECT * from
						(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
						(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
						(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
						(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
						(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_cis_contracts_feedback) xx Left Join
						(Select id as sid, fname, lname, fusion_id, assigned_to, office_id, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				}else if($lob=="cis_proposal"){
					$qSql="SELECT * from
						(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
						(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
						(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
						(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
						(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_cis_proposal_feedback) xx Left Join
						(Select id as sid, fname, lname, fusion_id, assigned_to, office_id, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				}
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_jurys_inn_list"] = $fullAray;

				if(in_array($lob,array("cis_contracts","cis_proposal"))){

					$header=$lob."Header";
					$header=$this->$header();

					$this->create_qa_process_new_CSV($fullAray,$header,$lob);		
					$dn_link = base_url()."reports_qa/download_qa_process_new_CSV/".$lob;
				}else{
					$this->create_qa_jurys_inn_CSV($fullAray,$lob);	
					$dn_link = base_url()."reports_qa/download_qa_jurys_inn_CSV/".$lob;	
				}

				
				
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['lob']=$lob;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_jurys_inn_CSV($lob)
	{
		if($lob=="cis"){
			$campaign="Reservation CIS";
		}else if($lob=="email_cis"){
			$campaign="Email Reservation CIS";
		}else if($lob=="me_cis"){
			$campaign="M&E CIS Reservation";
		}
		
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA ".$campaign." Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_jurys_inn_CSV($rr,$lob)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		if($lob=="cis"){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "Audit Type", "VOC", "Overall Score", "Earned Score", "Possible Score", "Pass Count", "Fail Count", "N/A Count", "Customer Score", "Business Score", "Compliance Score", "Did the agent Greet the Customer appropriately?", "Comment", "Did the agent offer his/her name?", "Comment", "Did the agent ascertain the customer name and use conversationally?", "Comment", "Did the agent ask an Open Question?", "Comment", "Did the agent utilise all resources available?", "Comment", "Did the agent determine if the call was for business?", "Comment", "Did the agent reconfirm to caller when the customer wants to stay?", "Comment", "Did the agent reconfirm to caller where the customer wants to stay?", "Comment", "Did the agent ask and reconfirm the number of rooms and guests?", "Comment", "Did the agent determine if the guest has stayed with us before?", "Comment", "Did the agent take relevant caller and profile information", "Comment", "Did the agent conform to GDPR requirements during the call?", "Comment", "Did the agent determine if the guest was a Jurys Rewards member?", "Comment", "Did the agent recommend the benefits of the Jurys Rewards programme?", "Comment", "Did the agent offer to enrol the guest on Jurys Rewards?", "Comment", "Did the agent upsell the room type and offer the benefits?", "Comment", "Did the agent offer Room Only and Bed & Breakfast?", "Comment", "Did the agent offer alternates positively", "Comment", "Did the agent present terms and conditions positively at the time of quoting?", "Comment", "Did the agent ask for the business?", "Comment", "Did the agent reconfirm all booking details?", "Comment", "Did the agent follow the correct SOP?", "Comment", "Did the agent offer to send a confirmation email?", "Comment", "Did the agent advise that directions and parking information?", "Comment", "Did the agent ask if there was anything else?", "Comment", "Did the agent avoid long silences during the call?", "Comment", "Did the agent display a professional manner throughout the call?", "Comment", "Did the agent pro-actively volunteer additional info throughout the call?", "Comment", "Did the agent sound clear and confident throughout the call?", "Comment", "Did the agent refrain from using jargon throughout the call?", "Comment", "Did the agent sound polite and welcoming?", "Comment", "Did the agent use effective questioning skills?", "Comment", "Did the agent demonstrate active listening?", "Comment", "Call Summary", "Feedback", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		}else if($lob=="email_cis"){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Reference ID", "Query Type", "Sub Query Type", "Assessment Type", "Transaction Status", "Audit Type", "VOC", "Overall Score", "Earned Score", "Possible Score", "Did the agent use an appropriate opening line at the beginning of the email?", "Did the agent use the guests name?", "Did the agent use the appropriate template? (If applicable)", "Was the email formatted correctly and consistently? (Same font and colour)", "Did the agent use their signature?", "Did the agent offer add on to maximise revenue? (Offer Breakfast and Superior Rooms)", "Did the agent close the email in a appropriate manner?", "Did the agent use all available information", "Did the agent reconfirm all details including terms and conditions?", "Did the agent state if there was anything else they could help the guest with?", "Did the agent offer any alternatives? (if applicable)", "Did the agent answer all the guests questions fully?", "Has the agent amended the subject line appropriately?", "Did the agent check if preferential rates were available? (If applicable)", "Did the agent send the email from the correct cluster?", "Call Summary", "Feedback", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		
		}else if($lob=="me_cis"){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Audit Type", "VOC", "Overall Score", "Earned Score", "Possible Score", "Did the agent Greet the Customer appropriately?", "Did the agent offer his/her name?", "Did the agent ascertain the customer name and use conversationally?", "Did the agent clarify if the caller is from a company or agency?", "Did the agent take down the callers contact details?", "Did the agent establish how the caller had heard of the hotel AND give an upbeat response?", "Did the agent adopt an open approach initially in order to establish the callers requirements?", "Did the agent establish the type purpose of the event?", "Did the agent confirm to the caller what location they are requesting?", "Did the agent confirm to caller dates days and times of the meeting?", "Were the following also clearly discussed?", "Did the agent determine if accommodation was required?", "Did the agent reconfirm delegate numbers & room layout?", "Did the agent determine if the company agency had a specific price range?", "Did the agent determine if the caller has been quoted by any competitors?", "Did the agent establish the most important factors in the choice of venue?", "Did the agent quote the rate without being prompted by the caller", "Were the key package features highlighted when the price was quoted?", "Did the agent offer to place the meeting space on hold?", "Did the agent offer alternates positively?", "Did the agent ask if there were any other meeting requests or if there was anything else?", "Did the agent close the call in an appropriate manner", "Did the agent reconfirm all booking details?", "Did the agent offer send a proposal via email?", "Did the agent avoid long silences during the call?", "Did the agent display a professional manner throughout the call?", "Did the agent sound clear and confident throughout the call?", "Did the agent sound friendly polite and welcoming?", "Did the agent use effective questioning skills?", "Did the agent demonstrate active listening?", "Did the agent ask the caller to complete the CCC Survey?", "Call Summary", "Feedback", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		
		}
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		if($lob=="cis"){
		
			foreach($rr as $user)
			{	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				$row = '"'.$auditorName.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['earned_score'].'",';
				$row .= '"'.$user['possible_score'].'",';
				$row .= '"'.$user['pass_count'].'",';
				$row .= '"'.$user['fail_count'].'",';
				$row .= '"'.$user['na_count'].'",';
				$row .= '"'.$user['customer_score'].'%'.'",';
				$row .= '"'.$user['business_score'].'%'.'",';
				$row .= '"'.$user['compliance_score'].'%'.'",';
				$row .= '"'.$user['greet_customer'].'",';
				$row .= '"'.$user['greet1_comm'].'",';
				$row .= '"'.$user['greet_name'].'",';
				$row .= '"'.$user['greet2_comm'].'",';
				$row .= '"'.$user['greet_conversation'].'",';
				$row .= '"'.$user['greet3_comm'].'",';
				$row .= '"'.$user['greet_question'].'",';
				$row .= '"'.$user['greet4_comm'].'",';
				$row .= '"'.$user['greet_utilise'].'",';
				$row .= '"'.$user['greet5_comm'].'",';
				$row .= '"'.$user['qualifi_determine'].'",';
				$row .= '"'.$user['qualifi1_comm'].'",';
				$row .= '"'.$user['qualifi_reconfirm'].'",';
				$row .= '"'.$user['qualifi2_comm'].'",';
				$row .= '"'.$user['qualifi_customer'].'",';
				$row .= '"'.$user['qualifi3_comm'].'",';
				$row .= '"'.$user['qualifi_guest'].'",';
				$row .= '"'.$user['qualifi4_comm'].'",';
				$row .= '"'.$user['recognise_agent'].'",';
				$row .= '"'.$user['recognise1_comm'].'",';
				$row .= '"'.$user['recognise_caller'].'",';
				$row .= '"'.$user['recognise2_comm'].'",';
				$row .= '"'.$user['recognise_gdpr'].'",';
				$row .= '"'.$user['recognise3_comm'].'",';
				$row .= '"'.$user['recomend_guest'].'",';
				$row .= '"'.$user['recomend1_comm'].'",';
				$row .= '"'.$user['recomend_benefit'].'",';
				$row .= '"'.$user['recomend2_comm'].'",';
				$row .= '"'.$user['recomend_offer'].'",';
				$row .= '"'.$user['recomend3_comm'].'",';
				$row .= '"'.$user['recomend_upsell'].'",';
				$row .= '"'.$user['recomend4_comm'].'",';
				$row .= '"'.$user['recomend_room'].'",';
				$row .= '"'.$user['recomend5_comm'].'",';
				$row .= '"'.$user['overcome_positive'].'",';
				$row .= '"'.$user['overcome1_comm'].'",';
				$row .= '"'.$user['overcome_terms'].'",';
				$row .= '"'.$user['overcome2_comm'].'",';
				$row .= '"'.$user['sale_business'].'",';
				$row .= '"'.$user['sale1_comm'].'",';
				$row .= '"'.$user['closure_booking'].'",';
				$row .= '"'.$user['closure1_comm'].'",';
				$row .= '"'.$user['follow_SOP'].'",';
				$row .= '"'.$user['closure5_comm'].'",';
				$row .= '"'.$user['closure_email'].'",';
				$row .= '"'.$user['closure2_comm'].'",';
				$row .= '"'.$user['closure_advise'].'",';
				$row .= '"'.$user['closure3_comm'].'",';
				$row .= '"'.$user['closure_ask'].'",';
				$row .= '"'.$user['closure4_comm'].'",';
				$row .= '"'.$user['ss_avoid'].'",';
				$row .= '"'.$user['ss1_comm'].'",';
				$row .= '"'.$user['ss_display'].'",';
				$row .= '"'.$user['ss2_comm'].'",';
				$row .= '"'.$user['ss_volunteer'].'",';
				$row .= '"'.$user['ss3_comm'].'",';
				$row .= '"'.$user['ss_sound'].'",';
				$row .= '"'.$user['ss4_comm'].'",';
				$row .= '"'.$user['ss_refrain'].'",';
				$row .= '"'.$user['ss5_comm'].'",';
				$row .= '"'.$user['ss_welcome'].'",';
				$row .= '"'.$user['ss6_comm'].'",';
				$row .= '"'.$user['ss_question'].'",';
				$row .= '"'.$user['ss7_comm'].'",';
				$row .= '"'.$user['ss_demonstrate'].'",';
				$row .= '"'.$user['ss8_comm'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_date'].'",';
				$row .= '"'.$user['client_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		
		}else if($lob=="email_cis"){
		
			foreach($rr as $user)
			{	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				$row = '"'.$user['auditor_name'].'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['ref_id'].'",';
				$row .= '"'.$user['query_type'].'",';
				$row .= '"'.$user['query_sub_type'].'",';
				$row .= '"'.$user['asmnt_type'].'",';
				$row .= '"'.$user['tran_status'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['earned_score'].'",';
				$row .= '"'.$user['possible_score'].'",';
				$row .= '"'.$user['agentuseopening'].'",';
				$row .= '"'.$user['agentuseguestname'].'",';
				$row .= '"'.$user['agentusetemplate'].'",';
				$row .= '"'.$user['emailformatedcorrectly'].'",';
				$row .= '"'.$user['agentusesignature'].'",';
				$row .= '"'.$user['agentofferrevenue'].'",';
				$row .= '"'.$user['agentcloseemail'].'",';
				$row .= '"'.$user['agentuseinformation'].'",';
				$row .= '"'.$user['agentreconfirmterms'].'",';
				$row .= '"'.$user['agentstateguesthelp'].'",';
				$row .= '"'.$user['agentofferalternative'].'",';
				$row .= '"'.$user['agentanswerguestquestion'].'",';
				$row .= '"'.$user['agentamendedsubjectline'].'",';
				$row .= '"'.$user['agentcheckprefererate'].'",';
				$row .= '"'.$user['agentsendemailcluster'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_date'].'",';
				$row .= '"'.$user['client_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';				
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		
		}else if($lob=="me_cis"){
		
			foreach($rr as $user)
			{	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				$row = '"'.$user['auditor_name'].'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['earned_score'].'",';
				$row .= '"'.$user['possible_score'].'",';
				$row .= '"'.$user['greetcustomerapprox'].'",';
				$row .= '"'.$user['agentoffername'].'",';
				$row .= '"'.$user['ascertaincustomername'].'",';
				$row .= '"'.$user['clarifycallerfromcompany'].'",';
				$row .= '"'.$user['takedowncallercontact'].'",';
				$row .= '"'.$user['callerheardthehotel'].'",';
				$row .= '"'.$user['adoptOpenapproach'].'",';
				$row .= '"'.$user['establishedEventType'].'",';
				$row .= '"'.$user['callerRequestLocation'].'",';
				$row .= '"'.$user['callerMeetingtimedate'].'",';
				$row .= '"'.$user['clearlydiscussAVCatering'].'",';
				$row .= '"'.$user['determineaccomodationrequired'].'",';
				$row .= '"'.$user['reconfirmdelegatenumber'].'",';
				$row .= '"'.$user['determineagencyspecificprice'].'",';
				$row .= '"'.$user['callerquotedcompetetion'].'",';
				$row .= '"'.$user['establishchoiceofVenue'].'",';
				$row .= '"'.$user['promptedbythecaller'].'",';
				$row .= '"'.$user['keypackagefeatures'].'",';
				$row .= '"'.$user['offertoplacemeeting'].'",';
				$row .= '"'.$user['offeralternatepositively'].'",';
				$row .= '"'.$user['agentaskmeetingrequest'].'",';
				$row .= '"'.$user['agentclosetheCall'].'",';
				$row .= '"'.$user['reconfirmallbookingdetails'].'",';
				$row .= '"'.$user['offersendproposalviaEmail'].'",';
				$row .= '"'.$user['avoidsilencesduringCall'].'",';
				$row .= '"'.$user['displayprofessionalcall'].'",';
				$row .= '"'.$user['soundclearthroughCall'].'",';
				$row .= '"'.$user['soundFriendlyPoliteWelcome'].'",';
				$row .= '"'.$user['useeffectivequestionSkills'].'",';
				$row .= '"'.$user['demonstrateactivelistening'].'",';
				$row .= '"'.$user['callercompleteCCCSurvey'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_date'].'",';
				$row .= '"'.$user['client_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';				
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		
		}
		
	}

///////////////////////////////////////////////////////////////////////////////////////////
///////////////////////////////////// QA Indiabulls REPORT ////////////////////////////////	
///////////////////////////////////////////////////////////////////////////////////////////

	public function qa_indiabulls_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_indiabulls_report.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			
			$data["qa_indiabulls_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
		
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_indiabulls_feedback) xx Left Join
				(Select id as sid, fname, lname, fusion_id, assigned_to, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_indiabulls_list"] = $fullAray;
				$this->create_qa_indiabulls_CSV($fullAray);	
				$dn_link = base_url()."reports_qa/download_qa_indiabulls_CSV";
				
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_indiabulls_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Indiabulls Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_indiabulls_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Call Date/Time", "Call Duration", "Outgoing Number", "Campaign", "Register No", "Call Link", "Agent Tagging", "Actual Tagging", "Type Of Call", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "IB_Disposition", "IB_Sub-Disposition", "Greeting", "Closing", "Coprehending", "Customer Ownership For Payment", "Hold", "Behavior", "Language", "Proactive Information", "Disposition", "Overall Score", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review By", "Mgnt Review Date", "Mgnt Comment", "Client Reviw By", "Client Reviw Date", "Client Reviw Note");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['call_duration'].'",';
			$row .= '"'.$user['outgoing_no'].'",';
			$row .= '"'.$user['campaign'].'",';
			$row .= '"'.$user['register_no'].'",';
			$row .= '"'.$user['call_link'].'",';
			$row .= '"'.$user['agent_tagging'].'",';
			$row .= '"'.$user['actual_tagging'].'",';
			$row .= '"'.$user['call_type'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['ib_dispo'].'",';
			$row .= '"'.$user['ib_subdispo'].'",';
			$row .= '"'.$user['greeting'].'",';
			$row .= '"'.$user['closing'].'",';
			$row .= '"'.$user['coprehending'].'",';
			$row .= '"'.$user['ownership'].'",';
			$row .= '"'.$user['hold'].'",';
			$row .= '"'.$user['behaviour'].'",';
			$row .= '"'.$user['language'].'",';
			$row .= '"'.$user['proactive'].'",';
			$row .= '"'.$user['disposition'].'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_name'].'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
			$row .= '"'.$user['client_rvw_name'].'",';
			$row .= '"'.$user['client_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';			
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}


///////////////////////////////////////////////////////////////////////////////////// 
///////////////////////////////// QA IDFC REPORT ////////////////////////////////////	
/////////////////////////////////////////////////////////////////////////////////////

	public function qa_idfc_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_idfc_report.php";
			$data["content_js"] = "qa_metropolis_js.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$campaign="";
			$audit_type="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			
			$data["qa_idfc_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				$campaign = $this->input->get('campaign');
				$audit_type = $this->input->get('audit_type');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if($audit_type=="All") $cond .= "";
				else $cond .=" and audit_type='$audit_type'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else if(get_login_type()=="client"){
					$cond1 .=" And audit_type not in ('Operation Audit','Trainer Audit')";
				}else{
					$cond1 .="";
				}
		
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_".$campaign."_feedback) xx Left Join
				(Select id as sid, fname, lname, fusion_id, office_id, assigned_to, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_idfc_list"] = $fullAray;
				$this->create_qa_idfc_CSV($fullAray,$campaign);	
				$dn_link = base_url()."reports_qa/download_qa_idfc_CSV";	
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['campaign']=$campaign;
			$data['audit_type']=$audit_type;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_idfc_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA IDFC Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_idfc_CSV($rr,$campaign)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		if($campaign=='idfc'){
			$header = array("Auditor Name", "Audit Date", "Agent", "Fusion ID", "L1 Super", "Call Date Time", "Week", "Cycle Date", "Phone", "Customer Name", "Disposition", "Call Duration", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Agent opened the call with the desired enthusiasm in 3 seconds", "Agent clearly introduced himself/herself to the customer", "Agent introduced the company he/she is calling from", "Agent used the prescribed script as per previous disposition", "Agent clearly explained the objective of calling the customer", "Agent quoted the previous call commitment made my the customer", "Agent reminds and gets agreement of a customer on number of broken PTP or Already Paid as applicable", "Agent created the urgency in the call to collect the payment", "Agent reiterated the impact due to delay in payment like cibil adhar etc", "Agent gave appropriate and effective rebuttal when the payment was delayed or being differed", "Agent promoted paid C modes to the customer", "Agent did the right probing to gather information from the customer in case of already paid", "Agent checked relevent tools notes details and historry before call back", "Third party disclosure", "Agent updated correct time for call back customer details updated accurately in COSMOS and VICI dial", "Agent used verbal nods to display interest in customers avoids dead-air", "Agent avoided speaking over or interrupt the customer and apologized if interrupted", "Agent acknowledged and/or empathized where appropriate", "Agent sounded confident and showed no sign of hesitancy to convey information", "Clear Explanations - Articulation sentence construction grammar etc", "Agents rate of speech was moderate", "Agent sounded courteous and energetic", "Listening and comprehension", "Agent did not provide/ confirm Incorrect/ incomplete information", "Agent did not follow Incorrect procedure followed to resolve an issue raised by the customer or made No promise", "Agent responded on question or query raised by the customer", "Agent followed the correct Hold procedure", "Agent followed the correct transfer procedure", "Agent did not Disconnect call before the customer or hung up on customer", "Agent was not abusive during the call", "Agent was not side-talking or speaking to another colleague while customer on line", "Agent complied to the call closure script", "Agents tone was appropriate while closing the call", "Follow-up call and appointment fixed as agreed with the customer", "Greeting Score", "Purpose Call Score", "Collection Technique Score", "Communicatio Skill Score", "Telephone Etiquette Score", "Call Closing Score", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		}else if($campaign=='idfc_new'){
			$header = array("Auditor Name", "Audit Date", "Agent", "Fusion ID", "L1 Super", "Call Date Time", "Week", "Cycle Date", "Phone", "Customer Name", "Disposition", "Call Duration", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Greeting & Customer Identification", "Self Introduction & Reaching RPC", "Purpose of call", "Complete & Correct information Minor Impact", "** Incomplete or Incorrect information", "** Incomplete or Wrong Information", "Confirmed PU and PTP details", "Referred the Trail remarks in CRM", "Referred customers Payment history", "** Use convincing skills for early payment", "Follow appropriate and relevant probing as per the process", "Identify accurate reasons of payment delay", "Objection Handing", "Online payment effectively pitched", "Active Listening", "Clarity of Speech & Rate of Speech", "Tone and Voice Modulation", "Empathy", "Confidence", "Language and Grammar", "Telephone Etiquettes & Hold Procedure", "** Rudeness or Unprofessionalism", "CRM protocol", "Capture Alternate number", "CRM protocol - Field and Remark Updation", "CRM protocol - Disposition", "Summarization", "Strong assurance on PU PTP", "Closing", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		}
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		if($campaign=='idfc'){
		
			foreach($rr as $user){	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$auditorName.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['fusion_id'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date_time'].'",';
				$row .= '"'.$user['week'].'",';
				$row .= '"'.$user['cycle_date'].'",';
				$row .= '"'.$user['phone'].'",';
				$row .= '"'.$user['customer_name'].'",';
				$row .= '"'.$user['disposition'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['agentopencallin3sec'].'",';
				$row .= '"'.$user['agentintroducehimself'].'",';
				$row .= '"'.$user['agentintroducecompany'].'",';
				$row .= '"'.$user['agentusedprescribedscript'].'",';
				$row .= '"'.$user['agentclearlyexplained'].'",';
				$row .= '"'.$user['agentquotedpreviouscall'].'",';
				$row .= '"'.$user['agentgetsagreement'].'",';
				$row .= '"'.$user['agentcreateurjency'].'",';
				$row .= '"'.$user['agentreiteratedtheimpact'].'",';
				$row .= '"'.$user['agentgaveeffectiverebruttal'].'",';
				$row .= '"'.$user['agentpromotedpaidC'].'",';
				$row .= '"'.$user['agentdidrightprobing'].'",';
				$row .= '"'.$user['agentcheckrelevanttool'].'",';
				$row .= '"'.$user['3rdpartydisclosure'].'",';
				$row .= '"'.$user['agentupdatedcalltime'].'",';
				$row .= '"'.$user['agentusedverbalnods'].'",';
				$row .= '"'.$user['agentavoidspeakingover'].'",';
				$row .= '"'.$user['agentemphathizedappropiate'].'",';
				$row .= '"'.$user['agentsoundedconfident'].'",';
				$row .= '"'.$user['clearexpansion'].'",';
				$row .= '"'.$user['agentrateofspeech'].'",';
				$row .= '"'.$user['agentsoundedenergetic'].'",';
				$row .= '"'.$user['listeningandcomprehensive'].'",';
				$row .= '"'.$user['agentnotprovideinfo'].'",';
				$row .= '"'.$user['agentnotfollowincorrectprocedure'].'",';
				$row .= '"'.$user['agentresponceonquestion'].'",';
				$row .= '"'.$user['agentfollowHoldprocedure'].'",';
				$row .= '"'.$user['agentfollowtransferprocedure'].'",';
				$row .= '"'.$user['agentnotDisconnectcall'].'",';
				$row .= '"'.$user['agentwasnotabuseonCall'].'",';
				$row .= '"'.$user['agentnotSitetakingonCall'].'",';
				$row .= '"'.$user['agentcompiledoncall'].'",';
				$row .= '"'.$user['agenttoneappropiateonCall'].'",';
				$row .= '"'.$user['followupcallwiththeCustomer'].'",';
				$row .= '"'.$user['greetingscore'].'",';
				$row .= '"'.$user['purposecallscore'].'",';
				$row .= '"'.$user['collectiontechniquescore'].'",';
				$row .= '"'.$user['communicatioskillscore'].'",';
				$row .= '"'.$user['telephoneetiquettescore'].'",';
				$row .= '"'.$user['callclosingscore'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_date'].'",';
				$row .= '"'.$user['client_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		
		}else if($campaign=='idfc_new'){
		
			foreach($rr as $user){	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$auditorName.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['fusion_id'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['week'].'",';
				$row .= '"'.$user['cycle_date'].'",';
				$row .= '"'.$user['phone'].'",';
				$row .= '"'.$user['customer_name'].'",';
				$row .= '"'.$user['disposition'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['greeting'].'",';
				$row .= '"'.$user['self_introduction'].'",';
				$row .= '"'.$user['call_purpose'].'",';
				$row .= '"'.$user['correct_information'].'",';
				$row .= '"'.$user['incomplete_information'].'",';
				$row .= '"'.$user['wrong_information'].'",';
				$row .= '"'.$user['PU_PTP_details'].'",';
				$row .= '"'.$user['remarks_in_CRM'].'",';
				$row .= '"'.$user['referred_customer_payment'].'",';
				$row .= '"'.$user['use_convincing_skill'].'",';
				$row .= '"'.$user['appropriate_probing'].'",';
				$row .= '"'.$user['accurate_reason_payment'].'",';
				$row .= '"'.$user['customer_rebuttal'].'",';
				$row .= '"'.$user['online_payment_pitched'].'",';
				$row .= '"'.$user['active_listening'].'",';
				$row .= '"'.$user['speech_clarity'].'",';
				$row .= '"'.$user['tone_voice_modulation'].'",';
				$row .= '"'.$user['empathy'].'",';
				$row .= '"'.$user['confidence'].'",';
				$row .= '"'.$user['grammer_language'].'",';
				$row .= '"'.$user['hold_procedure'].'",';
				$row .= '"'.$user['call_disconnection'].'",';
				$row .= '"'.$user['CRM_protocol'].'",';
				$row .= '"'.$user['capture_alternate_number'].'",';
				$row .= '"'.$user['CRM_protocol_field'].'",';
				$row .= '"'.$user['CRM_protocol_disposition'].'",';
				$row .= '"'.$user['summarization'].'",';
				$row .= '"'.$user['PU_PTP_strong_assurance'].'",';
				$row .= '"'.$user['closing'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_date'].'",';
				$row .= '"'.$user['client_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}
		
	
	}



///////////////////////////////////////////////////////////////////////////////////// 
/////////////////////////////// QA Ideal Living REPORT //////////////////////////////	
/////////////////////////////////////////////////////////////////////////////////////

	public function qa_il_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_il_report.php";
			$data["content_js"] = "qa_metropolis_js.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$process="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			$process = $this->input->get('process');
			
			$data["qa_il_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
				
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
				if($process == 'verification'){
					$table = 'qa_il_sales_'.$process.'_feedback';
				}else if($process == 'mercy'){
					$table = 'qa_'.$process.'_feedback';
				}else{
					$table = 'qa_ideal_living_'.$process.'_feedback';
				}
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from $table) xx Left Join
				(Select id as sid, fname, lname, fusion_id, office_id, assigned_to, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				


				// $qSql="SELECT * from
				// (Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				// (select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				// (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				// (select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				// (select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_ideal_living_".$process."_feedback) xx Left Join
				// (Select id as sid, fname, lname, fusion_id, office_id, assigned_to, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_il_list"] = $fullAray;
				$this->create_qa_il_CSV($fullAray,$process);	
				$dn_link = base_url()."reports_qa/download_qa_il_CSV/".$process;
				
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['process']=$process;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_il_CSV($process)
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA ".$process." Audit List-'".$currDate."'.csv";
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_il_CSV($rr,$process)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		if($process=='sales'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "TL", "Call Date", "Call Duration", "Call Type", "Product", "QA Type", "Disposition", "Recording ID", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Greeting", "Probing Question", "Product Benefit", "Rapport Empathy", "Product Knowledge", "Speed Clarity", "Professional ethics Emotional Intelligence", "Enthusiasm Passion About Selling", "Acknowledge", "Build Value", "Close the Sale", "Closing the Sales", "Rebuttals", "Main Offers Compliance", "Upsells Compliance", "Main D Prepays Compliance", "Third party separation Compliance", "Legal Terms Confirmation Compliance", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		}else if($process=='cs'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "TL", "Call Date", "Call Duration", "Product", "QA Type", "Disposition", "Recording ID", "Order/Acct Number", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Greeting", "Professionalism", "Empathy", "Closure", "Problem Solving Skills", "Solve Problem", "Save the sale", "Enthusiasm Passion About Selling", "New Order Warranty replacement", "Return instructions Refunds", "Acccount verification", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		}else if($process == 'verification'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "TL", "Call Date", "Call Duration", "Product", "Disposition", "Recorded Id",  "Wrong Disposition", "Correct Disposition" , "Audit Type", "QA Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Greeting", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		}else if($process=='mercy'){
			$header = Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","Call Duration","Call Type","Audit Type ","Auditor Type ","VOC ","Disposition ","CDRID ","Agent Assessment Request History as Requested by Client or AMD ","Overall Score ","Possible Score ","Earned Score ","Greeting / Closing ","Smile / Enthusiasm ","Info Capture / Verification ","Accuracy of Data Entry in ACDD CRM & Qgiv Payment Processing Page ","Acknowledgement or Empathy ","Appreciation (Donor Services Desire to Volunteer Etc.) ","Tone / Pace ","Positive Phrasing ","Script Adherence ","Active Listening ","Proper Use of Navigational Tools / Help Buttons / FAQs ","Disposition of Call ","Redirect/Rebuttals ","Agent Engagement ","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","Comments 8 ","Comments 9 ","Comments 10 ","Comments 11 ","Comments 12 ","Comments 13 ","Comments 14 ","Call Summary ","Feedback ","Entry By ","Entry Date ","Audit Start Time ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date" );
		}
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		if($process=='sales'){
			foreach($rr as $user){	
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['call_type'].'",';
				$row .= '"'.$user['product'].'",';
				$row .= '"'.$user['qa_type'].'",';
				$row .= '"'.$user['disposition'].'",';
				$row .= '"'.$user['recording_id'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['greeting'].'",';
				$row .= '"'.$user['probing_question'].'",';
				$row .= '"'.$user['product_benefit'].'",';
				$row .= '"'.$user['rapport'].'",';
				$row .= '"'.$user['product_knowledge'].'",';
				$row .= '"'.$user['speed_clarity'].'",';
				$row .= '"'.$user['professional_ethics'].'",';
				$row .= '"'.$user['passion_selling'].'",';
				$row .= '"'.$user['acknowledge'].'",';
				$row .= '"'.$user['build_value'].'",';
				$row .= '"'.$user['sale_close'].'",';
				$row .= '"'.$user['close_the_sale'].'",';
				$row .= '"'.$user['rebuttals'].'",';
				$row .= '"'.$user['main_offers'].'",';
				$row .= '"'.$user['upsell_compliance'].'",';
				$row .= '"'.$user['prepays_compliance'].'",';
				$row .= '"'.$user['third_party_separation'].'",';
				$row .= '"'.$user['legal_terms'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}else if($process=='cs'){
			
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['product'].'",';
				$row .= '"'.$user['qa_type'].'",';
				$row .= '"'.$user['disposition'].'",';
				$row .= '"'.$user['recording_id'].'",';
				$row .= '"'.$user['order_accnt'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['greeting'].'",';
				$row .= '"'.$user['professionalism'].'",';
				$row .= '"'.$user['empathy'].'",';
				$row .= '"'.$user['closure'].'",';
				$row .= '"'.$user['problem_solving_skill'].'",';
				$row .= '"'.$user['solve_problem'].'",';
				$row .= '"'.$user['save_the_sale'].'",';
				$row .= '"'.$user['new_order'].'",';
				$row .= '"'.$user['return_instruction'].'",';
				$row .= '"'.$user['account_verification'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		}else if($process == 'verification'){
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['product'].'",';
				// $row .= '"'.$user['qa_type'].'",';
				$row .= '"'.$user['disposition'].'",';
				$row .= '"'.$user['recorded_id'].'",';
				$row .= '"'.$user['wrong_disposition'].'",';
				$row .= '"'.$user['correct_disposition'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['auditor_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['greeting'].'",';
				// $row .= '"'.$user['professionalism'].'",';
				// $row .= '"'.$user['empathy'].'",';
				// $row .= '"'.$user['closure'].'",';
				// $row .= '"'.$user['problem_solving_skill'].'",';
				// $row .= '"'.$user['solve_problem'].'",';
				// $row .= '"'.$user['save_the_sale'].'",';
				// $row .= '"'.$user['new_order'].'",';
				// $row .= '"'.$user['return_instruction'].'",';
				// $row .= '"'.$user['account_verification'].'",';
				// $row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				// $row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		}else if($process == 'mercy'){
				
				$field_name="SHOW FULL COLUMNS FROM qa_".$process."_feedback WHERE Comment!=''";
				$field_name=$this->Common_model->get_query_result_array($field_name);
				$fld_cnt=count($field_name);
				for($i=0;$i<$fld_cnt;$i++){
								$val=$field_name[$i]['Field'];
								if($val!=""){
									$field_val[]=$val;
								}		
							 }
				
				array_unshift($field_val ,"auditor_name");
				$key = array_search ('agent_id', $field_val);
				array_splice($field_val, $key, 0, 'fusion_id');
				$field_val=array_values($field_val);

				$count_for_field=count($field_val);

				// print_r($rr);
				// die;
				foreach($rr as $user)
				{	
					for($z=0;$z<$count_for_field;$z++){
						
						if($field_val[$z]==="auditor_name"){
							$row = '"'.$user['auditor_name'].'",';
						}elseif($field_val[$z]==="fusion_id"){
							$row .= '"'.$user['fusion_id'].'",';
						}elseif($field_val[$z]==="agent_id"){
							$row .= '"'.$user['fname']." ".$user['lname'].'",';
						}elseif($field_val[$z]==="tl_id"){
							$row .= '"'.$user['tl_name'].'",';	
						}elseif(in_array($field_val[$z], array('call_summary','feedback','agent_rvw_note','mgnt_rvw_note'))) {
		    			
		    			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user[$field_val[$z]])).'",';

						}else{
							$row .= '"'.$user[$field_val[$z]].'",';	
						}
						
					}
						
						fwrite($fopen,$row."\r\n");
						$row = "";
				}
				
				fclose($fopen);
		}
		
	}


//////////////////////////////////////////////////////////////////////////////////////////	 
////////////////////////////////// QA IBUUMERANG REPORT //////////////////////////////////	
//////////////////////////////////////////////////////////////////////////////////////////
	public function qa_ibuumerang_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["download_link1"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_ibuumerang_report.php";
			$data["content_js"] = "qa_ibuumerang_js.php";
						
			$date_from="";
			$date_to="";
			$office_id="";
			$campaign="";
			$action="";
			$dn_link="";
			$dn_link1="";
			$cond1='';
			
			$campaign = $this->input->get('campaign');
			
			$data["qa_ibuumerang_list"] = array();
			
			if(get_role_dir()=="super" || $is_global_access==1){
				$data['location_list'] = $this->Common_model->get_office_location_list();
			}else{
				$data['location_list'] = $this->Common_model->get_office_location_session_all($current_user);
			}
			
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond1= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
				if($office_id != "") $cond1 .= " and office_id='$office_id'";
				
				if($campaign=='ibmn_old'){
					$qSql="SELECT * from (Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, (select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name from qa_ibuumerang_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, get_process_names(id) as campaign, DATEDIFF(CURDATE(), doj) as tenure, assigned_to from signin) yy on (xx.agent_id=yy.sid) $cond1 order by audit_date";
					$fullAray = $this->Common_model->get_query_result_array($qSql);
					$data["qa_ibuumerang_list"] = $fullAray;
					$this->create_qa_ibuumerang_new_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_ibuumerang_new_CSV";
				}else if($campaign=='ibmn'){
					$qSql="SELECT * from 
					(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, 
					(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, 
					(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
					(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_rvw_by) as client_rvw_name from qa_ibuumerang_new_feedback) xx Left Join 
					(Select id as sid, fname, lname, fusion_id, office_id, get_process_names(id) as campaign, DATEDIFF(CURDATE(), doj) as tenure, assigned_to from signin) yy on (xx.agent_id=yy.sid) $cond1 order by audit_date";
					$fullAray = $this->Common_model->get_query_result_array($qSql);
					$data["qa_ibuumerang_list"] = $fullAray;
					$this->create_qa_ibmn_new_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_ibmn_new_CSV";
				}
			}
			
			$data['download_link']=$dn_link;
			$data['download_link1']=$dn_link1;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id'] = $office_id;	
			$data['campaign'] = $campaign;	
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_ibuumerang_new_CSV(){
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Ibuumerang New Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function ibmn_headerDetails(){
		return $arrayName = array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Id","Call Date","Call Duration","Audit Type","Auditor Type","VOC","Call Type","Overall Score","Used First Name in Opening","Thank Customer for Contacting","Took Ownership & Assured Resolution","Restated the Customer's Issue demonstrating complete understanding of TSA request","Provided Step-by-Step Resolution","Resolution Provided is Best Resolution","Uses 'Please and Thank You' in response","If follow up needed set appropriate customer expectations","Took Ownership of Ticket and provided First Contact Resolution","Apologized when necessary","Used appropriate verbiage","Correct grammar use","Reviewed Next Steps","Used Correct Closing","Did representative read the complete TSA request?","Did representative checked all details before answer?","Did representative leave clear internal notes?","Did representative leave IT escalations clear notes?","Did representative check updates?","Did representative use excellent grammar in reply?","Did representative mark tickets as resolved/closed incorrectly?","Did representative respond with canned response that does not answer/address questions?","Did representative get clarity from ticket/question from before responding?","Profanity","Dishonesty","Incorrect information in ticket response","Not following updates and instructions","Incomplete answers to questions","Not using First name to reply back","Entering tickets unnecessarily","Changing/Deleting information without authority or justification","Ticket productivity by time of audit","Inbox checked and clear","Comments 1","Comments 2","Comments 3","Comments 4","Comments 5","Comments 6","Comments 7","Comments 8","Comments 9","Comments 101","Comments 11","Comments 12","Comments 13","Comments 14","Comments 15","Comments 16","Comments 17","Comments 18","Comments 19","Comments 20","Comments 21","Comments 22","Comments 23","Comments 24","Comments 25","Comments 26","Comments 27","Comments 28","Comments 29","Comments 30","Comments 31","Comments 32","Comments 33","Call Summary","Feedback","Entry By","Entry Date","Client entry by","Mgnt review by","Mgnt review note","Mgnt review date","Agent review note","Agent review date","Client review by","Client review note","Client_rvw_date");
	}

	public function create_qa_ibuumerang_new_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");		
		$header=$this->ibmn_headerDetails();
		$field_name="SHOW FULL COLUMNS FROM qa_ibuumerang_feedback WHERE Comment!=''";
		$field_name=$this->Common_model->get_query_result_array($field_name);
		$fld_cnt=count($field_name);
		for($i=0;$i<$fld_cnt;$i++){
						$val=$field_name[$i]['Field'];
						if($val!=""){
							$field_val[]=$val;
						}		
					 }
		
		array_unshift($field_val ,"auditor_name");
		$key = array_search ('agent_id', $field_val);
		array_splice($field_val, $key, 0, 'fusion_id');
		$field_val=array_values($field_val);

		$count_for_field=count($field_val);

		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		$row = "";
		// print_r($rr);
		// die;
		foreach($rr as $user)
		{	
			for($z=0;$z<$count_for_field;$z++){
				
				if($field_val[$z]==="auditor_name"){
					$row = '"'.$user['auditor_name'].'",';
				}elseif($field_val[$z]==="fusion_id"){
					$row .= '"'.$user['fusion_id'].'",';
				}elseif($field_val[$z]==="agent_id"){
					$row .= '"'.$user['fname']." ".$user['lname'].'",';
				}elseif($field_val[$z]==="tl_id"){
					$row .= '"'.$user['tl_name'].'",';	
				}elseif(in_array($field_val[$z], array('call_summary','feedback','agent_rvw_note','mgnt_rvw_note'))) {
    			
    			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user[$field_val[$z]])).'",';

				}else{
					$row .= '"'.$user[$field_val[$z]].'",';	
				}
				
			}
				
				fwrite($fopen,$row."\r\n");
				$row = "";
		}
		
		fclose($fopen);
	}
	
//////////////////////////////////////////////
	public function download_qa_ibmn_new_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Ibuumerang Audit List-'".$currDate."'.csv";
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_ibmn_new_CSV($rr)
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		$header = array("Auditor Name", "Audit Date", "Agent", "Fusion ID", "L1 Super", "Call Date", "Call Type", "Call ID", "Contact Duration", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Earned Score", "Possible Score", "Used First Name in Opening", "Thank Customer for Contacting", "Took Ownership & Provided Best Resolution", "Uses Please and Thank You in response", "Apologized when necessary & Communicated with empathy", "Did representative get clarity from ticket/question from before responding?", "Provided Step-by-Step Resolution", "Used appropriate verbiage & Communicated clearly and professionaly", "Used proper spelling and grammar", "Did representative give a follow up ?", "Used Correct Closing", "Did representative respond with canned response that answer/address all questions?", "Did representative leave clear internal notes?", "Did representative fill out properties & use the correct status of the ticket?", "Profanity", "Dishonesty", "Incorrect information in ticket response", "Not following updates and instructions", "Incomplete answers to questions", "Not using First name to reply back", "Changing/Deleting information without authority or justification", "Not removing watermark in email", "GREETING Comment 1", "GREETING Comment 2", "GREETING Comment 3", "SOFT SKILL Comment 1", "SOFT SKILL Comment 2", "SOFT SKILL Comment 3", "SOFT SKILL Comment 4", "SOFT SKILL Comment 5", "SOFT SKILL Comment 6", "SOFT SKILL Comment 7", "EMAIL Comment 1", "EMAIL Comment 2", "BACKOFFICE Comment 1", "BACKOFFICE Comment 2", "AUTOFAILS Comment 1", "AUTOFAILS Comment 2", "AUTOFAILS Comment 3", "AUTOFAILS Comment 4", "AUTOFAILS Comment 5", "AUTOFAILS Comment 6", "AUTOFAILS Comment 7", "AUTOFAILS Comment 8", "Call Summary", "Feedback", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user){	
			if($user['entry_by']!=''){
				$auditorName = $user['auditor_name'];
			}else{
				$auditorName = $user['client_name'];
			}
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$auditorName.'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['fusion_id'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['call_type'].'",';
			$row .= '"'.$user['call_id'].'",';
			$row .= '"'.$user['call_duration'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'.$user['earned_score'].'",';
			$row .= '"'.$user['possible_score'].'",';
			$row .= '"'.$user['use_opening_first_name'].'",';
			$row .= '"'.$user['thank_contacting_customer'].'",';
			$row .= '"'.$user['took_ownership_resolution'].'",';
			$row .= '"'.$user['use_please_thankyou'].'",';
			$row .= '"'.$user['necessary_apology'].'",';
			$row .= '"'.$user['representative_get_clarity'].'",';
			$row .= '"'.$user['step_by_step_resolution'].'",';
			$row .= '"'.$user['use_appropiate_veriage'].'",';
			$row .= '"'.$user['use_proper_spelling'].'",';
			$row .= '"'.$user['representative_give_followup'].'",';
			$row .= '"'.$user['use_correct_closing'].'",';
			$row .= '"'.$user['representative_responce_question'].'",';
			$row .= '"'.$user['representative_leave_notes'].'",';
			$row .= '"'.$user['representative_fillout_property'].'",';
			$row .= '"'.$user['profanity'].'",';
			$row .= '"'.$user['dishonesty'].'",';
			$row .= '"'.$user['incorrect_information'].'",';
			$row .= '"'.$user['not_following_update'].'",';
			$row .= '"'.$user['incomplete_answer'].'",';
			$row .= '"'.$user['not_use_first_name'].'",';
			$row .= '"'.$user['change_delete_information'].'",';
			$row .= '"'.$user['removing_email_watermark'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt16'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt17'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt18'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt19'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt20'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt21'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt22'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agnt_fd_acpt'].'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
			$row .= '"'.$user['client_rvw_date'].'",';
			$row .= '"'.$user['client_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
			
			fwrite($fopen,$row."\r\n");
		}
		fclose($fopen);
		
	
	}

///////////////////////////////////////////////////////////////////////////////////////////	 
// ////////////////////////////////////// QA HRA REPORT //////////////////////////////////////	
// ///////////////////////////////////////////////////////////////////////////////////////////
	public function qa_hra_report(){

		if(check_logged_in()){
			
			$office_id = "";
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["download_link1"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_amd_episource_report.php";
						
			$date_from="";
			$date_to="";
			$office_id="";
			$action="";
			$dn_link="";
			$dn_link1="";
			$cond1='';
			
			$data["qa_hra_list"] = array();
			
			if(get_role_dir()=="super" || $is_global_access==1){
				$data['location_list'] = $this->Common_model->get_office_location_list();
			}else{
				$data['location_list'] = $this->Common_model->get_office_location_session_all($current_user);
			}
			
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond1= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
				if($office_id != "") $cond1 .= " and office_id='$office_id'";
				
					$qSql="SELECT * from (Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, (select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name from qa_amd_episource_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, get_process_names(id) as campaign, DATEDIFF(CURDATE(), doj) as tenure, assigned_to from signin) yy on (xx.agent_id=yy.sid) $cond1 order by audit_date";
					$fullAray = $this->Common_model->get_query_result_array($qSql);
					$data["qa_hra_list"] = $fullAray;
					$header_arr=$this->Common_model->get_query_result_array("SELECT column_comment FROM information_schema.COLUMNS WHERE table_name = 'qa_amd_episource_feedback'");
					$cnt=count($header_arr);

					 for($i=0;$i<$cnt;$i++){
						$val=$this->getval($header_arr[$i],'column_comment');
						if($val!=""){
							$header[]=$val;
						}		
					 }
					array_unshift($header ,"Auditor Name");
					$key = array_search ('Agent', $header);
					array_splice($header, $key, 0, 'Fusion Id');
					// print_r($header);
					// die;
					$this->create_qa_hra_new_CSV($header,$fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_hra_new_CSV";
			}
			
			$data['download_link']=$dn_link;
			$data['download_link1']=$dn_link1;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id'] = $office_id;	
			
			$this->load->view('dashboard',$data);
		}
	}	
	 
		
// /////////////////// HRA NEW /////////////////////
	public function download_qa_hra_new_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA HRA New Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_hra_new_CSV($header,$rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");		
		
		$field_name="SHOW FULL COLUMNS FROM qa_amd_episource_feedback WHERE Comment!=''";
		$field_name=$this->Common_model->get_query_result_array($field_name);
		$fld_cnt=count($field_name);
		for($i=0;$i<$fld_cnt;$i++){
						$val=$field_name[$i]['Field'];
						if($val!=""){
							$field_val[]=$val;
						}		
					 }
		
		array_unshift($field_val ,"auditor_name");
		$key = array_search ('agent_id', $field_val);
		array_splice($field_val, $key, 0, 'fusion_id');
		$field_val=array_values($field_val);

		$count_for_field=count($field_val);

		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		$row = "";
		// print_r($rr);
		// die;
		foreach($rr as $user)
		{	
			for($z=0;$z<$count_for_field;$z++){
				
				if($field_val[$z]==="auditor_name"){
					$row = '"'.$user['auditor_name'].'",';
				}elseif($field_val[$z]==="fusion_id"){
					$row .= '"'.$user['fusion_id'].'",';
				}elseif($field_val[$z]==="agent_id"){
					$row .= '"'.$user['fname']." ".$user['lname'].'",';
				}elseif($field_val[$z]==="tl_id"){
					$row .= '"'.$user['tl_name'].'",';	
				}elseif(in_array($field_val[$z], array('call_summary','feedback','agent_rvw_note','mgnt_rvw_note'))) {
    			
    			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user[$field_val[$z]])).'",';

				}else{
					$row .= '"'.$user[$field_val[$z]].'",';	
				}
				
			}
				
				fwrite($fopen,$row."\r\n");
				$row = "";
		}
		
		fclose($fopen);
	}


		public function qa_homeadvisor_report(){
		if(check_logged_in()){
			
			$office_id = "";
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			
			/* $office_id = $this->input->get('office_id');
			if($office_id=="")  $office_id=$user_office_id; */
			
			
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_homeadvisor_report.php";
			
			
			$date_from="";
			$date_to="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			$cond2="";
			
			$pValue = trim($this->input->post('process_id'));
			if($pValue=="") $pValue = trim($this->input->get('process_id'));
			$data['pValue']=$pValue;
			
			$data["qa_homeadvisor_list"] = array();
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$date_from = $this->input->get('date_from');
			$date_to = $this->input->get('date_to');
			
			if($date_from==""){ 
				$date_from=CurrDate();
			}else{
				$date_from = mmddyy2mysql($date_from);
			}
			
			if($date_to==""){ 
				$date_to=CurrDate();
			}else{
				$date_to = mmddyy2mysql($date_to);
			}
			
			$office_id = $this->input->get('office_id');
			
		/////////////////////	
			if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
	
			if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
			if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
				if(get_user_fusion_id()=='FELS000025'){
					$cond1 .="";
				}else{
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}
			}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
				if(get_user_fusion_id()=='FJAM004099'){
					$cond1 .="";
					$cond2 .=" and office_id='JAM'";
				}else{
					$cond1 .=" And assigned_to='$current_user'";
				}
			}else{
				$cond1 .="";
			}
			
			if($this->input->get('show')=='Show'){
				
				if($pValue=='Home Advisor'){
					
					$qSql="SELECT * from
					(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name from qa_homeadvisor_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, assigned_to from signin) yy on (xx.agent_id=yy.sid) Left join (Select fd_id, note as agent_note, date(entry_date) as agent_rvw_date from qa_homeadvisor_agent_rvw) zz on (xx.id=zz.fd_id) Left Join (Select fd_id as mgnt_fd_id, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as mgnt_name, note as mgnt_note, date(entry_date) as mgnt_rvw_date from qa_homeadvisor_mgnt_rvw) ww on (xx.id=ww.mgnt_fd_id) $cond $cond1 order by audit_date";
					
					$fullAray = $this->Common_model->get_query_result_array($qSql);
					$data["qa_homeadvisor_list"] = $fullAray;
					$this->create_qa_homeadvisor_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_homeadvisor_CSV";
					
				}elseif($pValue=='HCCI'){
					$qSql="SELECT * from (Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, (select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name from qa_hcci_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, get_process_names(id) as campaign, DATEDIFF(CURDATE(), doj) as tenure, assigned_to from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
					$fullAray = $this->Common_model->get_query_result_array($qSql);
					$data["qa_homeadvisor_list"] = $fullAray;
					// $header_arr=$this->Common_model->get_query_result_array("SELECT column_comment FROM information_schema.COLUMNS WHERE table_name = 'qa_hcci_feedback'");
					// $cnt=count($header_arr);

					//  for($i=0;$i<$cnt;$i++){
					// 	$val=$this->getval($header_arr[$i],'column_comment');
					// 	if($val!=""){
					// 		$header[]=$val;
					// 	}		
					//  }
					// array_unshift($header ,"Auditor Name");
					// $key = array_search ('Agent', $header);
					// array_splice($header, $key, 0, 'Fusion Id');
					// print_r($header);
					// die;
					$this->create_qa_hcci_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_hcci_CSV";
					
				}else{
					
					$qSql="SELECT * from
					(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name from qa_hcco_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, assigned_to from signin) yy on (xx.agent_id=yy.sid) Left join (Select fd_id, note as agent_note, date(entry_date) as agent_rvw_date from qa_hcco_agent_rvw) zz on (xx.id=zz.fd_id) Left Join (Select fd_id as mgnt_fd_id, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as mgnt_name, note as mgnt_note, date(entry_date) as mgnt_rvw_date from qa_hcco_mgnt_rvw) ww on (xx.id=ww.mgnt_fd_id) $cond $cond1 $cond2 order by audit_date";	
					
					$fullAray = $this->Common_model->get_query_result_array($qSql);
					$data["qa_homeadvisor_list"] = $fullAray;
					$this->create_qa_hcco_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_hcco_CSV";
					
				}
				
			}	
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 
	// /////////////////// hcci NEW /////////////////////
	public function download_qa_hcci_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA HCCI Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_hcci_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");		
		$header=array ( "Auditor Name","Audit Date","Fusion Id","Agent","TL Name","Call Date/Time","Call Duration","SR NO.","Consumer No.","Call File","AUDIT TYPE","AUDITOR TYPE","VOC","Overall Score","Introduction must include company name","We attempted to overcome all homeowner objections","Kept call simple and brief by not extending the information provided","We educated homeowner on what will happen after their request is submit","Attempt to gather and accurately submit all SR information for the professional","Do you agree to HomeAdvisor's Terms including that HomeAdvisor","HomeAdvisor and our partners may offer discounts and other offers in the future","Note BETTI if homeowner does not agree to 2nd Consent","Suggestive cross sell offered","Offer contact information and a transfer to pro","Compliance Score","Customer Score","Business Score","Call Summary","Feedback","Entry By","Entry Date","Client entry by","Mgnt review by","Mgnt review note","Mgnt review date","Agent review note","Agent review date","Client review by","Client review note","Client rvw date");

		$field_name="SHOW FULL COLUMNS FROM qa_hcci_feedback WHERE Comment!=''";
		$field_name=$this->Common_model->get_query_result_array($field_name);
		$fld_cnt=count($field_name);
		for($i=0;$i<$fld_cnt;$i++){
						$val=$field_name[$i]['Field'];
						if($val!=""){
							$field_val[]=$val;
						}		
					 }
		
		array_unshift($field_val ,"auditor_name");
		$key = array_search ('agent_id', $field_val);
		array_splice($field_val, $key, 0, 'fusion_id');
		$field_val=array_values($field_val);

		$count_for_field=count($field_val);

		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		$row = "";
		// print_r($rr);
		// die;
		foreach($rr as $user)
		{	
			for($z=0;$z<$count_for_field;$z++){
				
				if($field_val[$z]==="auditor_name"){
					$row = '"'.$user['auditor_name'].'",';
				}elseif($field_val[$z]==="fusion_id"){
					$row .= '"'.$user['fusion_id'].'",';
				}elseif($field_val[$z]==="agent_id"){
					$row .= '"'.$user['fname']." ".$user['lname'].'",';
				}elseif($field_val[$z]==="tl_id"){
					$row .= '"'.$user['tl_name'].'",';	
				}elseif(in_array($field_val[$z], array('call_summary','feedback','agent_rvw_note','mgnt_rvw_note'))) {
    			
    			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user[$field_val[$z]])).'",';

				}else{
					$row .= '"'.$user[$field_val[$z]].'",';	
				}
				
			}
				
				fwrite($fopen,$row."\r\n");
				$row = "";
		}
		
		fclose($fopen);
	}	

/* public function getval($arrs, $k) {
    foreach($arrs as $key=>$val) {
        if( $key === $k ) {
            return $val;
        }
        else {
            if(is_array($val)) {
                $ret = $this->getval($val, $k);
                if($ret !== NULL) {
                    return $ret;
                }
            }
        }
    }
    return NULL;
	} */


////////////Home Advisor/////////////
	public function download_qa_homeadvisor_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Home Advisor Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_homeadvisor_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Call Duration", "Fusion ID", "Agent Name", "L1 Supervisor", "Sale Date", "EXT Number", "Phone", "Sale Confirmation", "Call Type", "Audit Type", "VOC", "Audit Start Date/Time", "Audit End Date/Time", "Interval(In Second)", "Call Pass/Fail", "Rep clearly communicated that these are leads and not guaranteed jobs", "Rep explains that  SP is only charged for leads they opt into", "Rep clearly communicates the value of opting into leads as the best way to make money with the service", "Rep clearly communicated that SP will be competing on these leads", "Background: Rep communicated the importance of the background check (for homeowners and HA brand)", "Background: Rep communicated what background check looks for (liens judgements bankruptcies felonies)", "Ratings and Reviews: Rep clearly communicated the importance of ratings and reviews and collecte a reference on the sales call", "Lead Response: Rep communicates that leads will be sent via email text message and via mobile app", "Lead Response: Rep reinforces the importance of responding to leads as quickly as possible", "HA Pro App: Rep clearly communicated the importance of the app as the most effective tool for success with HA", "HA Pro App: Rep sent the link to download the HA Pro app on their phone", "Misconduct: Intentionally skirting the screening process", "Falsifying VL: Pressing 1 without the SP specific consent or request OR intentionally hanging up/dropping VL after pressing 2", "Falsifying VL: Speaking over VL at all", "Falsifying VL: Asking SP to hold questions", "Suggesting or implying the SP sign up for multiple accounts", "Adding tasks outside SP scope of work to circumvent licensing requirements", "Misinterpreting lead quality or lead prices", "Implying that friends and family are acceptable for CVRs", "Referring to leads as guaranteed jobs", "Misleading over uses just the background check today", "POC Implies to SP that sales rep can help in any way with credits", "POC Refers to customer care org in a negative manner", "Overusing the word jobs", "Overall Score", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
		
			if($user['product_communicate']==6) $product_communicate='Yes';
			else if($user['product_communicate']==0) $product_communicate='No';
			else $product_communicate='N/A';
			
			if($user['product_explain']==10) $product_explain='Yes';
			else if($user['product_explain']==0) $product_explain='No';
			else $product_explain='N/A';
			
			if($user['product_money']==15) $product_money='Yes';
			else if($user['product_money']==0) $product_money='No';
			else $product_money='N/A';
			
			if($user['product_lead']==6) $product_lead='Yes';
			else if($user['product_lead']==0) $product_lead='No';
			else $product_lead='N/A';
			
			if($user['product_background']==8) $product_background='Yes';
			else if($user['product_background']==0) $product_background='No';
			else $product_background='N/A';
			
			if($user['product_look']==10) $product_look='Yes';
			else if($user['product_look']==0) $product_look='No';
			else $product_look='N/A';
			
			if($user['product_rating']==10) $product_rating='Yes';
			else if($user['product_rating']==0) $product_rating='No';
			else $product_rating='N/A';
			
			if($user['product_email']==7) $product_email='Yes';
			else if($user['product_email']==0) $product_email='No';
			else $product_email='N/A';
			
			if($user['product_reinforce']==10) $product_reinforce='Yes';
			else if($user['product_reinforce']==0) $product_reinforce='No';
			else $product_reinforce='N/A';
			
			if($user['product_tool']==8) $product_tool='Yes';
			else if($user['product_tool']==0) $product_tool='No';
			else $product_tool='N/A';
			
			if($user['product_download']==10) $product_download='Yes';
			else if($user['product_download']==0) $product_download='No';
			else $product_download='N/A';
			
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval = '---';
			}else{
				$interval = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",';
			$row .= '"'.$user['call_duration'].'",';			
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",'; 
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['sale_date'].'",';
			$row .= '"'.$user['ext_no'].'",';
			$row .= '"'.$user['phone'].'",';
			$row .= '"'.$user['sale_confirm'].'",';
			$row .= '"'.$user['call_type'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval.'",';
			$row .= '"'.$user['call_pass_fail'].'",';
			$row .= '"'.$product_communicate.'",';
			$row .= '"'.$product_explain.'",';
			$row .= '"'.$product_money.'",';
			$row .= '"'.$product_lead.'",';
			$row .= '"'.$product_background.'",';
			$row .= '"'.$product_look.'",';
			$row .= '"'.$product_rating.'",';
			$row .= '"'.$product_email.'",';
			$row .= '"'.$product_reinforce.'",';
			$row .= '"'.$product_tool.'",';
			$row .= '"'.$product_download.'",';
			$row .= '"'.$user['auto_misconduct'].'",';
			$row .= '"'.$user['auto_hanging'].'",';
			$row .= '"'.$user['auto_speaking'].'",';
			$row .= '"'.$user['auto_asking'].'",';
			$row .= '"'.$user['auto_implying'].'",';
			$row .= '"'.$user['auto_adding'].'",';
			$row .= '"'.$user['auto_quality'].'",';
			$row .= '"'.$user['auto_family'].'",';
			$row .= '"'.$user['auto_lead'].'",';
			$row .= '"'.$user['auto_background'].'",';
			$row .= '"'.$user['auto_poc'].'",';
			$row .= '"'.$user['auto_manner'].'",';
			$row .= '"'.$user['auto_jobs'].'",';
			$row .= '"'.$user['overall_score'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';				
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}
	
////////////HCCO/////////////
	public function download_qa_hcco_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA HCCO Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_hcco_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Time of Call", "Fusion ID", "Agent Name", "L1 Supervisor", "Call Date", "Call Duration", "Consumer1", "Consumer2 (if applicable)", "Consumer3 (if applicable)", "Original SR ID", "New SR ID1", "New SR ID2", "EXT No", "Audit Type", "VOC", "Call Pass/Fail", "Verify Address if possible (Address required on IB Appts) Zip code & Email", "The business needs were met", "Offer to transfer the Consumer to the Service Professional", "Informed the consumer of features and benefits of Angi/HA", "Maintain proper tone word choice and rate of speech. Avoid interrupting in a non-collaborative conversation", "Properly presented pros and asked the consumer how many options they want ", "The advisor asked questions about the project and related projects & included detailed descriptions", "Make sure the Consumer knows what to expect after the call and Do what you said you would do. ", "The advisor accurately updated and noted all SRs", "The correct solution was provided", "The advisor asked for a cross sell", "Correct CTT was submitted and included a detailed description of the project", "Brand Angi/HA somewhere other than the Intro", "Your Name/Verify who you are speaking with HA/Angi Branding and stated recorded line", "Recorded line must be stated in the introduction of the call", "All SRs were submitted with the homeowners knowledge and approval ", "5 Star Rating If yes QA score will increase by 5 percent (manager must review and notify QA of 5 star Stella rating)", "Overall Score","Comments 1","Comments 2","Comments 3","Comments 4","Comments 5","Comments 6","Comments 7","Comments 8","Comments 9","Comments 10","Comments 11","Comments 12","Comments 13","Comments 14","Comments 15","Comments 16","Comments 17", "Call Summary", "Feedback", "Agent Review Date","Agent Fd ACPT", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",';
			$row .= '"'.$user['call_time'].'",';			
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",'; 
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['call_duration'].'",';
			$row .= '"'.$user['consumer1'].'",';
			$row .= '"'.$user['consumer2'].'",';
			$row .= '"'.$user['consumer3'].'",';
			$row .= '"'.$user['original_sr_id'].'",';
			$row .= '"'.$user['new_sr_id1'].'",';
			$row .= '"'.$user['new_sr_id2'].'",';
			$row .= '"'.$user['ext_no'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['call_pass_fail'].'",';
			$row .= '"'.$user['Location_email'].'",';
			$row .= '"'.$user['Business_expectations'].'",';
			$row .= '"'.$user['Transfer'].'",';
			$row .= '"'.$user['educate'].'",';
			$row .= '"'.$user['professionalism'].'",';
			$row .= '"'.$user['Proper_presentation'].'",';
			$row .= '"'.$user['prob'].'",';
			$row .= '"'.$user['Customer_expectations'].'",';
			$row .= '"'.$user['account_accuracy'].'",';
			$row .= '"'.$user['Solution'].'",';
			$row .= '"'.$user['Cross_sell'].'",';
			$row .= '"'.$user['Correct_CTT'].'",';
			$row .= '"'.$user['Branding'].'",';
			$row .= '"'.$user['Introduction'].'",';
			$row .= '"'.$user['recorded_line'].'",';
			$row .= '"'.$user['acknowledgement'].'",';
			//$row .= '"'.$user['stella_survey'].'",';
			$row .= '"'.$user['stella_survey'].'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt16'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt17'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'.$user['agnt_fd_acpt'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}


	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////// 
//////////////////////////////// QA Entice Energy REPORT ////////////////////////////	
/////////////////////////////////////////////////////////////////////////////////////

	public function qa_entice_energy_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_entice_energy_report.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			
			$data["entice_energy_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
				
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
				
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, 
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, 
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_rvw_by) as client_rvw_name from qa_entice_energy_feedback) xx Left Join 
				(Select id as sid, fname, lname, fusion_id, office_id, get_process_names(id) as campaign, DATEDIFF(CURDATE(), doj) as tenure, assigned_to from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["entice_energy_list"] = $fullAray;
				$this->create_qa_entice_energy_CSV($fullAray);	
				$dn_link = base_url()."reports_qa/download_qa_entice_energy_CSV";
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_entice_energy_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Entice Energy List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_entice_energy_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Agent", "L1 Super", "Call Date", "Customer Name", "Week End Date", "Call Type", "Customer Phone", "Audit Type", "VOC", "Overall Score", "Earned Score", "Possible Score", "Agent states name", "Confirmation that speaking to DMC", "Golden Account details confirmed Customers", "Customer to provide first line", "Did agent ask if customer takes part in the WHD", "Confirm Single/ Duel Fuel", "Tariff probed 3 times", "Have you asked sufficient questions to accurately", "Does the customer have a Smart Meter?", "Economy 7 checked and caller advised correctly?", "Confirm if customer has any debt?", "Did agent give Entice Energy", "Did agent give current and future spends?", "C3a Daily standing charge & unit rates provided in full", "C3b VAT Statement customer advised comparison", "C4a Customer advised if cancellation fees", "C4b Customer advised of SP cancellation fees", "Verify that the customer is the named bank", "Obtained & reconfirmed the account number", "Advised that they will receive confirmation of payments", "Informed that the direct debit mandate", "T&Cs read correctly?", "Did agent read contact number", "Sign up scripting read and clear", "Was the agent open honest and transparent", "G1a Did the agent recognise signs of potential vulnerability", "G1b Did the agent ask the Vulnerability Priority", "Did the agent take appropriate action act accordingly", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review By", "Client Review Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['customer_name'].'",';
			$row .= '"'.$user['week_end_date'].'",';
			$row .= '"'.$user['call_type'].'",';
			$row .= '"'.$user['customer_phone'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'.$user['earned_score'].'",';
			$row .= '"'.$user['possible_score'].'",';
			$row .= '"'.$user['agentstatesname'].'",';
			$row .= '"'.$user['cofirmspeakingtoDMC'].'",';
			$row .= '"'.$user['goldenaccountdetails'].'",';
			$row .= '"'.$user['customerprovide1stline'].'",';
			$row .= '"'.$user['customertakepartinWHD'].'",';
			$row .= '"'.$user['confirmsigleduelFuel'].'",';
			$row .= '"'.$user['tariffprobed3times'].'",';
			$row .= '"'.$user['askedsufficientquestion'].'",';
			$row .= '"'.$user['customerhaveSmartmeter'].'",';
			$row .= '"'.$user['economy7checked'].'",';
			$row .= '"'.$user['customerhasanydebt'].'",';
			$row .= '"'.$user['agentgavebesttariff'].'",';
			$row .= '"'.$user['agentgavefuturespend'].'",';
			$row .= '"'.$user['dailystandingcharges_C3a'].'",';
			$row .= '"'.$user['VATstatement_C3b'].'",';
			$row .= '"'.$user['cancelletionfees_C4a'].'",';
			$row .= '"'.$user['SPcancelletionfees_C4b'].'",';
			$row .= '"'.$user['verifycustomerbankaccount'].'",';
			$row .= '"'.$user['reconfirmaccountnumber'].'",';
			$row .= '"'.$user['receiveconfirmpayment'].'",';
			$row .= '"'.$user['directdebitmandate'].'",';
			$row .= '"'.$user['correctT&Cneed'].'",';
			$row .= '"'.$user['agentreadcontactnumber'].'",';
			$row .= '"'.$user['signupScriptingread'].'",';
			$row .= '"'.$user['honestwithcustomer'].'",';
			$row .= '"'.$user['potentialVulnerability_G1a'].'",';
			$row .= '"'.$user['priorityVulnerability_G1b'].'",';
			$row .= '"'.$user['takeappropriateaction'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
			$row .= '"'.$user['client_rvw_date'].'",';
			$row .= '"'.$user['client_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
			
			fwrite($fopen,$row."\r\n");
		}
		fclose($fopen);
	}


	///////////////////////////////////////////////////////////////////////////////////// 
/////////////////////////////////// QA Doubtnut REPORT //////////////////////////////	
/////////////////////////////////////////////////////////////////////////////////////

	public function qa_doubtnut_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_doubtnut_report.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$process="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			$process = $this->input->get('process');
			if($process=="doubtnut"){
				$dn_table="qa_doubtnut_feedback";
			}else if($process=="doubtnut_p2p"){
				$dn_table="qa_doubtnut_p2p_scrubbed";
			}
			
			$data["qa_doubtnut_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
				
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
				
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from ".$dn_table.") xx Left Join
				(Select id as sid, fname, lname, fusion_id, office_id, assigned_to, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_doubtnut_list"] = $fullAray;
				$this->create_qa_doubtnut_CSV($fullAray,$process);	
				$dn_link = base_url()."reports_qa/download_qa_doubtnut_CSV/".$process;
				
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['process']=$process;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_doubtnut_CSV($process)
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		if($process=="doubtnut"){
			$title="Doubtnut";
		}else if($process=="doubtnut_p2p"){
			$title="Doubtnut P2P Scrubbed";
		}
		$newfile="QA ".$title." Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_doubtnut_CSV($rr,$process)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		if($process=='doubtnut'){
			$header = array("Auditor Name", "Evaluation Date", "Fusion ID", "Agent", "TL", "Call Date", "Call Duration", "Partner", "Emp ID", "Disposition", "Sub Disposition", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Greeting", "Self Introduction", "Customer Introduction", "Reason for Call", "Student Class", "Category of Student", "City of Residence", "Parents Profiling", "Examination Preparing for Future Goal", "Judgemnet Point", "Complete analysis of customer requirements", "VMC Introduction - Not applicable for DN Tutions", "VMC - VOD as a solution - Not applicable for DN Tutions", "DN Tutions - IF student is in 10th or 12th and not preparing JEE NEET", "Offerings", "Product Explanation", "Alternate Contact", "Product Price", "Payee Confirmation", "Probe to connect with Payee", "Student views regarding course", "Buying hesitation", "Urgency Creation", "Approach to close sale", "Segment2 - Urgency Creation", "Segment2 - Student Weaknesses", "Segment2 - Product Explanation", "Segment2 - Product Price", "Segment2 - Payment Options", "Segment2 - Parents views regarding course", "Segment2 - Buying hesitation", "Segment2 - Creating Urgency", "Segment2 - Closing the sale", "Segment2 - Summary", "Introduction Comment1", "Introduction Comment2", "Introduction Comment3", "Introduction Comment4", "Student Qualification Comment1", "Student Qualification Comment2", "Student Qualification Comment3", "Student Qualification Comment4", "Student Qualification Comment5", "Student Qualification Comment6", "Student Qualification Comment7", "Need Analysis Comment", "Product Comment1", "Product Comment2", "Product Comment3", "Product Comment4", "Product Comment5", "Pricing & Payment Comment1", "Pricing & Payment Comment2", "Pricing & Payment Comment3", "Pricing & Payment Comment4", "Objection Handling Comment1", "Objection Handling Comment2", "Closing Urgency Comment1", "Closing Urgency Comment2", "Segment2 Closing Urgency Comment", "Segment2 Product Comment1", "Segment2 Product Comment2", "Segment2 Pricing & Payment Comment1", "Segment2 Pricing & Payment Comment2", "Segment2 Objection Handling Comment1", "Segment2 Objection Handling Comment2", "Segment2 Closing & Summary Comment1", "Segment2 Closing & Summary Comment2", "Segment2 Closing & Summary Comment3", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		}else if($process=='doubtnut_p2p'){
			$header = array("Scrubbed By", "Lead Date", "Partner", "Student ID", "Student Name", "L1 Supervisor", "Phone", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "LEVEL1 - P2P Generation Date", "LEVEL1 - P2P Generation TM Name", "LEVEL1 - P2P Promise Date", "LEVEL1 - Cause", "LEVEL1 - SubCause", "LEVEL1 - Remarks", "LEVEL2 - Last Connect Date", "LEVEL2 - Last Promise Date", "LEVEL2 - Last Connect TM Name", "LEVEL2 - Cause", "LEVEL2 - SubCause", "LEVEL2 - Remarks", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		}
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		if($process=='doubtnut'){
			foreach($rr as $user){	
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['partner'].'",';
				$row .= '"'.$user['emp_id'].'",';
				$row .= '"'.$user['disposition'].'",';
				$row .= '"'.$user['sub_disposition'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['greeting'].'",';
				$row .= '"'.$user['self_introduction'].'",';
				$row .= '"'.$user['customer_introduction'].'",';
				$row .= '"'.$user['reason_for_call'].'",';
				$row .= '"'.$user['student_class'].'",';
				$row .= '"'.$user['student_catagory'].'",';
				$row .= '"'.$user['medium_schooling'].'",';
				$row .= '"'.$user['city_residence'].'",';
				$row .= '"'.$user['parent_profiling'].'",';
				$row .= '"'.$user['examination_prepare'].'",';
				$row .= '"'.$user['judgement_point'].'",';
				$row .= '"'.$user['customer_analysis'].'",';
				$row .= '"'.$user['VMC_introduction'].'",';
				$row .= '"'.$user['VOD_solution'].'",';
				$row .= '"'.$user['DN_titution'].'",';
				$row .= '"'.$user['offering'].'",';
				$row .= '"'.$user['product_explanation'].'",';
				$row .= '"'.$user['alternate_contact'].'",';
				$row .= '"'.$user['product_price'].'",';
				$row .= '"'.$user['payee_confirmation'].'",';
				$row .= '"'.$user['probe_to_connect'].'",';
				$row .= '"'.$user['student_course_view'].'",';
				$row .= '"'.$user['buying_hesitation'].'",';
				$row .= '"'.$user['urgency_creation'].'",';
				$row .= '"'.$user['approach_close_sale'].'",';
				$row .= '"'.$user['introduction_payee_segment2'].'",';
				$row .= '"'.$user['student_weakness_segment2'].'",';
				$row .= '"'.$user['product_explaination_segment2'].'",';
				$row .= '"'.$user['product_price_segment2'].'",';
				$row .= '"'.$user['payment_option_segment2'].'",';
				$row .= '"'.$user['parent_view_course_segment2'].'",';
				$row .= '"'.$user['buying_hesitation_segment2'].'",';
				$row .= '"'.$user['creating_urgency_segment2'].'",';
				$row .= '"'.$user['closing_sale_segment2'].'",';
				$row .= '"'.$user['summary_segment2'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt16'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt17'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt18'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt19'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt20'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt21'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt22'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt23'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt24'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt25'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt26'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt27'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt28'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt29'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt30'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt31'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt32'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt33'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt34'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt35'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		}else if($process=='doubtnut_p2p'){
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['partner'].'",'; 
				$row .= '"'.$user['student_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['phone'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['level1generationdate'].'",';
				$row .= '"'.$user['level1generationTMname'].'",';
				$row .= '"'.$user['level1promisedate'].'",';
				$row .= '"'.$user['level1cause'].'",';
				$row .= '"'.$user['level1subcause'].'",';
				$row .= '"'.$user['level1subcausedate'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['level1remarks'])).'",';
				$row .= '"'.$user['level2lastconnectdate'].'",';
				$row .= '"'.$user['level2lastpromisedate'].'",';
				$row .= '"'.$user['level2connectTMname'].'",';
				$row .= '"'.$user['level2cause'].'",';
				$row .= '"'.$user['level2subcause'].'",';
				$row .= '"'.$user['level2subcausedate'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['level2remarks'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		}
		
	}



	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////// 
/////////////////////////////// QA DocuSign REPORT ////////////////////////////////	
/////////////////////////////////////////////////////////////////////////////////////

	public function qa_docusign_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_report.php";
			$data["content_js"] = "qa_kabbage_js.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$p_id="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			$p_id = $this->input->get('p_id');
			if($p_id=='email'){
				$pid='qa_docusign_email_feedback';
			}else if($p_id=='phone_chat'){
				$pid='qa_docusign_phone_chat_feedback';
			}else if($p_id=='dc_new'){
				$pid='qa_docusign_feedback';
			}
			
			$data["qa_docusign_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
		
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from ".$pid.") xx Left Join
				(Select id as sid, fname, lname, fusion_id, assigned_to, office_id, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_docusign_list"] = $fullAray;
				$this->create_qa_docusign_CSV($fullAray,$p_id);	
				$dn_link = base_url()."reports_qa/download_qa_docusign_CSV/".$p_id;
				
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['p_id']=$p_id;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_docusign_CSV($p_id)
	{
		$currDate=date("Y-m-d");
		
		if($p_id=='email'){
			$pname='Email';
		}else if($p_id=='phone_chat'){
			$pname='Phone & Chat';
		}else if($p_id=='dc_new'){
			$pname='New';
		}
		
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Docusign ".$pname." Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	
	public function create_qa_docusign_CSV($rr,$p_id)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		if($p_id=='email'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Case Number", "Call Duration", "Topic", "Sub-Topic", "Opportunity Area", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Properly verifies the admin before making any account changes", "Does not close or cancel any corporate accounts and prior to closing Web accounts advises that documents will be inaccessible upon closure", "Submits all eligible refund requests in accordance with the Refund Policy", "Properly submits ACRs in all applicable scenarios", "Obtains verbal or written permission from an authenticated admin before enabling or disabling any account features", "Verifies the necessary account billing information OR ensures that an email sent by an authenticated Account", "Does not volunteer PII information to the customer If the customer is an admin PII information can only be provided to them", "Requests that a manager deletes all sensitive customer-provided PII", "Informs the customer that the call may be recorded on outbound or Click-to-Call customer engagements", "Does not engage in a reverse screen sharing", "Sends all email communications from within the Salesforce case", "Does not provide their personal work email address in any fashion", "Observes all procedures of unique customer contacts", "Directs the customer to their AM in scenarios listed on the Procedures page linked to in Policy section 4a", "Does not enable a Paid Feature or discuss the price of a feature", "Properly informs the Account Manager of a bug that affects one of their accounts", "Follows this flowchart when working a case for a customer with a TCSM", "Case Subjects are a high-level concise issue descriptor that is appropriately customer facing", "Case Subject and Description fields do not include abbreviations or shorthand", "Taxonomy status fields email alias and product field are accurate and any Case Issues relating to the case are properly linked", "Duplicate cases are properly tied to their parent case and case notes are input on the parent case rather than child", "The Case Description field contains only a concise summary of the problem the customer is having", "Case is tied to the correct Contact and Account records", "The Expert first responds to a Portal-originated case within a Public Case Comment", "The Expert never assigns the case outside of Support", "All information relevant to the interaction is captured", "If it is clearly documented when a call disconnects and the customer has to be called back", "All envelope IDs version numbers browser types and environment information that is required to troubleshoot a specific problem is documented", "The Expert refrains from negative or derogatory comments about customers", "Unresponsive follow up cadence procedure is observed", "Customer replies are responded to within one business day", "Agreed upon follow-ups with the customer occur when scheduled", "The Expert obtain ownership of the case and contacts the customer the same day", "All technical information provided is accurate", "Uses targeted probing questions and pays attention to key words and phrases to quickly determine the issue", "Asks the customer to perform logical and necessary troubleshooting steps throughout the interaction", "Attempts to offer all troubleshooting steps and utilizes their tools", "Immediately and appropriately acknowledges and responds to the customers emotional statements", "Maintains a friendly confident and professional voice tone throughout interaction", "Stays focused and concise with directions and allows customers to complete tasks prior to moving to next steps", "Refrains from using language that could be interpreted as offensive or controversial to a customer", "Demonstrates active listening by not ignoring customer information", "Appropriately advises of case status next steps and relevant time frames", "Follows through with expectations set for the customer", "Appropriately advises the customer that any test files sent to DocuSign Support", "Closes all screen sharing sessions prior to disconnecting the call or chat", "Two or fewer spelling or grammatical mistakes are observed throughout the customer-facing correspondences", "All specialized company branding such as DocuSign PowerForm etc", "Comment1", "Comment2", "Comment3", "Comment4", "Comment5", "Comment6", "Comment7", "Comment8", "Comment9", "Comment10", "Comment11", "Comment12", "Comment13", "Comment14", "Comment15", "Comment16", "Comment17", "Comment18", "Comment19", "Comment20", "Comment21", "Comment22", "Comment23", "Comment24", "Comment25", "Comment26", "Comment27", "Comment28", "Comment29", "Comment30", "Comment31", "Comment32", "Comment33", "Comment34", "Comment35", "Comment36", "Comment37", "Comment38", "Comment39", "Comment40", "Comment41", "Comment42", "Comment43", "Comment44", "Comment45", "Comment46", "Comment47", "Comment48", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		}else if($p_id=='phone_chat'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Case Number", "Call Duration", "Topic", "Sub-Topic", "Opportunity Area", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Properly verifies the admin before making any account changes", "Does not close or cancel any corporate accounts and prior to closing Web accounts advises that documents will be inaccessible upon closure", "Submits all eligible refund requests in accordance with the Refund Policy", "Properly submits ACRs in all applicable scenarios", "Obtains verbal or written permission from an authenticated admin before enabling or disabling any account features", "Verifies the necessary account billing information OR ensures that an email sent by an authenticated Account", "Does not volunteer PII information to the customer If the customer is an admin PII information can only be provided to them", "Requests that a manager deletes all sensitive customer-provided PII", "Informs the customer that the call may be recorded on outbound or Click-to-Call customer engagements", "Does not engage in a reverse screen sharing", "Sends all email communications from within the Salesforce case", "Does not provide their personal work email address in any fashion", "Observes all procedures of unique customer contacts", "Directs the customer to their AM in scenarios listed on the Procedures page linked to in Policy section 4a", "Does not enable a Paid Feature or discuss the price of a feature", "Properly informs the Account Manager of a bug that affects one of their accounts", "Follows this flowchart when working a case for a customer with a TCSM", "Case Subjects are a high-level concise issue descriptor that is appropriately customer facing", "Case Subject and Description fields do not include abbreviations or shorthand", "Taxonomy status fields email alias and product field are accurate and any Case Issues relating to the case are properly linked", "Duplicate cases are properly tied to their parent case and case notes are input on the parent case rather than child", "The Case Description field contains only a concise summary of the problem the customer is having", "Case is tied to the correct Contact and Account records", "The Expert first responds to a Portal-originated case within a Public Case Comment", "The Expert never assigns the case outside of Support", "All information relevant to the interaction is captured", "If it is clearly documented when a call disconnects and the customer has to be called back", "All envelope IDs version numbers browser types and environment information that is required to troubleshoot a specific problem is documented", "The Expert refrains from negative or derogatory comments about customers", "Unresponsive follow up cadence procedure is observed", "Customer replies are responded to within one business day", "Agreed upon follow-ups with the customer occur when scheduled", "The Expert obtain ownership of the case and contacts the customer the same day", "All technical information provided is accurate", "Uses targeted probing questions and pays attention to key words and phrases to quickly determine the issue", "Asks the customer to perform logical and necessary troubleshooting steps throughout the interaction", "Attempts to offer all troubleshooting steps and utilizes their tools", "Immediately and appropriately acknowledges and responds to the customers emotional statements", "Maintains a friendly confident and professional voice tone throughout interaction", "Stays focused and concise with directions and allows customers to complete tasks prior to moving to next steps", "Refrains from using language that could be interpreted as offensive or controversial to a customer", "Demonstrates active listening by not ignoring customer information", "Appropriately advises of case status next steps and relevant time frames", "Clearly and appropriately sets hold and mute expectations", "Follows through with expectations set for the customer", "Appropriately advises the customer that any test files sent to DocuSign Support", "Closes all screen sharing sessions prior to disconnecting the call or chat", "Two or fewer spelling or grammatical mistakes are observed throughout the customer-facing correspondences", "All specialized company branding such as DocuSign PowerForm etc", "Comment1", "Comment2", "Comment3", "Comment4", "Comment5", "Comment6", "Comment7", "Comment8", "Comment9", "Comment10", "Comment11", "Comment12", "Comment13", "Comment14", "Comment15", "Comment16", "Comment17", "Comment18", "Comment19", "Comment20", "Comment21", "Comment22", "Comment23", "Comment24", "Comment25", "Comment26", "Comment27", "Comment28", "Comment29", "Comment30", "Comment31", "Comment32", "Comment33", "Comment34", "Comment35", "Comment36", "Comment37", "Comment38", "Comment39", "Comment40", "Comment41", "Comment42", "Comment43", "Comment44", "Comment45", "Comment46", "Comment47", "Comment48", "Comment49", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note"); 
		}else if($p_id=='dc_new'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Case Number", "Call Duration", "Time Stamp", "Case Topic", "Case Sub-Topic", "ACPT", "Industry", "Industry Other", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "1) Did the agent execute properly any of these processes and properly verifies the admin", "Qustion1 Checkbox1", "Qustion2 Checkbox2", "2) Did the agent advise the customer that documents will be inaccessible upon closure?", "3) Did the agent properly submit ACRs in all applicable scenarios?", "4) Did the agent execute any of these processes about proper handling of PII information?", "Qustion4 Checkbox1", "Qustion4 Checkbox2", "5) Did the agent inform the customer that the call may be recorded on outbound", "6) Did the agent send all email communications only from within the Salesforce case?", "7) Did the agent not provide their personal work email address in any fashion?", "8) Did the agent appropriately advise the customer that any test files sent to DocuSign", "9) Did the agent execute properly any of the Escalation to Service Management", "Qustion9 Checkbox1", "Qustion9 Checkbox2", "Qustion9 Checkbox3", "10) Did the agent properly execute any of the process for CASE MANAGEMENT & POLICIES: Were all case fields filled out properly?", "Qustion10 Checkbox1", "Qustion10 Checkbox2", "Qustion10 Checkbox3", "Qustion10 Checkbox4", "Qustion10 Checkbox5", "Qustion10 Checkbox6", "Qustion10 Checkbox7", "Qustion10 Checkbox8", "11) Did the agent properly execute any of the process for CASE MANAGEMENT & POLICIES: Were Case Comments Complete and Accurate?", "Qustion11 Checkbox1", "Qustion11 Checkbox2", "Qustion11 Checkbox3", "Qustion11 Checkbox4", "12) Did the agent execute properly any of the cost-affecting process?", "Qustion12 Checkbox1", "Qustion12 Checkbox2", "Qustion12 Checkbox3", "Qustion12 Checkbox4", "Qustion12 Checkbox5", "13) Did the agent execute any of troubleshooting standard procedure and demonstrate logical", "Qustion13 Checkbox1", "Qustion13 Checkbox2", "Qustion13 Checkbox3", "Qustion13 Checkbox4", "14) Did the agent properly execute any of the process for CASE MANAGEMENT & POLICIES: Were all follow up policies observed when appropriate?", "Qustion14 Checkbox1", "Qustion14 Checkbox2", "Qustion14 Checkbox3", "15) Did the agent properly execute any of the process for SOFT SKILLS: Agent display courtesy positive tone and active listening?", "Qustion15 Checkbox1", "Qustion15 Checkbox2", "Qustion15 Checkbox3", "Qustion15 Checkbox4", "Qustion15 Checkbox5", "16) Did the agent properly execute any of the process for SOFT SKILLS and meet the expectations they set during the interactions?", "Qustion16 Checkbox1", "Qustion16 Checkbox2", "Qustion16 Checkbox3", "Qustion16 Checkbox4", "17) Did the agent properly execute any of the process for SOFT SKILLS and use proper spelling and grammar for all written or verbal customer-facing communication?", "Qustion17 Checkbox1", "Qustion17 Checkbox2", "Qustion17 Checkbox3", "Comment1", "Comment2", "Comment3", "Comment4", "Comment5", "Comment6", "Comment7", "Comment8", "Comment9", "Comment10", "Comment11", "Comment12", "Comment13", "Comment14", "Comment15", "Comment16", "Comment17", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note"); 
		}
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		if($p_id=='email'){
		
			foreach($rr as $user)
			{	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
			
				$row = '"'.$auditorName.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['case_no'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['topic'].'",';
				$row .= '"'.$user['subtopic'].'",';
				$row .= '"'.$user['oppor_area'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['adminPropertyVerify'].'",';
				$row .= '"'.$user['donotCloseCorporateAccount'].'",';
				$row .= '"'.$user['submitAllEligibleRefund'].'",';
				$row .= '"'.$user['properlySubmitACR'].'",';
				$row .= '"'.$user['obtainRetainPermission'].'",';
				$row .= '"'.$user['verifyAccountBillingInfo'].'",';
				$row .= '"'.$user['volunteerPIIInformation'].'",';
				$row .= '"'.$user['managerDeleteCustomerPII'].'",';
				$row .= '"'.$user['customerCallMaybeRecorded'].'",';
				$row .= '"'.$user['engageReverseScreening'].'",';
				$row .= '"'.$user['sendAllEmailComunication'].'",';
				$row .= '"'.$user['doesnotProvidePersonalEmail'].'",';
				$row .= '"'.$user['observesCustomerContact'].'",';
				$row .= '"'.$user['directCustomerAMScenario'].'",';
				$row .= '"'.$user['doesnotEnablePaidFeature'].'",';
				$row .= '"'.$user['properlyInformAccountManager'].'",';
				$row .= '"'.$user['followstheFlowchart'].'",';
				$row .= '"'.$user['caseSubjectAreHighLevel'].'",';
				$row .= '"'.$user['caseSubjectFieldnotInclude'].'",';
				$row .= '"'.$user['taxonomyStatusFieldAccurate'].'",';
				$row .= '"'.$user['duplicateCaseProperlyTied'].'",';
				$row .= '"'.$user['caseDescriptionFieldContain'].'",';
				$row .= '"'.$user['caseTiedCorrectContact'].'",';
				$row .= '"'.$user['expartFirstRespondtoPortal'].'",';
				$row .= '"'.$user['expertNeverAssign'].'",';
				$row .= '"'.$user['allInformationRelevent'].'",';
				$row .= '"'.$user['clearlyDocumentedCallDisconnect'].'",';
				$row .= '"'.$user['envelopeIDsInformation'].'",';
				$row .= '"'.$user['expertRefrainNegativeComment'].'",';
				$row .= '"'.$user['unresponsiveFollowup'].'",';
				$row .= '"'.$user['customerRepliesBusinessDay'].'",';
				$row .= '"'.$user['agreedUponFollowup'].'",';
				$row .= '"'.$user['expertObtainOwenership'].'",';
				$row .= '"'.$user['technicalInformationAccurate'].'",';
				$row .= '"'.$user['useTargetedProbingQuestion'].'",';
				$row .= '"'.$user['performLogicalTroubleshooting'].'",';
				$row .= '"'.$user['attemptOfferAllTroubleshooting'].'",';
				$row .= '"'.$user['appropiateAcknowledgeResponce'].'",';
				$row .= '"'.$user['maintainFriendlyInteraction'].'",';
				$row .= '"'.$user['stayFocusAndConcise'].'",';
				$row .= '"'.$user['refrainFromUsingLanguage'].'",';
				$row .= '"'.$user['demonstrateActiveListening'].'",';
				$row .= '"'.$user['appropiateAdviseCaseStatus'].'",';
				$row .= '"'.$user['followTroughWithExpectation'].'",';
				$row .= '"'.$user['customerTestFilesSent'].'",';
				$row .= '"'.$user['closeAllScreenSharing'].'",';
				$row .= '"'.$user['toworFewerSpelling'].'",';
				$row .= '"'.$user['allSpecializedCompanyBranding'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt16'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt17'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt18'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt19'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt20'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt21'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt22'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt23'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt24'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt25'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt26'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt27'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt28'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt29'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt30'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt31'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt32'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt33'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt34'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt35'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt36'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt37'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt38'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt39'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt40'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt41'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt42'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt43'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt44'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt45'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt46'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt47'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt48'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_date'].'",';
				$row .= '"'.$user['client_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		
		}else if($p_id=='phone_chat'){
			
			foreach($rr as $user)
			{	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval2 = '---';
				}else{
					$interval2 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
			
				$row = '"'.$auditorName.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['case_no'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['topic'].'",';
				$row .= '"'.$user['subtopic'].'",';
				$row .= '"'.$user['oppor_area'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval2.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['adminPropertyVerify'].'",';
				$row .= '"'.$user['donotCloseCorporateAccount'].'",';
				$row .= '"'.$user['submitAllEligibleRefund'].'",';
				$row .= '"'.$user['properlySubmitACR'].'",';
				$row .= '"'.$user['obtainRetainPermission'].'",';
				$row .= '"'.$user['verifyAccountBillingInfo'].'",';
				$row .= '"'.$user['volunteerPIIInformation'].'",';
				$row .= '"'.$user['managerDeleteCustomerPII'].'",';
				$row .= '"'.$user['customerCallMaybeRecorded'].'",';
				$row .= '"'.$user['engageReverseScreening'].'",';
				$row .= '"'.$user['sendAllEmailComunication'].'",';
				$row .= '"'.$user['doesnotProvidePersonalEmail'].'",';
				$row .= '"'.$user['observesCustomerContact'].'",';
				$row .= '"'.$user['directCustomerAMScenario'].'",';
				$row .= '"'.$user['doesnotEnablePaidFeature'].'",';
				$row .= '"'.$user['properlyInformAccountManager'].'",';
				$row .= '"'.$user['followstheFlowchart'].'",';
				$row .= '"'.$user['caseSubjectAreHighLevel'].'",';
				$row .= '"'.$user['caseSubjectFieldnotInclude'].'",';
				$row .= '"'.$user['taxonomyStatusFieldAccurate'].'",';
				$row .= '"'.$user['duplicateCaseProperlyTied'].'",';
				$row .= '"'.$user['caseDescriptionFieldContain'].'",';
				$row .= '"'.$user['caseTiedCorrectContact'].'",';
				$row .= '"'.$user['expartFirstRespondtoPortal'].'",';
				$row .= '"'.$user['expertNeverAssign'].'",';
				$row .= '"'.$user['allInformationRelevent'].'",';
				$row .= '"'.$user['clearlyDocumentedCallDisconnect'].'",';
				$row .= '"'.$user['envelopeIDsInformation'].'",';
				$row .= '"'.$user['expertRefrainNegativeComment'].'",';
				$row .= '"'.$user['unresponsiveFollowup'].'",';
				$row .= '"'.$user['customerRepliesBusinessDay'].'",';
				$row .= '"'.$user['agreedUponFollowup'].'",';
				$row .= '"'.$user['expertObtainOwenership'].'",';
				$row .= '"'.$user['technicalInformationAccurate'].'",';
				$row .= '"'.$user['useTargetedProbingQuestion'].'",';
				$row .= '"'.$user['performLogicalTroubleshooting'].'",';
				$row .= '"'.$user['attemptOfferAllTroubleshooting'].'",';
				$row .= '"'.$user['appropiateAcknowledgeResponce'].'",';
				$row .= '"'.$user['maintainFriendlyInteraction'].'",';
				$row .= '"'.$user['stayFocusAndConcise'].'",';
				$row .= '"'.$user['refrainFromUsingLanguage'].'",';
				$row .= '"'.$user['demonstrateActiveListening'].'",';
				$row .= '"'.$user['appropiateAdviseCaseStatus'].'",';
				$row .= '"'.$user['setHoldMuteExpectation'].'",';
				$row .= '"'.$user['followTroughWithExpectation'].'",';
				$row .= '"'.$user['customerTestFilesSent'].'",';
				$row .= '"'.$user['closeAllScreenSharing'].'",';
				$row .= '"'.$user['toworFewerSpelling'].'",';
				$row .= '"'.$user['allSpecializedCompanyBranding'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt16'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt17'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt18'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt19'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt20'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt21'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt22'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt23'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt24'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt25'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt26'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt27'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt28'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt29'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt30'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt31'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt32'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt33'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt34'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt35'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt36'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt37'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt38'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt39'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt40'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt41'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt42'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt43'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt44'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt45'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt46'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt47'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt48'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt49'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_date'].'",';
				$row .= '"'.$user['client_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}else if($p_id=='dc_new'){
			
			foreach($rr as $user)
			{	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval2 = '---';
				}else{
					$interval2 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$auditorName.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['case_no'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['time_stamp'].'",';
				$row .= '"'.$user['case_topic'].'",';
				$row .= '"'.$user['case_sub_topic'].'",';
				$row .= '"'.$user['acpt'].'",';
				$row .= '"'.$user['industry'].'",';
				$row .= '"'.$user['industry_other'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval2.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['making_account_change'].'",';
				$row .= '"'.$user['compliance1_check1'].'",';
				$row .= '"'.$user['compliance1_check2'].'",';
				$row .= '"'.$user['for_account_closure'].'",';
				$row .= '"'.$user['properly_submit_ACRs'].'",';
				$row .= '"'.$user['proper_handling_PII'].'",';
				$row .= '"'.$user['compliance4_check1'].'",';
				$row .= '"'.$user['compliance4_check2'].'",';
				$row .= '"'.$user['inform_customer_call_record'].'",';
				$row .= '"'.$user['send_email_communication'].'",';
				$row .= '"'.$user['not_provide_personal_eork'].'",';
				$row .= '"'.$user['testfile_sent_to_docusign'].'",';
				$row .= '"'.$user['escalation_service_management'].'",';
				$row .= '"'.$user['business9_check1'].'",';
				$row .= '"'.$user['business9_check2'].'",';
				$row .= '"'.$user['business9_check3'].'",';
				$row .= '"'.$user['process_of_case_management'].'",';
				$row .= '"'.$user['business10_check1'].'",';
				$row .= '"'.$user['business10_check2'].'",';
				$row .= '"'.$user['business10_check3'].'",';
				$row .= '"'.$user['business10_check4'].'",';
				$row .= '"'.$user['business10_check5'].'",';
				$row .= '"'.$user['business10_check6'].'",';
				$row .= '"'.$user['business10_check7'].'",';
				$row .= '"'.$user['business10_check8'].'",';
				$row .= '"'.$user['process_of_case_policies'].'",';
				$row .= '"'.$user['business11_check1'].'",';
				$row .= '"'.$user['business11_check2'].'",';
				$row .= '"'.$user['business11_check3'].'",';
				$row .= '"'.$user['business11_check4'].'",';
				$row .= '"'.$user['cost_affecting_process'].'",';
				$row .= '"'.$user['business12_check1'].'",';
				$row .= '"'.$user['business12_check2'].'",';
				$row .= '"'.$user['business12_check3'].'",';
				$row .= '"'.$user['business12_check4'].'",';
				$row .= '"'.$user['business12_check5'].'",';
				$row .= '"'.$user['troushooting_standard_procedure'].'",';
				$row .= '"'.$user['customer13_check1'].'",';
				$row .= '"'.$user['customer13_check2'].'",';
				$row .= '"'.$user['customer13_check3'].'",';
				$row .= '"'.$user['customer13_check4'].'",';
				$row .= '"'.$user['observe_policies_appropiately'].'",';
				$row .= '"'.$user['customer14_check1'].'",';
				$row .= '"'.$user['customer14_check2'].'",';
				$row .= '"'.$user['customer14_check3'].'",';
				$row .= '"'.$user['process_of_soft_skill'].'",';
				$row .= '"'.$user['customer15_check1'].'",';
				$row .= '"'.$user['customer15_check2'].'",';
				$row .= '"'.$user['customer15_check3'].'",';
				$row .= '"'.$user['customer15_check4'].'",';
				$row .= '"'.$user['customer15_check5'].'",';
				$row .= '"'.$user['expectation_during_interaction'].'",';
				$row .= '"'.$user['customer16_check1'].'",';
				$row .= '"'.$user['customer16_check2'].'",';
				$row .= '"'.$user['customer16_check3'].'",';
				$row .= '"'.$user['customer16_check4'].'",';
				$row .= '"'.$user['use_proper_spelling'].'",';
				$row .= '"'.$user['customer17_check1'].'",';
				$row .= '"'.$user['customer17_check2'].'",';
				$row .= '"'.$user['customer17_check3'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt16'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt17'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_date'].'",';
				$row .= '"'.$user['client_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}
	
	}
	




///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////	 
////////////////////////////////////// QA craftjack REPORT ////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////

	public function qa_craftjack_report(){
		if(check_logged_in()){
			
			$office_id = "";
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_craftjack_report.php";

			$date_from="";
			$date_to="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			$data["qa_craftjack_list"] = array();
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
				
				$qSql="SELECT * from
					(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name from qa_craftjack_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, assigned_to from signin) yy on (xx.agent_id=yy.sid) Left join (Select fd_id, note as agent_note, date(entry_date) as agent_rvw_date from qa_craftjack_agent_rvw) zz on (xx.id=zz.fd_id) Left Join (Select fd_id as mgnt_fd_id, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as mgnt_name, note as mgnt_note, date(entry_date) as mgnt_rvw_date from qa_craftjack_mgnt_rvw) ww on (xx.id=ww.mgnt_fd_id) $cond $cond1 order by audit_date";	
					
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_craftjack_list"] = $fullAray;
				$this->create_qa_craftjack_CSV($fullAray);	
				$dn_link = base_url()."reports_qa/download_qa_craftjack_CSV";
				
			}	
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 
////////////Craftjack ///////////////////////////////
	public function download_qa_craftjack_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Craftjack Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_craftjack_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Call Duration", "Fusion ID", "Agent Name", "L1 Supervisor", "Call Date", "EXT Number", "Call Type", "Recording ID", "Audit Type", "VOC", "Call Pass/Fail", "Introduction - Your Name/Verify who you are speaking with/HomeAdvisor Branding","Educate -  Explain how Craft jack Project Advisor works","Solution -  You explained and offered appropriate solutions based on the consumer?s needs and the conversation","Location & Email - Verify Address if possible (Address required on IB Appts)- Zip code & Email","XM/MMR/IB -  Properly presented all XM/MMR/IB options","Expectations -  Make sure the Consumer knows what to expect after the call and Do what you said you would do","Professionalism -  Maintain proper tone - word choice and rate of speech. Avoid interrupting in a non collaborative conversation","Transfer -  Offer to transfer the Consumer to the Service Professional","Correct/Valid CTT -  Correct CTT was submitted and included a detailed description of the project","Correct Dispo -  Accurately updated and noted every SR submitted within the last 14 days","Displayed a Polite - positive & professional attitude ? does not interrupt","Displayed -Ownership/Decisiveness/Call Control","Listened with interest and acknowledged statements","Verbal Skills (volume/pitch/tone/jargon/slang & avoided dead air)","Customer's Card details captured without repeating","Used proper closing","Purpose -  The advisor stated their purpose for calling","Probe -  The advisor asked questions about the project and related projects & included detailed descriptions","Cross Sell -  The advisor asked for a cross sell","Branding -  Brand HomeAdvisor somewhere other than the Intro", "Overall Score","Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment" );
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
		
			if($user['introduction']==8) $introduction='Yes';
			else if($user['introduction']==0) $introduction='No';
			else if($user['introduction']==8.1) $introduction='N/A';

			if($user['educate']==4) $educate='Yes';
			else if($user['educate']==0) $educate='No';
			else if($user['educate']==4.1) $educate='N/A';

			if($user['solution']==10) $solution='Yes';
			else if($user['solution']==0) $solution='No';
			else if($user['solution']==10.1) $solution='N/A';

			if($user['email_zip_code']==10) $email_zip_code='Yes';
			else if($user['email_zip_code']==0) $email_zip_code='No';
			else if($user['email_zip_code']==10.1) $email_zip_code='N/A';

			if($user['xm_mmr_ib']==4) $xm_mmr_ib='Yes';
			else if($user['xm_mmr_ib']==0) $xm_mmr_ib='No';
			else if($user['xm_mmr_ib']==4.1) $xm_mmr_ib='N/A';
			else $xm_mmr_ib='N/A';
			
			if($user['expectation']==4) $expectation='Yes';
			else if($user['expectation']==0) $expectation='No';
			else if($user['expectation']==4.1) $expectation='N/A';
			else $expectation='N/A';

			if($user['professionalism']==4) $professionalism='Yes';
			else if($user['professionalism']==0) $professionalism='No';
			else if($user['professionalism']==4.1) $professionalism='N/A';
			else $professionalism='N/A';
			
			if($user['transfer']==4) $transfer='Yes';
			else if($user['transfer']==0) $transfer='No';
			else if($user['transfer']==4.1) $transfer='N/A';
			else $transfer='N/A';
			
			if($user['valid_ctt']==4) $valid_ctt='Yes';
			else if($user['valid_ctt']==0) $valid_ctt='No';
			else if($user['valid_ctt']==4.1) $valid_ctt='N/A';
			else $valid_ctt='N/A';
			
			if($user['correct_dispo']==4) $correct_dispo='Yes';
			else if($user['correct_dispo']==0) $correct_dispo='No';
			else if($user['correct_dispo']==4.1) $correct_dispo='N/A';
			else $correct_dispo='N/A';
			
			if($user['attitude']==8) $attitude='Yes';
			else if($user['attitude']==0) $attitude='No';
			else if($user['attitude']==8.1) $attitude='N/A';
			else $attitude='N/A';
			
			if($user['ownership']==4) $ownership='Yes';
			else if($user['ownership']==0) $ownership='No';
			else if($user['ownership']==4.1) $ownership='N/A';
			else $ownership='N/A';
			
			if($user['acknowledged']==10) $acknowledged='Yes';
			else if($user['acknowledged']==0) $acknowledged='No';
			else if($user['acknowledged']==10.1) $acknowledged='N/A';
			else $acknowledged='N/A';
			
			if($user['verbal_skill']==10) $verbal_skill='Yes';
			else if($user['verbal_skill']==0) $verbal_skill='No';
			else if($user['verbal_skill']==10.1) $verbal_skill='N/A';
			else $verbal_skill='N/A';
			
			if($user['card_detail']==10) $card_detail='Yes';
			else if($user['card_detail']==0) $card_detail='No';
			else if($user['card_detail']==10.1) $card_detail='N/A';
			else $card_detail='N/A';
			
			if($user['proper_closing']==8) $proper_closing='Yes';
			else if($user['proper_closing']==0) $proper_closing='No';
			else if($user['proper_closing']==8.1) $proper_closing='N/A';
			else $proper_closing='N/A';

			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",';
			$row .= '"'.$user['call_duration'].'",';			
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",'; 
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['ext_no'].'",';
			$row .= '"'.$user['call_type'].'",';
			$row .= '"'.$user['recording_id'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['call_pass_fail'].'",';
			$row .= '"'.$introduction.'",';
			$row .= '"'.$educate.'",';
			$row .= '"'.$solution.'",';
			$row .= '"'.$email_zip_code.'",';
			$row .= '"'.$xm_mmr_ib.'",';
			$row .= '"'.$expectation.'",';
			$row .= '"'.$professionalism.'",';
			$row .= '"'.$transfer.'",';
			$row .= '"'.$valid_ctt.'",';
			$row .= '"'.$correct_dispo.'",';
			$row .= '"'.$attitude.'",';
			$row .= '"'.$ownership.'",';
			$row .= '"'.$acknowledged.'",';
			$row .= '"'.$verbal_skill.'",';
			$row .= '"'.$card_detail.'",';
			$row .= '"'.$proper_closing.'",'; 
			$row .= '"'.$user['purpose_for_calling'].'",';
			$row .= '"'.$user['probe'].'",';
			$row .= '"'.$user['cross_sell'].'",';
			$row .= '"'.$user['branding'].'",';
			$row .= '"'.$user['overall_score'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';				
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////	 
////////////////////////////////////// QA PuppySpot REPORT ////////////////////////////////////	
///////////////////////////////////////////////////////////////////////////////////////////

	public function qa_puppyspot_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_puppyspot_report.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			
			$data["qa_puppyspot_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
		
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name from qa_puppyspot_pa_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, assigned_to from signin) yy on (xx.agent_id=yy.sid) Left join (Select fd_id, note as agent_note, date(entry_date) as agent_rvw_date from qa_puppyspot_pa_agent_rvw) zz on (xx.id=zz.fd_id) Left Join (Select fd_id as mgnt_fd_id, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as mgnt_name, note as mgnt_note, date(entry_date) as mgnt_rvw_date from qa_puppyspot_pa_mgnt_rvw) ww on (xx.id=ww.mgnt_fd_id) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_puppyspot_list"] = $fullAray;
				$this->create_qa_puppyspot_pa_CSV($fullAray);	
				$dn_link = base_url()."reports_qa/download_qa_puppyspot_pa_CSV";
				
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 
	
//////////////////PuppySpot PA///////////////////
	public function download_qa_puppyspot_pa_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA PuppySpot Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_puppyspot_pa_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Customer ID", "Call Date", "Call ID", "Phone", "Campaign", "Audit Type", "VOC", "Did the PA use correct greeting?", "Did the PA ask the customer for their name?", "Did the PA establish rapport by asking questions?", "Did the PA ask the customer to visit our website?", "Did the PA ask for the puppy of choice and/or recommend a puppy?", "Did the PA build excitement?", "Did the PA offer overcome customers objection?", "Did the PA avoid long silences during the call?", "Did the PA display a professional manner throughout the call?", "Did the PA sounded clear and confident throughout the call?", "Did the PA demonstrate active listening?", "Did the PA set an appointment? Did the PA transferred the call?", "Did the PA confirm the final cost?", "Did the PA complete the Sales recap?", "Did the PA set proper Travel expectations?", "Did the PA ask all screening questions?", "If no sale did the PA define the next steps?", "Did the PA effectively notate the contact?", "Overall Score", "Call Summary", "Opportunities", "Were there any violations in the call?If yes please explain", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
		
			if($user['correct_greeting']==2.1) $correct_greeting='N/A';
			else $correct_greeting=$user['correct_greeting'];
			
			if($user['customer_greeting']==3.1) $customer_greeting='N/A';
			else $customer_greeting=$user['customer_greeting'];
			
			if($user['rapport_greeting']==10.1) $rapport_greeting='N/A';
			else $rapport_greeting=$user['rapport_greeting'];
			
			if($user['website_greeting']==10.1) $website_greeting='N/A';
			else $website_greeting=$user['website_greeting'];
			
			if($user['puppy_greeting']==10.1) $puppy_greeting='N/A';
			else $puppy_greeting=$user['puppy_greeting'];
			
			if($user['excitement_sale']==3.1) $excitement_sale='N/A';
			else $excitement_sale=$user['excitement_sale'];
			
			if($user['objection_sale']==7.1) $objection_sale='N/A';
			else $objection_sale=$user['objection_sale'];
			
			if($user['silence_sale']==3.1) $silence_sale='N/A';
			else $silence_sale=$user['silence_sale'];
			
			if($user['professional_sale']==3.1) $professional_sale='N/A';
			else $professional_sale=$user['professional_sale'];
			
			if($user['sound_sale']==3.1) $sound_sale='N/A';
			else $sound_sale=$user['sound_sale'];
			
			if($user['listening_sale']==5.1) $listening_sale='N/A';
			else $listening_sale=$user['listening_sale'];
			
			if($user['transfer_closing']==10.1) $transfer_closing='N/A';
			else $transfer_closing=$user['transfer_closing'];
			
			if($user['cost_closing']==3.1) $cost_closing='N/A';
			else $cost_closing=$user['cost_closing'];
			
			if($user['sales_closing']==3.1) $sales_closing='N/A';
			else $sales_closing=$user['sales_closing'];
			
			if($user['travel_closing']==5.1) $travel_closing='N/A';
			else $travel_closing=$user['travel_closing'];
			
			if($user['screening_closing']==5.1) $screening_closing='N/A';
			else $screening_closing=$user['screening_closing'];
			
			if($user['step_closing']==5.1) $step_closing='N/A';
			else $step_closing=$user['step_closing'];
			
			if($user['contact_notation']==10.1) $contact_notation='N/A';
			else $contact_notation=$user['contact_notation'];
			
			
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",'; 
			$row .= '"'.$user['tl_name'].'",'; 
			$row .= '"'.$user['customer_id'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['call_id'].'",';
			$row .= '"'.$user['phone'].'",';
			$row .= '"'.$user['campaign'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$correct_greeting.'",'; 
			$row .= '"'.$customer_greeting.'",';
			$row .= '"'.$rapport_greeting.'",';
			$row .= '"'.$website_greeting.'",';
			$row .= '"'.$puppy_greeting.'",';
			$row .= '"'.$excitement_sale.'",';
			$row .= '"'.$objection_sale.'",';
			$row .= '"'.$silence_sale.'",';
			$row .= '"'.$professional_sale.'",';
			$row .= '"'.$sound_sale.'",';
			$row .= '"'.$listening_sale.'",';
			$row .= '"'.$transfer_closing.'",';
			$row .= '"'.$cost_closing.'",';
			$row .= '"'.$sales_closing.'",';
			$row .= '"'.$travel_closing.'",';
			$row .= '"'.$screening_closing.'",';
			$row .= '"'.$step_closing.'",';
			$row .= '"'.$contact_notation.'",';
			$row .= '"'.$user['overall_score'].'",'; 
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['opportunity'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['violation_explain'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';				
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}
	
	
//////////////////PuppySpot PC///////////////////
	public function download_qa_puppyspot_pc_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA PuppySpot PC Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_puppyspot_pc_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Customer ID", "Call Date", "Call ID", "Phone", "Campaign", "Audit Type", "VOC", "Did the PC use correct greeting?", "Did the PC ask the customer for their name?", "Has anyone from PuppySpot ever reached out to you before?", "Did the PC establish rapport by asking questions?", "Did the PC ask the customer to visit our web site?", "Did the PC ask for the puppy of choice and/or recommend a puppy?", "Did the PC build excitement?", "Did the PC offer overcome customers objection?", "Did the PC avoid long silences during the call?", "Did the PC display a professional manner throughout the call?", "Did the PC sound clear and confident throughout the call?", "Did the PC demonstrate active listening?", "Did the PC ask for the sale?", "Did the PC complete the Sales recap including final cost?", "Did the PC set proper Travel expectations?", "Did the PC ask all screening questions?", "Did the PC offer/explain the value of the Pup Pack?", "Did the PC explain our VIP Puppy program using VCA as value prop?", "If no sale did the PC define the next steps?", "Did the PC effectively notate the contact?", "Overall Score", "Call Summary", "Were there any violations in the call?If yes please explain", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			if($user['correct_greeting']==2.1) $correct_greeting='N/A';
			else $correct_greeting=$user['correct_greeting'];
			
			if($user['customer_greeting']==2.1) $customer_greeting='N/A';
			else $customer_greeting=$user['customer_greeting'];
			
			if($user['reached_greeting']==3.1) $reached_greeting='N/A';
			else $reached_greeting=$user['reached_greeting'];
			
			if($user['rapport_greeting']==8.1) $rapport_greeting='N/A';
			else $rapport_greeting=$user['rapport_greeting'];
			
			if($user['website_handle']==8.1) $website_handle='N/A';
			else $website_handle=$user['website_handle'];
			
			if($user['choice_handle']==8.1) $choice_handle='N/A';
			else $choice_handle=$user['choice_handle'];
			
			if($user['excitement_sale']==3.1) $excitement_sale='N/A';
			else $excitement_sale=$user['excitement_sale'];
			
			if($user['objection_sale']==7.1) $objection_sale='N/A';
			else $objection_sale=$user['objection_sale'];
			
			if($user['call_skill']==2.1) $call_skill='N/A';
			else $call_skill=$user['call_skill'];
			
			if($user['professional_skill']==3.1) $professional_skill='N/A';
			else $professional_skill=$user['professional_skill'];
			
			if($user['clear_skill']==3.1) $clear_skill='N/A';
			else $clear_skill=$user['clear_skill'];
			
			if($user['listening_skill']==5.1) $listening_skill='N/A';
			else $listening_skill=$user['listening_skill'];
			
			if($user['sales_closing']==8.1) $sales_closing='N/A';
			else $sales_closing=$user['sales_closing'];
			
			if($user['cost_closing']==5.1) $cost_closing='N/A';
			else $cost_closing=$user['cost_closing'];
			
			if($user['travel_closing']==5.1) $travel_closing='N/A';
			else $travel_closing=$user['travel_closing'];
			
			if($user['screening_closing']==5.1) $screening_closing='N/A';
			else $screening_closing=$user['screening_closing'];
			
			if($user['pup_closing']==5.1) $pup_closing='N/A';
			else $pup_closing=$user['pup_closing'];
			
			if($user['vca_closing']==5.1) $vca_closing='N/A';
			else $vca_closing=$user['vca_closing'];
			
			if($user['pcdefine_closing']==5.1) $pcdefine_closing='N/A';
			else $pcdefine_closing=$user['pcdefine_closing'];
			
			if($user['contact_notation']==8.1) $contact_notation='N/A';
			else $contact_notation=$user['contact_notation'];
			
			
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",'; 
			$row .= '"'.$user['tl_name'].'",'; 
			$row .= '"'.$user['customer_id'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['call_id'].'",';
			$row .= '"'.$user['phone'].'",';
			$row .= '"'.$user['campaign'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$correct_greeting.'",'; 
			$row .= '"'.$customer_greeting.'",';
			$row .= '"'.$reached_greeting.'",';
			$row .= '"'.$rapport_greeting.'",';
			$row .= '"'.$website_handle.'",';
			$row .= '"'.$choice_handle.'",';
			$row .= '"'.$excitement_sale.'",';
			$row .= '"'.$objection_sale.'",';
			$row .= '"'.$call_skill.'",';
			$row .= '"'.$professional_skill.'",';
			$row .= '"'.$clear_skill.'",';
			$row .= '"'.$listening_skill.'",';
			$row .= '"'.$sales_closing.'",';
			$row .= '"'.$cost_closing.'",';
			$row .= '"'.$travel_closing.'",';
			$row .= '"'.$screening_closing.'",';
			$row .= '"'.$pup_closing.'",';
			$row .= '"'.$vca_closing.'",';
			$row .= '"'.$pcdefine_closing.'",';
			$row .= '"'.$contact_notation.'",';
			$row .= '"'.$user['overall_score'].'",'; 
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['violation_explain'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';				
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}


	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////	 
////////////////////////////////////// QA CheckPoint REPORT ////////////////////////////////////	
///////////////////////////////////////////////////////////////////////////////////////////

	public function qa_checkpoint_report(){
		if(check_logged_in()){
			
			$office_id = "";
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			
			/* $office_id = $this->input->get('office_id');
			if($office_id=="")  $office_id=$user_office_id; */
			
			
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_checkpoint_report.php";
			
			
			$date_from="";
			$date_to="";
			$action="";
			$dn_link="";
			
			/* $cValue = trim($this->input->post('client_id'));
			if($cValue=="") $cValue = trim($this->input->get('client_id')); */
			
			$pValue = trim($this->input->post('process_id'));
			if($pValue=="") $pValue = trim($this->input->get('process_id'));
			
			//$data['cValue']=$cValue;
			$data['pValue']=$pValue;
			
			
			
			$data["qa_checkpoint_list"] = array();
			
			if(get_role_dir()=="super" || $is_global_access==1){
				$data['location_list'] = $this->Common_model->get_office_location_list();
			}else{
				$data['location_list'] = $this->Common_model->get_office_location_session_all($current_user);
			}
			
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				//$office_id = $this->input->get('office_id');
				
				$field_array = array(
						"date_from"=>$date_from,
						"date_to" => $date_to,
						//"office_id" => $office_id,
						"process_id" => $pValue,
						"current_user" => $current_user
					);
					
				
				if($pValue=='Checkpoint Email'){
					
					$fullAray = $this->Qa_checkpoint_model->qa_checkpoint_report_model($field_array);
					$data["qa_checkpoint_list"] = $fullAray;
					$this->create_qa_checkpoint_email_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_checkpoint_Email_CSV";
				
				}else if($pValue=='Checkpoint Chat'){
					
					$fullAray = $this->Qa_checkpoint_model->qa_checkpoint_report_model($field_array);
					$data["qa_checkpoint_list"] = $fullAray;
					$this->create_qa_checkpoint_chat_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_Checkpoint_Chat_CSV";
				
				}else{
					
					$fullAray = $this->Qa_checkpoint_model->qa_checkpoint_report_model($field_array);
					$data["qa_checkpoint_list"] = $fullAray;
					$this->create_qa_checkpoint_CSV($fullAray);	
					$dn_link = base_url()."reports_qa/download_qa_Checkpoint_CSV";
				
				}
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			//$data['office_id']=$office_id;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 
	
//////////////////CheckPoint///////////////////
	public function download_qa_checkpoint_email_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Checkpoint email -'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_checkpoint_email_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Customer ID", "Call Date", "Call ID", "Phone", "Campaign", "Audit Type", "VOC", 
		"Probing Question (to assist)", "Probing Question (to tag ticket)", "Accuracy and appropriateness of information", "Does the customer have more than 2 concerns / questions?", "Did the rep review previous conversation?", "Resolution", "Offer Additional/Alternate Resolution", "Empathy and Enthusiasm (apologize when needed only)", "Simplicity and Politeness", "Grammar", "Are the thoughts and instruction on the email properly organized?", "Salutation", "Closing", "Escalation / Asked for proper assistance", "Use of Proper Tools:", "Proper Tags were used on the ticket", "Other notes", "Timeliness of response", "Status", 
		"Probing Question (to assist) Remarks", "Probing Question (to tag ticket) Remarks", "Accuracy and appropriateness of information Remarks", "Does the customer have more than 2 concerns / questions? Remarks", "Did the rep review previous conversation? Remarks", "Resolution Remarks", "Offer Additional/Alternate Resolution Remarks", "Empathy and Enthusiasm (apologize when needed only) Remarks", "Simplicity and Politeness Remarks", "Grammar Remarks", "Are the thoughts and instruction on the email properly organized? Remarks", "Salutation Remarks", "Closing Remarks", "Escalation / Asked for proper assistance Remarks", "Use of Proper Tools: Remarks", "Proper Tags were used on the ticket Remarks", "Other notes Remarks", "Timeliness of response Remarks", "Status Remarks", 
		"Overall Score","Custiomer Score","Business Score","Compliance Score", "Recommendations", "Feedback", 
		"Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",'; 
			$row .= '"'.$user['tl_name'].'",'; 
			$row .= '"'.$user['customer_id'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['call_id'].'",';
			$row .= '"'.$user['phone'].'",';
			$row .= '"'.$user['campaign'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			
			if($user['probing_que_assist'] == '0') $probing_que_assist = "No";
			else if($user['probing_que_assist'] == '-1') $probing_que_assist = "NA";
			else $probing_que_assist = "Yes";			
			$row .= '"'.$probing_que_assist.'",';
			
			if($user['probing_que_ticket'] == '0') $probing_que_ticket = "No";
			else if($user['probing_que_ticket'] == '-1') $probing_que_ticket = "NA";
			else $probing_que_ticket = "Yes";
			$row .= '"'.$probing_que_ticket.'",';
			
			if($user['accuracy_info'] == '0') $accuracy_info = "No";
			else if($user['accuracy_info'] == '-1') $accuracy_info = "NA";
			else $accuracy_info = "Yes";
			$row .= '"'.$accuracy_info.'",';
			
			if($user['more_concerns'] == '0') $more_concerns = "No";
			else if($user['more_concerns'] == '-1') $more_concerns = "NA";
			else $more_concerns = "Yes";
			$row .= '"'.$more_concerns.'",';
			
			if($user['review_conversation'] == '0') $review_conversation = "No";
			else if($user['review_conversation'] == '-1') $review_conversation = "NA";
			else $review_conversation = "Yes";
			$row .= '"'.$review_conversation.'",';
			
			if($user['resolution'] == '0') $resolution = "No";
			else if($user['resolution'] == '-1') $resolution = "NA";
			else $resolution = "Yes";
			$row .= '"'.$resolution.'",';
			
			if($user['offer_additional'] == '0') $offer_additional = "No";
			else if($user['offer_additional'] == '-1') $offer_additional = "NA";
			else $offer_additional = "Yes";			
			$row .= '"'.$offer_additional.'",';
			
			if($user['empathy_enthusiasm'] == '0') $empathy_enthusiasm = "No";
			else if($user['empathy_enthusiasm'] == '-1') $empathy_enthusiasm = "NA";
			else $empathy_enthusiasm = "Yes";
			$row .= '"'.$empathy_enthusiasm.'",';
			
			if($user['simplicity_politeness'] == '0') $simplicity_politeness = "No";
			else if($user['simplicity_politeness'] == '-1') $simplicity_politeness = "NA";
			else $simplicity_politeness = "Yes";
			$row .= '"'.$simplicity_politeness.'",';
			
			if($user['grammar'] == '0') $grammar = "No";
			else if($user['grammar'] == '-1') $grammar = "NA";
			else $grammar = "Yes";
			$row .= '"'.$grammar.'",';
			
			if($user['instruction_email'] == '0') $instruction_email = "No";
			else if($user['instruction_email'] == '-1') $instruction_email = "NA";
			else $instruction_email = "Yes";
			$row .= '"'.$instruction_email.'",';
			
			if($user['salutation'] == '0') $salutation = "No";
			else if($user['salutation'] == '-1') $salutation = "NA";
			else $salutation = "Yes";
			$row .= '"'.$salutation.'",';
			
			if($user['closing'] == '0') $closing = "No";
			else if($user['closing'] == '-1') $closing = "NA";
			else $closing = "Yes";
			$row .= '"'.$closing.'",';
			
			if($user['escalation'] == '0') $escalation = "No";
			else if($user['escalation'] == '-1') $escalation = "NA";
			else $escalation = "Yes";
			$row .= '"'.$escalation.'",';
			
			if($user['proper_tools'] == '0') $proper_tools = "No";
			else if($user['proper_tools'] == '-1') $proper_tools = "NA";
			else $proper_tools = "Yes";
			$row .= '"'.$proper_tools.'",';
			
			if($user['proper_tags'] == '0') $proper_tags = "No";
			else if($user['proper_tags'] == '-1') $proper_tags = "NA";
			else $proper_tags = "Yes";
			$row .= '"'.$proper_tags.'",';
			
			if($user['other_notes'] == '0') $other_notes = "No";
			else if($user['other_notes'] == '-1') $other_notes = "NA";
			else $other_notes = "Yes";
			$row .= '"'.$other_notes.'",';
			
			if($user['timeliness_response'] == '0') $timeliness_response = "No";
			else if($user['timeliness_response'] == '-1') $timeliness_response = "NA";
			else $timeliness_response = "Yes";
			$row .= '"'.$timeliness_response.'",';
			
			if($user['status'] == '0') $status = "No";
			else if($user['status'] == '-1') $status = "NA";
			else $status = "Yes";
			$row .= '"'.$status.'",';
			/*$row .= '"'.$user['probing_que_assist'].'",';
			$row .= '"'.$user['probing_que_ticket'].'",';
			$row .= '"'.$user['accuracy_info'].'",';
			$row .= '"'.$user['more_concerns'].'",';
			$row .= '"'.$user['review_conversation'].'",';
			$row .= '"'.$user['resolution'].'",';
			$row .= '"'.$user['offer_additional'].'",';
			$row .= '"'.$user['empathy_enthusiasm'].'",';
			$row .= '"'.$user['simplicity_politeness'].'",';
			$row .= '"'.$user['grammar'].'",';
			$row .= '"'.$user['instruction_email'].'",';
			$row .= '"'.$user['salutation'].'",';
			$row .= '"'.$user['closing'].'",';
			$row .= '"'.$user['escalation'].'",';
			$row .= '"'.$user['proper_tools'].'",';
			$row .= '"'.$user['proper_tags'].'",';
			$row .= '"'.$user['other_notes'].'",';
			$row .= '"'.$user['timeliness_response'].'",';
			$row .= '"'.$user['status'].'",';*/
			
			$row .= '"'.$user['probing_que_assist_rmk'].'",';
			$row .= '"'.$user['probing_que_ticket_rmk'].'",';
			$row .= '"'.$user['accuracy_info_rmk'].'",';
			$row .= '"'.$user['more_concerns_rmk'].'",';
			$row .= '"'.$user['review_conversation_rmk'].'",';
			$row .= '"'.$user['resolution_rmk'].'",';
			$row .= '"'.$user['offer_additional_rmk'].'",';
			$row .= '"'.$user['empathy_enthusiasm_rmk'].'",';
			$row .= '"'.$user['simplicity_politeness_rmk'].'",';
			$row .= '"'.$user['grammar_rmk'].'",';
			$row .= '"'.$user['instruction_email_rmk'].'",';
			$row .= '"'.$user['salutation_rmk'].'",';
			$row .= '"'.$user['closing_rmk'].'",';
			$row .= '"'.$user['escalation_rmk'].'",';
			$row .= '"'.$user['proper_tools_rmk'].'",';
			$row .= '"'.$user['proper_tags_rmk'].'",';
			$row .= '"'.$user['other_notes_rmk'].'",';
			$row .= '"'.$user['timeliness_response_rmk'].'",';
			$row .= '"'.$user['status_rmk'].'",';
			
			$row .= '"'.$user['overall_score'].'",'; 
			$row .= '"'.$user['cust_score'].'",'; 
			$row .= '"'.$user['busi_score'].'",'; 
			$row .= '"'.$user['comp_score'].'",'; 
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['recommendations'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';				
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}
	
	public function download_qa_checkpoint_chat_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Checkpoint Chat -'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_checkpoint_chat_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Customer ID", "Call Date", "Call ID", "Phone", "Campaign", "Audit Type", "VOC", 
		"Opening Spiel", "Offered Assistance", "Empathy", "Being Polite and Courteous", "PETA (Permission/ Explanation/ Time Frame/ Acknowledgment)", "Reduced Response Time (Quick/Timely Response)", "Chat Flow based on service SOPs and Protocols", "Understanding the issue", "Proper Probing", "Accuracy", "Product Service Information", "Technical Procedures", "Case Logs/Documentation", "Actions Taken (FF up email/ Escalation/ Etc.)", "Correct Grammar/ Spelling/ Punctuation and Verbiage", "Proper Use of Canned Messages", "Customer Satisfaction", 
		"Opening Spiel Remarks", "Offered Assistance Remarks", "Empathy Remarks", "Being Polite and Courteous Remarks", "PETA (Permission/ Explanation Remarks/ Time Frame/ Acknowledgment) Remarks", "Reduced Response Time (Quick/Timely Response) Remarks", "Chat Flow based on service SOPs and Protocols Remarks", "Understanding the issue Remarks", "Proper Probing Remarks", "Accuracy Remarks", "Product Service Information Remarks", "Technical Procedures Remarks", "Case Logs/Documentation Remarks", "Actions Taken (FF up email/ Escalation/ Etc.) Remarks", "Correct Grammar/ Spelling/ Punctuation and Verbiage Remarks", "Proper Use of Canned Messages Remarks", "Customer Satisfaction Remarks", 
		"Overall Score","Custiomer Score","Business Score","Compliance Score", "Recommendations", "Call Summary",
		"Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",'; 
			$row .= '"'.$user['tl_name'].'",'; 
			$row .= '"'.$user['customer_id'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['call_id'].'",';
			$row .= '"'.$user['phone'].'",';
			$row .= '"'.$user['campaign'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			
			$row .= '"'.$user['opening_spiel'].'",';
			$row .= '"'.$user['offered_assistance'].'",';
			$row .= '"'.$user['empathy'].'",';
			$row .= '"'.$user['being_polite'].'",';
			$row .= '"'.$user['peta'].'",';
			$row .= '"'.$user['reduced_response_time'].'",';
			$row .= '"'.$user['chat_flow'].'",';
			$row .= '"'.$user['understanding_issue'].'",';
			$row .= '"'.$user['proper_probing'].'",';
			$row .= '"'.$user['accuracy'].'",';
			$row .= '"'.$user['product_service_info'].'",';
			$row .= '"'.$user['technical_procedures'].'",';
			$row .= '"'.$user['case_logs'].'",';
			$row .= '"'.$user['actions_taken'].'",';
			$row .= '"'.$user['correct_grammar'].'",';
			$row .= '"'.$user['proper_use_msg'].'",';
			$row .= '"'.$user['cust_satisfaction'].'",';
			
			
			$row .= '"'.$user['opening_spiel_rmk'].'",';
			$row .= '"'.$user['offered_assistance_rmk'].'",';
			$row .= '"'.$user['empathy_rmk'].'",';
			$row .= '"'.$user['being_polite_rmk'].'",';
			$row .= '"'.$user['peta_rmk'].'",';
			$row .= '"'.$user['reduced_response_time_rmk'].'",';
			$row .= '"'.$user['chat_flow_rmk'].'",';
			$row .= '"'.$user['understanding_issue_rmk'].'",';
			$row .= '"'.$user['proper_probing_rmk'].'",';
			$row .= '"'.$user['accuracy_rmk'].'",';
			$row .= '"'.$user['product_service_info_rmk'].'",';
			$row .= '"'.$user['technical_procedures_rmk'].'",';
			$row .= '"'.$user['case_logs_rmk'].'",';
			$row .= '"'.$user['actions_taken_rmk'].'",';
			$row .= '"'.$user['correct_grammar_rmk'].'",';
			$row .= '"'.$user['proper_use_msg_rmk'].'",';
			$row .= '"'.$user['cust_satisfaction_rmk'].'",';
			
			$row .= '"'.$user['overall_score'].'",'; 
			$row .= '"'.$user['cust_score'].'",'; 
			$row .= '"'.$user['busi_score'].'",'; 
			$row .= '"'.$user['comp_score'].'",'; 
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['recommendations'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';				
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}
	
	
//////////////////CheckPoint///////////////////
	public function download_qa_checkpoint_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Checkpoint Chat -'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_checkpoint_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Customer ID", "Call Date", "Call ID", "Phone", "Campaign", "Audit Type", "VOC", 
		"Greetings and closing", "Identify the correct reason for chatting", "Made the customer feel important and top priority", "Grammar. Thoughts are organized. Handles the customers multiple concerns one at a time", "Does the customer have more than 1 concern?", "Dead Air / Long Periods of Silence", "Gives correct information", "Probing Questions (to Assist)", "Probing Questions (to Tag)", "Gives correct and appropriate instruction (TS)", "Documents chat on Agent Prod Tracker", "Uses the correct Tags in Zendesk", "Demonstrates correct use of system tools (client or internal) to help the customer", "Sends an email for Escalation/ Suggestion/ Feedback/ Comment/ Asking for further assistance", "Greetings and closing Remarks", "Identify the correct reason for chatting Remarks", "Made the customer feel important and top priority Remarks", "Grammar. Thoughts are organized. Handles the customers multiple concerns one at a time Remarks", "Does the customer have more than 1 concern? Remarks", "Dead Air / Long Periods of Silence Remarks", "Gives correct information Remarks", "Probing Questions (to Assist) Remarks", "Probing Questions (to Tag) Remarks", "Gives correct and appropriate instruction (TS) Remarks", "Documents chat on Agent Prod Tracker Remarks", "Uses the correct Tags in Zendesk Remarks", "Demonstrates correct use of system tools (client or internal) to help the customer Remarks", "Sends an email for Escalation/ Suggestion/ Feedback/ Comment/ Asking for further assistance Remarks",
		"Overall Score", "Custiomer Score","Business Score","Compliance Score", "Call Summary", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",'; 
			$row .= '"'.$user['tl_name'].'",'; 
			$row .= '"'.$user['customer_id'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['call_id'].'",';
			$row .= '"'.$user['phone'].'",';
			$row .= '"'.$user['campaign'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			
			$row .= '"'.$user['greetings_closing'].'",';
			$row .= '"'.$user['identify_reason_chatting'].'",';
			$row .= '"'.$user['made_customer_feel'].'",';
			$row .= '"'.$user['customers_multiple_concerns'].'",';
			if($user['customer_more_concern'] == '1.1')
				$row .= '"N/A",';
			else
				$row .= '"'.$user['customer_more_concern'].'",';
			$row .= '"'.$user['dead_air'].'",';
			$row .= '"'.$user['correct_information'].'",';
			$row .= '"'.$user['probing_assist'].'",';
			$row .= '"'.$user['probing_tag'].'",';
			$row .= '"'.$user['appropriate_instruction'].'",';
			$row .= '"'.$user['documents_chat'].'",';
			$row .= '"'.$user['tags_zendesk'].'",';
			$row .= '"'.$user['help_customer'].'",';
			$row .= '"'.$user['further_assistance'].'",';
			
			$row .= '"'.$user['greetings_closing_rmk'].'",';
			$row .= '"'.$user['identify_reason_chatting_rmk'].'",';
			$row .= '"'.$user['made_customer_feel_rmk'].'",';
			$row .= '"'.$user['customers_multiple_concerns_rmk'].'",';
			$row .= '"'.$user['customer_more_concern_rmk'].'",';
			$row .= '"'.$user['dead_air_rmk'].'",';
			$row .= '"'.$user['correct_information_rmk'].'",';
			$row .= '"'.$user['probing_assist_rmk'].'",';
			$row .= '"'.$user['probing_tag_rmk'].'",';
			$row .= '"'.$user['appropriate_instruction_rmk'].'",';
			$row .= '"'.$user['documents_chat_rmk'].'",';
			$row .= '"'.$user['tags_zendesk_rmk'].'",';
			$row .= '"'.$user['help_customer_rmk'].'",';
			$row .= '"'.$user['further_assistance_rmk'].'",';
			
			$row .= '"'.$user['overall_score'].'",'; 
			$row .= '"'.$user['cust_score'].'",'; 
			$row .= '"'.$user['busi_score'].'",'; 
			$row .= '"'.$user['comp_score'].'",'; 
			//$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			//$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['violation_explain'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';				
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}


		public function qa_araca_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_araca_report.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			
			$data["qa_araca_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
				
		
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name from qa_araca_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, get_process_names(id) as campaign, assigned_to from signin) yy on (xx.agent_id=yy.sid) Left join (Select fd_id, note as agent_note, date(entry_date) as agent_rvw_date from qa_araca_agent_rvw) zz on (xx.id=zz.fd_id) Left Join (Select fd_id as mgnt_fd_id, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as mgnt_name, note as mgnt_note, date(entry_date) as mgnt_rvw_date from qa_araca_mgnt_rvw) ww on (xx.id=ww.mgnt_fd_id) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_araca_list"] = $fullAray;
				$this->create_qa_araca_CSV($fullAray);	
				$dn_link = base_url()."reports_qa/download_qa_araca_CSV";
				
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_araca_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA araca Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_araca_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Call Date", "Call Duration", "UCID/REC ID(Uptivity/OC Tool)", "Campaign", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Identifying Himself/Herself", "Verify account information", "Communicates", "Active Listening Skills", "Professionalism", "Call Control/Hold Techniques", "Answers questions accurately", "Reason for the call", "Effective Value Building", "Effective Single Call Resolution Attempt", "Product Terms & Conditions Disclosed", "Closed Call Properly", "Overall Score", "QA Comment", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['call_duration'].'",';
			$row .= '"'.$user['uc_id'].'",';
			$row .= '"'.$user['campaign'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['identifying'].'",';
			$row .= '"'.$user['accinfo'].'",';
			$row .= '"'.$user['communicate'].'",';
			$row .= '"'.$user['listeningskill'].'",';
			$row .= '"'.$user['professional'].'",';
			$row .= '"'.$user['callcontrol'].'",';
			$row .= '"'.$user['answerquestion'].'",';
			$row .= '"'.$user['reasoncall'].'",';
			$row .= '"'.$user['valuebuilding'].'",';
			$row .= '"'.$user['callresolution'].'",';
			$row .= '"'.$user['termcondition'].'",';
			$row .= '"'.$user['closecall'].'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['qa_comment'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';				
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}


///////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////// AMERIDIAL ////////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////
	
	public function qa_ameridial_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_ameridial_report.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$from_date="";
			$to_date="";
			$process_id="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			$cond2="";
			$cmp1='';
			
			$process_id = $this->input->get('process_id');
			
			$data["qa_ameridial_list"] = array();
			
			if($process_id!=""){
			
				if($this->input->get('show')=='Show')
				{
					$from_date = mmddyy2mysql($this->input->get('from_date'));
					$to_date = mmddyy2mysql($this->input->get('to_date'));
					$office_id = $this->input->get('office_id');
					$lob = $this->input->get('lob');
					
					
					if($from_date !="" && $to_date!=="" )  $cond= " Where (date(audit_date) >= '$from_date' and date(audit_date) <= '$to_date' ) ";
					
					if($office_id=="All") $cond .= "";
					else $cond .=" and office_id='$office_id'";
					
					if(get_user_fusion_id()!='FMIN000011' || get_user_fusion_id()!='FUTA000007' || get_user_fusion_id()!='FUTA000012'){
						$ops_cond="";
					}else{
						if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
							$ops_cond=" Where (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
						}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
							$ops_cond=" Where assigned_to='$current_user'";
						}else{
							$ops_cond="";
						}
					}

					$qSql="SELECT * from (Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, (select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name from qa_amd_".$process_id."_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, get_process_names(id) as campaign, DATEDIFF(CURDATE(), doj) as tenure, assigned_to from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
					
					$fullAray = $this->Common_model->get_query_result_array($qSql);
					
					$data["qa_ameridial_list"] = $fullAray;

					if(!in_array($process_id,array('episource','magnilife','blains','pajamagram','delta','brightway_prescreen','brightway_evaluation','trapollo'))){
					
						$this->create_qa_ameridial_CSV($fullAray,$process_id);	
						
					
					}else{

						$header=$process_id."Header";
						$header=$this->$header();
						
						$this->create_qa_amd_common_new_CSV($header,$fullAray,$process_id);
					
					}

					$dn_link = base_url()."reports_qa/download_qa_ameridial_CSV/".$process_id;
					
					
				}
			
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['from_date'] = $from_date;
			$data['to_date'] = $to_date;	
			$data['office_id']=$office_id;
			$data['process_id']=$process_id;
			//$data['lob']=$lob;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_ameridial_CSV($pid)
	{
		if($pid=='fortunebuilder'){
			$pname='Fortune Biulder';
		}else if($pid=='hoveround'){
			$pname='Hoveround';
		}else if($pid=='ncpssm'){
			$pname='NCPSSM';
		}else if($pid=='stc'){
			$pname='STC Scoresheet';
		}else if($pid=='touchfuse'){
			$pname='TouchFuse';
		}else if($pid=='tbn'){
			$pname='TBN Scoresheet';
		}else if($pid=='purity_free_bottle'){
			$pname='Purity Free Bottle';
		}else if($pid=='purity_catalog'){
			$pname='Purity Catalog';
		}else if($pid=='purity_care'){
			$pname='Purity Care';
		}else if($pid=='puritycare_new'){
			$pname='Purity Care New';
		}else if($pid=='jfmi'){
			$pname='JFMI';
		}else if($pid=='tpm'){
			$pname='TPM Scoresheet';
		}else if($pid=='patchology'){
			$pname='Patchology Agent Improvement';
		}else if($pid=='aspca'){
			$pname='ASPCA Scoresheet';
		}else if($pid=='ffai'){
			$pname='FilterFast Agent Improvement Scoresheet';
		}else if($pid=='lifi'){
			$pname='LIFI Improvement Scoresheet';
		}else if($pid=='heatsurge'){
			$pname='Heat Surge';
		}else if($pid=='stauers_sales'){
			$pname='Stauers Sales'; 
		}else if($pid=='operation_smile'){
			$pname='Operation Smile'; 
		}else if($pid=='5_11_tactical'){
			$pname='5-11 Tactical'; 
		}else if($pid=='jmmi'){
			$pname='JMMI'; 
		}else if($pid=='non_profit'){
			$pname='Non-Profit'; 
		}else if($pid=='revel'){
			$pname='REVEL'; 
		}else if($pid=='qpc'){
			$pname='QPC'; 
		}else if($pid=='ancient_nutrition'){
			$pname='Ancient Nutrition'; 
		}else if($pid=='powerfan'){
			$pname='Power Fan';
		}else if($pid=='nuwave'){
			$pname='NuWave';
		}else if($pid=='sabal'){
			$pname='SABAL'; 
		}else if($pid=='curative'){
			$pname='CURATIVE'; 
		}else if($pid=='episource'){
			$pname='EPISOURCE'; 
		}else if($pid=='magnilife'){
			$pname='MAGNILIFE'; 
		}else if($pid=='blains'){
			$pname='BLAINS'; 
		}else if($pid=='pajamagram'){
			$pname='PAJAMAGRAM'; 
		}else if($pid=='delta'){
			$pname='DELTA DENTAL [ILLINOIS]';
		}else if($pid=='delta_iowa'){
			$pname='DELTA DENTAL [IOWA]';
		}else if($pid=='brightway_prescreen'){
			$pname='Brightway Prescreen'; 
		}else if($pid=='brightway_evaluation'){
			$pname='Brightway Evaluation'; 
		}
		
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Ameridial ".$pname." Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}

//////////// qa_amd_report_header///////////////////////////////////

	function episourceHeader(){

		return Array ("Auditor Name","Audit Date","Call Date","Fusion Id","Agent","L1 Super","Call Reference","Call Status","System","Site","Call Duration","File No.","Audit Type","Auditor Type","VOC", "Overall Score","Did the agent provide the appropriate introduction? ","Did the agent provide a clear reason for the call?","Did the agent accurately respond to the member’s questions?","Did the agent allow the member to speak uninterrupted?","Did the agent avoid long periods of silence?","Did the agent ask to schedule the visit.","Did the agent verify the member?","Did the agent include all relevant details for the appointment?","Did the agent verify the full address?","Did the agent advise member to take note of all confirmation details?","Did the agent accurately document notes to NP?","Did the agent provide two response?","Did the agent advise of a reminder call?","Did the agent provide a fitting  closing for each call?","Did the agent status and document Salesforce correctly?","Did the agent advise the member he/she was on a recorded line?","Did the agent follow verification requirements for the script?","Did the agent maintain security of PHI and abide by HIPAA requirements?","Did the agent Inappropriately release the call prior ot providing an approptiate closing?","Did the agent perform any unauthorized action on a member profile","Did the agent knowingly providing false information?","Did the agent place blame?","Call Summary","Feedback","Entry By","Entry Date","Client entry by","Mgnt review by","Mgnt review note","Mgnt review date","Agent Feedback Acceptance","Agent review note","Agent review date","Client review by","Client review note","Client_rvw_date");

	}

	///////////////////////Magnilife/////////////////////////////////////

	function magnilifeHeader(){
		return Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","File No","Call Date","Call Duration","Audit Type","Auditor Type","VOC", "disposition","Overall Score","Possible Score","Earned Score","Greeting (Agent complied with greeting mentioned Brand and call reason )","Enthusiasm (Agent sounds with enthusiasm good energy when speaking)","Clarity (Agent demonstrate a good level of grammar pronunciation pace and confidence at the time of speaking)","Professionalism (listening skills phone etiquette maintain call control and ethics agent's ethics)","Product knowledge (Agent answers product questions sounds as a product expert)","Accuracy (Agent provides accurate product information to the customer avoid providing false expectation/information to the customer)","Efficiency (Agent works effectively during the call to complete the purpose of the call )","System Knowledge (Agent demonstrates program knowledge)","Offer Information (Agents read offer information to the customer including price and features with good and clear pace)","Purchase confirmation (Agent confirms purchase information including prices provides confirmation number to the customer)","Call Summary","Feedback","Entry By","Entry Date","Client entry by","Mgnt review by","Mgnt review note","Mgnt review date","Agent Feedback Acceptance","Agent review note","Agent review date","Client review by","Client review note","Client_rvw_date" );
	}

	///////////////////////Blains/////////////////////////////////////

	function blainsHeader(){
		return Array ("Auditor Name","Audit Date","Call Date","Fusion Id","Agent","L1 Super","Phone","Filler 2","Area Code","Site","Call Duration","File No","Audit Type","Auditor Type","VOC", "Possible Score","Earned Score","Overall Score","Correct Call Path Procedures","Data & Program Integrity for Order Capture","Correct use of Flags/Escalations/Transfer","Correct use of FAQs/Memos/Promotions/Website","Professionalism/Courtesy","Ready for call and no dead air","Tone / Grammar & Pronunciation / Pacing","Offers e-alerts to caller","Attentive Listening","Blain's Culture Followed","Comments 1","Comments 2","Comments 3","Comments 4","Comments 5","Comments 6","Comments 7","Comments 8","Comments 9","Comments 10","Call Summary","Feedback","Entry By","Entry Date","Audit Start Time","Client entry by","Mgnt review by","Mgnt review note","Mgnt review date","Agent Feedback Acceptance","Agent review note","Agent review date","Client review by","Client review note","Client_rvw_date");
	}

	function brightway_evaluationHeader(){
		return Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Phone","Call Date","Call Duration","Audit Type","Auditor Type ","VOC ","Enter Policy Information ","Skill - Select all the Apply ","File No. ", "Overall Score ","Possible Score ","Earned Score ","Did the CSR use the approved greeting ","Did rep advise they were on a recorded line ","Did the associate use the appropriate tone pace and professionalism while avoidinginsurance jargon? ","Did the associate demonstrate the right level of empathy or sympathy? ","Did the associate listen carefully to understand and address the customers needs askingprobing questions and verbally verify the information obtained and processed? ","Did the CSR follow the appropriate hold procedure and provide a wrap-up summary ","The associate maintained call control throughout the call by guiding the conversation ","All verbal and written information provided by associate to insured and other parties wasclear ","If call was transferred was the appropriate transfer process followed? ","Did the CSR attempt to contact the callerback to complete the call? ","Worked correct policy. ","Created all activities corresponding with the interaction with clear ","Were the correct interaction templates used? ","Attached all emails fax confirmations and other documents as needed ","Was the issue or request resolved/completed? ","Effectively accessed and utilized all appropriate systems and resources to obtaininformation ","If a renewal payment was processed and there is an open renewal suspense was thesuspense updated and closed? ","Did the associate offer additional assistance thanked the customer? ","Was the customer adversely impacted? ","Were there any additional adverse impacts? ","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","Comments 8 ","Comments 9 ","Comments 10 ","Comments 11 ","Comments 12 ","Comments 13 ","Comments 14 ","Comments 15 ","Comments 16 ","Comments 17 ","Comments 18 ","Comments 19 ","Comments 20 ","Call Summary ","Feedback ","Entry By ","Entry Date ","Audit Start Time ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent Feedback Acceptance","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date");
	}

	function brightway_prescreenHeader(){
		return Array ("Auditor Name","Audit Date","Call Date","Fusion Id","Agent","L1 Super","Phone","Filler 2","Area Code","Site ","Call Duration ","File No. ","Audit Type ","Auditor Type ","VOC ", "Possible Score ","Earned Score ","Overall Score ","Transfer to ","Did the associate use the appropriate greeting? ","Was the Pre-Screen template completed correctly? ","Did the associate disposition the call correctly? ","Did the associate use the appropriate verbiage tone pace and professionalism? ","Did the associate transfer to the correct skill based on the decision flow diagram? ","Was the caller appropriately authenticated? ","If verified and change needed was AMS updated? ","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","Comments 8 ","Call Summary ","Feedback ","Entry By ","Entry Date ","Audit Start Time ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent Feedback Acceptance","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date");
	}

	function pajamagramHeader(){
		return Array ("Auditor Name","Audit Date","Call Date","Fusion Id","Agent","L1 Super","Phone","Call Duration","File No","Audit Type","Auditor Type","VOC", "Possible Score","Earned Score","Overall Score","Caller is ready and logged in to website to handle call","Greet caller and Thank them for calling Pajamagram or Vermont Teddy Bear","Ask caller what can we order for them today","Verify all  caller and product information","Assist search if caller doesn’t know specific item","Offer personalization if available","Offer Upsell","Ask for additional items","Confirm email and phone number","Energy/enthusiasm","Proper pace","Maintained control of the conversation/Minimal Dead Air","Spoke clearly/utilized proper grammar (NO SLANG)","Good listening skills/Does not interrupt","Empathized with caller","Overall professionalism","Ask for Priority code if caller has catalog","Enter advertising source from CRM screen or ask caller for it","Close call with order confirmaiton and Thank caller for their order","False/inappropriate information","Hung up inappropriately","Unprofessional or rude behavior","Inappropriate language","Comments 1","Comments 2","Comments 3","Comments 4","Comments 5","Call Summary","Feedback","Entry By","Entry Date","Audit Start Time","Client entry by","Mgnt review by","Mgnt review note","Mgnt review date","Agent Feedback Acceptance","Agent review note","Agent review date","Client review by","Client review note","Client_rvw_date");
	}

	public function deltaHeader(){

		return $arrayName = Array ("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Phone","Call Date","Call Duration","Audit Type","Auditor Type","VOC","File No.", "Overall Score","Possible Score","Earned Score","Did CER appropriately greet the caller?","Did CER use a pleasant respectful tone and use the caller's name at least once during the call?","Did CER answer in a timely manner?","Did CER obtain 3 pieces of PHI?","Did CER obtain member's information first and then provider's if on provider call?","If Non-Covered Parent did the caller answer yes to all 3 questions on Guidelines tab?","Did CER ask appropriate questions to determine the purpose of the call?","Did CER assess all information before responding to the caller? (BVN)","Did CER pose appropriate questions to clarify the caller's issue? (Restate Issue)","Did CER utilize active listening skills throughout the inquiry?","Did CER demonstrate use of call control techniques?","Did CER refrain from interrupting the caller?","Did CER speak clearly and concisely and at an appropriate pace?","Did CER avoid use of internal terms technical terms slang and jargon?","Did CER demonstrate confidence in responses?","Did CER minimize silences and use fillers to obtain additional information?","Did CER provide accurate information and/or demonstrate knowledge of client's benefit programs?","Did CER take correct action to resolve the caller's issues?","Did CER promote self-service options where appropriate?","Did CER answer questions clearly and completely?","Was CER proactive by anticipating additional needs of the caller?","Did CER accurately and completely document the call's outcome?","Did the CER document the callers phone number name call type CITS code etc?","Did CER close CITS if it did not require a follow up?","Did CER confirm resolution of the caller's question?","Did CER ask if any additional information could be provided?","Did CER thank the individual for calling and release the call within 5 seconds","Comments 1","Comments 2","Comments 3","Comments 4","Comments 5","Comments 6","Comments 7","Comments 8","Comments 9","Comments 10","Comments 11","Comments 12","Comments 13","Comments 14","Comments 15","Comments 16","Comments 17","Comments 18","Comments 19","Comments 20","Comments 21","Comments 22","Comments 23","Comments 24","Comments 25","Comments 26","Comments 27","Call Summary","Feedback","Entry By","Entry Date","Audit Start Time","Client entry by","Mgnt review by","Mgnt review note","Mgnt review date","Agent Feedback Acceptance","Agent review note","Agent review date","Client review by","Client review note","Client_rvw_date");
	}

	////////////////////support function for Report///////////////////////

	public function getval1($arrs, $k) {
    foreach($arrs as $key=>$val) {
        if( $key === $k ) {
            return $val;
        }
        else {
            if(is_array($val)) {
                $ret = $this->getval1($val, $k);
                if($ret !== NULL) {
                    return $ret;
                }
            }
        }
    }
    return NULL;
	}


	// function abc(){

	// 	echo "work please";

	// 	// $this->db->query("create table xyz1 as SELECT phno as phone1,concat(fname,' ',lname) as name,email_id as email FROM `signin` WHERE 1");

		
	// 	$field_name=$this->Common_model->get_query_result_array("SELECT phno as phone1,concat(fname,' ',lname) as name,email_id as email FROM `signin` WHERE 1");
	// 	// print_r($field_name);
	// 	$this->create_qa_ameridial_CSV($field_name,"xyz");
	// 	$dn_link = base_url()."qa_ameridial/download_qa_ameridial_CSV/"."Full User Details";



	// }

	////////////////Dynamic function for automatic report generation//////////////

	public function create_qa_amd_common_new_CSV($header,$rr,$pid)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");		
		
		$field_name="SHOW FULL COLUMNS FROM qa_amd_".$pid."_feedback WHERE Comment!=''";
		$field_name=$this->Common_model->get_query_result_array($field_name);
		$fld_cnt=count($field_name);
		for($i=0;$i<$fld_cnt;$i++){
						$val=$field_name[$i]['Field'];
						if($val!=""){
							$field_val[]=$val;
						}		
					 }
		
		array_unshift($field_val ,"auditor_name");
		$key = array_search ('agent_id', $field_val);
		array_splice($field_val, $key, 0, 'fusion_id');
		$field_val=array_values($field_val);

		$count_for_field=count($field_val);

		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		$row = "";
		// print_r($rr);
		// die;
		foreach($rr as $user)
		{	
			for($z=0;$z<$count_for_field;$z++){
				
				if($field_val[$z]==="auditor_name"){
					$row = '"'.$user['auditor_name'].'",';
				}elseif($field_val[$z]==="fusion_id"){
					$row .= '"'.$user['fusion_id'].'",';
				}elseif($field_val[$z]==="agent_id"){
					$row .= '"'.$user['fname']." ".$user['lname'].'",';
				}elseif($field_val[$z]==="tl_id"){
					$row .= '"'.$user['tl_name'].'",';	
				}elseif(in_array($field_val[$z], array('call_summary','feedback','agent_rvw_note','mgnt_rvw_note'))) {
    			
    			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user[$field_val[$z]])).'",';

				}else{
					$row .= '"'.$user[$field_val[$z]].'",';	
				}
				
			}
				
				fwrite($fopen,$row."\r\n");
				$row = "";
		}
		
		fclose($fopen);
	}

	public function create_qa_ameridial_CSV($rr,$pid)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		if($pid=='fortunebuilder'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "File No", "Call Duration", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Was the call answered within 5 seconds?", "Did the agent introduce him/herself to the caller?", "Did the agent advise the call is being recorded?", "Did the agent use the standard greeting?", "Did the agent ask for the zip code?", "Did the agent verify callers first and last name and complete address?", "Did the agent ask for and verify the caller's email address", "Did the agent correctly offer the seminars?", "Did the agent correctly ask for and verify the phone number?", "Did the agent inform the caller about the text reminders he/she will receive?", "Did the agent summarize the call with relevant details?", "Did the agent offer to register a guest?", "Did the agents collect and verify the guests email address?", "Did the agent demonstrate knowledge of Fortune Builders?", "Did the agent use appropriate grammar and pronunciation?", "Did the agent use good pacing and tone?", "Did the agent display professionalism and handle difficult callers appropriately?", "Did the agent maintain call control throughout the call?", "Did the agent use the appropriate Closing?", "Did the agent correctly disposition the call?", "Call Summary", "Feedback", "Agent Feedback Acceptance","Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		}else if($pid=='xyz'){
			$header=array("phone1","Name","Email");
	}else if($pid=='purity_free_bottle'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "Call Type/LOB", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Did the rep greet the customer promptly and properly?", "Did the rep use their soft skills appropriately?", "Did the rep collect and verify the customers information appropriately?", "Did the rep cover the super saver offer appropriately?", "Did the rep cover the upsell appropriately?", "Did the rep cover the payment procedures appropriately?", "Did the rep demonstrate knowledge of the product/program?", "Did the rep maintain call control?", "Did the rep use the tools/FAQ's appropriately?", "Did the rep use the appropriate objection responses?", "Did the rep use the callers last name to personalize the call at least once per section?", "Did the rep complete the correct confirmation and closing?", "Did the rep cover the frequency and cost of each delivery when applicable?", "Did the rep have any misrepresentation?", "Did the rep response appropriately to a DNC response?", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		}else if($pid=='purity_catalog'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Proper Greeting", "Customer First Name and Address Verification", "Identifies Type of Account Properly", "Properly transfers the Account", "Accurate Notes Taken/Info Verified Appropriately", "Correct Information Given", "Proper Terminology/Use of Disc Names, etc", "Free Gift Scripting", "Bulk Offer", "Promotions Offered Correctly", "Super Saver Offered and Explained Properly", "Additional Product Offered", "Order Placed Properly/Cancelled Properly", "Order Confirmation", "Uses Tools and FAQ", "Address Verification at Confirmation", "Credit Card Verification/Charged Correct Information", "Attempt to Gather CVV Code", "Daily Special Offer", "Product/Benefits Offered with Daily Special", "Thank You Statement", "Maintained Call Control/Call Flow", "Response Time/Minimal Dead Air", "Used Proper Hold Techniques", "Good Attitude/Maintained Composure", "Energy/Enthusiasm/Attentiveness", "Context Related Responses", "Empathy/Respectfulness/Courteous", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		}else if($pid =='purity_care'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date",
			"Call 1 Call Duration", "Call 1 File No","Call 2 Call Duration", "Call 2 File No","Call 3 Call Duration", "Call 3 File No", "Audit Type", "VOC","Overall Score","Proper Introduction Call 1","Proper Introduction Call 2","Proper Introduction Call 3","Proper Introduction Review","Proper Introduction Score","Customer First Name and Address Verification Call 1","Customer First Name and Address Verification Call 2","Customer First Name and Address Verification Call 3","Customer First Name and Address Verification Review","Customer First Name and Address Verification Score", "Opening Question Call 1","Opening Question Call 2","Opening Question Call 3","Opening Question Review"
			,"Opening Question Score","Accurate Notes Taken Call 1","Accurate Notes Taken Call 2","Accurate Notes Taken Call 3","Accurate Notes Taken Review","Accurate Notes Taken Score","Correct Reason Code Call 1","Correct Reason Code Call 2","Correct Reason Code Call 3","Correct Reason Code Review","Correct Reason Code Score","Correct Information Given Call 1","Correct Information Given Call 2","Correct Information Given Call 3","Correct Information Given Review","Correct Information Given Score","Proper Terminology/use of disc names. etc. Call 1","Proper Terminology/use of disc names. etc. Call 2","Proper Terminology/use of disc names. etc. Call 3","Proper Terminology/use of disc names. etc. Review","Proper Terminology/use of disc names. etc. Score","Proper Inquiry Call 1","Proper Inquiry Call 2","Proper Inquiry Call 3","Proper Inquiry Review","Proper Inquiry Score","Company Promotion Call 1","Company Promotion Call 2","Company Promotion Call 3","Company Promotion Review","Company Promotion Score","Correct Use of Actions Call 1","Correct Use of Actions Call 2","Correct Use of Actions 3","Correct Use of Actions Review","Correct Use of Actions Score","Database Follow Up Call 1","Database Follow Up Call 2","Database Follow Up Call 3","Database Follow Up Review","Database Follow Up Score","Product Promotion Call 1","Product Promotion Call 2","Product Promotion Call 3","Product Promotion Review","Product Promotion Score","Reason for Cancel Call 1","Reason for Cancel Call 2","Reason for Cancel Call 3","Reason for Cancel Review","Reason for Cancel Score","Legitimate Offers/Sequence of Offers Call 1","Legitimate Offers/Sequence of Offers Call 2","Legitimate Offers/Sequence of Offers Call 3","Legitimate Offers/Sequence of Offers Review","Legitimate Offers/Sequence of Offers Score","1st Retention Offer Call 1","1st Retention Offer Call 2","1st Retention Offer Call 3","1st Retention Offer Review","1st Retention Offer Score","2nd Retention Offer Call 1","2nd Retention Offer Call 2","2nd Retention Offer Call 3","2nd Retention Offer Review","2nd Retention Offer Score","Valid Delay Call 1","Valid Delay Call 2","Valid Delay Call 3","Valid Delay Review","Valid Delay Score","Preserved Avg # Units/Shipment Call 1","Preserved Avg # Units/Shipment Call 2","Preserved Avg # Units/Shipment Call 3","Preserved Avg # Units/Shipment Review","Preserved Avg # Units/Shipment Score","Proper Confirmation Call 1","Proper Confirmation Call 2","Proper Confirmation Call 3","Proper Confirmation Review","Proper Confirmation Score","Daily Special Offer Call 1","Daily Special Offer Call 2","Daily Special Offer Call 3","Daily Special Offer Review","Daily Special Offer Score","Anything Else Statement Call 1","Anything Else Statement Call 2","Anything Else Statement Call 3","Anything Else Statement Review","Anything Else Statement Score","Thank You Statement Call 1","Thank You Statement Call 2","Thank You Statement Call 3","Thank You Statement Review","Thank You Statement Score","Maintained call control Call 1","Maintained call control Call 2","Maintained call control Call 3","Maintained call control Review","Maintained call control Score","Response Time/Minimal dead air Call 1","Response Time/Minimal dead air Call 2","Response Time/Minimal dead air Call 3","Response Time/Minimal dead air Review","Response Time/Minimal dead air Score","Uses proper hold techniques Call 1","Uses proper hold techniques Call 2","Uses proper hold techniques Call 3","Uses proper hold techniques Review","Uses proper hold techniques Score","Good Attitude/Maintained Composure Call 1","Good Attitude/Maintained Composure Call 2","Good Attitude/Maintained Composure Call 3","Good Attitude/Maintained Composure Review","Good Attitude/Maintained Composure Score","Energy/Enthusiasm/Attentiveness Call 1","Energy/Enthusiasm/Attentiveness Call 2","Energy/Enthusiasm/Attentiveness Call 3","Energy/Enthusiasm/Attentiveness Review","Energy/Enthusiasm/Attentiveness Score","Context Related Responses Call 1","Context Related Responses Call 2","Context Related Responses Call 3","Context Related Responses Review","Context Related Responses Score","Empathy/Respectfulness/Courteous Call 1","Empathy/Respectfulness/Courteous Call 2","Empathy/Respectfulness/Courteous Call 3","Empathy/Respectfulness/Courteous Review","Empathy/Respectfulness/Courteous Score","Badgering Call 1","Badgering Call 2","Badgering Call 3","Badgering Review","Badgering Score","Average Calls Per Hour/4 or More Call 1","Average Calls Per Hour/4 or More Call 2","Average Calls Per Hour/4 or More Call 3","Average Calls Per Hour/4 or More Review","Average Calls Per Hour/4 or More Score","Average Save % Above 44% Call 1","Average Save % Above 44% Call 2","Average Save % Above 44% Call 3","Average Save % Above 44% Review","Average Save % Above 44% Score","Average Call Length Does Not Exceed 8 min. Call 1","Average Call Length Does Not Exceed 8 min. Call 2","Average Call Length Does Not Exceed 8 min. Call 3","Average Call Length Does Not Exceed 8 min. Review","Average Call Length Does Not Exceed 8 min. Score","Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		}else if($pid =='puritycare_new'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "File No", "Call Duration", "Audit Type", "VOC","Overall Score", "Customer Address Verification Call 1", "Customer Address Verification Call2", "Customer Address Verification Call3", "Script Compliance Call1", "Script Compliance Call2", "Script Compliance Call3", "Opening Question Call1", "Opening Question Call2", "Opening Question Call3", "Accurate Detailed Notes Taken Call1", "Accurate Detailed Notes Taken Call2", "Accurate Detailed Notes Taken Call3", "Correct Important Info Given Call1", "Correct Important Info Given Call2", "Correct Important Info Given Call3", "Correct Reason Code Call1", "Correct Reason Code Call2", "Correct Reason Code Call3", "Proper Terminology Call1", "Proper Terminology Call2", "Proper Terminology Call3", "Proper Inquiry Effective Questions Call1", "Proper Inquiry Effective Questions Call2", "Proper Inquiry Effective Questions Call3", "Product Promotion Call1", "Product Promotion Call2", "Product Promotion Call3", "Company Promotion Call1", "Company Promotion Call2", "Company Promotion Call3", "Database Follow-Up Call1", "Database Follow-Up Call2", "Database Follow-Up Call3", "Reason for Cancel Call1", "Reason for Cancel Call2", "Reason for Cancel Call3", "1st Retention Offer Call1", "1st Retention Offer Call2", "1st Retention Offer Call3", "Two Tools Each Offer Call1", "Two Tools Each Offer Call2", "Two Tools Each Offer Call3", "Sequence of Legitimate Offers Call1", "Sequence of Legitimate Offers Call2", "Sequence of Legitimate Offers Call3", "2nd Retention Offer Call1", "2nd Retention Offer Call2", "2nd Retention Offer Call3", "# of bottles Call1", "# of bottles Call2", "# of bottles Call3", "Correct Delay Length Call1", "Correct Delay Length Call2", "Correct Delay Length Call3", "Complete Confirmation Recap Call1", "Complete Confirmation Recap Call2", "Complete Confirmation Recap Call3", "Anything Else Question Call1", "Anything Else Question Call2", "Anything Else Question Call3", "Daily Special Offer Call1", "Daily Special Offer Call2", "Daily Special Offer Call3", "Thank You Statement Call1", "Thank You Statement Call2", "Thank You Statement Call3", "Maintained Call Control Call1", "Maintained Call Control Call2", "Maintained Call Control Call3", "Hold Technique Call1", "Hold Technique Call2", "Hold Technique Call3", "Response Time Min Dead Air Call1", "Response Time Min Dead Air Call2", "Response Time Min Dead Air Call3", "Used hold Tactically Call1", "Used hold Tactically Call2", "Used hold Tactically Call3", "Good Attitude Maintained Composure Call1", "Good Attitude Maintained Composure Call2", "Good Attitude Maintained Composure Call3", "Context Related Responses Call1", "Context Related Responses Call2", "Context Related Responses Call3", "Energy & Enthusiasm Call1", "Energy & Enthusiasm Call2", "Energy & Enthusiasm Call3", "Respectful & Courteous Call1", "Respectful & Courteous Call2", "Respectful & Courteous Call3", "Call Length Call1", "Call Length Call2", "Call Length Call3", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		}else if($pid=='touchfuse'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "Call Status", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Was the call answered promptly?", "Did the agent answer with thank you for calling", "Did the agent ask for the zip code?", "Did the agent correctly offer the seminars?", "Did the caller wish to cancel the seminar?", "Did the agent confirm the callers first and last name?", "Did the agent confirm the callers address?", "Did the agent ask for and correctly verify the email phonetically?", "Did the agent correctly ask for and verify the phone number", "Did the agent summarize the call with relevant detail?", "Did the agent offer to register a guest", "Did the agent correctly disposition the call?", "Did the agent use the appropriate closing?", "Did the agent use appropriate tone/pacing/grammar/pronunciation?", "Did the agent use active listening throughout the call?", "Was the agent professional throughout the call?", "Did the agent show knowledge of TouchFuse throughout the call?", "Did the agent maintain call control throughout the call?", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		}else if($pid=='tbn'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "File No", "Call Duration", "Call ID", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Full Recording Between Communicator and Caller is Captured", "Communicator Properly Prepared for Call", "Communicator Gave Her/His First Name", "Stated-This Call May Be Recorded For Training Purposes", "Stated Offer Title as Scripted", "Stated No Offer Disclosure (if applicable)", "Spelled Donors Full Name Back on ALL CALLS", "EXISTING File - Communicator Verified Address", "IF NEW ADDRESS - Communicator Spelled Address", "IF No Existing Email - Asked for Email", "Spelled Back Email", "Asked for Phone Number", "Confirmed Phone Number", "Verified Phone Number Type", "IF Cell Asked for Consent", "Asked for Alternate Phone Number", "Verified Alternate Phone Number", "Verified Alternate Number Type", "IF Alternate Phone Number is Cell - Asked for Consent", "Read First Request as Scripted", "Appropriately Presented Higher Tier Offers (if applicable )", "Read Monthly Ask As Scripted (if applicable)", "Navigates Script With Ease", "Displays TBN Knowledge and Answers Questions Appropriately", "Correctly Pronounces Speaker/Author Name and Title of Offer", "Overall Script Adherence", "Verified Donation Frequency (One-Time/Monthly)", "Verified Donation Amount", "Verified Monthly Donation Beginning and End Date (if applicable)", "Verified Resource Donor Will Be Receiving (if applicable)", "Read Close as Scripted", "Speaks Clearly with Proper Articulation (no slang)", "Pleasant Demeanor", "Speaks at an Appropriate Pace", "Actively Listens and Responds Appropriately", "Exhibits Empathy (if appropriate)", "Communicator Shows Sincere Appreciation for Donor and Donations", "Maintained Control of the Conversation and Talk Time", "Autofail - False and/or Inappropriate Information", "Autofail - Inappropriately Ended Call", "Autofail - Rudeness/Unprofessional Behavior", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		}else if($pid=='jfmi'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score","Greets the customer promptly and properly","Uses professionalism/courtesy/enthusiasm/proper grammar/no jargon","Shows gratitude throughout the call","Collects and verifies all customer information/uses phonetic when applicable","Follows correct Scripting Path","Collects information to provide to Partner Relations if necessary","Covers all payment scripting and responses properly","Maintains call control","Keeps dead air to a minimum","Uses FAQ's/Agent notes to answer questions properly","Brands the call with proper close", "Not stopping the recording for credit card capture", "Agent read legal scripting to the caller", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		}else if($pid=='hoveround'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score","Was the agent ready for the call (no dead air)?", "Did the agent give the proper introduction including company name?", "Did the agent correctly probe and transfer if applicable?", "Did the agent verify all customer information/NATO spell back of email address?", "Did the agent close the call with proper branding?", "Did the agent disposition the call properly?", "Was the agent polite and courteous?", "Did the agent show energy empathy and enthusiasm?", "Did the agent have good tone grammer?", "Did the agent give accurate information and show a complete grasp of information?", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		}else if($pid=='ncpssm'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Thanks caller for calling NCPSSM", "Verified opening info", "Gathered and spelled back all necessary information", "Verified/Asked for Email Address", "Makes thank you/supporting statements", "Familiarity with FAQ -Organization", "Personalized call (Mr./Mrs etc)", "Thanked Caller for being a member/previous support", "Energy/enthusiasm", "Proper pace", "Maintained control of the conversation/Minimal Dead Air", "Spoke clearly/utilized proper grammar (NO SLANG)", "Good listening skills/Does not interrupt", "Empathized with caller", "Overall professionalism", "Proper thanks at call conclusion", "Provided correct and appropriate information", "Confirmed caller has no further questions", "False/inappropriate information", "Hung up inappropriately", "Unprofessional behavior", "Inappropriate language", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		}else if($pid=='stc'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Did the agent use proper introduction?", "Did the agent correctly capture and verify donor name?", "Did the agent read first request as scripted?", "Did the agent cover second monthly request (if applicable)?", "Did the agent correctly capture and verify donation amount?", "Did the agent offer payment types?", "Did the agent correctly capture and verify donor address?", "Did the agent correctly capture and verify donor phone number?", "Did the agent correctly capture and verify donor email address?", "Did the agent properly present rebuttals (if applicable)?", "Did the agent follow overall script adherence?", "Did the agent show familiarity with Save the Children?", "Did the agent use appropriate script navigation and proper disposition?", "Did the agent follow proper close?", "Did the agent use effective communication?", "Did the agent maintain control of the conversation and talk time?", " Did the agent show appreciation for donor and donations?", "Did the agent give false or inappropriate information?", "Did the agent hang up inappropriately?", "Did the agent show any rudeness or unprofessional behavior?", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		}else if($pid=='tpm'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Read Call Opening as Scripted", "Are You Calling From the US or Canada", "Verify Form of Payment", "Communicator Asked for Name", "Communicator Spelled Name", "Communicator Asked for Address", "Communicator Spelled Address", "Communicator Asked for Phone Number", "Communicator Verified Phone Number", "Communicator Verified Landline or Cell", "Communicator Read Consent to Call Verbatim", "Communicator Read Consent to Text Verbatim", "Communicator Asked for Email", "Communicator Spelled Email", "Overall Script Adherence", "Appropriately Presented higher Tier Offers (If applicable)", "Navigates Script with Ease", "Displays TPM Knowledge and Answers Questions Appropriately", "Verified Contents of the Cart", "Monthly Ask Presented (If Applicable)", "Reviewed Shipping Time Frame", "Provided Cart Total Including Shipping (If Applicable)", "Read Close As Scripted", "Speaks Clearly and Articulately", "Pleasant Demeanor", "Professionalism", "Speaks at an Appropriate Pace", "Listens and Responds Approriately", "Exibits Empathy If Applicable", "Communicator Shows Sincere Appreciation for Donor and Donations", "Maintained Control of the Conversation and Talk Time", "Blatantly False/Inappropriate Information", "Rudely Hung up on Donor", "Rude/Hostile/Uses Profanity", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		}else if($pid=='patchology'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Did the agent open the call using their name and the appropriate branding for the call?", "Did the agent close the call using the appropriate branding?", "Remarks1", "Did the agent verify/confirm all necessary information?", "Did agent provide consistent/accurate information regarding products and availability?", "Did agent provide/confirm shipping information/next steps/resolution of issue?", "Remarks2", "Was call answered in a timely manner?", "Was agent engaged/helpful with customer?", "Was customer satisfied/fulfilled?", "If escalated were all resources explored before sending escalation form?", "Remarks3", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		}else if($pid=='aspca'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Greets the customer promptly and properly", "Uses professionalism/courtesy/enthusiasm/proper grammar/no jargon",  "Shows gratitude throughout the call","Collects and verifies all customer information/ uses phonetic when applicable", "Asks if they are calling to join ASPCA guardians program",  "Covered monthly guardian/roundup upsell $25", "Covered one time gift scripting (when applicable)", "Covered all payment scripting and responses properly", "Offers the Animal Champion T-Shirt", "Covers donation processing script", "Covers additional one time donation", "Covers pet insurance / proper close", "Followed correct script path/followed transfer procedures and scripting", "Maintains call control", "Keeps dead air to a minimum", "Uses FAQ's/KB's to answer questions properly", "Personalizes the call", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By","Mgnt Comment");
		}else if($pid=='ffai'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Did the agent open the call using their name and the appropriate branding for the call?", "Did the agent close the call using the appropriate branding?", "Did agent verify if caller had ordered before with FiltersFast?", "Did the agent verify/confirm all necessary information and spell back email address using NATO?", "Did agent provide consistent/accurate information regarding products and availability?", "Did agent provide confirm shipping information/next steps/resolution of issue to ensure one call resolution?", "Did agent accurately and clearly fill out pulse on Monday.com?", "Was agent engaged/empathetic with customer?", "Did agent offer membership in the Home Filter Club (if applicable)?", "Did agent offer donation to Wine to Water?", "If escalated were all resources explored before transferring?", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By","Mgnt Comment");
		}else if($pid=='lifi'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Life Quotes Greeting & Introduction", "Did the agent give positive response to the caller", "Customer Name Capture", "Did the agent capture the address of the customer", "Phone Number confirmation", "Email address", "Customer's DOB", "Overall Script Adherence", "Did the agent ask for coverage amount of the Insurance", "Confirmation of Tobacco or smoking", "Did the agent ask for Height & Weight of the customer", "Did the agent mention about price comparison report", "Overall confidence level professionalism & tone", "Call closing", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By","Mgnt Comment");
		}else if($pid=='heatsurge'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Was the agent Prepared for call or answer within 5 seconds", "Did the agent use inbound or outbound greeting", "Accesses customers accounts or any reports needed", "Agent verifies cst name address phone and TPA if needed", "Verifies or Asks for email address spelling and gave email disclaimer", "Reads mini Miranda and or Recording statement on outbound calls", "Gives accurate pricing or refund or return information", "Gives accurate shipping or delivery information", "Accurately describes product or promo or answers questions", "Asks for Upsell or add on product where appropriate", "Provides appropriate solution or alternatives", "Keyed or coded order correctly and corrected info as needed", "Asks for cancelation reason", "1st save attempt did agent use PK key buying factors", "2nd save attempt used appropriately and per guidelines", "Asks for billing Name as it appears on cc or check", "agent verified caller is an authorized user of the cc or check", "Asks for billing address for payment method used", "Asks for permission to authorize payment (cc or check)", "Agent verifies shipping address", "Notates account with issue or resolution", "Summarizes and reviews call or appropriate closure to call", "Gave CS hours of operation and CS phone number", "Was the agent polite courteous and patient", "Agent refrained from using inappropriate comments or presentation", "Uses hold and transfers properly", "**Automatic Zero", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By","Mgnt Comment");
		}else if($pid=='stauers_sales'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Was the call answered within 5 seconds?","Did the agent verify the customer's name and address on the account?","Did the agent capture the correct offer code?","Did the agent verify the phone number with the customer?","Did the agent verify the customer's email address?","Did the agent compliment the caller's purchase choice?","Did the agent recap the item and ask if the customer would be interested in any other product(s)?","Did the agent cover at least one upsell?","Did the agent cover the replacement guarantee pitch?","Did the agent use an appropriate rebuttal if the replacement guarantee was declined?","Did the agent cover the membership pitch?","Did the agent use an appropriate rebuttal if the membership pitch was declined?","Did the agent offer the membership accurately?","Did the agent cover the auto-renew offer correctly?","Was the shipping address verified?","Did the agent quote the correct delivery time?","Did the agent give a total product quote appropriately?","Did the agent quote shipping & taxes correctly?","Did the agent give the total to be charged and verify the credit card to be charged correctly?","Did the agent provide the order number correctly?","Did the agent close the call with the brand correctly?","Was the customer satisfied with his/her experience?","Was the customer dissatisfied with the agent's professionalism and/or tone?","Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By","Mgnt Comment");
		}else if($pid=='operation_smile'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Was the agent ready to handle the call promptly and answer properly?", "Did the agent greet the caller read the scripted opening?", "Did the agent confirm all information and utilize phonetic spell back when necessary?", "Does the agent show gratitude and acknowledge callers concerns?", "Did the agent use rebuttals appropriately?", "Did the agent offer the upsell?", "Did the agent follow the script correctly and with confidence?", "Did the agent address questions about the program and utilize the FAQs correctly?", "Did the agent speak with energy and enthusiasm?", "Did the agent use proper pacing?", "Did the agent maintain control of the conversation and minimize dead air?", "Was the agent professional and speak with proper enunciation grammar and tone?", "Did the agent use good listening skills and does not interrupt?", "Did the agent empathize with the caller?", "Did the agent provide a good donor experience and show appropriate appreciation?", "Did the agent ask what prompted them to call today?", "Did the agent thank the caller for their call today and close appropriately?", "***Did the agent give false or inappropriate information?", "***Did the agent hang up inappropriately?", "***Did the agent use inappropriate language?", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By","Mgnt Comment");
		}else if($pid=='5_11_tactical'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Did the rep greet the customer promptly and properly?", "Did the rep confirm the customers item to order (product size colour price)", "Did the rep ask is there anything else you would like to add to your order?", "Did the rep ask for customer login information or continue as guest appropriately", "Did the rep gather/verify the callers information for accuracy", "Did the rep cover the final confirmation (each product total cost to be charged)?", "Did the rep give customer their order number?", "Did the rep use all applicable search method?", "Did the rep cover the returns process appropriately?", "Did the rep cover the exchange process appropriately?", "Did the rep cover the refund process appropriately?", "Did the rep track the package appropriately", "Did the agent ask is there anything else I can assist you with today?", "Did the agent close and brand the call appropriately?", "Did the rep answer questions appropriately", "Did the rep maintain call control?", "Did the rep properly notate AX?", "If an escalation was done was it warranted?", "Did the agent disposition the call appropriately?", "Did the rep maintain professionalism throughout the call?", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By","Mgnt Comment");
		}else if($pid=='jmmi'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "1) Did the agent give appropriate greeting?",	"2) Did the agent give excellent conversational responses to caller's requests?",	"3) Did the agent verify the opening information (name-zip code-address-phone number)?",	"4) Did the agent follow call flow with caller's initial request (orders what the caller asks for)?",	"5) Did the agent show appropriate gratitude throughout the call?",	"6) Did the agent share upsells when presented?",	"7) Did the agent show familiarity and search all options for offers products?", "8) If partner-did the agent thank the caller specifically?",	"9) Did the agent share HOM/JMM facts as appropriate and make good use of dead air?",	"10) Was the agent professional with communication?",	"11) Did the agent use proper pace energy & enthusiasm?",	"12) Did the agent maintain control of the conversation?",	"13) Did the agent spoke clearly and utilize proper grammar (no slang)?",	"14) Did the agent use good listening skills and appropriate responses?",	"15) Did the agent empathize with the caller and show compassion?",	"16) Did the agent have minimal dead air?",	"17) Did the agent have the caller provide the address if not populated on review screen?",	"18) Did the agent confirm dollar amount and frequency as well as reviewing cart?", "19) Did the agent read shipping information as scripted/share charges as appropriate?", "20) Did the agent ask caller for email and tv information?", "21) Did the agent use proper thanks at the call conclusion?", "22) Did the agent transfer the call to prayer/CS when appropriate?", "23) ***Did the agent follow payment industry compliance policies properly?", "24) ***Did the agent read back the customer's details properly? Like name - phone number etc.", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By","Mgnt Comment");
		}else if($pid=='non_profit'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Properly prepared to take calls", "Clearly stated paid caller from Donor Care Center/recorded line", "Communicator stated his/her full name", "Pronounced clients name correctly", "Gave a warm friendly greeting", "Followed scripted 1st request as scripted", "1st request Used correct dollar amounts", "1st request Assumptive gift ask", "Showed empathy/Concern", "Repeated the objection", "Personalized the objection", "Attempted to handle objection", "Did not reinforce the negative", "Exited a dead-end call", "Followed scripted 2nd request as scripted", "2nd request Used correct dollar amounts", "2nd request Assumptive gift ask", "Attempted 3rd request as scripted (when applicable)", "3rd request Used correct dollar amounts", "3rd request Assumptive gift ask", "Confirmation question/Confirmed gift amount & waited for response", "Assumed the higher dollar amount", "Showed meaningful gratitude/Thanked the donor or volunteer", "Read credit card/ACH ask verbatim/assumptively asked for credit card", "Confirmed full name and address", "Followed Maybe Close appropriately", "Read close as scripted", "Ended call in a reasonable time", "Sounded conversational used good voice inflection not read or monotone", "Mirrored donor / Used appropriate pace", "Confident presentation w/out hesitation filler words or uptalking", "Did not lose control of the conversation", "Proper personalization", "Utilized proper grammar & pronunciation", "BAILING", "DID NOT ASK FOR A CREDIT CARD/ACH", "GAVE FALSE INFORMATION", "OMITTED PAID CALLER FROM DONOR CARE CENTER STATEMENT", "DID NOT ASK CONFIRMATION QUESTION", "UNSOLID GIFT", "NOT CODING A REFUSAL/CODING A REFUSAL INAPPROPRIATELY", "UNPROFESSIONAL BEHAVIOR/RUDENESS (not extreme)", "IMPROPER PRESENTATION", "OMITTED DNC CODE/USED DNC CODE INCORRECTLY", "FALSIFICATION OF A GIFT", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By","Mgnt Comment");
		}else if($pid=='revel'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "CSR ID", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Did the rep greet the customer promptly and properly?", "Did the rep use a pleasant respectful tone and use the caller name", "Did the rep answer in a timely manner?", "Did the rep collect and verify the caller information appropriately and accurately?", "Did the rep use active listening skills throughout the inquiry so the caller did not have to repeat themselves?", "Did the rep demonstrate use of call control techniques?", "Did the rep refrain from interrupting the caller?", "Did the rep speak clearly and concisely and at an appropriate pace?", "Did the rep avoid use of internal terms technical terms slang and jargon?", "Did the rep demonstrate confidence in responses?", "Did the rep use the callers last name to personalize the call at least once per section?", "Did the rep minimize silences and use fillers to obtain additional information?", "Did the rep maintain call control?", "Did the rep use the tools appropriately?", "Did the rep demonstrate knowledge of the product/program?", "Did the rep use the appropriate scripting responses verbatim?", "Did the rep accurately and completely document the call?", "Did the rep complete the correct confirmation and closing?", "Did the rep thank the caller before closing?", "***Did the rep attempt give Medical Advice to the caller?", "***Did the agent miscode the call?", "Greeting Comment 1.1", "Greeting Comment 1.2", "Greeting Comment 1.3", "Authentication Comment 2.1", "Listening Skills Comment 3.1", "Listening Skills Comment 3.2", "Listening Skills Comment 3.3", "Soft Skills Comment 4.1", "Soft Skills Comment 4.2", "Soft Skills Comment 4.3", "Soft Skills Comment 4.4", "Soft Skills Comment 4.5", "Knowledge Procedure & Call Flow Comment 5.1", "Knowledge Procedure & Call Flow Comment 5.2", "Knowledge Procedure & Call Flow Comment 5.3", "Knowledge Procedure & Call Flow Comment 5.4", "Closing Comment 6.1", "Closing Comment 6.2", "Closing Comment 6.3", "Auto-Fail Comment 7.1", "Auto-Fail Comment 7.2", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By","Mgnt Comment");
		}else if($pid=='qpc'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Unprepared to Introduce Call", "Did Not Use Branding", "Data Not Collected or Collected Incorrectly", "Second Data Occurrence", "Inaccurate Call Result Code", "Inappropriate or Unusable After-Call Comments", "Underutilized Call Narration", "Inappropriate FAQ Responses", "No or Improper Transitions", "Under-Acknowledged Caller's Concerns", "Inappropriate Script Navigation", "Did Not Display Ownership", "Incorrect Transfer or Referral", "***Did the agent abruptly end the call or display any rude behavior?", "***Did the agent answer premium/cover questions?", "***Did the agent give a wrong callback or referral number?", "***Did the agent use an incorrect carrier name?", "Open/Close Comment 1.1", "Open/Close Comment 1.2", "Data Accuracy Comment 2.1", "Data Accuracy Comment 2.2", "Data Accuracy Comment 2.3", "Data Accuracy Comment 2.4", "Active Listening Comment 3.1", "Active Listening Comment 3.2", "Customer Experience Comment 4.1", "Customer Experience Comment 4.2", "Customer Experience Comment 4.3", "Customer Experience Comment 4.4", "Customer Experience Comment 4.5", "Auto-Fail Comment 5.1", "Auto-Fail Comment 5.2", "Auto-Fail Comment 5.3", "Auto-Fail Comment 5.4", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By","Mgnt Comment");
		}else if($pid=='ancient_nutrition'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "1.1 Did the rep greet the customer promptly and properly?", "1.2 Did the rep use a pleasant respectful tone and use the callers name at least once?", "1.3 Did the rep answer in a timely manner?", "2.1 Did the rep collect and verify the callers information appropriately and accurately?", "2.2 Did the rep cover the payment procedures appropriately?", "3.1 Did the rep use active listening skills throughout the inquiry so the caller did not have to repeat themselves?", "3.2 Did the rep demonstrate use of call control techniques?", "3.3 Did the rep refrain from interrupting the caller?", "4.1 Did the rep speak clearly and concisely and at an appropriate pace?", "4.2 Did the rep avoid use of internal terms technical terms slang and jargon?", "4.3 Did the rep demonstrate confidence in responses?", "4.4 Did the rep use the callers last name to personalize the call at least once per section?", "4.5 Did the rep minimize silences and use fillers to obtain additional information?", "5.1 Did the rep cover the Auto Shipping appropriately?", "5.2 If rep gathered email did they read the complete email scripting?", "5.3 Did the rep cover the Rush Shipping appropriately?", "5.4 Did the rep complete order confirmation?", "5.5 Did the rep maintain call control?", "5.6 Did the rep use the tools appropriately?", "5.7 Did the rep demonstrate knowledge of the product/program?", "5.8 Did the rep use the appropriate objection responses?", "6.1 Did the rep accurately and completely document the call?", "6.2 Did the rep complete the correct confirmation and closing?", "6.3 Did the rep thank the caller before closing?", "7.1 ***Did the rep attempt give Medical Advice to the caller?", "7.2 ***Did the rep cover the upsell appropriately?", "7.3 ***Did the agent read the confirmation script if email address was obtained?", "Greeting Comment 1.1", "Greeting Comment 1.2", "Greeting Comment 1.3", "Authentication Comment 2.1", "Authentication Comment 2.2", "Listening Skills Comment 3.1", "Listening Skills Comment 3.2", "Listening Skills Comment 3.3", "Soft Skills Comment 4.1", "Soft Skills Comment 4.2", "Soft Skills Comment 4.3", "Soft Skills Comment 4.4", "Soft Skills Comment 4.5", "Knowledge Procedure& Call Flow Comment 5.1", "Knowledge Procedure& Call Flow Comment 5.2", "Knowledge Procedure& Call Flow Comment 5.3", "Knowledge Procedure& Call Flow Comment 5.4", "Knowledge Procedure& Call Flow Comment 5.5", "Knowledge Procedure& Call Flow Comment 5.6", "Knowledge Procedure& Call Flow Comment 5.7", "Knowledge Procedure& Call Flow Comment 5.8", "Closing Comment 6.1", "Closing Comment 6.2", "Closing Comment 6.3", "Auto-Fail Comment 7.1", "Auto-Fail Comment 7.2", "Auto-Fail Comment 7.3", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By","Mgnt Comment");
		}else if($pid=='sabal'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Did the agent ask for the individual by Mr. or Mrs. Last Name?", "Did the agent introduce him/herself?", "Did the agent state he/she is a Customer Service Specialist for WellCare?", "Did the agent apologize for the unannounced phone call and state reason for the call?", "Did the agent ask how the individuals Rx plan is currently working for him/her and respond with the appropriate scripted response?", "Did the agent read the listed examples of benefits they could add? Comprehensive Dental i)Complete Vision ii)Extensive Hearing iii)Transportation iv)Free membership to fitness centers and some even come with a free Fitbit!", "Did the agent ask for the individuals red white and blue card and explain why this was needed?", "Did the agent ask for the individuals updated Medicare ID and accurately record the inforamtion?", "Did the agent ask for the individuals Part A effective date and accurately record the information?", "Did the agent use correct rebuttal is individual doesnt want to give ID over the phone?", "Did the agent use scripting if the individual wants to know the cost to him/her?", "Did the agent use correct rebuttal if the agent says he/she is not interested?", "***Did the agent abruptly end the call or display any rude behavior?", "***Did the agent become argumentative with the individual?", "***Did the agent record the incorrect Medicare members information?", "***Did agent provide any false or misleading information?", "Greeting Comment 1.1", "Greeting Comment 1.2", "Greeting Comment 1.3", "Call Flow Comment 2.1", "Call Flow Comment 2.2", "Call Flow Comment 2.3", "Data Collection Comment 3.1", "Data Collection Comment 3.2", "Data Collection Comment 3.3", "Rebuttals Comment 4.1", "Rebuttals Comment 4.2", "Rebuttals Comment 4.3", "Auto-Fail Comment 5.1", "Auto-Fail Comment 5.2", "Auto-Fail Comment 5.3", "Auto-Fail Comment 5.4", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By","Mgnt Comment");
		}else if($pid=='curative'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "1.1 Did the rep greet the customer promptly and properly?", "1.2 Did the rep use a pleasant respectful tone?", "1.3 Did the rep answer in a timely manner? (within 5 seconds)", "2.1 Did the rep collect and verify the customers information appropriately and accurately?", "2.2 Did the rep verify patients PHI (name email phone number address email address DOB) is entered correctly in Patient Portal?", "2.3 Did the agent accurately send the email regarding correct use of all PHI?", "2.4 Did the agent escalate to Tier 2 when necessary? (Helpscout ticket tag Tier 2 Escalation) Test Cancelled", "2.5 Did the agent respect the patients privacy and provide results only to the verified caller?", "2.6 Did the agent ensure the email address was correct prior to sending the email message and only send to the verified caller?", "3.1 Did the agent speak clearly concisely and at an appropriate pace?", "3.2 Did the agent avoid use of internal terms technical terms slang and jargon on the call and in email?", "3.3 Did the agent demonstrate a strong use of empathy in responses where required on the call and in email?", "3.4 Did the agent use please and thank you throughout the call and in email communication?", "3.5 Did the agent minimize extended silences throughout the call?", "3.6 Did the agent speak with sincere warmth in his/her voice?", "3.7 Did the agent use correct sentence structure and grammar in email commumnication?", "3.8 Did the agent demonstrate patience with the caller?", "3.9 Did the caller give the agent a KUDOS or express happiness with the rep?", "4.1 Did the rep accurately and completely document the call?", "4.2 Did the rep complete the correct confirmation and closing?", "4.3 Did the rep thank the caller before closing?", "4.4 Did the agent provide accurate results?", "4.5 Did the rep anticipate the caller's needs?", "4.6 Did the rep do everything possible to assist the caller?", "Greeting Comment 1.1", "Greeting Comment 1.2", "Greeting Comment 1.3", "AutoFail Comment 2.1", "AutoFail Comment 2.2", "AutoFail Comment 2.3", "AutoFail Comment 2.4", "AutoFail Comment 2.5", "AutoFail Comment 2.6", "Soft Skills Comment 3.1", "Soft Skills Comment 3.2", "Soft Skills Comment 3.3", "Soft Skills Comment 3.4", "Soft Skills Comment 3.5", "Soft Skills Comment 3.6", "Soft Skills Comment 3.7", "Soft Skills Comment 3.8", "Soft Skills Comment 3.9", "Closing Comment 4.1", "Closing Comment 4.2", "Closing Comment 4.3", "Closing Comment 4.4", "Closing Comment 4.5", "Closing Comment 4.6", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By","Mgnt Comment");
		}else if($pid=='powerfan'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "Call Duration", "File No", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Was the agent Prepared for call answer within 5 seconds", "Did the agent identify self and the company?", "Collects intro information Claim code zip code", "Main Sell agent accurately gave terms of offer asks for sale per script quanity", "Did the agent promote upsell downsell asks for sale per script", "Accurately Described Product answered", "Used appropriate Objection Handling", "Asks for billing Name as it appears on cc or check", "If billing name is different than caller agent verified caller is an authorized user of the cc or check", "Asks for billing address for payment method used", "Agent verifies shipping address", "Order was set up and or coded correctly", "Asks for email address spelling and gave email disclaimer", "Gave total amount charged payment information", "Gave correct shipping information", "Gave MBG return info in", "Gave CS phone number", "Asks for permission to authorize payment cc or check", "Was the agent polite courteous and patient", "Agent refrained from using inappropriate comments presentation", "Uses hold and transfers properly", "Auto Fail", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By","Mgnt Comment");
		}else if($pid=='nuwave'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "File No", "Order ID", "Call Duration", "Interaction", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Greeting & Identification: Example Thank you for calling NuWave", "Asked and Verified Customer Information: May I please have your Order ID Primary name or e-mail address?", "Used the Callers Name: CSR should address the customer as he/she addresses him/herself Mr. Mrs. Dr. Rev. etc.", "Active Listening: Doesnt interrupt the customer understands customers frame of reference doesnt anticipate or make assumptions", "Communication Skills: Converses in a clear concise manner", "Professionalism: Avoids the use of slang jargon and acronyms", "Empathy Towards Customer: CSR sounds sincere about helping the customer and apologizes", "Courtesy: CSR sounds helpful upbeat friendly and patient", "Put On Hold: Asked customer May I put you on hold or Could you hold while I research this further please?", "Thanked Customer for Holding: CSR thanked customer for holding upon returning to customers call", "Hold Time/Reason Appropriate/Inappropriate: Was it really necessary for the CSR to put the customer on hold?", "Escalation/Referral Procedures: Utilized established guidelines and procedures policy from the leadership team", "Fact Finding: Used probing questions and resources to identify problem", "Verbally Verified Problem Reported: Clearly defined and restated needs reported by the customer", "Managed Customer Expectations: Regarding the order of the product and the shipping time", "Explained: Reason for troubleshooting for possible resolution", "Used Available Resources Well: Referred to knowledge training or other resource programs for order troubleshooting", "Complete & Accurate Customer Documentation: Complete description of the order and or the troubleshooting steps", "Trial Close: Confirmed customer is comfortable with outcome", "Additional Needs Uncovered: CSR asked Is there anything else that I can assist you with today?", "Upsale: Ask customer if the product completely serves their needs", "Used Correct Closing Gave Customer Order Number: Mr. Ms. Mrs. I would like to thank you for ordering with NuWave", "Infractions", "Sub-Infractions", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		}else if($pid=='delta_iowa'){
			$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "File No", "Call ID", "Call Duration", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "1.1 Answered the call promptly (within 5 seconds)", "1.2 Opens the call properly obtains caller name", "1.3 Verifies all identifying information to continue the call", "2.1 Adhered to HIPAA/PCI guidelines depending on the type of call", "2.2 Adhered to Client Policies & Procedures", "2.3 Performed the correct actions for the caller", "2.4 Set approriate expectations", "2.5 Gave accurate and complete information", "2.6 Routed issue to the appropriate department", "2.7 Completed all necessary documentation", "3.1 Used courtesy phrases like please and thank you throughout the call", "3.2 Used the caller's name at least once during the call", "3.3 Followed acceptable hold and transfer procedures", "3.4 Allowed the caller to state the reason for the call", "3.5 Avoided the use of jargon acronyms and slang", "3.6 Allowed the caller to speak without interruption", "3.7 Explained all positives of the plan-type without pushing the caller to purchase", "3.8 Stated a willingness to help the caller usually at the beginning of the call", "3.9 Gained agreement with the caller on the proposed solution", "3.10 Demonstrated an empathetic manner professional tone", "4.1 Closed call by offering further assistance", "4.2 Resolved and followed through on all actions to resolve the customers issue", "4.3 Assured customer their concern will be handled to resolution when possible", "4.4 Made an effective attempt to handle a difficult situation", "*** Agent disconnects customer inappropriately", "*** Agent transfers customer without notifying customer", "*** Agent uses offensive words or profanity", "*** Agent was antagonistic talked back or talked down to caller", "*** Agent discloses confidential information inappropriately", "Greeting Comment 1.1", "Greeting Comment 1.2", "Greeting Comment 1.3", "Call Handling Comment 2.1", "Call Handling Comment 2.2", "Call Handling Comment 2.3", "Call Handling Comment 2.4", "Call Handling Comment 2.5", "Call Handling Comment 2.6", "Call Handling Comment 2.7", "Soft Skills Comment 3.1", "Soft Skills Comment 3.2", "Soft Skills Comment 3.3", "Soft Skills Comment 3.4", "Soft Skills Comment 3.5", "Soft Skills Comment 3.6", "Soft Skills Comment 3.7", "Soft Skills Comment 3.8", "Soft Skills Comment 3.9", "Soft Skills Comment 3.10", "Closing Comment 4.1", "Closing Comment 4.2", "Closing Comment 4.3", "Closing Comment 4.4", "Auto Fail Comment 1.1", "Auto Fail Comment 1.2", "Auto Fail Comment 1.3", "Auto Fail Comment 1.4", "Auto Fail Comment 1.5", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		}

		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		if($pid=='fortunebuilder'){
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['callans5sec'].'",';
				$row .= '"'.$user['agentintro'].'",';
				$row .= '"'.$user['agentadvise'].'",';
				$row .= '"'.$user['agentgreeting'].'",';
				$row .= '"'.$user['agentzip'].'",';
				$row .= '"'.$user['verifycaller'].'",';
				$row .= '"'.$user['calleremail'].'",';
				$row .= '"'.$user['agentseminar'].'",';
				$row .= '"'.$user['agentphone'].'",';
				$row .= '"'.$user['callerreminder'].'",';
				$row .= '"'.$user['agentsummerize'].'",';
				$row .= '"'.$user['registerguest'].'",';
				$row .= '"'.$user['verifyguest'].'",';
				$row .= '"'.$user['agentdemonstrate'].'",';
				$row .= '"'.$user['appropiategrammer'].'",';
				$row .= '"'.$user['goodpacing'].'",';
				$row .= '"'.$user['agentdisplay'].'",';
				$row .= '"'.$user['callcontrol'].'",';
				$row .= '"'.$user['agentclosing'].'",';
				$row .= '"'.$user['correctdisposition'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}else if($pid=='xyz'){
			echo "User";
			foreach($rr as $user){
			$row = '"'.$user['phone1'].'",'; 
				$row .= '"'.$user['name'].'",'; 
				$row .= '"'.$user['email'].'",'; 
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		}else if($pid=='purity_free_bottle'){
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['call_type_lob'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['customer_prompt'].'",';
				$row .= '"'.$user['soft_skills'].'",';
				$row .= '"'.$user['customer_information'].'",';
				$row .= '"'.$user['super_saver_offer'].'",';
				$row .= '"'.$user['upsell'].'",';
				$row .= '"'.$user['payment_procedure'].'",';
				$row .= '"'.$user['knowledge_of_product'].'",';
				$row .= '"'.$user['call_control'].'",';
				$row .= '"'.$user['faq'].'",';
				$row .= '"'.$user['objection_response'].'",';
				$row .= '"'.$user['personalize_the_call'].'",';
				$row .= '"'.$user['correct_confirmation'].'",';
				$row .= '"'.$user['cost_of_delivery'].'",';
				$row .= '"'.$user['misrepresentation'].'",';
				$row .= '"'.$user['dnc_response'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}else if($pid=='purity_catalog'){
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['proper_greeting'].'",';
				$row .= '"'.$user['customer_first_name_address_verification'].'",';
				$row .= '"'.$user['identified_type_of_account'].'",';
				$row .= '"'.$user['properly_transfer_account'].'",';
				$row .= '"'.$user['accurate_note_taken'].'",';
				$row .= '"'.$user['correct_information_given'].'",';
				$row .= '"'.$user['proper_terminology'].'",';
				$row .= '"'.$user['free_gift_scripting'].'",';
				$row .= '"'.$user['bulk_offer'].'",';
				$row .= '"'.$user['super_saver_offer_explained_correctly'].'",';
				$row .= '"'.$user['additional_product_offered'].'",';
				$row .= '"'.$user['order_placed_properly'].'",';
				$row .= '"'.$user['order_confirmation'].'",';
				$row .= '"'.$user['user_tool_faq'].'",';
				$row .= '"'.$user['address_verification_at_confirmation'].'",';
				$row .= '"'.$user['credit_card_verification'].'",';
				$row .= '"'.$user['attemp_to_gather_cvv_code'].'",';
				$row .= '"'.$user['daily_special_offer'].'",';
				$row .= '"'.$user['product_offered_with_daily_special'].'",';
				$row .= '"'.$user['thank_you_statement'].'",';
				$row .= '"'.$user['maintained_call_control'].'",';
				$row .= '"'.$user['response_time'].'",';
				$row .= '"'.$user['used_proper_hold_techniques'].'",';
				$row .= '"'.$user['good_attitude'].'",';
				$row .= '"'.$user['energy_attentiveness'].'",';
				$row .= '"'.$user['context_related_response'].'",';
				$row .= '"'.$user['empathy_respectfulness'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		
		}else if($pid=='purity_care'){
			foreach($rr as $user){
				$row = '"'.$user['auditor_name'].'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_one_call_duration'].'",';
				$row .= '"'.$user['call_one_file_no'].'",';
				$row .= '"'.$user['call_two_call_duration'].'",';
				$row .= '"'.$user['call_two_file_no'].'",';
				//$row .= '"'.$user['call_two_voc'].'",';
				$row .= '"'.$user['call_three_call_duration'].'",';
				$row .= '"'.$user['call_three_file_no'].'",';
				//$row .= '"'.$user['call_three_voc'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['call_one_proper_introduction'].'",';
				$row .= '"'.$user['call_two_proper_introduction'].'",';
				$row .= '"'.$user['call_three_proper_introduction'].'",';
				$row .= '"'.$user['review_proper_introduction'].'",';
				$row .= '"'.$user['score_proper_introduction'].'",';
				$row .= '"'.$user['call_one_cust_fname_addrs_verification'].'",';
				$row .= '"'.$user['call_two_cust_fname_addrs_verification'].'",';
				$row .= '"'.$user['call_three_cust_fname_addrs_verification'].'",';
				$row .= '"'.$user['review_cust_fname_addrs_verification'].'",';
				$row .= '"'.$user['score_cust_fname_addrs_verification'].'",';
				$row .= '"'.$user['call_one_opening_question'].'",';
				$row .= '"'.$user['call_two_opening_question'].'",';
				$row .= '"'.$user['call_three_opening_question'].'",';
				$row .= '"'.$user['review_opening_question'].'",';
				$row .= '"'.$user['score_opening_question'].'",';
				$row .= '"'.$user['call_one_accurate_note'].'",';
				$row .= '"'.$user['call_two_accurate_note'].'",';
				$row .= '"'.$user['call_three_accurate_note'].'",';
				$row .= '"'.$user['review_accurate_note'].'",';
				$row .= '"'.$user['score_accurate_note'].'",';
				$row .= '"'.$user['call_one_correct_reason'].'",';
				$row .= '"'.$user['call_two_correct_reason'].'",';
				$row .= '"'.$user['call_three_correct_reason'].'",';
				$row .= '"'.$user['review_correct_reason'].'",';
				$row .= '"'.$user['score_correct_reason'].'",';
				$row .= '"'.$user['call_one_correct_information_given'].'",';
				$row .= '"'.$user['call_two_correct_information_given'].'",';
				$row .= '"'.$user['call_three_correct_information_given'].'",';
				$row .= '"'.$user['review_correct_information_given'].'",';
				$row .= '"'.$user['score_correct_information_given'].'",';
				$row .= '"'.$user['call_one_proper_terminology'].'",';
				$row .= '"'.$user['call_two_proper_terminology'].'",';
				$row .= '"'.$user['call_three_proper_terminology'].'",';
				$row .= '"'.$user['review_proper_terminology'].'",';
				$row .= '"'.$user['score_proper_terminology'].'",';
				$row .= '"'.$user['call_one_proper_inquiry'].'",';
				$row .= '"'.$user['call_two_proper_inquiry'].'",';
				$row .= '"'.$user['call_three_proper_inquiry'].'",';
				$row .= '"'.$user['review_proper_inquiry'].'",';
				$row .= '"'.$user['score_company_promotion'].'",';
				$row .= '"'.$user['call_one_company_promotion'].'",';
				$row .= '"'.$user['call_two_company_promotion'].'",';
				$row .= '"'.$user['call_three_company_promotion'].'",';
				$row .= '"'.$user['review_company_promotion'].'",';
				$row .= '"'.$user['score_company_promotion'].'",';
				$row .= '"'.$user['call_one_correct_use_of_action'].'",';
				$row .= '"'.$user['call_two_correct_use_of_action'].'",';
				$row .= '"'.$user['call_three_correct_use_of_action'].'",';
				$row .= '"'.$user['review_correct_use_of_action'].'",';
				$row .= '"'.$user['score_correct_use_of_action'].'",';
				$row .= '"'.$user['call_one_database_follow_up'].'",';
				$row .= '"'.$user['call_two_database_follow_up'].'",';
				$row .= '"'.$user['call_three_database_follow_up'].'",';
				$row .= '"'.$user['review_database_follow_up'].'",';
				$row .= '"'.$user['score_database_follow_up'].'",';
				$row .= '"'.$user['call_one_product_promotion'].'",';
				$row .= '"'.$user['call_two_product_promotion'].'",';
				$row .= '"'.$user['call_three_product_promotion'].'",';
				$row .= '"'.$user['review_product_promotion'].'",';
				$row .= '"'.$user['score_product_promotion'].'",';
				$row .= '"'.$user['call_one_reason_for_cancel'].'",';
				$row .= '"'.$user['call_two_reason_for_cancel'].'",';
				$row .= '"'.$user['call_three_reason_for_cancel'].'",';
				$row .= '"'.$user['review_reason_for_cancel'].'",';
				$row .= '"'.$user['score_reason_for_cancel'].'",';
				$row .= '"'.$user['call_one_legimate_sequence_offer'].'",';
				$row .= '"'.$user['call_two_legimate_sequence_offer'].'",';
				$row .= '"'.$user['call_three_legimate_sequence_offer'].'",';
				$row .= '"'.$user['review_legimate_sequence_offer'].'",';
				$row .= '"'.$user['score_legimate_sequence_offer'].'",';
				$row .= '"'.$user['call_one_first_retention_offer'].'",';
				$row .= '"'.$user['call_two_first_retention_offer'].'",';
				$row .= '"'.$user['call_three_first_retention_offer'].'",';
				$row .= '"'.$user['review_first_retention_offer'].'",';
				$row .= '"'.$user['score_first_retention_offer'].'",';
				$row .= '"'.$user['call_one_second_retention_offer'].'",';
				$row .= '"'.$user['call_two_second_retention_offer'].'",';
				$row .= '"'.$user['call_three_second_retention_offer'].'",';
				$row .= '"'.$user['review_second_retention_offer'].'",';
				$row .= '"'.$user['score_second_retention_offer'].'",';
				$row .= '"'.$user['call_one_valid_delay'].'",';
				$row .= '"'.$user['call_two_valid_delay'].'",';
				$row .= '"'.$user['call_three_valid_delay'].'",';
				$row .= '"'.$user['review_valid_delay'].'",';
				$row .= '"'.$user['score_valid_delay'].'",';
				$row .= '"'.$user['call_one_preserved_avg_unit'].'",';
				$row .= '"'.$user['call_two_preserved_avg_unit'].'",';
				$row .= '"'.$user['call_three_preserved_avg_unit'].'",';
				$row .= '"'.$user['review_preserved_avg_unit'].'",';
				$row .= '"'.$user['score_preserved_avg_unit'].'",';
				$row .= '"'.$user['call_one_proper_confirmation'].'",';
				$row .= '"'.$user['call_two_proper_confirmation'].'",';
				$row .= '"'.$user['call_three_proper_confirmation'].'",';
				$row .= '"'.$user['review_proper_confirmation'].'",';
				$row .= '"'.$user['score_proper_confirmation'].'",';
				$row .= '"'.$user['call_one_daily_special_offer'].'",';
				$row .= '"'.$user['call_two_daily_special_offer'].'",';
				$row .= '"'.$user['call_three_daily_special_offer'].'",';
				$row .= '"'.$user['review_daily_special_offer'].'",';
				$row .= '"'.$user['score_daily_special_offer'].'",';
				$row .= '"'.$user['call_one_anything_else'].'",';
				$row .= '"'.$user['call_two_anything_else'].'",';
				$row .= '"'.$user['call_three_anything_else'].'",';
				$row .= '"'.$user['review_anything_else'].'",';
				$row .= '"'.$user['score_anything_else'].'",';
				$row .= '"'.$user['call_one_thank_you'].'",';
				$row .= '"'.$user['call_two_thank_you'].'",';
				$row .= '"'.$user['call_three_thank_you'].'",';
				$row .= '"'.$user['review_thank_you'].'",';
				$row .= '"'.$user['score_thank_you'].'",';
				$row .= '"'.$user['call_one_mantained_call'].'",';
				$row .= '"'.$user['call_two_mantained_call'].'",';
				$row .= '"'.$user['call_three_mantained_call'].'",';
				$row .= '"'.$user['review_mantained_call'].'",';
				$row .= '"'.$user['score_mantained_call'].'",';
				$row .= '"'.$user['call_one_response_time'].'",';
				$row .= '"'.$user['call_two_response_time'].'",';
				$row .= '"'.$user['call_three_response_time'].'",';
				$row .= '"'.$user['review_response_time'].'",';
				$row .= '"'.$user['score_response_time'].'",';
				$row .= '"'.$user['call_one_proper_hold_technique'].'",';
				$row .= '"'.$user['call_two_proper_hold_technique'].'",';
				$row .= '"'.$user['call_three_proper_hold_technique'].'",';
				$row .= '"'.$user['review_proper_hold_technique'].'",';
				$row .= '"'.$user['score_proper_hold_technique'].'",';
				$row .= '"'.$user['call_one_good_attitude'].'",';
				$row .= '"'.$user['call_two_good_attitude'].'",';
				$row .= '"'.$user['call_three_good_attitude'].'",';
				$row .= '"'.$user['review_good_attitude'].'",';
				$row .= '"'.$user['score_good_attitude'].'",';
				$row .= '"'.$user['call_one_attentiveness'].'",';
				$row .= '"'.$user['call_two_attentiveness'].'",';
				$row .= '"'.$user['call_three_attentiveness'].'",';
				$row .= '"'.$user['review_attentiveness'].'",';
				$row .= '"'.$user['score_attentiveness'].'",';
				$row .= '"'.$user['call_one_context_related_response'].'",';
				$row .= '"'.$user['call_two_context_related_response'].'",';
				$row .= '"'.$user['call_three_context_related_response'].'",';
				$row .= '"'.$user['review_context_related_response'].'",';
				$row .= '"'.$user['score_context_related_response'].'",';
				$row .= '"'.$user['call_one_empathy'].'",';
				$row .= '"'.$user['call_two_empathy'].'",';
				$row .= '"'.$user['call_three_empathy'].'",';
				$row .= '"'.$user['review_empathy'].'",';
				$row .= '"'.$user['score_empathy'].'",';
				$row .= '"'.$user['call_one_badgering'].'",';
				$row .= '"'.$user['call_two_badgering'].'",';
				$row .= '"'.$user['call_three_badgering'].'",';
				$row .= '"'.$user['review_badgering'].'",';
				$row .= '"'.$user['score_badgering'].'",';
				$row .= '"'.$user['call_one_avg_call'].'",';
				$row .= '"'.$user['call_two_avg_call'].'",';
				$row .= '"'.$user['call_three_avg_call'].'",';
				$row .= '"'.$user['review_avg_call'].'",';
				$row .= '"'.$user['score_avg_call'].'",';
				$row .= '"'.$user['call_one_avg_save'].'",';
				$row .= '"'.$user['call_two_avg_save'].'",';
				$row .= '"'.$user['call_three_avg_save'].'",';
				$row .= '"'.$user['review_avg_save'].'",';
				$row .= '"'.$user['score_avg_save'].'",';
				$row .= '"'.$user['call_one_avg_call_length'].'",';
				$row .= '"'.$user['call_two_avg_call_length'].'",';
				$row .= '"'.$user['call_three_avg_call_length'].'",';
				$row .= '"'.$user['review_avg_call_length'].'",';
				$row .= '"'.$user['score_avg_call_length'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';

				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		
		}else if($pid=='puritycare_new'){
			foreach($rr as $user){
				$row = '"'.$user['auditor_name'].'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['customer_address_verfication_call1'].'",';
				$row .= '"'.$user['customer_address_verfication_call2'].'",';
				$row .= '"'.$user['customer_address_verfication_call3'].'",';
				$row .= '"'.$user['script_compliance_call1'].'",';
				$row .= '"'.$user['script_compliance_call2'].'",';
				$row .= '"'.$user['script_compliance_call3'].'",';
				$row .= '"'.$user['opening_question_call1'].'",';
				$row .= '"'.$user['opening_question_call2'].'",';
				$row .= '"'.$user['opening_question_call3'].'",';
				$row .= '"'.$user['detail_note_call1'].'",';
				$row .= '"'.$user['detail_note_call2'].'",';
				$row .= '"'.$user['detail_note_call3'].'",';
				$row .= '"'.$user['correct_info_call1'].'",';
				$row .= '"'.$user['correct_info_call2'].'",';
				$row .= '"'.$user['correct_info_call3'].'",';
				$row .= '"'.$user['correct_reason_call1'].'",';
				$row .= '"'.$user['correct_reason_call2'].'",';
				$row .= '"'.$user['correct_reason_call3'].'",';
				$row .= '"'.$user['proper_terminilogy_call1'].'",';
				$row .= '"'.$user['proper_terminilogy_call2'].'",';
				$row .= '"'.$user['proper_terminilogy_call3'].'",';
				$row .= '"'.$user['proper_inquiry_call1'].'",';
				$row .= '"'.$user['proper_inquiry_call2'].'",';
				$row .= '"'.$user['proper_inquiry_call3'].'",';
				$row .= '"'.$user['product_promotion_call1'].'",';
				$row .= '"'.$user['product_promotion_call2'].'",';
				$row .= '"'.$user['product_promotion_call3'].'",';
				$row .= '"'.$user['company_promotion_call1'].'",';
				$row .= '"'.$user['company_promotion_call2'].'",';
				$row .= '"'.$user['company_promotion_call3'].'",';
				$row .= '"'.$user['database_followup_call1'].'",';
				$row .= '"'.$user['database_followup_call2'].'",';
				$row .= '"'.$user['database_followup_call3'].'",';
				$row .= '"'.$user['reason_cancel_call1'].'",';
				$row .= '"'.$user['reason_cancel_call2'].'",';
				$row .= '"'.$user['reason_cancel_call3'].'",';
				$row .= '"'.$user['1st_retention_call1'].'",';
				$row .= '"'.$user['1st_retention_call2'].'",';
				$row .= '"'.$user['1st_retention_call3'].'",';
				$row .= '"'.$user['two_tools_call1'].'",';
				$row .= '"'.$user['two_tools_call2'].'",';
				$row .= '"'.$user['two_tools_call3'].'",';
				$row .= '"'.$user['sequence_offers_call1'].'",';
				$row .= '"'.$user['sequence_offers_call2'].'",';
				$row .= '"'.$user['sequence_offers_call3'].'",';
				$row .= '"'.$user['2nd_retention_call1'].'",';
				$row .= '"'.$user['2nd_retention_call2'].'",';
				$row .= '"'.$user['2nd_retention_call3'].'",';
				$row .= '"'.$user['bottles_call1'].'",';
				$row .= '"'.$user['bottles_call2'].'",';
				$row .= '"'.$user['bottles_call3'].'",';
				$row .= '"'.$user['correct_delay_call1'].'",';
				$row .= '"'.$user['correct_delay_call2'].'",';
				$row .= '"'.$user['correct_delay_call3'].'",';
				$row .= '"'.$user['complete_recap_call1'].'",';
				$row .= '"'.$user['complete_recap_call2'].'",';
				$row .= '"'.$user['complete_recap_call3'].'",';
				$row .= '"'.$user['question_call1'].'",';
				$row .= '"'.$user['question_call2'].'",';
				$row .= '"'.$user['question_call3'].'",';
				$row .= '"'.$user['special_offer_call1'].'",';
				$row .= '"'.$user['special_offer_call2'].'",';
				$row .= '"'.$user['special_offer_call3'].'",';
				$row .= '"'.$user['thank_you_call1'].'",';
				$row .= '"'.$user['thank_you_call2'].'",';
				$row .= '"'.$user['thank_you_call3'].'",';
				$row .= '"'.$user['call_control_call1'].'",';
				$row .= '"'.$user['call_control_call2'].'",';
				$row .= '"'.$user['call_control_call3'].'",';
				$row .= '"'.$user['hold_technique_call1'].'",';
				$row .= '"'.$user['hold_technique_call2'].'",';
				$row .= '"'.$user['hold_technique_call3'].'",';
				$row .= '"'.$user['dead_air_call1'].'",';
				$row .= '"'.$user['dead_air_call2'].'",';
				$row .= '"'.$user['dead_air_call3'].'",';
				$row .= '"'.$user['used_dead_call1'].'",';
				$row .= '"'.$user['used_dead_call2'].'",';
				$row .= '"'.$user['used_dead_call3'].'",';
				$row .= '"'.$user['good_attitude_call1'].'",';
				$row .= '"'.$user['good_attitude_call2'].'",';
				$row .= '"'.$user['good_attitude_call3'].'",';
				$row .= '"'.$user['context_related_call1'].'",';
				$row .= '"'.$user['context_related_call2'].'",';
				$row .= '"'.$user['context_related_call3'].'",';
				$row .= '"'.$user['enthusiasm_call1'].'",';
				$row .= '"'.$user['enthusiasm_call2'].'",';
				$row .= '"'.$user['enthusiasm_call3'].'",';
				$row .= '"'.$user['respectful_call1'].'",';
				$row .= '"'.$user['respectful_call2'].'",';
				$row .= '"'.$user['respectful_call3'].'",';
				$row .= '"'.$user['call_length_call1'].'",';
				$row .= '"'.$user['call_length_call2'].'",';
				$row .= '"'.$user['call_length_call3'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';

				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		
		}else if($pid=='touchfuse'){
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['call_status'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['callasnwer'].'",';
				$row .= '"'.$user['agentanswer'].'",';
				$row .= '"'.$user['agentzip'].'",';
				$row .= '"'.$user['agentoffer'].'",';
				$row .= '"'.$user['callerwish'].'",';
				$row .= '"'.$user['agentconfirm'].'",';
				$row .= '"'.$user['calleraddress'].'",';
				$row .= '"'.$user['calleremail'].'",';
				$row .= '"'.$user['agentphone'].'",';
				$row .= '"'.$user['agentsummerize'].'",';
				$row .= '"'.$user['registerguest'].'",';
				$row .= '"'.$user['dispocall'].'",';
				$row .= '"'.$user['agentclosing'].'",';
				$row .= '"'.$user['agenttone'].'",';
				$row .= '"'.$user['activelistening'].'",';
				$row .= '"'.$user['agentprofession'].'",';
				$row .= '"'.$user['agentknowledge'].'",';
				$row .= '"'.$user['callcontrol'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		
		}else if($pid=='tbn'){
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['call_id'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['introrecord'].'",';
				$row .= '"'.$user['introcall'].'",';
				$row .= '"'.$user['introname'].'",';
				$row .= '"'.$user['introstate'].'",';
				$row .= '"'.$user['introscript'].'",';
				$row .= '"'.$user['introdisclose'].'",';
				$row .= '"'.$user['verifydonor'].'",';
				$row .= '"'.$user['verifyaddress'].'",';
				$row .= '"'.$user['verifyspelled'].'",';
				$row .= '"'.$user['verifyemail'].'",';
				$row .= '"'.$user['verifyback'].'",';
				$row .= '"'.$user['verifyasked'].'",';
				$row .= '"'.$user['verifyconfirm'].'",';
				$row .= '"'.$user['verifytype'].'",';
				$row .= '"'.$user['verifycell'].'",';
				$row .= '"'.$user['verifyaskalterphn'].'",';
				$row .= '"'.$user['verifyalterphn'].'",';
				$row .= '"'.$user['verifyalterno'].'",';
				$row .= '"'.$user['verifyconsent'].'",';
				$row .= '"'.$user['presentrequest'].'",';
				$row .= '"'.$user['presenttieroffer'].'",';
				$row .= '"'.$user['presentmonthask'].'",';
				$row .= '"'.$user['presentnavigate'].'",';
				$row .= '"'.$user['presenttbnknowledge'].'",';
				$row .= '"'.$user['presentauthor'].'",';
				$row .= '"'.$user['presentadherence'].'",';
				$row .= '"'.$user['cartclosedonation'].'",';
				$row .= '"'.$user['cartcloseamount'].'",';
				$row .= '"'.$user['cartclosemonthly'].'",';
				$row .= '"'.$user['cartcloseresource'].'",';
				$row .= '"'.$user['cartclosescript'].'",';
				$row .= '"'.$user['callhandleclearly'].'",';
				$row .= '"'.$user['callhandledemeanor'].'",';
				$row .= '"'.$user['callhandlepace'].'",';
				$row .= '"'.$user['callhandlelisten'].'",';
				$row .= '"'.$user['callhandleexhibit'].'",';
				$row .= '"'.$user['callhandlecommunicate'].'",';
				$row .= '"'.$user['callhandlecontrol'].'",';
				$row .= '"'.$user['autofinfo'].'",';
				$row .= '"'.$user['autofcall'].'",';
				$row .= '"'.$user['autofbehaviour'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		
		}else if($pid=='jfmi'){
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['greets_customer_promptly'].'",';
				$row .= '"'.$user['uses_professionalism'].'",';
				$row .= '"'.$user['shows_gratitude'].'",';
				$row .= '"'.$user['collects_and_verifies_customer_information'].'",';
				$row .= '"'.$user['follows_correct_scripting_path'].'",';
				$row .= '"'.$user['collects_information_to_provide_to_partner_relations'].'",';
				$row .= '"'.$user['covers_all_payment_scripting'].'",';
				$row .= '"'.$user['maintains_call_control'].'",';
				$row .= '"'.$user['keeps_dead_air_to_minimum'].'",';
				$row .= '"'.$user['uses_faq_agent_note'].'",';
				$row .= '"'.$user['brands_the_call_with_proper_close'].'",';
				$row .= '"'.$user['stop_recording'].'",';
				$row .= '"'.$user['read_legal_script'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}else if($pid=='hoveround'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['agentreadyforcall'].'",';
				$row .= '"'.$user['agentgiveintro'].'",';
				$row .= '"'.$user['agentcorrectprobe'].'",';
				$row .= '"'.$user['agentverifycustomer'].'",';
				$row .= '"'.$user['agentclosecall'].'",';
				$row .= '"'.$user['agentdisposition'].'",';
				$row .= '"'.$user['agentpolite'].'",';
				$row .= '"'.$user['agentshowenergy'].'",';
				$row .= '"'.$user['agenthavegoodtone'].'",';
				$row .= '"'.$user['agentgiveaccurateinfo'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		
		}else if($pid=='ncpssm'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['introcaller'].'",';
				$row .= '"'.$user['introopenning'].'",';
				$row .= '"'.$user['scriptgathered'].'",';
				$row .= '"'.$user['scriptemail'].'",';
				$row .= '"'.$user['scriptstatement'].'",';
				$row .= '"'.$user['scriptmedicareissue'].'",';
				$row .= '"'.$user['scriptpersonalizecall'].'",';
				$row .= '"'.$user['scriptcallersupport'].'",';
				$row .= '"'.$user['toneenthusiasm'].'",';
				$row .= '"'.$user['toneproperpace'].'",';
				$row .= '"'.$user['tonecontroldeadair'].'",';
				$row .= '"'.$user['tonespokeclearly'].'",';
				$row .= '"'.$user['tonegoodlistening'].'",';
				$row .= '"'.$user['toneempathized'].'",';
				$row .= '"'.$user['toneprofessionalism'].'",';
				$row .= '"'.$user['closecallconslusion'].'",';
				$row .= '"'.$user['closecorrectinfo'].'",';
				$row .= '"'.$user['closeconfirmcaller'].'",';
				$row .= '"'.$user['autofailinfo'].'",';
				$row .= '"'.$user['autofailhungup'].'",';
				$row .= '"'.$user['autofailbehaviour'].'",';
				$row .= '"'.$user['autofaillanguage'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		
		}else if($pid=='stc'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['agentproperintro'].'",';
				$row .= '"'.$user['agentcapturedonorname'].'",';
				$row .= '"'.$user['agentreadscript'].'",';
				$row .= '"'.$user['agentcovermonthlyrequest'].'",';
				$row .= '"'.$user['agentcapturedonationamount'].'",';
				$row .= '"'.$user['agentofferpayment'].'",';
				$row .= '"'.$user['agentcapturedonoraddress'].'",';
				$row .= '"'.$user['agentcapturedonorphone'].'",';
				$row .= '"'.$user['agentcapturedonoremail'].'",';
				$row .= '"'.$user['agentproperlyrebuttals'].'",';
				$row .= '"'.$user['agentfollowscript'].'",';
				$row .= '"'.$user['agentshowfamiliarity'].'",';
				$row .= '"'.$user['agentusescriptnavigation'].'",';
				$row .= '"'.$user['agentfollowproperclose'].'",';
				$row .= '"'.$user['agentuseeffectivecommunication'].'",';
				$row .= '"'.$user['agentmaintaincontrol'].'",';
				$row .= '"'.$user['agentshowappreciation'].'",';
				$row .= '"'.$user['autofailfalseinfo'].'",';
				$row .= '"'.$user['autofailhungup'].'",';
				$row .= '"'.$user['autofailagentbehaviuor'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}else if($pid=='tpm'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['introcall'].'",';
				$row .= '"'.$user['verifycall'].'",';
				$row .= '"'.$user['verifypayment'].'",';
				$row .= '"'.$user['verifycommunicator'].'",';
				$row .= '"'.$user['verifyspelledname'].'",';
				$row .= '"'.$user['verifyaskedaddress'].'",';
				$row .= '"'.$user['verifyspelledaddress'].'",';
				$row .= '"'.$user['verifyaskedphone'].'",';
				$row .= '"'.$user['verifycommunicatorphone'].'",';
				$row .= '"'.$user['verifylandline'].'",';
				$row .= '"'.$user['verifycallverbatim'].'",';
				$row .= '"'.$user['verifytextverbatim'].'",';
				$row .= '"'.$user['verifyaskedemail'].'",';
				$row .= '"'.$user['verifyspelledemail'].'",';
				$row .= '"'.$user['scriptadherence'].'",';
				$row .= '"'.$user['scripthighertier'].'",';
				$row .= '"'.$user['scriptnavigate'].'",';
				$row .= '"'.$user['scriptdisplaytpm'].'",';
				$row .= '"'.$user['closedcontent'].'",';
				$row .= '"'.$user['closedmonthlyask'].'",';
				$row .= '"'.$user['closedshippingtime'].'",';
				$row .= '"'.$user['closedprovidecart'].'",';
				$row .= '"'.$user['closedreadscript'].'",';
				$row .= '"'.$user['callhandlespeakclearly'].'",';
				$row .= '"'.$user['callhandledemeanor'].'",';
				$row .= '"'.$user['callhandleprofesionalism'].'",';
				$row .= '"'.$user['callhandlepace'].'",';
				$row .= '"'.$user['callhandleresponds'].'",';
				$row .= '"'.$user['callhandleemphaty'].'",';
				$row .= '"'.$user['callhandledonor'].'",';
				$row .= '"'.$user['callhandletalktime'].'",';
				$row .= '"'.$user['autofinfo'].'",';
				$row .= '"'.$user['autofhungup'].'",';
				$row .= '"'.$user['autofrude'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}else if($pid=='patchology'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['agentcallopening'].'",';
				$row .= '"'.$user['agentclosecall'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['remarks1'])).'",';
				$row .= '"'.$user['agentverifyinformation'].'",';
				$row .= '"'.$user['agentprovideinformation'].'",';
				$row .= '"'.$user['agenthippinginformation'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['remarks2'])).'",';
				$row .= '"'.$user['callanswertimely'].'",';
				$row .= '"'.$user['agentengagedcustomer'].'",';
				$row .= '"'.$user['customersatisfaction'].'",';
				$row .= '"'.$user['escalatedresources'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['remarks3'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);	
			
		}else if($pid=='aspca'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['Greet_customer'].'",';
				$row .= '"'.$user['Uses_professionalism'].'",';
				$row .= '"'.$user['Shows_gratitude'].'",';
				$row .= '"'.$user['Collects_verifies'].'",';
				$row .= '"'.$user['guardians_program'].'",';
				$row .= '"'.$user['monthly_guardian'].'",';
				$row .= '"'.$user['gift_scripting'].'",';
				$row .= '"'.$user['payment_scripting'].'",';
				$row .= '"'.$user['Animal_champion'].'",';
				$row .= '"'.$user['donation_processing'].'",';
				$row .= '"'.$user['onetime_donation'].'",';
				$row .= '"'.$user['pet_insurance'].'",';
				$row .= '"'.$user['correct_script'].'",';
				$row .= '"'.$user['call_control'].'",';
				$row .= '"'.$user['min_deadair'].'",';
				$row .= '"'.$user['faq'].'",';
				$row .= '"'.$user['personalizes_call'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		
		}else if($pid=='ffai'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['open_call_appropriate_branding'].'",';
				$row .= '"'.$user['close_call_appropriate_branding'].'",';
				$row .= '"'.$user['before_with_filtersfast'].'",';
				$row .= '"'.$user['address_using_nato'].'",';
				$row .= '"'.$user['products_availability'].'",';
				$row .= '"'.$user['one_call_resolution'].'",';
				$row .= '"'.$user['agent_accurately_clearly'].'",';
				$row .= '"'.$user['agent_engaged_customer'].'",';
				$row .= '"'.$user['membership'].'",';
				$row .= '"'.$user['offer_donation'].'",';
				$row .= '"'.$user['explored_before_transferring'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}else if($pid=='lifi'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['life_quotes_greeting'].'",';
				$row .= '"'.$user['agent_positive_response'].'",';
				$row .= '"'.$user['customer_name_capture'].'",';
				$row .= '"'.$user['capture_address'].'",';
				$row .= '"'.$user['phone_number_confirmation'].'",';
				$row .= '"'.$user['email_Address'].'",';
				$row .= '"'.$user['customer_dob'].'",';
				$row .= '"'.$user['script_adherence'].'",';
				$row .= '"'.$user['coverage_amount_insurance'].'",';
				$row .= '"'.$user['tobacco_smoking'].'",';
				$row .= '"'.$user['height_weight_customer'].'",';
				$row .= '"'.$user['mention_price_comparison'].'",';
				$row .= '"'.$user['overall_confidence_level'].'",';
				$row .= '"'.$user['call_closing'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		
		}else if($pid=='heatsurge'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['callprepared5sec'].'",';
				$row .= '"'.$user['useibobgreeting'].'",';
				$row .= '"'.$user['accesscustomeraccount'].'",';
				$row .= '"'.$user['vreifynameaddress'].'",';
				$row .= '"'.$user['askforemail'].'",';
				$row .= '"'.$user['readminiMiranda'].'",';
				$row .= '"'.$user['giveaccuratepricing'].'",';
				$row .= '"'.$user['giveaccurateshiping'].'",';
				$row .= '"'.$user['accuratedescribeproduct'].'",';
				$row .= '"'.$user['askforupsellproduct'].'",';
				$row .= '"'.$user['provideappropiatesolution'].'",';
				$row .= '"'.$user['codedordercorrectly'].'",';
				$row .= '"'.$user['askforcancelarion'].'",';
				$row .= '"'.$user['usePKkeybuying'].'",';
				$row .= '"'.$user['useappropiateguideline'].'",';
				$row .= '"'.$user['askforbillingname'].'",';
				$row .= '"'.$user['authorizeuserofcheck'].'",';
				$row .= '"'.$user['billingaddressforpayment'].'",';
				$row .= '"'.$user['permissiontoauthorizepayment'].'",';
				$row .= '"'.$user['vrifyshippingaddress'].'",';
				$row .= '"'.$user['accountwithissue'].'",';
				$row .= '"'.$user['summarizesreviewcall'].'",';
				$row .= '"'.$user['gaveCSphonenumber'].'",';
				$row .= '"'.$user['wasagentpolite'].'",';
				$row .= '"'.$user['usinginappropiatecomment'].'",';
				$row .= '"'.$user['usesholdtrasferproperly'].'",';
				$row .= '"'.$user['automaticzero'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);	
			
		}else if($pid=='stauers_sales'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['call_answered_5_seconds'].'",';
				$row .= '"'.$user['agent_verify_customer_name_address'].'",';
				$row .= '"'.$user['agent_capture_correct_offer'].'",';
				$row .= '"'.$user['agent_verify_phone_number'].'",';
				$row .= '"'.$user['agent_verify_customer_email'].'",';
				$row .= '"'.$user['agent_compliment_caller_purchase'].'",';
				$row .= '"'.$user['agent_recap_item'].'",';
				$row .= '"'.$user['agent_cover_one_upsell'].'",';
				$row .= '"'.$user['agent_cover_replacement'].'",';
				$row .= '"'.$user['agent_appropriate_rebuttal'].'",';
				$row .= '"'.$user['agent_cover_membership'].'",';
				$row .= '"'.$user['agent_appropriate_rebuttal_declined'].'",';
				$row .= '"'.$user['agent_offer_membership'].'",';
				$row .= '"'.$user['agent_cover_autorenew'].'",';
				$row .= '"'.$user['shipping_address_verified'].'",';
				$row .= '"'.$user['quote_correct_delivery_time'].'",';
				$row .= '"'.$user['agent_total_product_appropriately'].'",';
				$row .= '"'.$user['agent_quote_shipping_taxes'].'",';
				$row .= '"'.$user['agent_give_total_charged'].'",';
				$row .= '"'.$user['agent_provide_order_number'].'",';
				$row .= '"'.$user['agent_close_call_brand_correctly'].'",';
				$row .= '"'.$user['customer_satisfied_experience'].'",';
				$row .= '"'.$user['customer_dissatisfied_professionalism'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);	
			
		}else if($pid=='operation_smile'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['agentreadytohandle'].'",';
				$row .= '"'.$user['agentgreetthecaller'].'",';
				$row .= '"'.$user['agentconfirminfo'].'",';
				$row .= '"'.$user['agentshowgraduate'].'",';
				$row .= '"'.$user['agentuserebuttals'].'",';
				$row .= '"'.$user['agentofferupsell'].'",';
				$row .= '"'.$user['agentfollowscript'].'",';
				$row .= '"'.$user['agentaddressquestion'].'",';
				$row .= '"'.$user['agentspeakenergy'].'",';
				$row .= '"'.$user['agentuseproperpacing'].'",';
				$row .= '"'.$user['agentmaintaincontrol'].'",';
				$row .= '"'.$user['agentprofessionalspeak'].'",';
				$row .= '"'.$user['agentgoodlistening'].'",';
				$row .= '"'.$user['agentempathize'].'",';
				$row .= '"'.$user['agentprovidedonor'].'",';
				$row .= '"'.$user['agnetaskprompted'].'",';
				$row .= '"'.$user['agentthankcaller'].'",';
				$row .= '"'.$user['agentgaveinformation'].'",';
				$row .= '"'.$user['agenthangup'].'",';
				$row .= '"'.$user['agentlaguage'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);	
			
		}else if($pid=='5_11_tactical'){ 
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['greetthecustomer'].'",';
				$row .= '"'.$user['customeritemtoorder'].'",';
				$row .= '"'.$user['wouldaddyourorder'].'",';
				$row .= '"'.$user['customerlogininformation'].'",';
				$row .= '"'.$user['callerinformationaccuracy'].'",';
				$row .= '"'.$user['coverfinalconfirmation'].'",';
				$row .= '"'.$user['givecustomerordernumber'].'",';
				$row .= '"'.$user['userapplicablesearch'].'",';
				$row .= '"'.$user['coverreturnprocess'].'",';
				$row .= '"'.$user['coverexchangeprocess'].'",';
				$row .= '"'.$user['coverrefundprocess'].'",';
				$row .= '"'.$user['trackthepackage'].'",';
				$row .= '"'.$user['agentaskforassist'].'",';
				$row .= '"'.$user['agentbrandthecall'].'",';
				$row .= '"'.$user['answerquestions'].'",';
				$row .= '"'.$user['maintaincallcontrol'].'",';
				$row .= '"'.$user['properlynotateAX'].'",';
				$row .= '"'.$user['escalationwaranted'].'",';
				$row .= '"'.$user['agentdispositioncall'].'",';
				$row .= '"'.$user['maintainprofessionalism'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);	
			
		}else if($pid=='jmmi'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['agent_appropriate_greeting'].'",';
				$row .= '"'.$user['agent_excellent_conversational_responses'].'",';
				$row .= '"'.$user['agent_verify_opening_information'].'",';
				$row .= '"'.$user['agent_follow_call_flow'].'",';
				$row .= '"'.$user['agent_appropriate_gratitude'].'",';
				$row .= '"'.$user['agent_share_upsells'].'",';
				$row .= '"'.$user['agent_show_familiarity_search'].'",';
				$row .= '"'.$user['agent_thank_caller_specifically'].'",';
				$row .= '"'.$user['agent_share_facts_appropriate'].'",';
				$row .= '"'.$user['agent_professional_communication'].'",';
				$row .= '"'.$user['agent_proper_enthusiasm'].'",';
				$row .= '"'.$user['agent_maintain_control_conversation'].'",';
				$row .= '"'.$user['agent_spoke_clearly'].'",';
				$row .= '"'.$user['agent_good_listening_skills_responses'].'",';
				$row .= '"'.$user['agent_empathize_caller_and_compassion'].'",';
				$row .= '"'.$user['agent_have_minimal_dead_air'].'",';
				$row .= '"'.$user['agent_have_caller_provide_address'].'",';
				$row .= '"'.$user['agent_confirm_dollar_amount'].'",';
				$row .= '"'.$user['agent_read_shipping_information'].'",';
				$row .= '"'.$user['agent_ask_caller_email_tv_information'].'",';
				$row .= '"'.$user['agent_proper_thanks'].'",';
				$row .= '"'.$user['agent_transfer_call_prayer_appropriate'].'",';
				$row .= '"'.$user['agent_follow_payment'].'",';
				$row .= '"'.$user['agent_read_back_customer_details_properly'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);	
			
		}else if($pid=='non_profit'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['preparedtakecall'].'",';
				$row .= '"'.$user['paidcallerfromdonor'].'",';
				$row .= '"'.$user['communicatorstarted'].'",';
				$row .= '"'.$user['pronouncedclients'].'",';
				$row .= '"'.$user['gavewarmgreeting'].'",';
				$row .= '"'.$user['followedscript1stReq'].'",';
				$row .= '"'.$user['usedcorrectdollar'].'",';
				$row .= '"'.$user['assumptivegiftask'].'",';
				$row .= '"'.$user['shownempathy'].'",';
				$row .= '"'.$user['repeatedobjection'].'",';
				$row .= '"'.$user['personalizedobjection'].'",';
				$row .= '"'.$user['attemptedhandleobjection'].'",';
				$row .= '"'.$user['reinforcethenegative'].'",';
				$row .= '"'.$user['deadendcall'].'",';
				$row .= '"'.$user['followed2ndReq'].'",';
				$row .= '"'.$user['usedoller2ndReq'].'",';
				$row .= '"'.$user['assumptive2ndReq'].'",';
				$row .= '"'.$user['attempted3rdReq'].'",';
				$row .= '"'.$user['usedoller3rdReq'].'",';
				$row .= '"'.$user['assumptive3rdReq'].'",';
				$row .= '"'.$user['confirmationgiftamount'].'",';
				$row .= '"'.$user['assumedhigherdoller'].'",';
				$row .= '"'.$user['meaningfulgratitude'].'",';
				$row .= '"'.$user['readcreditcard'].'",';
				$row .= '"'.$user['confirmedfullname'].'",';
				$row .= '"'.$user['followedmaybeclose'].'",';
				$row .= '"'.$user['readclosescript'].'",';
				$row .= '"'.$user['endedcalltime'].'",';
				$row .= '"'.$user['soundedconversational'].'",';
				$row .= '"'.$user['useappropiatepace'].'",';
				$row .= '"'.$user['confidentpresentation'].'",';
				$row .= '"'.$user['didnotlosecontrol'].'",';
				$row .= '"'.$user['properpersonalization'].'",';
				$row .= '"'.$user['utilizedpropergrammer'].'",';
				$row .= '"'.$user['bailing'].'",';
				$row .= '"'.$user['askforcreditcard'].'",';
				$row .= '"'.$user['gavefalseinformation'].'",';
				$row .= '"'.$user['donorcarecenter'].'",';
				$row .= '"'.$user['askconfirmationquestion'].'",';
				$row .= '"'.$user['unsolidgift'].'",';
				$row .= '"'.$user['codingrefusal'].'",';
				$row .= '"'.$user['unprofessionalbehaviour'].'",';
				$row .= '"'.$user['improperpresentation'].'",';
				$row .= '"'.$user['omittedDNCcode'].'",';
				$row .= '"'.$user['falsificationgift'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);	
			
		}else if($pid=='revel'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['csr_id'].'",';
				//$row .= '"'.$user['call_type'].'",';
				//$row .= '"'.$user['caller_type'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['repgreetingcustomer'].'",';
				$row .= '"'.$user['repuserespectfultone'].'",';
				$row .= '"'.$user['repasnwertimelymanner'].'",';
				$row .= '"'.$user['repcollectcallerinformation'].'",';
				$row .= '"'.$user['repuselisteningskills'].'",';
				$row .= '"'.$user['repdemonstratecalltechnique'].'",';
				$row .= '"'.$user['repreframeinterruptcaller'].'",';
				$row .= '"'.$user['repspeakclearlyatpace'].'",';
				$row .= '"'.$user['repavoiduseofterms'].'",';
				$row .= '"'.$user['repconfidentinresponce'].'",';
				$row .= '"'.$user['repusercallerlastname'].'",';
				$row .= '"'.$user['repusefiltertoobtain'].'",';
				$row .= '"'.$user['repmaintaincallcontrol'].'",';
				$row .= '"'.$user['repusetoolappropiately'].'",';
				$row .= '"'.$user['repdemonstrateproductknowledge'].'",';
				$row .= '"'.$user['repuseappropiatescript'].'",';
				$row .= '"'.$user['repaccuratelycalldocument'].'",';
				$row .= '"'.$user['repcompletecorrectclosing'].'",';
				$row .= '"'.$user['repthankthecaller'].'",';
				$row .= '"'.$user['repgiveMedicaladvice'].'",';
				$row .= '"'.$user['agentMiscodeCall'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt16'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt17'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt18'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt19'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt20'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt21'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);	
			
		}else if($pid=='qpc'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				//$row .= '"'.$user['csr_id'].'",';
				//$row .= '"'.$user['call_type'].'",';
				//$row .= '"'.$user['caller_type'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['unpreparedCallIntroduce'].'",';
				$row .= '"'.$user['didnotUseBranding'].'",';
				$row .= '"'.$user['dataNotCollected'].'",';
				$row .= '"'.$user['secondDataOccurrence'].'",';
				$row .= '"'.$user['inaccurateCallResult'].'",';
				$row .= '"'.$user['unusableAfterCallComment'].'",';
				$row .= '"'.$user['underutilizedCallNarration'].'",';
				$row .= '"'.$user['inappropiateFAQResponce'].'",';
				$row .= '"'.$user['imprpperTransaction'].'",';
				$row .= '"'.$user['underAcknowledgeCaller'].'",';
				$row .= '"'.$user['inappropiateScript'].'",';
				$row .= '"'.$user['notDisplayOwnership'].'",';
				$row .= '"'.$user['incorrectTransfer'].'",';
				$row .= '"'.$user['didagentabruptendcall'].'",';
				$row .= '"'.$user['didagentanswerpremiumquestion'].'",';
				$row .= '"'.$user['didagentgivewrongcallback'].'",';
				$row .= '"'.$user['didagentuseincorrectname'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt16'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt17'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);	
			
		}else if($pid=='ancient_nutrition'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['repgreetingcustomer'].'",';
				$row .= '"'.$user['repuserespectfultone'].'",';
				$row .= '"'.$user['repasnwertimelymanner'].'",';
				$row .= '"'.$user['repcollectcustomerinfo'].'",';
				$row .= '"'.$user['repcoverpaymentprocedure'].'",';
				$row .= '"'.$user['repuselisteningskills'].'",';
				$row .= '"'.$user['repdemonstratecalltechnique'].'",';
				$row .= '"'.$user['repreframeinterruptcaller'].'",';
				$row .= '"'.$user['repspeakclearlyatpace'].'",';
				$row .= '"'.$user['repavoiduseinternalterms'].'",';
				$row .= '"'.$user['repconfidentinresponce'].'",';
				$row .= '"'.$user['repusercallerlastname'].'",';
				$row .= '"'.$user['repusefiltertoobtain'].'",';
				$row .= '"'.$user['repcoverautoshipping'].'",';
				$row .= '"'.$user['repgatheredemail'].'",';
				$row .= '"'.$user['repcoverRushshipping'].'",';
				$row .= '"'.$user['repcompleteorderconfirmation'].'",';
				$row .= '"'.$user['repmaintaincallcontrol'].'",';
				$row .= '"'.$user['repusetoolappropiately'].'",';
				$row .= '"'.$user['repdemonstrateproductknowledge'].'",';
				$row .= '"'.$user['repuseappropiateobjection'].'",';
				$row .= '"'.$user['repaccuratelycalldocument'].'",';
				$row .= '"'.$user['repcompletecorrectclosing'].'",';
				$row .= '"'.$user['repthankthecallerbeforeclosing'].'",';
				$row .= '"'.$user['repcoveroffersappropiately'].'",';
				$row .= '"'.$user['repcoverupsellappropiately'].'",';
				$row .= '"'.$user['agentReadConfirmScript'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt16'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt17'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt18'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt19'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt20'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt21'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt22'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt23'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt24'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt25'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt26'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt27'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);	
			
		}else if($pid=='sabal'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['agentaskIndividualName'].'",';
				$row .= '"'.$user['agentIntroduceHimHerself'].'",';
				$row .= '"'.$user['agentStateCustomerService'].'",';
				$row .= '"'.$user['agentApologizePhoneCall'].'",';
				$row .= '"'.$user['agentIndividualRXplan'].'",';
				$row .= '"'.$user['agentReadListedExample'].'",';
				$row .= '"'.$user['agentAskIndividualColorCard'].'",';
				$row .= '"'.$user['agentAskIndividualUpdate'].'",';
				$row .= '"'.$user['agentAskIndividualEffectiveDate'].'",';
				$row .= '"'.$user['agentUseCorrectRebuttal'].'",';
				$row .= '"'.$user['agentUseIndividualScript'].'",';
				$row .= '"'.$user['agentSaysHeShenotInterested'].'",';
				$row .= '"'.$user['agentAbruptlyEndCall'].'",';
				$row .= '"'.$user['agentbecomeUrgumentative'].'",';
				$row .= '"'.$user['agentRecordIncirrectMedicare'].'",';
				$row .= '"'.$user['agentProvideFalseInformation'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt16'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);	
			
		}else if($pid=='curative'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['greetCustomerProperly'].'",';
				$row .= '"'.$user['useRespectfulTone'].'",';
				$row .= '"'.$user['answerInTimelyManner'].'",';
				$row .= '"'.$user['verifyCustomerInformation'].'",';
				$row .= '"'.$user['verifyPatientPHI'].'",';
				$row .= '"'.$user['accidentalIncorrectInformation'].'",';
				$row .= '"'.$user['agentEscalateTier2Correctly'].'",';
				$row .= '"'.$user['agentEnsureEmailAddress'].'",';
				$row .= '"'.$user['agentRespectPatientPrivacy'].'",';
				$row .= '"'.$user['agentSpeakConcisely'].'",';
				$row .= '"'.$user['agentAvoidInternalTerms'].'",';
				$row .= '"'.$user['agentDemonstrateEmpathyUse'].'",';
				$row .= '"'.$user['agentUsePleaseThankyou'].'",';
				$row .= '"'.$user['agentMinimizeExtendedSilence'].'",';
				$row .= '"'.$user['agentUseCorrectSentence'].'",';
				$row .= '"'.$user['agentSpeakWarmthVoice'].'",';
				$row .= '"'.$user['callerGaveAgentKUDOS'].'",';
				$row .= '"'.$user['agentDemonstrateCallerPatient'].'",';
				$row .= '"'.$user['repCompletlyCallDocument'].'",';
				$row .= '"'.$user['repConfirmCompleteClosing'].'",';
				$row .= '"'.$user['thankCallerBeforeClosing'].'",';
				$row .= '"'.$user['repDoEverythingPossible'].'",';
				$row .= '"'.$user['repAncipateCallerNeed'].'",';
				$row .= '"'.$user['agentProvideAccurateResult'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt16'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt17'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt18'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt19'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt20'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt21'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt22'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt23'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt24'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);	
			
		}else if($pid=='powerfan'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['answerCallWithin5sec'].'",';
				$row .= '"'.$user['agentIdentifySelftandCompany'].'",';
				$row .= '"'.$user['collectIntroInformation'].'",';
				$row .= '"'.$user['mainSelftAgentGiveTerms'].'",';
				$row .= '"'.$user['agentPromoteUpsell'].'",';
				$row .= '"'.$user['describedProductAccurately'].'",';
				$row .= '"'.$user['useAppropiateObjection'].'",';
				$row .= '"'.$user['askForBillingNamesOnCheck'].'",';
				$row .= '"'.$user['agentVerifyCallerUseofCheck'].'",';
				$row .= '"'.$user['askForBillingAddressForPayment'].'",';
				$row .= '"'.$user['agentVerifyShippingAddress'].'",';
				$row .= '"'.$user['orderWasSetUpAndCodedCorrectly'].'",';
				$row .= '"'.$user['askForEmailAddress'].'",';
				$row .= '"'.$user['gaveTotalAmountCharged'].'",';
				$row .= '"'.$user['gaveCorrectShippingInfo'].'",';
				$row .= '"'.$user['gaveMBGInfo'].'",';
				$row .= '"'.$user['gaveCSPhoneNumber'].'",';
				$row .= '"'.$user['permissionToAuthorizePayment'].'",';
				$row .= '"'.$user['wasAgentPolite'].'",';
				$row .= '"'.$user['agentUsingAppropiateComment'].'",';
				$row .= '"'.$user['useHoldAndTransferProperly'].'",';
				$row .= '"'.$user['power_fan_autofail'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);	
			
		}else if($pid=='nuwave'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['order_id'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['interaction'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['greeting_identification'].'",';
				$row .= '"'.$user['verified_customer'].'",';
				$row .= '"'.$user['use_caller_CSR_name'].'",';
				$row .= '"'.$user['doesnot_interrupt_customer'].'",';
				$row .= '"'.$user['converses_clear_concise_mannaer'].'",';
				$row .= '"'.$user['avoid_use_slang_jargon'].'",';
				$row .= '"'.$user['empathy_toward_customer'].'",';
				$row .= '"'.$user['CSR_sound_helpful'].'",';
				$row .= '"'.$user['gain_customer_permission'].'",';
				$row .= '"'.$user['thanks_customer_holding'].'",';
				$row .= '"'.$user['hold_time_appropiate'].'",';
				$row .= '"'.$user['utilized_established_guidelines'].'",';
				$row .= '"'.$user['use_probing_question'].'",';
				$row .= '"'.$user['verbally_verfied_problem'].'",';
				$row .= '"'.$user['manage_customer_expectation'].'",';
				$row .= '"'.$user['reason_for_troubleshooting'].'",';
				$row .= '"'.$user['use_available_resources'].'",';
				$row .= '"'.$user['complete_customer_documentation'].'",';
				$row .= '"'.$user['customer_comfortable_with_outcome'].'",';
				$row .= '"'.$user['additional_needs_uncovered'].'",';
				$row .= '"'.$user['product_served_their_needs'].'",';
				$row .= '"'.$user['used_correct_closing'].'",';
				$row .= '"'.$user['infractions'].'",';
				$row .= '"'.$user['sub_infractions'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
					
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);	
			
		}else if($pid=='delta_iowa'){
		
			foreach($rr as $user){
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$user['auditor_name'].'",';
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['call_id'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['answer_call_promptly'].'",';
				$row .= '"'.$user['open_call_property'].'",';
				$row .= '"'.$user['verify_identify_information'].'",';
				$row .= '"'.$user['adhered_HIPAA'].'",';
				$row .= '"'.$user['adhere_client_policies'].'",';
				$row .= '"'.$user['perform_correct_action'].'",';
				$row .= '"'.$user['set_appropiate_expectation'].'",';
				$row .= '"'.$user['gave_accurate_info'].'",';
				$row .= '"'.$user['routed_issue'].'",';
				$row .= '"'.$user['complete_documentation'].'",';
				$row .= '"'.$user['phrases_courtsey'].'",';
				$row .= '"'.$user['use_caller_name'].'",';
				$row .= '"'.$user['hold_and_transfer'].'",';
				$row .= '"'.$user['state_call_reason'].'",';
				$row .= '"'.$user['use_jargon'].'",';
				$row .= '"'.$user['allow_caller_speak'].'",';
				$row .= '"'.$user['positive_plan_type'].'",';
				$row .= '"'.$user['willingness_help_caller'].'",';
				$row .= '"'.$user['gained_agrrement'].'",';
				$row .= '"'.$user['emphathetic_manner'].'",';
				$row .= '"'.$user['closed_call'].'",';
				$row .= '"'.$user['resolved_customer_issue'].'",';
				$row .= '"'.$user['assure_customer_comcern'].'",';
				$row .= '"'.$user['effective_attempt'].'",';
				$row .= '"'.$user['agent_disconnect_customer'].'",';
				$row .= '"'.$user['agent_transfer_customer'].'",';
				$row .= '"'.$user['agent_use_offensive_word'].'",';
				$row .= '"'.$user['agent_talked_down_caller'].'",';
				$row .= '"'.$user['agent_disclosed_info'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt16'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt17'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt18'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt19'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt20'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt21'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt22'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt23'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt24'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt25'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt26'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt27'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt28'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt29'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);	
			
		}
		
		
	}

	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////	 
///////////////////////////////// QA AGENT COACHING REPORT ////////////////////////////////	
///////////////////////////////////////////////////////////////////////////////////////////

	public function qa_agent_coaching_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_agent_coaching_report.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$from_date="";
			$to_date="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			
			$data["qa_agent_coaching_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				// $date_from = mmddyy2mysql($this->input->get('date_from'));
				// $date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				$from_date = $this->input->get('date_from');
				$to_date = $this->input->get('date_to');
				$cond="";
				
				if($from_date==""){ 
					$from_date=CurrDate();
				}else{
					$from_date = mmddyy2mysql($from_date);
				}
				
				if($to_date==""){ 
					$to_date=CurrDate();
				}else{
					$to_date = mmddyy2mysql($to_date);
				}
				
				if($from_date !="" && $to_date!=="" )  $cond= " Where (audit_date >= '$from_date' and audit_date <= '$to_date' ) ";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
		
				$qSql="SELECT call_date,call_id,(select concat(fname, ' ', lname) from signin s where s.id=qa_coaching_mgnt_rvw.entry_by) as mgnt_name,qa_coaching_mgnt_rvw.comment as mgnt_note,qa_coaching_mgnt_rvw.entry_date as mgnt_feedback,(select office_abbr from site where site.id=(SELECT site_id from signin where id=qa_coaching_feedback.agent_id)) as site_name,(select fullname from client c where c.id=(SELECT client_id from info_assign_client where user_id=qa_coaching_feedback.agent_id)) as client_name,(select concat(fname, ' ', lname) as name from signin s where s.id=qa_coaching_feedback.entry_by) as auditor_name,audit_date,(select fusion_id from signin s where s.id=qa_coaching_feedback.agent_id) as fusion_id,(select concat(fname, ' ', lname) from signin s where s.id=qa_coaching_feedback.agent_id) as agent_name,(select concat(fname, ' ', lname) from signin s where s.id=(SELECT `assigned_to` FROM `signin` WHERE id=qa_coaching_feedback.agent_id)) as tl_name,(select name from process p where p.id=(SELECT `process_id` FROM info_assign_process as iap WHERE iap.user_id=qa_coaching_feedback.agent_id)) as process_name,(select entry_date from qa_coaching_agent_rvw qag where qag.cf_id=qa_coaching_feedback.id) as agent_feedback,(select comment from qa_coaching_agent_rvw qag where qag.cf_id=qa_coaching_feedback.id) as agent_note from qa_coaching_feedback INNER JOIN qa_coaching_mgnt_rvw on qa_coaching_feedback.id=qa_coaching_mgnt_rvw.cf_id $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				//print_r($fullAray);
				//die;
				$data["qa_agent_coaching_list"] = $fullAray;
				$this->create_qa_agent_coaching_CSV($fullAray);	
				$dn_link = base_url()."reports_qa/download_qa_agent_coaching_CSV";
				
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $from_date;
			$data['date_to'] = $to_date;	
			$data['office_id']=$office_id;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_agent_coaching_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Agent Coaching List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_agent_coaching_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent Name", "L1 Super", "Process","site", "Call ID","Agent Review Date", "Agent Comment", "Mgnt Review Date", "Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['agent_name'].'",';
			$row .= '"'.$user['tl_name'].'",';  
			$row .= '"'.$user['process_name'].'",';
			$row .= '"'.$user['site_name'].'",';
			$row .= '"'.$user['call_id'].'",'; 
			$row .= '"'.$user['agent_feedback'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", strip_tags($user['agent_note']))).'",';
			$row .= '"'.$user['mgnt_feedback'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", strip_tags($user['mgnt_note']))).'"';				
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}


	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

///////////////////////////////////////////////////////////////////////////////////////////	 
//////////////////////////////////////// QA AMAZON REPORT /////////////////////////////////
///////////////////////////////////////////////////////////////////////////////////////////

	public function qa_amazon_intake_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_amazon_intake_report.php";
			
			$office_id = $this->input->get('office_id');
			if($office_id=="")  $office_id=$user_office_id;
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			$pValue = trim($this->input->post('process_id'));
			if($pValue=="") $pValue = trim($this->input->get('process_id'));
			$data['pValue']=$pValue;
			
			$data["qa_amazon_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
				
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
				
				if($pValue=='Intake'){
					$qSql="SELECT * from
					(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, DATE_FORMAT(entry_date,'%m-%Y') AS m_Y from qa_amazon_intake_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, assigned_to from signin) yy on (xx.agent_id=yy.sid) Left join (Select fd_id, note as agent_note, date(entry_date) as agent_rvw_date from qa_amazon_intake_agent_rvw) zz on (xx.id=zz.fd_id) Left Join (Select fd_id as mgnt_fd_id, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as mgnt_name, note as mgnt_note, date(entry_date) as mgnt_rvw_date from qa_amazon_intake_mgnt_rvw) ww on (xx.id=ww.mgnt_fd_id) $cond $cond1 order by audit_date";
					
					$fullAray = $this->Common_model->get_query_result_array($qSql);
					$data["qa_amazon_list"] = $fullAray;
					$this->create_qa_amazon_intake_CSV($fullAray,$pValue);	
					$dn_link = base_url()."reports_qa/download_qa_amazon_intake_CSV/".$pValue;
				}
				if($pValue=='Question'){
					$qSql="SELECT * from
					(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name, DATE_FORMAT(entry_date,'%m-%Y') AS m_Y from qa_amazon_question_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, assigned_to from signin) yy on (xx.agent_id=yy.sid) Left join (Select fd_id, note as agent_note, date(entry_date) as agent_rvw_date from qa_amazon_question_agent_rvw) zz on (xx.id=zz.fd_id) Left Join (Select fd_id as mgnt_fd_id, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as mgnt_name, note as mgnt_note, date(entry_date) as mgnt_rvw_date from qa_amazon_question_mgnt_rvw) ww on (xx.id=ww.mgnt_fd_id) $cond $cond1 order by audit_date";
					
					$fullAray = $this->Common_model->get_query_result_array($qSql);
					$data["qa_amazon_list"] = $fullAray;
					$this->create_qa_amazon_intake_CSV($fullAray,$pValue);	
					$dn_link = base_url()."reports_qa/download_qa_amazon_intake_CSV/".$pValue;
				}				
				
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 
	
///////////////////////////Amazon Intake///////////////////////////
	public function download_qa_amazon_intake_CSV($type)
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		if($type == "Intake")
		{
			$newfile="QA Amazon Intake Audit List-'".$currDate."'.csv";
		}
		else
		{
			$newfile="QA Amazon Question Audit List-'".$currDate."'.csv";
		}
		
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_amazon_intake_CSV($rr,$type)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Review week", "Case Number", "Call ID", "Audit Date", "CM/CSR/IA Name", "Agent ID", "Site", "Follow up needed?", "Ops Manager", "Auditor Name", "Employee Status", "Product", "SECTION 1: CALL HANDLING", "SECTION 2: PERSONAL SERVICE", "SECTION 3: KNOWLEDGE", "SECTION 4: IA SPECIFIC", "Asks revelvant probing questions", "Solves problems", "Answers questions", "Addresses concerns within a timely and helpful manner", "Anticipates the callers needs and is proactive", "Informs caller what to expect during the call", "How the CM/CSR handles the call and level sets expectations", "2 min max hold time with reason for hold", "Asks permission to be placed on hold", "Hold not used more than twice", "Listens to caller to determine if referral to vendor partner is required", "Sets appropriate task based on caller need", "Confirm caller email or reg mail preference for correspondence", "Follows outbound call security measures", "Tone", "Exhibits Empathy", "Conversational vs Transactional", "Refrains from use of Jargon", "Uses coherent complete and concise sentences", "Avoids slang and inappropriate topics", "Asks appropriate questions regarding the context of the call", "Anticipates the callers needs and is proactive in handling the situation", "Conversation is solution focused", "Does not hand call off to another care/case manager", "Handles and offers opinions", "Holistic Review", "Reiterates what the call was about and indicates action items", "Confirms EE understanding", "Follows best practice measures for call validation/security", "Did they promote the use of the self service portal on the call?", "Used correct closure script", "Asked if they had other questions", "Thanked caller", "Transfered to call survey if applicable", "Claim notes reflect the content of the converstation", "Provided accurate details about eligibility", "Provider Contact Information documented accurately in 360", "Clinical Information documented accurately in 360", "360 AMZ PTO task was entered when appropriate", "Obtained EE emergency contact information", "Conducted EE Interview in the employee had time", "EE was educated accurately on the RTW process", "360 EE Interview task was thoroughly documented based on the call", "360 was correctly documented if the Provider can be contacted", "360 Work Place Injury indicator selected appropriately", "360 Leave Reason was selected appropriately", "360 was documented with applicable notes related to the case", "360 leave dates were documented correctly based on callers information", "Possible Point", "Correct Point", "Incorrect Point", "Overall Score", "1 Count of Pass", "2 Count of Pass", "3 Count of Pass", "4 Count of Pass", "Review Month/Year", "Call Summary", "Feedback", "Audit Type", "VOC", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
		
			if($user['call_probing']==1) $call_probing='Pass';
			else $call_probing=1;
			if($user['call_solve']==1) $call_solve='Pass';
			else $call_solve=1;
			if($user['call_question']==1) $call_question='Pass';
			else $call_question=1;
			if($user['call_address']==1) $call_address='Pass';
			else $call_address=1;
			if($user['call_proactive']==1) $call_proactive='Pass';
			else $call_proactive=1;
			if($user['call_inform']==1) $call_inform='Pass';
			else $call_inform=1;
			if($user['call_csr']==1) $call_csr='Pass';
			else $call_csr=1;
			if($user['call_hold']==1) $call_hold='Pass';
			else $call_hold=1;
			if($user['call_permission']==1) $call_permission='Pass';
			else $call_permission=1;
			if($user['call_twice']==1) $call_twice='Pass';
			else $call_twice=1;
			if($user['call_listen']==1) $call_listen='Pass';
			else $call_listen=1;
			if($user['call_task']==1) $call_task='Pass';
			else $call_task=1;
			if($user['call_email']==1) $call_email='Pass';
			else $call_email=1;
			if($user['call_outbound']==1) $call_outbound='Pass';
			else $call_outbound=1;
			if($user['personal_tone']==1) $personal_tone='Pass';
			else $personal_tone=1;
			if($user['personal_exhibit']==1) $personal_exhibit='Pass';
			else $personal_exhibit=1;
			if($user['personal_conversion']==1) $personal_conversion='Pass';
			else $personal_conversion=1;
			if($user['personal_refrain']==1) $personal_refrain='Pass';
			else $personal_refrain=1;
			if($user['personal_coherent']==1) $personal_coherent='Pass';
			else $personal_coherent=1;
			if($user['personal_avoid']==1) $personal_avoid='Pass';
			else $personal_avoid=1;
			if($user['knowledge_ask']==1) $knowledge_ask='Pass';
			else $knowledge_ask=1;
			if($user['knowledge_anticipate']==1) $knowledge_anticipate='Pass';
			else $knowledge_anticipate=1;
			if($user['knowledge_focus']==1) $knowledge_focus='Pass';
			else $knowledge_focus=1;
			if($user['knowledge_care']==1) $knowledge_care='Pass';
			else $knowledge_care=1;
			if($user['knowledge_handle']==1) $knowledge_handle='Pass';
			else $knowledge_handle=1;
			if($user['knowledge_holistic']==1) $knowledge_holistic='Pass';
			else $knowledge_holistic=1;
			if($user['knowledge_item']==1) $knowledge_item='Pass';
			else $knowledge_item=1;
			if($user['knowledge_confirm']==1) $knowledge_confirm='Pass';
			else $knowledge_confirm=1;
			if($user['knowledge_security']==1) $knowledge_security='Pass';
			else $knowledge_security=1;
			if($user['knowledge_promote']==1) $knowledge_promote='Pass';
			else $knowledge_promote=1;
			if($user['knowledge_script']==1) $knowledge_script='Pass';
			else $knowledge_script=1;
			if($user['knowledge_question']==1) $knowledge_question='Pass';
			else $knowledge_question=1;
			if($user['knowledge_caller']==1) $knowledge_caller='Pass';
			else $knowledge_caller=1;
			if($user['knowledge_survey']==1) $knowledge_survey='Pass';
			else $knowledge_survey=1;
			if($user['knowledge_claim']==1) $knowledge_claim='Pass';
			else $knowledge_claim=1;
			if($user['ia_eligibility']==1) $ia_eligibility='Pass';
			else $ia_eligibility=1;
			if($user['ia_contact']==1) $ia_contact='Pass';
			else $ia_contact=1;
			if($user['ia_clinical']==1) $ia_clinical='Pass';
			else $ia_clinical=1;
			if($user['ia_amz']==1) $ia_amz='Pass';
			else $ia_amz=1;
			if($user['ia_emergency']==1) $ia_emergency='Pass';
			else $ia_emergency=1;
			if($user['ia_interview']==1) $ia_interview='Pass';
			else $ia_interview=1;
			if($user['ia_rtw']==1) $ia_rtw='Pass';
			else $ia_rtw=1;
			if($user['ia_call']==1) $ia_call='Pass';
			else $ia_call=1;
			if($user['ia_provider']==1) $ia_provider='Pass';
			else $ia_provider=1;
			if($user['ia_work']==1) $ia_work='Pass';
			else $ia_work=1;
			if($user['ia_leave']==1) $ia_leave='Pass';
			else $ia_leave=1;
			if($user['ia_note']==1) $ia_note='Pass';
			else $ia_note=1;
			if($user['ia_documentation']==1) $ia_documentation='Pass';
			else $ia_documentation=1;
			
			$dateString = $user['audit_date'];
			  list($year, $month, $mday) = explode("-", $dateString);
			  $firstWday = date("w",strtotime("$year-$month-1"));
			  $week = floor(($mday + $firstWday - 1)/7) + 1;
			
			$incorrect_score = ($user['possible_score'] - $user['earned_score']);
			$call_handle = ($user['call_handle_possible'] - $user['call_handle_earned']);
			$personal_service = ($user['personal_service_possible'] - $user['personal_service_earned']);
			$knowledge = ($user['knowledge_possible'] - $user['knowledge_earned']);
			$ia_specific = ($user['ia_specific_possible'] - $user['ia_specific_earned']);
			
			$row = '"'.$week.'",';
			$row .= '"'.$user['case_no'].'",';
			$row .= '"'.$user['call_id'].'",';
			$row .= '"'.$user['audit_date'].'",';
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['fusion_id'].'",';
			$row .= '"'.$user['office_id'].'",';
			$row .= '"'.$user['followup_need'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['auditor_name'].'",';
			$row .= '"'.$user['emp_status'].'",';
			$row .= '"'.$user['product'].'",';
			$row .= '"'.$user['call_handle_score'].'",';
			$row .= '"'.$user['personal_service_score'].'",';
			$row .= '"'.$user['knowledge_score'].'",';
			$row .= '"'.$user['ia_specific_score'].'",';
			$row .= '"'.$call_probing.'",';
			$row .= '"'.$call_solve.'",';
			$row .= '"'.$call_question.'",';
			$row .= '"'.$call_address.'",';
			$row .= '"'.$call_proactive.'",';
			$row .= '"'.$call_inform.'",';
			$row .= '"'.$call_csr.'",';
			$row .= '"'.$call_hold.'",';
			$row .= '"'.$call_permission.'",';
			$row .= '"'.$call_twice.'",';
			$row .= '"'.$call_listen.'",';
			$row .= '"'.$call_task.'",';
			$row .= '"'.$call_email.'",';
			$row .= '"'.$call_outbound.'",';
			$row .= '"'.$personal_tone.'",';
			$row .= '"'.$personal_exhibit.'",';
			$row .= '"'.$personal_conversion.'",';
			$row .= '"'.$personal_refrain.'",';
			$row .= '"'.$personal_coherent.'",';
			$row .= '"'.$personal_avoid.'",';
			$row .= '"'.$knowledge_ask.'",';
			$row .= '"'.$knowledge_anticipate.'",';
			$row .= '"'.$knowledge_focus.'",';
			$row .= '"'.$knowledge_care.'",';
			$row .= '"'.$knowledge_handle.'",';
			$row .= '"'.$knowledge_holistic.'",';
			$row .= '"'.$knowledge_item.'",';
			$row .= '"'.$knowledge_confirm.'",';
			$row .= '"'.$knowledge_security.'",';
			$row .= '"'.$knowledge_promote.'",';
			$row .= '"'.$knowledge_script.'",';
			$row .= '"'.$knowledge_question.'",';
			$row .= '"'.$knowledge_caller.'",';
			$row .= '"'.$knowledge_survey.'",';
			$row .= '"'.$knowledge_claim.'",';
			$row .= '"'.$ia_eligibility.'",';
			$row .= '"'.$ia_contact.'",';
			$row .= '"'.$ia_clinical.'",';
			$row .= '"'.$ia_amz.'",';
			$row .= '"'.$ia_emergency.'",';
			$row .= '"'.$ia_interview.'",';
			$row .= '"'.$ia_rtw.'",';
			$row .= '"'.$ia_call.'",';
			$row .= '"'.$ia_provider.'",';
			$row .= '"'.$ia_work.'",';
			$row .= '"'.$ia_leave.'",';
			$row .= '"'.$ia_note.'",';
			$row .= '"'.$ia_documentation.'",';
			$row .= '"'.$user['possible_score'].'",'; 
			$row .= '"'.$user['earned_score'].'",';  
			$row .= '"'.$incorrect_score.'",'; 
			$row .= '"'.$user['overall_score']."%".'",';
			$row .= '"'.$call_handle.'",';
			$row .= '"'.$personal_service.'",';
			$row .= '"'.$knowledge.'",';
			$row .= '"'.$ia_specific.'",';
			$row .= '"'.$user['m_Y'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';				
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}	

///////////////////////////////////////////////////////////////////////////////////// 
////////////////////////////////////// QA ACM REPORT ////////////////////////////////	
/////////////////////////////////////////////////////////////////////////////////////

	public function qa_acm_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_acm_report.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			
			$data["qa_acm_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
				
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
				
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name, (select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name from qa_acm_feedback) xx Left Join (Select id as sid, fname, lname, fusion_id, office_id, get_process_names(id) as campaign, DATEDIFF(CURDATE(), doj) as tenure, assigned_to from signin) yy on (xx.agent_id=yy.sid) Left join (Select fd_id, note as agent_note, date(entry_date) as agent_rvw_date from qa_acm_agent_rvw) zz on (xx.id=zz.fd_id) Left Join (Select fd_id as mgnt_fd_id, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as mgnt_name, note as mgnt_note, date(entry_date) as mgnt_rvw_date from qa_acm_mgnt_rvw) ww on (xx.id=ww.mgnt_fd_id) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_acm_list"] = $fullAray;
				$this->create_qa_acm_CSV($fullAray);	
				$dn_link = base_url()."reports_qa/download_qa_acm_CSV";
				
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_acm_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA ACM Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_acm_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call ID", "Call Date", "Call Duration", "Claim/Policy", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Openning", "Process and Procedure", "Education", "Closing", "Voice Delivery", "listening Skills", "Communication Skills", "Customer Service", "QA Comments", "Call Summary", "Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user)
		{	
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$user['auditor_name'].'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_id'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['call_duration'].'",';
			$row .= '"'.$user['claim_policy'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'.$user['scripted_opening'].'",';
			$row .= '"'.$user['call_flow'].'",';
			$row .= '"'.$user['educate_customer'].'",';
			$row .= '"'.$user['close_script'].'",';
			$row .= '"'.$user['evident_smile'].'",';
			$row .= '"'.$user['listening_acknow'].'",';
			$row .= '"'.$user['grammer_pronoun'].'",';
			$row .= '"'.$user['ownership_polite'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['comment'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_note'])).'"';				
			
			fwrite($fopen,$row."\r\n");
		}
		
		fclose($fopen);
	}
	
	
/////////////////////////////////////////////////////////////////////////////////////
/////////////////////////////////// Zovio Follet ////////////////////////////////////	
/////////////////////////////////////////////////////////////////////////////////////
	
	public function qa_zovio_follet_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_zovio_follet_report.php";
			$data["content_js"] = "qa_ameridial_js.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$audit_type="";
			$campaign="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			$campaign = $this->input->get('campaign');
			if($campaign=="follet"){ 
				$cmp_tbl="qa_amd_follet_feedback";
			}else if($campaign=="zovio"){
				$cmp_tbl="qa_zovio_feedback";
			}
			
			$data["qa_zovio_follet_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				$audit_type = $this->input->get('audit_type');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' )";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if($audit_type=="All"){ 
					if(get_login_type()=="client"){
						$cond .= "audit_type not in ('Operation Audit','Trainer Audit')";
					}else{
						$cond .= "";
					}
				}else{ 
					$cond .=" and audit_type='$audit_type'";
				}
				
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if((get_role_dir()=='tl' && get_user_fusion_id()!='FMAN000616') && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
				
				
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from $cmp_tbl) xx Left Join
				(Select id as sid, fname, lname, fusion_id, office_id, assigned_to, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_zovio_follet_list"] = $fullAray;
				$this->create_qa_zovio_follet_CSV($fullAray,$campaign);	
				$dn_link = base_url()."reports_qa/download_qa_zovio_follet_CSV/".$campaign;	
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['audit_type']=$audit_type;
			$data['campaign']=$campaign;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_zovio_follet_CSV($campaign)
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA ".$campaign." Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_zovio_follet_CSV($rr,$campaign)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		if($campaign=='follet'){
			$header = array("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Phone","Call Date","Call Duration","File No","Audit Type","Auditor Type","VOC","Audit Start Time","Audit End Time","Interval (in second)","Overall Score ","Possible Score ","Earned Score ","Did the rep greet the caller promptly and properly? ","Did the rep use a pleasant respectful tone? ","Did the rep answer in a timely manner? ","Did the rep collect and verify the customers information appropriately and accurately? ","Did the rep correctly collect caller's work location and store phone number ","Did the agent correctly define Type of Case? ","Did the rep correctly mark the Date of Test and Expected Results? ","Did the rep correctly idently the Team Member's store location using the provided Excel sheet? ","Did the agent speak clearly concisely and at an appropriate pace? ","Did the agent demonstrate a strong use of empathy in responses where required on the call and in email? ","Did the agent use (please) and (thank you) throughout the call and in email communication? ","Did the agent minimize extended silences throughout the call? ","Did the agent speak with sincere warmth in his/her voice? ","Did the agent use correct sentence structure and grammar in email commumnication? ","Did the agent demonstrate patience with the caller on call and in email communication? ","Did the caller give the agent a KUDOS or express happiness with the rep during this call? ","Did the rep accurately and completely document the call? ","Did the rep complete the correct confirmation and closing? ","Did the rep provide the correct instructions based upon the Type of Case? ","Did the rep do everything possible to assist the caller? ","Did the rep make appropriate phone calls to managers and Health Dept ","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","Comments 8 ","Comments 9 ","Comments 10 ","Comments 11 ","Comments 12 ","Comments 13 ","Comments 14 ","Comments 15 ","Comments 16 ","Comments 17 ","Comments 18 ","Comments 19 ","Comments 20 ","Comments 21 ","Call Summary ","Feedback","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date");
		}else if($campaign=='zovio'){
			$header = array("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","Call Date","Call Number","Call Type","Caller Type","Audit Type","Auditor Type", "VOC","Audit Start Time","Audit End Time","Interval (in second)","Overall Score ","Possible Score ","Earned Score ","Did the rep greet the caller promptly and properly? ","Did the rep use a pleasant respectful tone? ","Did the rep answer in a timely manner?","Did the rep collect and verify the customers information appropriately and accurately?","Did the rep correctly collect callers work location and store phone number","Did the agent correctly define Type of Case?","Did the rep correctly mark the Date of Test and Expected Results?","2.5 Did the rep correctly record the callers address?","Did the agent speak clearly concisely and at an appropriate pace?","Did the agent demonstrate a strong use of empathy in responses where required on the call and in email? ","Did the agent use please and thank you throughout the call and in email communication?","Did the agent minimize extended silences throughout the call?","Did the agent speak with sincere warmth in his/her voice? ","Did the agent use correct sentence structure and grammar in email commumnication? ","Did the agent demonstrate patience with the caller on call and in email communication? ","Did the caller give the agent a KUDOS or express happiness with the rep during this call? ","Did the rep accurately and completely document the call? ","Did the rep complete the correct confirmation and closing? ","Did the rep provide the correct instructions based upon the Type of Case? ","Did the rep do everything possible to assist the caller? ","Did the rep make appropriate phone calls to managers and Health Dept ","Comments 1 ","Comments 2 ","Comments 3 ","Comments 4 ","Comments 5 ","Comments 6 ","Comments 7 ","Comments 8 ","Comments 9 ","Comments 10 ","Comments 11 ","Comments 12 ","Comments 13 ","Comments 14 ","Comments 15 ","Comments 16 ","Comments 17 ","Comments 18 ","Comments 19 ","Comments 20 ","Comments 21 ","Call Summary ","Feedback ","Client entry by ","Mgnt review by ","Mgnt review note ","Mgnt review date ","Agent review note ","Agent review date ","Client review by ","Client review note ","Client_rvw_date");
		}
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		if($campaign=='follet'){
		
			foreach($rr as $user){	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$auditorName.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",';
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['phone'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['file_no'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['possible_score'].'",';
				$row .= '"'.$user['earned_score'].'",';
				$row .= '"'.$user['identifynameatbeginning'].'",';
				$row .= '"'.$user['assurancetsatementverbatim'].'",';
				$row .= '"'.$user['msbFinancial'].'",';
				$row .= '"'.$user['speakingtorightparty'].'",';
				$row .= '"'.$user['SbSResolution'].'",';
				$row .= '"'.$user['demographicsinformation'].'",';
				$row .= '"'.$user['minimirandadisclosure'].'",';
				$row .= '"'.$user['statetheclientname'].'",';
				$row .= '"'.$user['askforbalancedue'].'",';
				$row .= '"'.$user['completeinformationtaken'].'",';
				$row .= '"'.$user['askforpaymentonphone'].'",';
				$row .= '"'.$user['askforpostdelaypayment'].'",';
				$row .= '"'.$user['accountforfollowupcall'].'",';
				$row .= '"'.$user['promisetopayaccount'].'",';
				$row .= '"'.$user['splitbalanceinpart'].'",';
				$row .= '"'.$user['offersumsettlement'].'",';
				$row .= '"'.$user['paymentplanwithpayment'].'",';
				$row .= '"'.$user['collectorfollowpropernegotiation'].'",';
				$row .= '"'.$user['didcerpromote'].'",';
				$row .= '"'.$user['didceranswer'].'",';
				$row .= '"'.$user['wascerproactive'].'",';
				$row .= '"'.$user['cmt1'].'",';
				$row .= '"'.$user['cmt2'].'",';
				$row .= '"'.$user['cmt3'].'",';
				$row .= '"'.$user['cmt4'].'",';
				$row .= '"'.$user['cmt5'].'",';
				$row .= '"'.$user['cmt6'].'",';
				$row .= '"'.$user['cmt7'].'",';
				$row .= '"'.$user['cmt8'].'",';
				$row .= '"'.$user['cmt9'].'",';
				$row .= '"'.$user['cmt10'].'",';
				$row .= '"'.$user['cmt11'].'",';
				$row .= '"'.$user['cmt12'].'",';
				$row .= '"'.$user['cmt13'].'",';
				$row .= '"'.$user['cmt14'].'",';
				$row .= '"'.$user['cmt15'].'",';
				$row .= '"'.$user['cmt16'].'",';
				$row .= '"'.$user['cmt17'].'",';
				$row .= '"'.$user['cmt18'].'",';
				$row .= '"'.$user['cmt19'].'",';
				$row .= '"'.$user['cmt20'].'",';
				$row .= '"'.$user['cmt21'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_date'].'",';
				$row .= '"'.$user['client_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}else if($campaign=='zovio'){
			
			foreach($rr as $user){	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$auditorName.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fusion_id'].'",';
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_no'].'",';
				$row .= '"'.$user['call_type'].'",';
				$row .= '"'.$user['caller_type'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['possible_score'].'",';
				$row .= '"'.$user['earned_score'].'",';
				$row .= '"'.$user['rep_greet_caller'].'",';
				$row .= '"'.$user['rep_use_pleasant_tone'].'",';
				$row .= '"'.$user['rep_answer_timely'].'",';
				$row .= '"'.$user['rep_collect_customer_info'].'",';
				$row .= '"'.$user['rep_collect_caller_location'].'",';
				$row .= '"'.$user['agent_define_case_type'].'",';
				$row .= '"'.$user['rep_marked_test_date'].'",';
				$row .= '"'.$user['rep_record_caller_address'].'",';
				$row .= '"'.$user['agent_speak_clearly'].'",';
				$row .= '"'.$user['agent_demonstrate_call_email'].'",';
				$row .= '"'.$user['agent_use_please_through_call'].'",';
				$row .= '"'.$user['agent_minimize_silence_on_call'].'",';
				$row .= '"'.$user['agent_speak_sincere_voice'].'",';
				$row .= '"'.$user['agent_use_correct_sentence'].'",';
				$row .= '"'.$user['agent_demonstrate_call_patience'].'",';
				$row .= '"'.$user['caller_give_agnet_KUDOS'].'",';
				$row .= '"'.$user['rep_completely_document_call'].'",';
				$row .= '"'.$user['rep_complete_closing'].'",';
				$row .= '"'.$user['rep_provide_correct_instruction'].'",';
				$row .= '"'.$user['rep_assist_the_caller'].'",';
				$row .= '"'.$user['rep_make_appropiate_contact'].'",';
				$row .= '"'.$user['cmt1'].'",';
				$row .= '"'.$user['cmt2'].'",';
				$row .= '"'.$user['cmt3'].'",';
				$row .= '"'.$user['cmt4'].'",';
				$row .= '"'.$user['cmt5'].'",';
				$row .= '"'.$user['cmt6'].'",';
				$row .= '"'.$user['cmt7'].'",';
				$row .= '"'.$user['cmt8'].'",';
				$row .= '"'.$user['cmt9'].'",';
				$row .= '"'.$user['cmt10'].'",';
				$row .= '"'.$user['cmt11'].'",';
				$row .= '"'.$user['cmt12'].'",';
				$row .= '"'.$user['cmt13'].'",';
				$row .= '"'.$user['cmt14'].'",';
				$row .= '"'.$user['cmt15'].'",';
				$row .= '"'.$user['cmt16'].'",';
				$row .= '"'.$user['cmt17'].'",';
				$row .= '"'.$user['cmt18'].'",';
				$row .= '"'.$user['cmt19'].'",';
				$row .= '"'.$user['cmt20'].'",';
				$row .= '"'.$user['cmt21'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_date'].'",';
				$row .= '"'.$user['client_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
			
		}
		
	
	}
	
	
///////////////////////////////////////////////////////////////////////////////////// 
/////////////////////////////////// QA Nuwave REPORT ////////////////////////////////	
/////////////////////////////////////////////////////////////////////////////////////

	public function qa_nuwave_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_nuwave_report.php";
			$data["content_js"] = "qa_ameridial_js.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$audit_type="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			
			$data["qa_nuwave_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				$audit_type = $this->input->get('audit_type');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' )";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if($audit_type=="All"){ 
					if(get_login_type()=="client"){
						$cond .= "audit_type not in ('Operation Audit','Trainer Audit')";
					}else{
						$cond .= "";
					}
				}else{ 
					$cond .=" and audit_type='$audit_type'";
				}
				
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if((get_role_dir()=='tl' && get_user_fusion_id()!='FMAN000616') && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
				
				
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_amd_nuwave_feedback) xx Left Join
				(Select id as sid, fname, lname, fusion_id, office_id, assigned_to, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_nuwave_list"] = $fullAray;
				$this->create_qa_nuwave_CSV($fullAray);	
				$dn_link = base_url()."reports_qa/download_qa_nuwave_CSV/";	
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['audit_type']=$audit_type;
			
			$this->load->view('dashboard',$data);
		}
	}
	
	public function download_qa_nuwave_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Nuwave Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_nuwave_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		$header = array("Auditor Name", "Audit Date", "Fusion ID", "Agent", "L1 Super", "Call Date", "File No", "Order ID", "Call Duration", "Interaction", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Greeting & Identification: Example Thank you for calling NuWave", "Asked and Verified Customer Information: May I please have your Order ID Primary name or e-mail address?", "Used the Callers Name: CSR should address the customer as he/she addresses him/herself Mr. Mrs. Dr. Rev. etc.", "Active Listening: Doesnt interrupt the customer understands customers frame of reference doesnt anticipate or make assumptions", "Communication Skills: Converses in a clear concise manner", "Professionalism: Avoids the use of slang jargon and acronyms", "Empathy Towards Customer: CSR sounds sincere about helping the customer and apologizes", "Courtesy: CSR sounds helpful upbeat friendly and patient", "Put On Hold: Asked customer May I put you on hold or Could you hold while I research this further please?", "Thanked Customer for Holding: CSR thanked customer for holding upon returning to customers call", "Hold Time/Reason Appropriate/Inappropriate: Was it really necessary for the CSR to put the customer on hold?", "Escalation/Referral Procedures: Utilized established guidelines and procedures policy from the leadership team", "Fact Finding: Used probing questions and resources to identify problem", "Verbally Verified Problem Reported: Clearly defined and restated needs reported by the customer", "Managed Customer Expectations: Regarding the order of the product and the shipping time", "Explained: Reason for troubleshooting for possible resolution", "Used Available Resources Well: Referred to knowledge training or other resource programs for order troubleshooting", "Complete & Accurate Customer Documentation: Complete description of the order and or the troubleshooting steps", "Trial Close: Confirmed customer is comfortable with outcome", "Additional Needs Uncovered: CSR asked Is there anything else that I can assist you with today?", "Upsale: Ask customer if the product completely serves their needs", "Used Correct Closing Gave Customer Order Number: Mr. Ms. Mrs. I would like to thank you for ordering with NuWave", "Infractions", "Sub-Infractions", "Call Summary", "Feedback","Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
			
		foreach($rr as $user){	
			if($user['entry_by']!=''){
				$auditorName = $user['auditor_name'];
			}else{
				$auditorName = $user['client_name'];
			}
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval = '---';
			}else{
				$interval = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$auditorName.'",';
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['file_no'].'",';
			$row .= '"'.$user['order_id'].'",';
			$row .= '"'.$user['call_duration'].'",';
			$row .= '"'.$user['interaction'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval.'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'.$user['greeting_identification'].'",';
			$row .= '"'.$user['verified_customer'].'",';
			$row .= '"'.$user['use_caller_CSR_name'].'",';
			$row .= '"'.$user['doesnot_interrupt_customer'].'",';
			$row .= '"'.$user['converses_clear_concise_mannaer'].'",';
			$row .= '"'.$user['avoid_use_slang_jargon'].'",';
			$row .= '"'.$user['empathy_toward_customer'].'",';
			$row .= '"'.$user['CSR_sound_helpful'].'",';
			$row .= '"'.$user['gain_customer_permission'].'",';
			$row .= '"'.$user['thanks_customer_holding'].'",';
			$row .= '"'.$user['hold_time_appropiate'].'",';
			$row .= '"'.$user['utilized_established_guidelines'].'",';
			$row .= '"'.$user['use_probing_question'].'",';
			$row .= '"'.$user['verbally_verfied_problem'].'",';
			$row .= '"'.$user['manage_customer_expectation'].'",';
			$row .= '"'.$user['reason_for_troubleshooting'].'",';
			$row .= '"'.$user['use_available_resources'].'",';
			$row .= '"'.$user['complete_customer_documentation'].'",';
			$row .= '"'.$user['customer_comfortable_with_outcome'].'",';
			$row .= '"'.$user['additional_needs_uncovered'].'",';
			$row .= '"'.$user['product_served_their_needs'].'",';
			$row .= '"'.$user['used_correct_closing'].'",';
			$row .= '"'.$user['infractions'].'",';
			$row .= '"'.$user['sub_infractions'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agnt_fd_acpt'].'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
			
			fwrite($fopen,$row."\r\n");
		}
		fclose($fopen);
	}
	
///////////////////////////////////////////////////////////////////////////////////// 
//////////////////////////////// QA Magnilife REPORT ////////////////////////////////	
/////////////////////////////////////////////////////////////////////////////////////

	public function qa_magnilife_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_magnilife_report.php";
			$data["content_js"] = "qa_ameridial_js.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$audit_type="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			
			$data["qa_magnilife_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				$audit_type = $this->input->get('audit_type');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' )";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if($audit_type=="All"){ 
					if(get_login_type()=="client"){
						$cond .= "audit_type not in ('Operation Audit','Trainer Audit')";
					}else{
						$cond .= "";
					}
				}else{ 
					$cond .=" and audit_type='$audit_type'";
				}
				
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if((get_role_dir()=='tl' && get_user_fusion_id()!='FMAN000616') && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
				
				
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_amd_magnilife_feedback) xx Left Join
				(Select id as sid, fname, lname, fusion_id, office_id, assigned_to, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_magnilife_list"] = $fullAray;
				$this->create_qa_magnilife_CSV($fullAray);	
				$dn_link = base_url()."reports_qa/download_qa_magnilife_CSV/";	
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['audit_type']=$audit_type;
			
			$this->load->view('dashboard',$data);
		}
	}
	
	public function download_qa_magnilife_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Magnilife Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_magnilife_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		$header = array("Auditor Name","Audit Date","Fusion Id","Agent","L1 Super","File No","Call Date","Call Duration","Audit Type","Auditor Type","VOC","disposition","Overall Score","Greeting (Agent complied with greeting mentioned Brand and call reason )","Enthusiasm (Agent sounds with enthusiasm good energy when speaking)","Clarity (Agent demonstrate a good level of grammar pronunciation pace and confidence at the time of speaking)","Professionalism (listening skills phone etiquette maintain call control and ethics agent's ethics)","Product knowledge (Agent answers product questions sounds as a product expert)","Accuracy (Agent provides accurate product information to the customer avoid providing false expectation/information to the customer)","Efficiency (Agent works effectively during the call to complete the purpose of the call )","System Knowledge (Agent demonstrates program knowledge)","Offer Information (Agents read offer information to the customer including price and features with good and clear pace)","Purchase confirmation (Agent confirms purchase information including prices provides confirmation number to the customer)","Call Summary","Feedback","Entry By","Entry Date","Client entry by","Mgnt review by","Mgnt review note","Mgnt review date","Agent Feedback Acceptance","Agent review note","Agent review date","Client review by","Client review note","Client_rvw_date");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
			
		foreach($rr as $user){	
			if($user['entry_by']!=''){
				$auditorName = $user['auditor_name'];
			}else{
				$auditorName = $user['client_name'];
			}
			
			$row = '"'.$auditorName.'",';
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fusion_id'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['file_no'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['call_duration'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['disposition'].'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'.$user['identifynameatbeginning'].'",';
			$row .= '"'.$user['assurancetsatementverbatim'].'",';
			$row .= '"'.$user['msbFinancial'].'",';
			$row .= '"'.$user['speakingtorightparty'].'",';
			$row .= '"'.$user['SbSResolution'].'",';
			$row .= '"'.$user['demographicsinformation'].'",';
			$row .= '"'.$user['minimirandadisclosure'].'",';
			$row .= '"'.$user['statetheclientname'].'",';
			$row .= '"'.$user['askforbalancedue'].'",';
			$row .= '"'.$user['completeinformationtaken'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agnt_fd_acpt'].'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
			
			fwrite($fopen,$row."\r\n");
		}
		fclose($fopen);
	}
	
////////////////////////////////////////////////////////////
////////////////////////// HSDL ////////////////////////////
////////////////////////////////////////////////////////////
	public function qa_hsdl_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_hsdl_report.php";
			$data["content_js"] = "qa_kabbage_js.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$audit_type="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			
			$data["qa_hsdl_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				$audit_type = $this->input->get('audit_type');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' )";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if($audit_type=="All"){ 
					if(get_login_type()=="client"){
						$cond .= "audit_type not in ('Operation Audit','Trainer Audit')";
					}else{
						$cond .= "";
					}
				}else{ 
					$cond .=" and audit_type='$audit_type'";
				}
				
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if((get_role_dir()=='tl' && get_user_fusion_id()!='FMAN000616') && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
				
				
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_hsdl_feedback) xx Left Join
				(Select id as sid, fname, lname, fusion_id, office_id, assigned_to, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_hsdl_list"] = $fullAray;
				$this->create_qa_hsdl_CSV($fullAray);	
				$dn_link = base_url()."reports_qa/download_qa_hsdl_CSV";	
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['audit_type']=$audit_type;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_hsdl_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA HSDL Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_hsdl_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		$header = array("Auditor Name", "Audit Date", "Agent", "Fusion ID", "L1 Super", "Call Date", "Call ID", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Earned Score", "Possible Score", "Overall Score", "Call opening meets standards of engagement", "Risk Category", "Tier Category", "T&C sent in 3-5 working days", "Risk Category", "Tier Category", "Banned practices are not used", "Risk Category", "Tier Category", "Read Manufacturer Warranty script", "Risk Category", "Tier Category", "Products and services were accurately described", "Risk Category", "Tier Category", "may used for describing replacement", "Risk Category", "Tier Category", "aim used to describe PP and replacement service", "Risk Category", "Tier Category", "Did not use Reinstate or Renew", "Risk Category", "Tier Category", "Identified signs of cover in place", "Risk Category", "Tier Category", "Followed the switch over process", "Risk Category", "Tier Category", "Good working order question asked", "Risk Category", "Tier Category", "Identifying signs of a pre-existing fault", "Risk Category", "Tier Category", "Brand name and the approximate age question asked", "Risk Category", "Tier Category", "If Brand not known asked to call in within 14 days", "Risk Category", "Tier Category", "Banned practices are not used Discount not described", "Risk Category", "Tier Category", "Agent matches product to customer needs", "Risk Category", "Tier Category", "Agent provides accurate savings information", "Risk Category", "Tier Category", "Agent confirms name address", "Risk Category", "Tier Category", "Total Cost Confirmed", "Risk Category", "Tier Category", "Agent confirms the address the card is registered at", "Risk Category", "Tier Category", "Call paused at payment details", "Risk Category", "Tier Category", "Total Cost of plan clear and understood", "Risk Category", "Tier Category", "Payment Frequency confirmed", "Risk Category", "Tier Category", "Frequency of payments clear and understood", "Risk Category", "Tier Category", "DD script read verbatim or customer is referred to a confirmation letter", "Risk Category", "Tier Category", "Payment Unsuccessful Script read", "Risk Category", "Tier Category", "T&C sent in 3-5 working days", "Risk Category", "Tier Category", "Cancellation Rights read", "Risk Category", "Tier Category", "Opt in Question asked and Opt out statement read", "Risk Category", "Tier Category", "Wording of Policy and Premium", "Risk Category", "Tier Category", "Script for limited cover read if Premium plan price declined", "Risk Category", "Tier Category", "Agent is professional throughout the call", "Risk Category", "Tier Category", "Opt in status accurately recorded", "Risk Category", "Tier Category", "Identifying clear signs of vulnerability", "Risk Category", "Tier Category", "Followed procedure for handling vulnerable customers", "Risk Category", "Tier Category", "Made clear its not insurance", "Risk Category", "Tier Category", "Company name stated 3 times in a call", "Risk Category", "Tier Category", "No facts or assumptions about a competitor stated", "Risk Category", "Tier Category", "Did not speak in a negative manor towards a competitor", "Risk Category", "Tier Category", "Sales Score", "Business Score", "Compliance Score", "Call Summary", "Feedback", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user){	
			if($user['entry_by']!=''){
				$auditorName = $user['auditor_name'];
			}else{
				$auditorName = $user['client_name'];
			}
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$auditorName.'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['fusion_id'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			//$row .= '"'.$user['customer_no'].'",';
			$row .= '"'.$user['call_id'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['earned_score'].'",';
			$row .= '"'.$user['possible_score'].'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'.$user['sales_score'].'%'.'",';
			$row .= '"'.$user['business_score'].'%'.'",';
			$row .= '"'.$user['compliance_score'].'%'.'",';
			$row .= '"'.$user['call_opening'].'",';
			$row .= '"'.$user['risk_cat1'].'",';
			$row .= '"'.$user['tier_cat1'].'",';
			$row .= '"'.$user['TC_send'].'",';
			$row .= '"'.$user['risk_cat2'].'",';
			$row .= '"'.$user['tier_cat2'].'",';
			$row .= '"'.$user['banned_practices'].'",';
			$row .= '"'.$user['risk_cat3'].'",';
			$row .= '"'.$user['tier_cat3'].'",';
			$row .= '"'.$user['read_manufacture_warranty'].'",';
			$row .= '"'.$user['risk_cat4'].'",';
			$row .= '"'.$user['tier_cat4'].'",';
			$row .= '"'.$user['product_described'].'",';
			$row .= '"'.$user['risk_cat5'].'",';
			$row .= '"'.$user['tier_cat5'].'",';
			$row .= '"'.$user['describe_replacement'].'",';
			$row .= '"'.$user['risk_cat6'].'",';
			$row .= '"'.$user['tier_cat6'].'",';
			$row .= '"'.$user['describe_PP_replacement'].'",';
			$row .= '"'.$user['risk_cat7'].'",';
			$row .= '"'.$user['tier_cat7'].'",';
			$row .= '"'.$user['not_use_reinstate'].'",';
			$row .= '"'.$user['risk_cat8'].'",';
			$row .= '"'.$user['tier_cat8'].'",';
			$row .= '"'.$user['identified_signs'].'",';
			$row .= '"'.$user['risk_cat9'].'",';
			$row .= '"'.$user['tier_cat9'].'",';
			$row .= '"'.$user['switch_over_process'].'",';
			$row .= '"'.$user['risk_cat10'].'",';
			$row .= '"'.$user['tier_cat10'].'",';
			$row .= '"'.$user['good_working_order'].'",';
			$row .= '"'.$user['risk_cat11'].'",';
			$row .= '"'.$user['tier_cat11'].'",';
			$row .= '"'.$user['preexisting_fault'].'",';
			$row .= '"'.$user['risk_cat12'].'",';
			$row .= '"'.$user['tier_cat12'].'",';
			$row .= '"'.$user['approximate_age_question'].'",';
			$row .= '"'.$user['risk_cat13'].'",';
			$row .= '"'.$user['tier_cat13'].'",';
			$row .= '"'.$user['brand_not_known_asked'].'",';
			$row .= '"'.$user['risk_cat14'].'",';
			$row .= '"'.$user['tier_cat14'].'",';
			$row .= '"'.$user['brand_practice_not_use'].'",';
			$row .= '"'.$user['risk_cat15'].'",';
			$row .= '"'.$user['tier_cat15'].'",';
			$row .= '"'.$user['agent_matches_product'].'",';
			$row .= '"'.$user['risk_cat16'].'",';
			$row .= '"'.$user['tier_cat16'].'",';
			$row .= '"'.$user['agent_provide_saving_info'].'",';
			$row .= '"'.$user['risk_cat17'].'",';
			$row .= '"'.$user['tier_cat17'].'",';
			$row .= '"'.$user['confirm_name_address'].'",';
			$row .= '"'.$user['risk_cat18'].'",';
			$row .= '"'.$user['tier_cat18'].'",';
			$row .= '"'.$user['total_cost_confirm'].'",';
			$row .= '"'.$user['risk_cat19'].'",';
			$row .= '"'.$user['tier_cat19'].'",';
			$row .= '"'.$user['confirm_registered_card'].'",';
			$row .= '"'.$user['risk_cat20'].'",';
			$row .= '"'.$user['tier_cat20'].'",';
			$row .= '"'.$user['call_paused_payment'].'",';
			$row .= '"'.$user['risk_cat21'].'",';
			$row .= '"'.$user['tier_cat21'].'",';
			$row .= '"'.$user['cost_of_plan_clear'].'",';
			$row .= '"'.$user['risk_cat22'].'",';
			$row .= '"'.$user['tier_cat22'].'",';
			$row .= '"'.$user['payment_frequency_confirm'].'",';
			$row .= '"'.$user['risk_cat23'].'",';
			$row .= '"'.$user['tier_cat23'].'",';
			$row .= '"'.$user['payment_frequency_understood'].'",';
			$row .= '"'.$user['risk_cat24'].'",';
			$row .= '"'.$user['tier_cat24'].'",';
			$row .= '"'.$user['DD_script_read_customer'].'",';
			$row .= '"'.$user['risk_cat25'].'",';
			$row .= '"'.$user['tier_cat25'].'",';
			$row .= '"'.$user['payment_unsuccessful'].'",';
			$row .= '"'.$user['risk_cat26'].'",';
			$row .= '"'.$user['tier_cat26'].'",';
			$row .= '"'.$user['TC_sent_in_3_5_days'].'",';
			$row .= '"'.$user['risk_cat27'].'",';
			$row .= '"'.$user['tier_cat27'].'",';
			$row .= '"'.$user['cancellation_rights_read'].'",';
			$row .= '"'.$user['risk_cat28'].'",';
			$row .= '"'.$user['tier_cat28'].'",';
			$row .= '"'.$user['question_asked_statement_read'].'",';
			$row .= '"'.$user['risk_cat29'].'",';
			$row .= '"'.$user['tier_cat29'].'",';
			$row .= '"'.$user['wording_of_policy_premium'].'",';
			$row .= '"'.$user['risk_cat30'].'",';
			$row .= '"'.$user['tier_cat30'].'",';
			$row .= '"'.$user['script_for_limited_cover_read'].'",';
			$row .= '"'.$user['risk_cat31'].'",';
			$row .= '"'.$user['tier_cat31'].'",';
			$row .= '"'.$user['professional_throughout_call'].'",';
			$row .= '"'.$user['risk_cat32'].'",';
			$row .= '"'.$user['tier_cat32'].'",';
			$row .= '"'.$user['status_accurately_recorded'].'",';
			$row .= '"'.$user['risk_cat33'].'",';
			$row .= '"'.$user['tier_cat33'].'",';
			$row .= '"'.$user['identify_clear_sign'].'",';
			$row .= '"'.$user['risk_cat34'].'",';
			$row .= '"'.$user['tier_cat34'].'",';
			$row .= '"'.$user['handle_vulnerable_customer'].'",';
			$row .= '"'.$user['risk_cat35'].'",';
			$row .= '"'.$user['tier_cat35'].'",';
			$row .= '"'.$user['clear_its_not_insurance'].'",';
			$row .= '"'.$user['risk_cat36'].'",';
			$row .= '"'.$user['tier_cat36'].'",';
			$row .= '"'.$user['company_name_stated_3times'].'",';
			$row .= '"'.$user['risk_cat37'].'",';
			$row .= '"'.$user['tier_cat37'].'",';
			$row .= '"'.$user['competitor_stated'].'",';
			$row .= '"'.$user['risk_cat38'].'",';
			$row .= '"'.$user['tier_cat38'].'",';
			$row .= '"'.$user['not_speak_negetive_manner'].'",';
			$row .= '"'.$user['risk_cat39'].'",';
			$row .= '"'.$user['tier_cat39'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agnt_fd_acpt'].'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
			$row .= '"'.$user['client_rvw_date'].'",';
			$row .= '"'.$user['client_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
			
			fwrite($fopen,$row."\r\n");
		}
		fclose($fopen);
	
	}
	
	
////////////////////////////////////////////////////////////////////////////
//////////////////////////////// K2 Claims /////////////////////////////////
////////////////////////////////////////////////////////////////////////////
	public function qa_k2_claims_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_k2_claims_report.php";
			$data["content_js"] = "qa_kabbage_js.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$audit_type="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			
			$data["qa_k2_claims_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				$audit_type = $this->input->get('audit_type');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' )";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if($audit_type=="All"){ 
					if(get_login_type()=="client"){
						$cond .= "audit_type not in ('Operation Audit','Trainer Audit')";
					}else{
						$cond .= "";
					}
				}else{ 
					$cond .=" and audit_type='$audit_type'";
				}
				
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if((get_role_dir()=='tl' && get_user_fusion_id()!='FMAN000616') && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
				
				
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_k2_claims_feedback) xx Left Join
				(Select id as sid, fname, lname, fusion_id, office_id, assigned_to, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_k2_claims_list"] = $fullAray;
				$this->create_qa_k2_claims_CSV($fullAray);	
				$dn_link = base_url()."reports_qa/download_qa_k2_claims_CSV";
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['audit_type']=$audit_type;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_k2_claims_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA K2 Claims Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_k2_claims_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		$header = array("Auditor Name", "Audit Date", "Agent", "Fusion ID", "L1 Super", "Call Date", "Call ID", "Claim/Policy", "Call Duration", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "OPENING", "LISTENING SKILLS", "COMMUNICATION SKILLS", "VOICE DELIVERY", "CLOSING", "FNOL Form", "CUSTOMER SERVICE", "PROCESS AND PROCEDURE", "Call Summary", "Feedback", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user){	
			if($user['entry_by']!=''){
				$auditorName = $user['auditor_name'];
			}else{
				$auditorName = $user['client_name'];
			}
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$auditorName.'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['fusion_id'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['call_id'].'",';
			$row .= '"'.$user['claim_policy'].'",';
			$row .= '"'.$user['call_duration'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'.$user['opening'].'",';
			$row .= '"'.$user['listening_skill'].'",';
			$row .= '"'.$user['communication_skill'].'",';
			$row .= '"'.$user['voice_delivary'].'",';
			$row .= '"'.$user['closing'].'",';
			$row .= '"'.$user['FNOL_from'].'",';
			$row .= '"'.$user['customer_service'].'",';
			$row .= '"'.$user['process_procedure'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agnt_fd_acpt'].'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
			$row .= '"'.$user['client_rvw_date'].'",';
			$row .= '"'.$user['client_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
			
			fwrite($fopen,$row."\r\n");
		}
		fclose($fopen);
		
	
	}
	
//////////////////////////////////////////////////////////////////////////
/////////////////////////// SHIP YOUR CAR NOW ////////////////////////////
//////////////////////////////////////////////////////////////////////////
	public function qa_sycn_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_sycn_report.php";
			$data["content_js"] = "qa_kabbage_js.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$audit_type="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			
			$data["qa_sycn_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				$audit_type = $this->input->get('audit_type');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' )";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if($audit_type=="All"){ 
					if(get_login_type()=="client"){
						$cond .= "audit_type not in ('Operation Audit','Trainer Audit')";
					}else{
						$cond .= "";
					}
				}else{ 
					$cond .=" and audit_type='$audit_type'";
				}
				
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if((get_role_dir()=='tl' && get_user_fusion_id()!='FMAN000616') && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
				
				
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_sycn_feedback) xx Left Join
				(Select id as sid, fname, lname, fusion_id, office_id, assigned_to, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_sycn_list"] = $fullAray;
				$this->create_qa_sycn_CSV($fullAray);	
				$dn_link = base_url()."reports_qa/download_qa_sycn_CSV";	
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['audit_type']=$audit_type;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_sycn_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="Ship Your Car Now Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_sycn_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		$header = array("Auditor Name", "Audit Date", "Agent", "Fusion ID", "L1 Super", "Call Date", "Caller ID", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Autofail", "Overall Score", "Customer Critical", "Business Critical", "Compliance Critical", "Did the agent welcome the carrier with the name and company?", "Did the agent acknowledge empathize and gave assurance?", "Did the agent responded appropriately and in a timely manner?", "Did the agent listen actively and intently to the carrier?", "Did the agent use correct Hold procedure?", "Was the agent polite and professional throughout the interaction and remained courteous and helpful?", "Did the agent thank the carrier and give proper closing?", "Did the agent verify that the caller is associated with the order or the person on record?", "Did the agent convey every detail of the process clearly and accurately?", "Did the agent escalate the concern as needed?", "Did the agent use good judgement and decision making while resolving or assisting the carrier?", "Did the agent leave complete notes and proper documentation?", "Did the agent follow correct or proper procedure based on company policy?", "Did the agent use correct pronunciation and proper diction?", "Was the agent easy to understand grammar?", "Call Summary", "Feedback", "Agent Acceptance Feedback", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user){	
			if($user['entry_by']!=''){
				$auditorName = $user['auditor_name'];
			}else{
				$auditorName = $user['client_name'];
			}
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$auditorName.'",'; 
			$row .= '"'.$user['audit_date'].'",'; 
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['fusion_id'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['caller_id'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['sycn_autofail'].'",';
			$row .= '"'.$user['overall_score'].'%'.'",';
			$row .= '"'.$user['customer_score'].'%'.'",';
			$row .= '"'.$user['business_score'].'%'.'",';
			$row .= '"'.$user['compliance_score'].'%'.'",';
			$row .= '"'.$user['agent_welcome_carrier'].'",';
			$row .= '"'.$user['agent_acknowledge'].'",';
			$row .= '"'.$user['agent_responded_appropiately'].'",';
			$row .= '"'.$user['agent_listen_actively'].'",';
			$row .= '"'.$user['agent_use_hold_procedure'].'",';
			$row .= '"'.$user['agent_polite_professional'].'",';
			$row .= '"'.$user['agent_thank_carrier'].'",';
			$row .= '"'.$user['agent_verify_caller'].'",';
			$row .= '"'.$user['agent_convey_every_details'].'",';
			$row .= '"'.$user['agent_escalate_concern'].'",';
			$row .= '"'.$user['agent_use_good_jugment'].'",';
			$row .= '"'.$user['agent_leave_complete_notes'].'",';
			$row .= '"'.$user['agent_follow_correct_procedure'].'",';
			$row .= '"'.$user['agent_use_correct_pronounce'].'",';
			$row .= '"'.$user['agent_understand_grammar'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
			$row .= '"'.$user['agnt_fd_acpt'].'",';
			$row .= '"'.$user['agent_rvw_date'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
			$row .= '"'.$user['mgnt_rvw_date'].'",';
			$row .= '"'.$user['mgnt_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
			$row .= '"'.$user['client_rvw_date'].'",';
			$row .= '"'.$user['client_rvw_name'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
			
			fwrite($fopen,$row."\r\n");
		}
		fclose($fopen);
	
	}
	
//////////////////////////////////////////////////////////////////////////
////////////////////////////// EDUTECH ///////////////////////////////////
//////////////////////////////////////////////////////////////////////////

/*------- CUEMATH ------*/
	public function qa_edtech_cuemath_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_edtech_cuemath_report.php";
			$data["content_js"] = "qa_kabbage_js.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$audit_type="";
			$campaign="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			$campaign = $this->input->get('campaign');
			
			$data["qa_edutech_cuemath_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				$audit_type = $this->input->get('audit_type');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' )";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if($audit_type=="All"){ 
					if(get_login_type()=="client"){
						$cond .= "audit_type not in ('Operation Audit','Trainer Audit')";
					}else{
						$cond .= "";
					}
				}else{ 
					$cond .=" and audit_type='$audit_type'";
				}
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if((get_role_dir()=='tl' && get_user_fusion_id()!='FMAN000616') && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
				
				
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_edtech_".$campaign."_feedback) xx Left Join
				(Select id as sid, fname, lname, fusion_id, office_id, assigned_to, get_process_ids(id) as process_id, get_process_names(id) as process, doj, DATEDIFF(CURDATE(), doj) as tenure from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_edutech_cuemath_list"] = $fullAray;
				$this->create_qa_edutech_CSV($fullAray,$campaign);	
				$dn_link = base_url()."reports_qa/download_qa_edutech_CSV/".$campaign;	
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['audit_type']=$audit_type;
			$data['campaign']=$campaign;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_edutech_CSV($campaign)
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA ".$campaign." Audit List-'".$currDate."'.csv";
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_edutech_CSV($rr,$campaign)
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		if($campaign=="cuemath"){
			$header = array("Auditor Name", "Audit Date", "Agent", "Fusion ID", "L1 Super", "Process", "Call Date", "Call Type", "Agent Disposition", "Disposition Validation", "Demo Scheduled", "Follow-up Call Done", "Customer interested", "Demo Scheduling Accuracy", "Demo Qualification Confirmed", "Contact Number", "Disposition Status", "Student ID", "Week", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Call opening meets standards of engagement", "Branding", "Stated the purpose of Call or Product Introduction in shown in short", "Seek Permission", "Language Preference", "Active Listening or Interruption", "Personalization", "Hold/Refreshing the hold","Dead Air/Mute on call", "**Sentence Construction & Grammar / Professionalism", "Confident & Energetic on call", "Voice Modulation/Pace level/Clear on call", "**Explain Complete & Accurate product Knowledge", "Effective Probing", "Convincing Skills/Create need", "Objection Handling & Effective rebuttals", "**Data Capturing", "**Resummarization Mandatory information", "Proper closing", "**Dispositon", "Call Summary", "Feedback", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		}else if($campaign=="cuemath_hygiene"){
			$header = array("Hygiene Audit Type", "Audit Date", "MSISDN", "Agent Name", "Fusion ID", "L1 Super", "Call Date", "Process", "Call Duration", "Disposition Selected", "Correct Disposition", "Valid/Invalid", "Call back date and time captured", "Followup done", "Demo Status", "DEMO Schedule as per the customer convience time or Requeird by us", "Conversation probality", "Alternate number Pitching or not", "ACPT", "L1", "Audit Observations", "VOC", "Auditor Name", "DoJ", "Today", "AON Days", "Tenurity", "Week", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		}else if($campaign=="cuemath_new"){
			$header = array("Auditor Name", "Audit Date", "Agent", "Fusion ID", "L1 Super", "Process", "Call Date", "Call Duration", "Call Type", "Agent Disposition", "Correct Disposition", "Customer interested", "Demo Status", "Invalid Reasons", "Contact Number", "Disposition Status", "Student ID", "Week", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Professionalism", "Time Duration Stamp with Remarks", "Data Capturing", "Time Duration Stamp with Remarks", "Resummarization", "Time Duration Stamp with Remarks", "Dispositon", "Time Duration Stamp with Remarks", "L1 Defect", "L2 Defect", "Call Summary", "Feedback", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		}else if($campaign=="cuemath_script"){
			$header = array("Auditor Name", "Audit Date", "Agent", "Fusion ID", "L1 Super", "Process", "Call Date", "Call Duration", "Phone Number", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Possible Score", "Earned Score", "Overall Score", "Greeting & Self Introduction with Company name", "Branding & Probing", "Hook Line", "Neutral Accents", "Mirror & Match", "City/State Phone Number Time Zone Parent Availibility", "Proposing date & time curriculum", "Student Name Grade Email ID Alternate contact number", "Session Brief", "Mandatory Information", "Summarization", "Take Aways of the session", "Opt in to be confirmed", "Convincing Skills/Creating need", "Objection Handling & Effective rebuttals", "Proper closing", "Proper Closing of NIs", "Dispositon", "Call Opening Remarks1", "Call Opening Remarks2", "Call Opening Remarks3", "Call Handeling Skill Remarks1", "Call Handeling Skill Remarks2", "Data Capturing Remarks1", "Data Capturing Remarks2", "Data Capturing Remarks3", "Correct And complete Information Remarks", "Mandatory information Remarks1", "Mandatory information Remarks2", "Mandatory information Remarks3", "Mandatory information Remarks4", "Selling Skill Remarks1", "Selling Skill Remarks2", "Closing Remarks1", "Closing Remarks2", "Closing Remarks3", "Demo Status", "Invalid Reasons", "L1", "L2", "Call Observation", "ACPT", "ACPT Reason", "Script Adherence", "Disposition Selected", "Customer Feedback on Opt IN", "Ethnicity", "NI Analysis", "Lead source", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		}
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		if($campaign=="cuemath")
		{
			foreach($rr as $user){	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$auditorName.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['fusion_id'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['process'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_type'].'",';
				$row .= '"'.$user['agent_disposition'].'",';
				$row .= '"'.$user['correct_disposition'].'",';
				$row .= '"'.$user['demo_schld'].'",';
				$row .= '"'.$user['call_followup'].'",';
				$row .= '"'.$user['customer_interest'].'",';
				$row .= '"'.$user['schdl_accuracy'].'",';
				$row .= '"'.$user['demo_qualification'].'",';
				$row .= '"'.$user['contact_no'].'",';
				$row .= '"'.$user['disposition_status'].'",';
				$row .= '"'.$user['student_id'].'",';
				$row .= '"'.$user['week'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['greeting'].'",';
				$row .= '"'.$user['branding'].'",';
				$row .= '"'.$user['call_started_purpose'].'",';
				$row .= '"'.$user['seek_permission'].'",';
				$row .= '"'.$user['language_preference'].'",';
				$row .= '"'.$user['active_listening'].'",';
				$row .= '"'.$user['personalization'].'",';
				$row .= '"'.$user['hold_refreshing'].'",';
				$row .= '"'.$user['mute_dead_air'].'",';
				$row .= '"'.$user['grammer_sentence'].'",';
				$row .= '"'.$user['energetic_on_call'].'",';
				$row .= '"'.$user['voice_modulation'].'",';
				$row .= '"'.$user['explain_product_knowledge'].'",';
				$row .= '"'.$user['effective_probing'].'",';
				$row .= '"'.$user['convincing_skill'].'",';
				$row .= '"'.$user['objection_handling'].'",';
				$row .= '"'.$user['data_capturing'].'",';
				$row .= '"'.$user['resummarization'].'",';
				$row .= '"'.$user['proper_closing'].'",';
				$row .= '"'.$user['disposition'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_date'].'",';
				$row .= '"'.$user['client_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		}
		else if($campaign=="cuemath_hygiene")
		{
			foreach($rr as $user){	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				if($user['go_live_date']=="" || $user['go_live_date']=='0000-00-00'){
					$aon_interval = '---';
				}else{	
					$aon_interval = ((strtotime($currDate) - strtotime($user['go_live_date']))/86400);
				}
				
				$row = '"'.$user['hygiene_audit_type'].'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['msisdn'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['fusion_id'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['process'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['disposition'].'",';
				$row .= '"'.$user['correct_disposition'].'",';
				$row .= '"'.$user['valid_invalid'].'",';
				$row .= '"'.$user['call_back_date_capture'].'",';
				$row .= '"'.$user['followup_done'].'",';
				$row .= '"'.$user['demo_status'].'",';
				$row .= '"'.$user['customer_demo_schedule'].'",';
				$row .= '"'.$user['conversation_probality'].'",';
				$row .= '"'.$user['number_pitching'].'",';
				$row .= '"'.$user['acpt'].'",';
				$row .= '"'.$user['l1'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['failure_reason1'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['failure_reason2'])).'",';
				$row .= '"'.$auditorName.'",';
				$row .= '"'.$user['doj'].'",';
				$row .= '"'.$currDate.'",';
				$row .= '"'.$aon_interval.'",';
				$row .= '"'.$user['tenure'].'",';
				$row .= '"'.$user['week'].'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_date'].'",';
				$row .= '"'.$user['client_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		}
		else if($campaign=="cuemath_new")
		{
			foreach($rr as $user){	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$auditorName.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['fusion_id'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['process'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['call_type'].'",';
				$row .= '"'.$user['agent_disposition'].'",';
				$row .= '"'.$user['correct_disposition'].'",';
				$row .= '"'.$user['customer_interest'].'",';
				$row .= '"'.$user['schdl_accuracy'].'",';
				$row .= '"'.$user['invalid_reason'].'",';
				$row .= '"'.$user['contact_no'].'",';
				$row .= '"'.$user['disposition_status'].'",';
				$row .= '"'.$user['student_id'].'",';
				$row .= '"'.$user['week'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['professionalism'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['professionalism_remarks'])).'",';
				$row .= '"'.$user['data_capturing'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['data_capturing_remarks'])).'",';
				$row .= '"'.$user['resummarization'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['resummarization_remarks'])).'",';
				$row .= '"'.$user['disposition'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['disposition_remarks'])).'",';
				$row .= '"'.$user['l1'].'",';
				$row .= '"'.$user['l2'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_date'].'",';
				$row .= '"'.$user['client_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		}
		else if($campaign=="cuemath_script")
		{
			foreach($rr as $user){	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$auditorName.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['fusion_id'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['process'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['phone_no'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['possible_score'].'",';
				$row .= '"'.$user['earned_score'].'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['greeting_self_introduction'].'",';
				$row .= '"'.$user['branding_probing'].'",';
				$row .= '"'.$user['hook_line'].'",';
				$row .= '"'.$user['natural_accents'].'",';
				$row .= '"'.$user['mirror_match'].'",';
				$row .= '"'.$user['state_phone_number'].'",';
				$row .= '"'.$user['proposing_date_time'].'",';
				$row .= '"'.$user['student_name_grade'].'",';
				$row .= '"'.$user['session_brief'].'",';
				$row .= '"'.$user['mandatory_information'].'",';
				$row .= '"'.$user['summarization'].'",';
				$row .= '"'.$user['session_take_away'].'",';
				$row .= '"'.$user['confirm_opt'].'",';
				$row .= '"'.$user['convincing_skill'].'",';
				$row .= '"'.$user['objection_handling'].'",';
				$row .= '"'.$user['proper_closing'].'",';
				$row .= '"'.$user['proper_NIS_closing'].'",';
				$row .= '"'.$user['disposition'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt1'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt2'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt3'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt4'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt5'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt6'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt7'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt8'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt9'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt10'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt11'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt12'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt13'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt14'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt15'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt16'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt17'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['cmt18'])).'",';
				$row .= '"'.$user['demo_status'].'",';
				$row .= '"'.$user['cuemath_invalid_reason'].'",';
				$row .= '"'.$user['l1'].'",';
				$row .= '"'.$user['l2'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'.$user['acpt'].'",';
				$row .= '"'.$user['acpt_reason'].'",';
				$row .= '"'.$user['script_adherence'].'",';
				$row .= '"'.$user['disposition_selected'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['customer_opt_feedback'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['ethnicity'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['ni_analysis'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['lead_source'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_date'].'",';
				$row .= '"'.$user['client_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		}
	
	}
	
/*------- LIDO ------*/
	public function qa_edtech_lido_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_edtech_lido_report.php";
			$data["content_js"] = "qa_kabbage_js.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$audit_type="";
			$campaign="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			$campaign = $this->input->get('campaign');
			
			$data["qa_edutech_lido_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				$audit_type = $this->input->get('audit_type');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' )";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if($audit_type=="All"){ 
					if(get_login_type()=="client"){
						$cond .= "audit_type not in ('Operation Audit','Trainer Audit')";
					}else{
						$cond .= "";
					}
				}else{ 
					$cond .=" and audit_type='$audit_type'";
				}
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if((get_role_dir()=='tl' && get_user_fusion_id()!='FMAN000616') && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
				
				
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_edtech_".$campaign."_feedback) xx Left Join
				(Select id as sid, fname, lname, fusion_id, office_id, assigned_to, get_process_ids(id) as process_id, get_process_names(id) as process, doj, DATEDIFF(CURDATE(), doj) as tenure from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_edutech_lido_list"] = $fullAray;
				$this->create_qa_lido_CSV($fullAray,$campaign);	
				$dn_link = base_url()."reports_qa/download_qa_lido_CSV/".$campaign;	
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['audit_type']=$audit_type;
			$data['campaign']=$campaign;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_lido_CSV($campaign)
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA ".$campaign." Audit List-'".$currDate."'.csv";
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_lido_CSV($rr,$campaign)
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		if($campaign=="lido"){
			$header = array("Auditor Name", "Audit Date", "Agent", "Fusion ID", "L1 Super", "Process", "Call Date", "Call Type", "Agent Disposition", "Disposition Validation", "Demo Scheduled", "Follow-up Call Done", "Customer interested", "Demo Scheduling Accuracy", "Demo Qualification Confirmed", "Contact Number", "Disposition Status", "Student ID", "Week", "Audit Type", "VOC", "Audit Start Date Time", "Audit End Date Time", "Interval(In Second)", "Overall Score", "Call opening meets standards of engagement", "Branding", "Stated the purpose of Call or Product Introduction in shown in short", "Seek Permission", "Language Preference", "Active Listening or Interruption", "Personalization", "Hold/Refreshing the hold","Dead Air/Mute on call", "**Sentence Construction & Grammar / Professionalism", "Confident & Energetic on call", "Voice Modulation/Pace level/Clear on call", "**Explain Complete & Accurate product Knowledge", "Effective Probing", "Convincing Skills/Create need", "Objection Handling & Effective rebuttals", "**Data Capturing", "**Resummarization Mandatory information", "Proper closing", "**Dispositon", "Call Summary", "Feedback", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		}else if($campaign=="lido_hygiene"){
			$header = array("Hygiene Audit Type", "Audit Date", "MSISDN", "Agent Name", "Fusion ID", "L1 Super", "Call Date", "Process", "Call Duration", "Disposition Selected", "Correct Disposition", "Valid/Invalid", "Call back date and time captured", "Followup done", "Demo Status", "DEMO Schedule as per the customer convience time or Requeird by us", "Conversation probality", "Alternate number Pitching or not", "ACPT", "L1", "Audit Observations", "VOC", "Auditor Name", "DoJ", "Today", "AON Days", "Tenurity", "Week", "Agent Feedback Acceptance", "Agent Review Date", "Agent Comment", "Mgnt Review Date","Mgnt Review By", "Mgnt Comment", "Client Review Date", "Client Review Name", "Client Review Note");
		}
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		if($campaign=="lido")
		{
			foreach($rr as $user){	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
					$interval1 = '---';
				}else{
					$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
				}
				
				$row = '"'.$auditorName.'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['fusion_id'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['process'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['call_type'].'",';
				$row .= '"'.$user['agent_disposition'].'",';
				$row .= '"'.$user['correct_disposition'].'",';
				$row .= '"'.$user['demo_schld'].'",';
				$row .= '"'.$user['call_followup'].'",';
				$row .= '"'.$user['customer_interest'].'",';
				$row .= '"'.$user['schdl_accuracy'].'",';
				$row .= '"'.$user['demo_qualification'].'",';
				$row .= '"'.$user['contact_no'].'",';
				$row .= '"'.$user['disposition_status'].'",';
				$row .= '"'.$user['student_id'].'",';
				$row .= '"'.$user['week'].'",';
				$row .= '"'.$user['audit_type'].'",';
				$row .= '"'.$user['voc'].'",';
				$row .= '"'.$user['audit_start_time'].'",';
				$row .= '"'.$user['entry_date'].'",';
				$row .= '"'.$interval1.'",';
				$row .= '"'.$user['overall_score'].'%'.'",';
				$row .= '"'.$user['greeting'].'",';
				$row .= '"'.$user['branding'].'",';
				$row .= '"'.$user['call_started_purpose'].'",';
				$row .= '"'.$user['seek_permission'].'",';
				$row .= '"'.$user['language_preference'].'",';
				$row .= '"'.$user['active_listening'].'",';
				$row .= '"'.$user['personalization'].'",';
				$row .= '"'.$user['hold_refreshing'].'",';
				$row .= '"'.$user['mute_dead_air'].'",';
				$row .= '"'.$user['grammer_sentence'].'",';
				$row .= '"'.$user['energetic_on_call'].'",';
				$row .= '"'.$user['voice_modulation'].'",';
				$row .= '"'.$user['explain_product_knowledge'].'",';
				$row .= '"'.$user['effective_probing'].'",';
				$row .= '"'.$user['convincing_skill'].'",';
				$row .= '"'.$user['objection_handling'].'",';
				$row .= '"'.$user['data_capturing'].'",';
				$row .= '"'.$user['resummarization'].'",';
				$row .= '"'.$user['proper_closing'].'",';
				$row .= '"'.$user['disposition'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['call_summary'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['feedback'])).'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_date'].'",';
				$row .= '"'.$user['client_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		}
		else if($campaign=="lido_hygiene")
		{
			foreach($rr as $user){	
				if($user['entry_by']!=''){
					$auditorName = $user['auditor_name'];
				}else{
					$auditorName = $user['client_name'];
				}
				
				if($user['go_live_date']=="" || $user['go_live_date']=='0000-00-00'){
					$aon_interval = '---';
				}else{	
					$aon_interval = ((strtotime($currDate) - strtotime($user['go_live_date']))/86400);
				}
				
				$row = '"'.$user['hygiene_audit_type'].'",'; 
				$row .= '"'.$user['audit_date'].'",'; 
				$row .= '"'.$user['msisdn'].'",'; 
				$row .= '"'.$user['fname']." ".$user['lname'].'",';
				$row .= '"'.$user['fusion_id'].'",';
				$row .= '"'.$user['tl_name'].'",';
				$row .= '"'.$user['call_date'].'",';
				$row .= '"'.$user['process'].'",';
				$row .= '"'.$user['call_duration'].'",';
				$row .= '"'.$user['disposition'].'",';
				$row .= '"'.$user['correct_disposition'].'",';
				$row .= '"'.$user['valid_invalid'].'",';
				$row .= '"'.$user['call_back_date_capture'].'",';
				$row .= '"'.$user['followup_done'].'",';
				$row .= '"'.$user['demo_status'].'",';
				$row .= '"'.$user['customer_demo_schedule'].'",';
				$row .= '"'.$user['conversation_probality'].'",';
				$row .= '"'.$user['number_pitching'].'",';
				$row .= '"'.$user['acpt'].'",';
				$row .= '"'.$user['l1'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['failure_reason1'])).'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['failure_reason2'])).'",';
				$row .= '"'.$auditorName.'",';
				$row .= '"'.$user['doj'].'",';
				$row .= '"'.$currDate.'",';
				$row .= '"'.$aon_interval.'",';
				$row .= '"'.$user['tenure'].'",';
				$row .= '"'.$user['week'].'",';
				$row .= '"'.$user['agnt_fd_acpt'].'",';
				$row .= '"'.$user['agent_rvw_date'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_rvw_note'])).'",';
				$row .= '"'.$user['mgnt_rvw_date'].'",';
				$row .= '"'.$user['mgnt_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['mgnt_rvw_note'])).'",';
				$row .= '"'.$user['client_rvw_date'].'",';
				$row .= '"'.$user['client_rvw_name'].'",';
				$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['client_rvw_note'])).'"';
				
				fwrite($fopen,$row."\r\n");
			}
			fclose($fopen);
		}
	
	}
	
	
///////////////////////////////////////////////////////////////////////////////////// 
///////////////////////////////// QA Hygiene REPORT /////////////////////////////////	
/////////////////////////////////////////////////////////////////////////////////////

	public function qa_hygiene_report(){
		if(check_logged_in()){
			$user_office_id=get_user_office_id();
			$current_user = get_user_id();
			$is_global_access=get_global_access();
			$role_dir=get_role_dir();
			$data["show_download"] = false;
			$data["download_link"] = "";
			$data["show_table"] = false;
			$data["show_table"] = false;
			$data["aside_template"] = "reports_qa/aside.php";
			$data["content_template"] = "reports_qa/qa_hygiene_report.php";
			$data["content_js"] = "qa_metropolis_js.php";
			
			$data['location_list'] = $this->Common_model->get_office_location_list();
			
			$qSql="Select s.id, s.fusion_id, s.office_id, s.role_id, s.dept_id, s.status, iap.user_id, iap.process_id, p.id as pid, p.name, p.is_active, o.abbr, o.location from signin s left join info_assign_process iap on s.id=iap.user_id left join process p on p.id=iap.process_id left join office_location o on o.abbr=s.office_id where office_id in ('KOL','HWH','BLR','CHE','MUM','NOI') and role_id in (select id from role where folder ='agent') and dept_id=6 and iap.process_id!=0 and p.is_active=1 group by p.name order by p.name";
			$data["process"] = $this->Common_model->get_query_result_array($qSql);
			
			$office_id = "";
			$date_from="";
			$date_to="";
			$process_id="";
			$action="";
			$dn_link="";
			$cond="";
			$cond1="";
			
			
			$data["qa_hygiene_list"] = array();
			
			if($this->input->get('show')=='Show')
			{
				$date_from = mmddyy2mysql($this->input->get('date_from'));
				$date_to = mmddyy2mysql($this->input->get('date_to'));
				$office_id = $this->input->get('office_id');
				$process_id = $this->input->get('process_id');
				
				if($date_from !="" && $date_to!=="" )  $cond= " Where (audit_date >= '$date_from' and audit_date <= '$date_to' ) ";
		
				if($office_id=="All") $cond .= "";
				else $cond .=" and office_id='$office_id'";
				
				if($process_id=="All") $cond .= "";
				else $cond .=" and process_id='$process_id'";
				
				if(get_role_dir()=='manager' && get_dept_folder()=='operations'){
					$cond1 .=" And (assigned_to='$current_user' OR assigned_to in (SELECT id FROM signin where assigned_to ='$current_user'))";
				}else if(get_role_dir()=='tl' && get_dept_folder()=='operations'){
					$cond1 .=" And assigned_to='$current_user'";
				}else{
					$cond1 .="";
				}
		
				$qSql="SELECT * from
				(Select *, (select concat(fname, ' ', lname) as name from signin s where s.id=entry_by) as auditor_name,
				(select concat(fname, ' ', lname) as name from signin_client sc where sc.id=client_entryby) as client_name,
				(select concat(fname, ' ', lname) as name from signin s where s.id=tl_id) as tl_name,
				(select concat(fname, ' ', lname) as name from signin sx where sx.id=mgnt_rvw_by) as mgnt_rvw_name,
				(select concat(fname, ' ', lname) as name from signin_client scx where scx.id=client_rvw_by) as client_rvw_name from qa_hygiene_feedback) xx Left Join
				(Select id as sid, fname, lname, fusion_id, office_id, assigned_to, get_process_ids(id) as process_id, get_process_names(id) as campaign from signin) yy on (xx.agent_id=yy.sid) $cond $cond1 order by audit_date";
				
				$fullAray = $this->Common_model->get_query_result_array($qSql);
				$data["qa_hygiene_list"] = $fullAray;
				$this->create_qa_hygiene_CSV($fullAray);	
				$dn_link = base_url()."reports_qa/download_qa_hygiene_CSV";	
			}
			
			$data['download_link']=$dn_link;
			$data["action"] = $action;	
			$data['date_from'] = $date_from;
			$data['date_to'] = $date_to;	
			$data['office_id']=$office_id;
			$data['process_id']=$process_id;
			
			$this->load->view('dashboard',$data);
		}
	}	
	 

	public function download_qa_hygiene_CSV()
	{
		$currDate=date("Y-m-d");
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$newfile="QA Hygiene Audit List-'".$currDate."'.csv";
		
		header('Content-Disposition: attachment;  filename="'.$newfile.'"');
		readfile($filename);
	}
	
	public function create_qa_hygiene_CSV($rr)
	{
		$filename = "./assets/reports/Report".get_user_id().".csv";
		$fopen = fopen($filename,"w+");
		
		$header = array("Fusion ID", "Name", "Team Leader", "QA", "Call Date", "Audit Date", "Guest Calling number", "Audit Type", "VOC", "OCOP Pitching", "Urgency", "Payment Status", "FCL Pitching", "Audit Start Date/Time", "Audit End Date/Time", "Interval (in sec)", "Authenticity", "Reason", "Call Complete By", "Calling Reason", "ACPT", "L1", "L2", "Agent Disposition", "Correct Disposition", "Observation", "Week");
		
		$row = "";
		foreach($header as $data) $row .= ''.$data.',';
		fwrite($fopen,rtrim($row,",")."\r\n");
		$searches = array("\r", "\n", "\r\n");
		
		foreach($rr as $user){	
			if($user['entry_by']!=''){
				$auditorName = $user['auditor_name'];
			}else{
				$auditorName = $user['client_name'];
			}
			
			if($user['audit_start_time']=="" || $user['audit_start_time']=='0000-00-00 00:00:00'){
				$interval1 = '---';
			}else{
				$interval1 = strtotime($user['entry_date']) - strtotime($user['audit_start_time']);
			}
			
			$row = '"'.$user['fusion_id'].'",';
			$row .= '"'.$user['fname']." ".$user['lname'].'",';
			$row .= '"'.$user['tl_name'].'",';
			$row .= '"'.$auditorName.'",'; 
			$row .= '"'.$user['call_date'].'",';
			$row .= '"'.$user['audit_date'].'",';
			$row .= '"'.$user['guest_call_no'].'",';
			$row .= '"'.$user['audit_type'].'",';
			$row .= '"'.$user['voc'].'",';
			$row .= '"'.$user['ocop_picth'].'",';
			$row .= '"'.$user['urgency'].'",';
			$row .= '"'.$user['payment_status'].'",';
			$row .= '"'.$user['fcl_pitch'].'",';
			$row .= '"'.$user['audit_start_time'].'",';
			$row .= '"'.$user['entry_date'].'",';
			$row .= '"'.$interval1.'",';
			$row .= '"'.$user['authenticity'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['authenticity_reason'])).'",';
			$row .= '"'.$user['call_complete_by'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['calling_reason'])).'",';
			$row .= '"'.$user['acpt'].'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['l1'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['l2'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['agent_dispo'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['correct_dispo'])).'",';
			$row .= '"'. str_replace('"',"'",str_replace($searches, "", $user['observation'])).'",';
			$row .= '"'.$user['week'].'",';
			
			fwrite($fopen,$row."\r\n");
		}
		fclose($fopen);
	}
	

/////////////////////////////////////////////////////	
 }